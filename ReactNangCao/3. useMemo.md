# useMemo

ChÃºng ta dÃ¹ng `useMemo` khi chÃºng ta muá»‘n má»™t biáº¿n khÃ´ng bá»‹ lÃ m má»›i láº¡i má»—i láº§n component re-render

```jsx
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

`useMemo` nháº­n vÃ o cÃ¡c dependency Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cÃ³ cháº¡y callback hay khÃ´ng tÆ°Æ¡ng tá»± nhÆ° bÃªn `useEffect`

## Äá»‹nh nghÄ©a useMemo chi tiáº¿t vÃ  dá»… hiá»ƒu nháº¥t:

- useMemo lÃ  má»™t hook cá»§a React, nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t khi tÃ­nh toÃ¡n cÃ¡c giÃ¡ trá»‹ phá»©c táº¡p trong functional component.

- Khi báº¡n tÃ­nh toÃ¡n má»™t giÃ¡ trá»‹ phá»©c táº¡p trong má»™t functional component, má»—i khi component re-render thÃ¬ giÃ¡ trá»‹ Ä‘Ã³ sáº½ bá»‹ tÃ­nh toÃ¡n láº¡i, dáº«n Ä‘áº¿n tá»‘n nhiá»u tÃ i nguyÃªn vÃ  lÃ m cháº­m hiá»‡u suáº¥t cá»§a á»©ng dá»¥ng. VÃ¬ váº­y, useMemo Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giá»¯ láº¡i giÃ¡ trá»‹ tÃ­nh toÃ¡n vÃ  sá»­ dá»¥ng láº¡i nÃ³ náº¿u cÃ¡c Ä‘á»‘i sá»‘ khÃ´ng thay Ä‘á»•i.

- CÃ¡ch sá»­ dá»¥ng useMemo lÃ  báº¡n truyá»n vÃ o má»™t hÃ m vÃ  má»™t máº£ng cÃ¡c giÃ¡ trá»‹ Ä‘á»‘i sá»‘. useMemo sáº½ tráº£ vá» káº¿t quáº£ cá»§a hÃ m tÃ­nh toÃ¡n, náº¿u cÃ¡c giÃ¡ trá»‹ Ä‘á»‘i sá»‘ khÃ´ng thay Ä‘á»•i, giÃ¡ trá»‹ tráº£ vá» Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  sá»­ dá»¥ng láº¡i trong cÃ¡c láº§n re-render tiáº¿p theo.

- VÃ­ dá»¥, náº¿u báº¡n cÃ³ má»™t component sá»­ dá»¥ng má»™t máº£ng dá»¯ liá»‡u Ä‘á»ƒ tÃ­nh toÃ¡n sá»‘ lÆ°á»£ng pháº§n tá»­ vÃ  báº¡n muá»‘n giá»¯ láº¡i giÃ¡ trá»‹ tÃ­nh toÃ¡n Ä‘á»ƒ sá»­ dá»¥ng láº¡i trong cÃ¡c láº§n re-render tiáº¿p theo, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng useMemo nhÆ° sau:

```jsx
import React, { useMemo } from "react";

function MyComponent({ data }) {
  const count = useMemo(() => {
    console.log("counting...");
    return data.length;
  }, [data]);

  return <p>There are {count} elements in the data.</p>;
}
```

- ğŸ‘‰ á» Ä‘Ã¢y, hÃ m Ä‘Æ°á»£c truyá»n vÃ o `useMemo` sáº½ Ä‘Æ°á»£c gá»i Ä‘á»ƒ tÃ­nh toÃ¡n giÃ¡ trá»‹ cá»§a biáº¿n `count`. Náº¿u máº£ng `data` khÃ´ng thay Ä‘á»•i giá»¯a cÃ¡c láº§n render, giÃ¡ trá»‹ cá»§a `count` sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  sá»­ dá»¥ng láº¡i trong cÃ¡c láº§n re-render tiáº¿p theo.

## ChÃºng ta dÃ¹ng `useMemo` khi chÃºng ta muá»‘n má»™t `biáº¿n` khÃ´ng bá»‹ lÃ m má»›i láº¡i má»—i láº§n component re-render cÃ¢u nÃ y Ä‘Ãºng hay sai ?

- ğŸ‘‰ CÃ¢u nÃ y Ä‘Ãºng. `useMemo` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ trÃ¡nh tÃ­nh toÃ¡n láº·p láº¡i má»™t giÃ¡ trá»‹ khi má»™t component re-render, giÃºp tÄƒng hiá»‡u suáº¥t cá»§a á»©ng dá»¥ng. Khi sá»­ dá»¥ng `useMemo`, giÃ¡ trá»‹ Ä‘Æ°á»£c tÃ­nh toÃ¡n má»™t láº§n vÃ  Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› Ä‘áº¿n khi má»™t trong cÃ¡c giÃ¡ trá»‹ phá»¥ thuá»™c thay Ä‘á»•i, khi Ä‘Ã³ giÃ¡ trá»‹ má»›i sáº½ Ä‘Æ°á»£c tÃ­nh toÃ¡n láº¡i.

## Táº¡i sao láº¡i lÃ  1 biáº¿n mÃ  khÃ´ng pháº£i thá»© khÃ¡c ?

- ğŸ‘‰ `useMemo` cho phÃ©p chÃºng ta táº¡o ra má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c tÃ­nh toÃ¡n trÆ°á»›c vÃ  lÆ°u láº¡i trong bá»™ nhá»›, vÃ  giÃ¡ trá»‹ nÃ y sáº½ khÃ´ng bá»‹ tÃ­nh toÃ¡n láº¡i trong cÃ¡c láº§n re-render tiáº¿p theo cá»§a component náº¿u cÃ¡c giÃ¡ trá»‹ dependencies khÃ´ng thay Ä‘á»•i. GiÃ¡ trá»‹ nÃ y cÃ³ thá»ƒ lÃ  báº¥t cá»© thá»© gÃ¬, tá»« má»™t giÃ¡ trá»‹ Ä‘Æ¡n giáº£n Ä‘áº¿n má»™t object hoáº·c má»™t máº£ng.

- ğŸ‘‰ Do Ä‘Ã³, khi chÃºng ta sá»­ dá»¥ng `useMemo`, chÃºng ta thÆ°á»ng táº¡o ra má»™t biáº¿n Ä‘á»ƒ lÆ°u trá»¯ giÃ¡ trá»‹ tÃ­nh toÃ¡n trÆ°á»›c Ä‘Ã³. Khi component re-render, giÃ¡ trá»‹ nÃ y sáº½ Ä‘Æ°á»£c tráº£ vá» thay vÃ¬ tÃ­nh toÃ¡n láº¡i tá»« Ä‘áº§u.

## ÄÃ¢y lÃ  má»™t sá»‘ vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `useMemo`:

**1. TÃ­nh toÃ¡n giÃ¡ trá»‹ cá»§a má»™t biáº¿n phá»©c táº¡p trong má»™t hÃ m component:**

```jsx
import React, { useMemo, useState } from "react";

function Component() {
  const [a, setA] = useState(0);
  const [b, setB] = useState(0);

  // tÃ­nh toÃ¡n giÃ¡ trá»‹ cá»§a biáº¿n c dá»±a trÃªn giÃ¡ trá»‹ cá»§a a vÃ  b
  const c = useMemo(() => {
    console.log("TÃ­nh toÃ¡n c");
    return a + b;
  }, [a, b]);

  return (
    <div>
      <p>a: {a}</p>
      <p>b: {b}</p>
      <p>c: {c}</p>
      <button onClick={() => setA(a + 1)}>TÄƒng a</button>
      <button onClick={() => setB(b + 1)}>TÄƒng b</button>
    </div>
  );
}
```

- ğŸ‘‰ Trong vÃ­ dá»¥ nÃ y, giÃ¡ trá»‹ cá»§a biáº¿n `c` Ä‘Æ°á»£c tÃ­nh toÃ¡n dá»±a trÃªn giÃ¡ trá»‹ cá»§a `a` vÃ  `b`. Tuy nhiÃªn, náº¿u `a` hoáº·c `b` thay Ä‘á»•i, giÃ¡ trá»‹ cá»§a `c` sáº½ Ä‘Æ°á»£c tÃ­nh toÃ¡n láº¡i. Äá»ƒ trÃ¡nh tÃ­nh toÃ¡n láº¡i giÃ¡ trá»‹ cá»§a `c` má»—i láº§n component re-render, chÃºng ta sá»­ dá»¥ng `useMemo` Ä‘á»ƒ lÆ°u trá»¯ giÃ¡ trá»‹ tÃ­nh toÃ¡n cá»§a `c` vÃ  chá»‰ tÃ­nh toÃ¡n láº¡i khi `a` hoáº·c `b` thay Ä‘á»•i.

**2. VÃ­ dá»¥ tá»‘i Æ°u hÃ³a viá»‡c render má»™t danh sÃ¡ch cÃ¡c items:**

```jsx
import React, { useMemo, useState } from "react";

function Component() {
  const [items, setItems] = useState([
    { id: 1, name: "Item 1" },
    { id: 2, name: "Item 2" },
    { id: 3, name: "Item 3" },
  ]);
  const [searchTerm, setSearchTerm] = useState("");

  // tÃ¬m kiáº¿m cÃ¡c items phÃ¹ há»£p vá»›i searchTerm
  const filteredItems = useMemo(() => {
    console.log("TÃ¬m kiáº¿m items");
    return items.filter((item) =>
      item.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [items, searchTerm]);

  return (
    <div>
      <input
        type="text"
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
      />
      <ul>
        {filteredItems.map((item) => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
      <button
        onClick={() =>
          setItems([
            ...items,
            { id: items.length + 1, name: `Item ${items.length + 1}` },
          ])
        }
      >
        ThÃªm item
      </button>
    </div>
  );
}
```

- Trong vÃ­ dá»¥ nÃ y, chÃºng ta cÃ³ má»™t danh sÃ¡ch cÃ¡c items vÃ  má»™t Ã´ tÃ¬m kiáº¿m Ä‘á»ƒ lá»c danh sÃ¡ch theo tá»« khÃ³a tÃ¬m kiáº¿m. Khi ngÆ°á»i dÃ¹ng nháº­p tá»« khÃ³a tÃ¬m kiáº¿m, danh sÃ¡ch sáº½ Ä‘Æ°á»£c lá»c láº¡i vÃ  hiá»ƒn thá»‹ cÃ¡c items phÃ¹ há»£p.

- Tuy nhiÃªn, náº¿u chÃºng ta tÃ¬m kiáº¿m má»—i láº§n ngÆ°á»i dÃ¹ng nháº­p má»™t kÃ½ tá»± má»›i, thÃ¬ sáº½ lÃ m cho component render láº¡i ráº¥t nhiá»u láº§n vÃ  gÃ¢y lÃ£ng phÃ­ tÃ i nguyÃªn. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng `useMemo` Ä‘á»ƒ giá»¯ cho viá»‡c lá»c danh sÃ¡ch chá»‰ Ä‘Æ°á»£c thá»±c hiá»‡n khi danh sÃ¡ch hoáº·c tá»« khÃ³a tÃ¬m kiáº¿m thay Ä‘á»•i.

- Trong Ä‘oáº¡n code, chÃºng ta sá»­ dá»¥ng `useMemo` Ä‘á»ƒ lá»c danh sÃ¡ch items phÃ¹ há»£p vá»›i tá»« khÃ³a tÃ¬m kiáº¿m. HÃ m lá»c nÃ y Ä‘Æ°á»£c cháº¡y khi danh sÃ¡ch items hoáº·c tá»« khÃ³a tÃ¬m kiáº¿m thay Ä‘á»•i. Náº¿u danh sÃ¡ch items hoáº·c tá»« khÃ³a tÃ¬m kiáº¿m khÃ´ng thay Ä‘á»•i, giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» tá»« hÃ m lá»c sáº½ Ä‘Æ°á»£c giá»¯ láº¡i vÃ  sá»­ dá»¥ng láº¡i cho render tiáº¿p theo mÃ  khÃ´ng pháº£i thá»±c hiá»‡n láº¡i viá»‡c lá»c.

- NhÆ° váº­y, viá»‡c sá»­ dá»¥ng `useMemo` giÃºp tá»‘i Æ°u viá»‡c render danh sÃ¡ch items khi cÃ³ sá»± thay Ä‘á»•i trong tá»« khÃ³a tÃ¬m kiáº¿m mÃ  khÃ´ng lÃ m cho component render láº¡i nhiá»u láº§n vÃ  tÄƒng tá»‘c Ä‘á»™ hiá»ƒn thá»‹ trÃªn trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng.

`ğŸš€ğŸš€ HÃ£y giáº£i thÃ­ch chi tiáº¿t tá»«ng dÃ²ng code hÆ¡n, rÃµ rÃ£ng , cáº·n cáº½ nháº¥t:`

ğŸ‘‰DÃ²ng 1: Import useMemo vÃ  useState hook tá»« React.

ğŸ‘‰DÃ²ng 3-9: Táº¡o má»™t component function Ä‘Æ¡n giáº£n vá»›i hai state lÃ  items vÃ  searchTerm, láº§n lÆ°á»£t chá»©a má»™t danh sÃ¡ch cÃ¡c items vÃ  tá»« khÃ³a tÃ¬m kiáº¿m.

ğŸ‘‰DÃ²ng 12-20: Sá»­ dá»¥ng hook useMemo Ä‘á»ƒ tá»‘i Æ°u hÃ³a viá»‡c render danh sÃ¡ch cÃ¡c items. HÃ m truyá»n vÃ o useMemo sáº½ Ä‘Æ°á»£c gá»i má»—i khi giÃ¡ trá»‹ cá»§a cÃ¡c dependency thay Ä‘á»•i. Náº¿u khÃ´ng cÃ³ sá»± thay Ä‘á»•i nÃ o vá»›i cÃ¡c dependency, giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» tá»« hook useMemo sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng láº¡i, khÃ´ng cáº§n pháº£i tÃ­nh toÃ¡n láº¡i.

ğŸ‘‰DÃ²ng 14: In ra mÃ n hÃ¬nh console khi chÃºng ta thá»±c hiá»‡n tÃ¬m kiáº¿m items Ä‘á»ƒ kiá»ƒm tra viá»‡c re-render cá»§a component.

ğŸ‘‰DÃ²ng 15-19: DÃ¹ng filter() Ä‘á»ƒ lá»c ra cÃ¡c item phÃ¹ há»£p vá»›i tá»« khÃ³a tÃ¬m kiáº¿m, sau Ä‘Ã³ tráº£ vá» má»™t danh sÃ¡ch cÃ¡c items Ä‘Ã£ Ä‘Æ°á»£c lá»c.

ğŸ‘‰DÃ²ng 22-23: Render má»™t input vÃ  má»™t danh sÃ¡ch cÃ¡c items Ä‘Ã£ Ä‘Æ°á»£c lá»c. Khi giÃ¡ trá»‹ cá»§a input thay Ä‘á»•i, hook useState sáº½ Ä‘Æ°á»£c gá»i láº¡i, gÃ¢y ra viá»‡c re-render cá»§a component.

ğŸ‘‰DÃ²ng 25-27: Render má»™t button, khi Ä‘Æ°á»£c click, thÃªm má»™t item má»›i vÃ o danh sÃ¡ch. Khi danh sÃ¡ch items thay Ä‘á»•i, hook useState Ä‘Æ°á»£c gá»i láº¡i, gÃ¢y ra viá»‡c re-render cá»§a component.

Nhá» hook useMemo, khi tÃ¬m kiáº¿m cÃ¡c items, chÃºng ta khÃ´ng cáº§n pháº£i lá»c toÃ n bá»™ danh sÃ¡ch items, mÃ  chá»‰ cáº§n lá»c danh sÃ¡ch Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong biáº¿n filteredItems. Äiá»u nÃ y giÃºp giáº£m thiá»ƒu viá»‡c tÃ­nh toÃ¡n láº¡i trong quÃ¡ trÃ¬nh re-render, giÃºp cáº£i thiá»‡n hiá»‡u suáº¥t cá»§a á»©ng dá»¥ng.

**3. TÃ­nh toÃ¡n phá»©c táº¡p trong `component`.**

- Giáº£ sá»­ chÃºng ta cÃ³ má»™t component `ExpensiveCalculation` nhÆ° sau:

```jsx
import React, { useState } from "react";

function ExpensiveCalculation({ a, b }) {
  const [result, setResult] = useState(null);

  const calculateResult = () => {
    // Simulate a complex calculation
    const res = a * b;
    setResult(res);
  };

  return (
    <div>
      <button onClick={calculateResult}>Calculate Result</button>
      {result && <p>The result is {result}</p>}
    </div>
  );
}
```

- Trong component nÃ y, khi chÃºng ta click vÃ o nÃºt "Calculate Result", nÃ³ sáº½ tÃ­nh toÃ¡n káº¿t quáº£ cá»§a `a*b` vÃ  hiá»ƒn thá»‹ káº¿t quáº£. Tuy nhiÃªn, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  má»—i láº§n chÃºng ta re-render component nÃ y, hÃ m `calculateResult` cÅ©ng Ä‘Æ°á»£c cháº¡y má»™t láº§n Ä‘á»ƒ set state, báº¥t cháº¥p viá»‡c chÃºng ta khÃ´ng cáº§n tÃ­nh toÃ¡n káº¿t quáº£ má»›i. Äiá»u nÃ y lÃ m tá»‘n thá»i gian tÃ­nh toÃ¡n vÃ  lÃ m cháº­m á»©ng dá»¥ng cá»§a chÃºng ta.

- Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng `useMemo` Ä‘á»ƒ lÆ°u trá»¯ káº¿t quáº£ cá»§a a \* b vÃ  chá»‰ tÃ­nh toÃ¡n láº¡i khi a hoáº·c b thay Ä‘á»•i. Äiá»u nÃ y giÃºp chÃºng ta trÃ¡nh tÃ­nh toÃ¡n khÃ´ng cáº§n thiáº¿t vÃ  tÄƒng tá»‘c Ä‘á»™ re-render.

```jsx
import React, { useState, useMemo } from "react";

function ExpensiveCalculation({ a, b }) {
  const [result, setResult] = useState(null);

  const calculateResult = () => {
    // Simulate a complex calculation
    const res = a * b;
    setResult(res);
  };

  const memoizedResult = useMemo(() => {
    // Simulate a complex calculation
    return a * b;
  }, [a, b]);

  return (
    <div>
      <button onClick={calculateResult}>Calculate Result</button>
      {result && <p>The result is {result}</p>}
      <p>The memoized result is {memoizedResult}</p>
    </div>
  );
}
```

- ğŸ‘‰ á» vÃ­ dá»¥ nÃ y, chÃºng ta sá»­ dá»¥ng `useMemo` Ä‘á»ƒ tÃ­nh toÃ¡n káº¿t quáº£ cá»§a a \* b vÃ  lÆ°u trá»¯ káº¿t quáº£ Ä‘Ã³ vÃ o biáº¿n `memoizedResult`. Biáº¿n nÃ y sáº½ Ä‘Æ°á»£c tÃ­nh toÃ¡n láº¡i chá»‰ khi a hoáº·c b thay Ä‘á»•i. Khi chÃºng ta click vÃ o nÃºt "Calculate Result", hÃ m `calculateResult` Ä‘Æ°á»£c gá»i Ä‘á»ƒ tÃ­nh toÃ¡n vÃ  hiá»ƒn thá»‹ káº¿t quáº£ má»›i. Tuy nhiÃªn, viá»‡c nÃ y khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n káº¿t quáº£ Ä‘Æ°á»£c lÆ°u trá»¯ trong `memoizedResult`, do Ä‘Ã³ chÃºng ta khÃ´ng pháº£i tÃ­nh toÃ¡n láº¡i giÃ¡ trá»‹ nÃ y.
