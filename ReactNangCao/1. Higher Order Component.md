# Higher Order Component

- Trong ReactJS, HOC lÃ  viáº¿t táº¯t cá»§a `"Higher-Order Component"`, Ä‘Ã¢y lÃ  má»™t ká»¹ thuáº­t láº­p trÃ¬nh cho phÃ©p tÃ¡i sá»­ dá»¥ng logic cá»§a cÃ¡c component trong ReactJS. `HOC` lÃ  má»™t `function` `nháº­n vÃ o má»™t component` vÃ  `tráº£ vá» má»™t component` má»›i vá»›i má»™t sá»‘ tÃ­nh nÄƒng bá»• sung.

## Ã”n láº¡i Higher Order Function

- Higher Order Function (HOF) lÃ  function mÃ  nháº­n vÃ o Ä‘á»‘i sá»‘ lÃ  function hoáº·c return vá» function. Ta cÃ³ cÃ¡c vÃ­ dá»¥ phá»• biáº¿n nhÆ°

- Nháº­n vÃ o Ä‘á»‘i sá»‘ lÃ  function (callback): `.map()`, `.forEach()`, `.filter()`
- Return vá» má»™t function: Ká»¹ thuáº­t currying mÃ  chÃºng ta hay dÃ¹ng vá»›i react khi táº¡o function cho cÃ¡c sá»± kiá»‡n onChange

- **VÃ­ dá»¥** Ä‘Æ¡n giáº£n cá»§a HOC cÃ³ thá»ƒ lÃ  viá»‡c xÃ¡c thá»±c ngÆ°á»i dÃ¹ng. Báº¡n cÃ³ thá»ƒ táº¡o má»™t `HOC` Ä‘á»ƒ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng trÆ°á»›c khi cho phÃ©p há» truy cáº­p vÃ o má»™t trang web hoáº·c trang web báº£o máº­t. Äá»ƒ lÃ m Ä‘iá»u nÃ y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t `HOC` Ä‘á»ƒ bá»c `component` vÃ  kiá»ƒm tra xem ngÆ°á»i dÃ¹ng cÃ³ Ä‘Æ°á»£c phÃ©p truy cáº­p vÃ o nÃ³ hay khÃ´ng.

- ğŸ‘‡ğŸ‘‡ VÃ­ dá»¥ cÆ¡ báº£n cá»§a `HOC` trong `ReactJS`:ğŸ‘‡ğŸ‘‡

```jsx
function withHeader(WrappedComponent) {
  return class extends React.Component {
    render() {
      return (
        <div>
          <h1>Header</h1>
          <WrappedComponent {...this.props} />
        </div>
      );
    }
  };
}

class MyComponent extends React.Component {
  render() {
    return <p>My Component</p>;
  }
}

const WrappedComponentWithHeader = withHeader(MyComponent);

ReactDOM.render(
  <WrappedComponentWithHeader />,
  document.getElementById("root")
);
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta táº¡o má»™t `HOC` `withHeader` Ä‘á»ƒ thÃªm má»™t tiÃªu Ä‘á» vÃ o trang web. `HOC` `nháº­n vÃ o má»™t component` Ä‘Æ°á»£c gá»i lÃ  `WrappedComponent` vÃ  `tráº£ vá» má»™t component` má»›i. Component má»›i nÃ y bao gá»“m má»™t tiÃªu Ä‘á» vÃ  component `WrappedComponent` ban Ä‘áº§u Ä‘Æ°á»£c truyá»n vÃ o thÃ´ng qua `props`. Cuá»‘i cÃ¹ng, chÃºng ta sá»­ dá»¥ng `ReactDOM.render()` Ä‘á»ƒ hiá»ƒn thá»‹ component má»›i.\*

ğŸ‘‡ğŸ‘‡**_VÃ­ dá»¥ vá» currying: TÃ¬m nhá»¯ng sá»‘ tá»« 0 Ä‘áº¿n n (khÃ´ng tÃ­nh n) thá»a mÃ£n Ä‘iá»u kiá»‡n nháº¥t Ä‘á»‹nh_**ğŸ‘‡ğŸ‘‡

```js
const findNumber = (num) => (func) => {
  const result = [];
  for (let i = 0; i < num; i++) {
    if (func(i)) {
      result.push(i);
    }
  }
  return result;
};
findNumber(10)((number) => number % 2 === 1); // < 10 vÃ  sá»‘ láº»
findNumber(20)((number) => number % 2 === 0); // < 20 vÃ  sá»‘ cháº³n
findNumber(30)((number) => number % 3 === 2); // < 30 vÃ  sá»‘ chia 3 dÆ° 2
```

## Higher Order Components

HOC lÃ  ká»¹ thuáº­t nÃ¢ng cao trong React, khÃ´ng pháº£i lÃ  má»™t React API.

> HOC lÃ  má»™t function nháº­n vÃ o má»™t component vÃ  return vá» má»™t component má»›i

```jsx
const EnhancedComponent = higherOrderComponent(WrappedComponent);
```

HOC phá»• biáº¿n trong cÃ¡c thÆ° viá»‡n React: `connect(mapStateToProps, mapDispatchToProps)(UserPage)` cá»§a react-redux, `withRouter(UserPage)` cá»§a react-router, `withStyles(styles)(UserPage)` cá»§a material-ui

HOC thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng khi:

### ChÃºng ta muá»‘n tÃ¡i sá»­ dá»¥ng logic gÃ¬ Ä‘Ã³

VÃ­ dá»¥ nhÆ° tá»± Ä‘á»™ng Ä‘Äƒng kÃ½ sá»± kiá»‡n khi render component vÃ  há»§y Ä‘Äƒng kÃ½ khi component unmount

```jsx
const CommentList = (props) => {
  return <div>Comment List</div>;
};

const BlogList = (props) => {
  return <div>Blog List</div>;
};

const withSubscription = (WrappedComponent) => {
  const newComponent = (props) => {
    useEffect(() => {
      subscribe("ÄÄƒng kÃ½!");
      return () => {
        unsubscribe("Há»§y Ä‘Äƒng kÃ½!");
      };
    }, []);
    return <WrappedComponent {...props} />;
  };
  return newComponent;
};

const NewCommentList = withSubscription(CommentList);
const NewBlogList = withSubscription(BlogList);
```

## Giáº£i thÃ­ch Ä‘oáº¡n code trÃªn:

- **Äoáº¡n code trÃªn lÃ  má»™t vÃ­ dá»¥ vá» Higher Order Component (HOC), Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng logic hoáº·c chá»©c nÄƒng giá»¯a cÃ¡c component khÃ¡c nhau.**

- **DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch tá»«ng dÃ²ng code trong Ä‘oáº¡n mÃ£ trÃªn**:

```jsx
const withSubscription = (WrappedComponent) => {
```

- **ÄÃ¢y lÃ  khai bÃ¡o cá»§a HOC. NÃ³ nháº­n vÃ o má»™t component WrappedComponent lÃ m tham sá»‘, vÃ  tráº£ vá» má»™t component má»›i.**

```jsx
const newComponent = (props) => {
```

- **ÄÃ¢y lÃ  khai bÃ¡o cá»§a component má»›i. NÃ³ nháº­n vÃ o props lÃ  cÃ¡c thuá»™c tÃ­nh cá»§a component, vÃ  tráº£ vá» má»™t component má»›i, cÃ³ sá»­ dá»¥ng useEffect Ä‘á»ƒ Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ má»™t sá»± kiá»‡n.**

```jsx
useEffect(() => {
  subscribe("ÄÄƒng kÃ½!");
  return () => {
    unsubscribe("Há»§y Ä‘Äƒng kÃ½!");
  };
}, []);
```

- **Trong useEffect, subscribe vÃ  unsubscribe Ä‘Æ°á»£c gá»i Ä‘á»ƒ Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ má»™t sá»± kiá»‡n. [] lÃ  dependency array Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng effect nÃ y chá»‰ Ä‘Æ°á»£c gá»i má»™t láº§n khi component Ä‘Æ°á»£c render láº§n Ä‘áº§u tiÃªn.**

```jsx
return <WrappedComponent {...props} />;
```

- **Sau khi Ä‘Äƒng kÃ½, component sáº½ tráº£ vá» component WrappedComponent (component ban Ä‘áº§u truyá»n vÃ o HOC) vá»›i cÃ¡c props Ä‘Æ°á»£c truyá»n vÃ o.**

```jsx
return newComponent;
```

- **Cuá»‘i cÃ¹ng, HOC sáº½ tráº£ vá» component má»›i, newComponent, sau khi Ä‘Ã£ Ä‘Æ°á»£c bá»c bá»Ÿi cÃ¡c logic Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½.**

```jsx
const NewCommentList = withSubscription(CommentList);
```

- **Cuá»‘i cÃ¹ng, CommentList sáº½ Ä‘Æ°á»£c truyá»n vÃ o HOC withSubscription Ä‘á»ƒ táº¡o ra má»™t component má»›i cÃ³ tÃªn lÃ  NewCommentList. Component nÃ y sáº½ cÃ³ táº¥t cáº£ cÃ¡c thuá»™c tÃ­nh cá»§a CommentList vÃ  Ä‘Æ°á»£c bá»c bá»Ÿi logic Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ sá»± kiá»‡n.**

> **_*Viá»‡c viáº¿t code theo kiá»ƒu HOC giÃºp ta tÃ¡i sá»­ dá»¥ng cÃ¡c Ä‘oáº¡n mÃ£ vÃ  cÃ¡c chá»©c nÄƒng giá»¯a cÃ¡c component khÃ¡c nhau, giÃºp giáº£m thiá»ƒu viá»‡c láº·p láº¡i code, tÄƒng tÃ­nh báº£o trÃ¬ vÃ  giáº£m thiá»ƒu lá»—i.*_**

> **_*Trong má»™t sá»‘ trÆ°á»ng há»£p thÃ¬ chÃºng ta cÃ³ thá»ƒ custom hook Ä‘á»ƒ xá»­ lÃ½ use case trÃªn mÃ  khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n HOC*_**

### ÄÃ¢y lÃ  cÃ¢u há»i giÃºp cho báº¡n pháº£i Ä‘á»™ng nÃ£o 1 chÃºt nÃ¨ !!!

### CÃ¢u há»i 1:

> **Váº­y component WrappedComponent thÃ¬ sao ? NÃ³ Ä‘Æ°á»£c truyá»n vÃ o nhÆ° lÃ  má»™t tham sá»‘ thÃ´i Ä‘Ã³ háº£ ? VÃ  nÃ³ Ä‘Ã£ Ä‘Æ°á»£c thay tháº¿ bá»Ÿi dÃ²ng code nÃ y Ã  ? const NewCommentList = withSubscription(CommentList);**

- ÄÃºng váº­y, `component WrappedComponent` lÃ  má»™t tham sá»‘ Ä‘Æ°á»£c truyá»n vÃ o `hÃ m withSubscription`, vÃ  khi `hÃ m withSubscription` Ä‘Æ°á»£c gá»i, nÃ³ sáº½ tráº£ vá» má»™t component má»›i (`newComponent`) mÃ  trong Ä‘Ã³ `component WrappedComponent` Ä‘Ã£ Ä‘Æ°á»£c "bá»c" láº¡i (wrapped) bá»Ÿi cÃ¡c logic `subscribe` vÃ  `unsubscribe`.

- DÃ²ng code nÃ y: **const NewCommentList = withSubscription(CommentList);** sáº½ gÃ¡n component má»›i (`newComponent`) Ä‘Æ°á»£c tráº£ vá» tá»« `hÃ m withSubscription` cho biáº¿n `NewCommentList`. VÃ¬ váº­y, khi sá»­ dá»¥ng biáº¿n `NewCommentList` nhÆ° má»™t component trong JSX, thá»±c táº¿ chÃºng ta Ä‘ang sá»­ dá»¥ng `component WrappedComponent` Ä‘Æ°á»£c bá»c láº¡i (wrapped) bá»Ÿi logic `subscribe` vÃ  `unsubscribe` trong component má»›i.

## CÃ¢u há»i 2:

> **CommentList nÃ³ thay tháº¿ cho component WrappedComponent háº£ ?**

- CommentList nÃ³ thay tháº¿ cho component WrappedComponent háº£ ?

- ÄÃºng váº­y, `component CommentList` Ä‘Æ°á»£c truyá»n vÃ o `hÃ m withSubscription` nhÆ° lÃ  `tham sá»‘ WrappedComponent`, vÃ  nÃ³ sáº½ thay tháº¿ cho `WrappedComponent` bÃªn trong `hÃ m withSubscription`.

- Trong `hÃ m newComponent` (component Ä‘Æ°á»£c tráº£ vá» tá»« `withSubscription`), `WrappedComponent` lÃ  tÃªn cá»§a tham sá»‘ Ä‘Æ°á»£c truyá»n vÃ o `hÃ m newComponent`. VÃ¬ váº­y, khi sá»­ dá»¥ng `WrappedComponent` trong dÃ²ng lá»‡nh **return <WrappedComponent {...props} />;**, nÃ³ thá»±c cháº¥t Ä‘ang tráº£ vá» `component CommentList` (vÃ¬ `CommentList` Ä‘Æ°á»£c truyá»n vÃ o nhÆ° má»™t tham sá»‘ cho `withSubscription` vÃ  Ä‘Æ°á»£c gÃ¡n cho biáº¿n `WrappedComponent`).

## CÃ¢u há»i 3:

> **Váº­y tÃ³m láº¡i component WrappedComponent chá»‰ lÃ  tham sá»‘ thÃ´i háº£ hay lÃ  component ?**

- ÄÃºng váº­y, `WrappedComponent` trong Ä‘oáº¡n mÃ£ lÃ  tÃªn cá»§a má»™t tham sá»‘ cá»§a `hÃ m withSubscription`, vÃ  thá»±c cháº¥t nÃ³ lÃ  má»™t component Ä‘Æ°á»£c truyá»n vÃ o nhÆ° má»™t tham sá»‘ cá»§a `hÃ m withSubscription`. Sau Ä‘Ã³, `WrappedComponent` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o má»™t component má»›i, Ä‘Æ°á»£c gá»i lÃ  `newComponent`, vÃ  cuá»‘i cÃ¹ng tráº£ vá» bá»Ÿi `hÃ m withSubscription`. VÃ¬ váº­y, `WrappedComponent` khÃ´ng chá»‰ lÃ  má»™t tham sá»‘ mÃ  cÃ²n lÃ  má»™t component.

## CÃ¢u há»i 4:

> **HÃ£y giáº£i thÃ­ch trÆ°á»ng táº­n hÆ¡n Ä‘i, vÃ  dá»… hiá»ƒu hÆ¡n**

- Khi báº¡n gá»i `withSubscription (CommentList)`, nÃ³ sáº½ tráº£ vá» má»™t hÃ m má»›i lÃ  `newComponent`. HÃ m nÃ y lÃ  má»™t `React functional component` vÃ  cÃ³ má»™t tham sá»‘ lÃ  `props`.

- Trong pháº§n thÃ¢n cá»§a `newComponent`, cÃ³ má»™t `useEffect` hook, nÃ³ sáº½ Ä‘Æ°á»£c gá»i khi component Ä‘Æ°á»£c `mount lÃªn trÃªn DOM`. Trong Ä‘Ã³, `hÃ m subscribe` Ä‘Æ°á»£c gá»i vá»›i chuá»—i "ÄÄƒng kÃ½!", Ä‘á»ƒ Ä‘Äƒng kÃ½ cho sá»± kiá»‡n cá»§a component. Sau Ä‘Ã³, má»™t hÃ m return Ä‘Æ°á»£c khai bÃ¡o trong `useEffect` hook, hÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi component Ä‘Æ°á»£c `unmount khá»i DOM`, vÃ  `hÃ m unsubscribe` Ä‘Æ°á»£c gá»i Ä‘á»ƒ há»§y Ä‘Äƒng kÃ½ cho sá»± kiá»‡n cá»§a component.

- Cuá»‘i cÃ¹ng, `newComponent` sáº½ render ra má»™t `WrappedComponent` vá»›i toÃ n bá»™ props Ä‘Æ°á»£c truyá»n vÃ o nhÆ° lÃ  má»™t `object props {...props}`. `WrappedComponent` chÃ­nh lÃ  component mÃ  báº¡n truyá»n vÃ o `withSubscription` nhÆ° lÃ  má»™t tham sá»‘, trong trÆ°á»ng há»£p nÃ y lÃ  `CommentList`.

- NhÆ° váº­y, khi `NewCommentList` Ä‘Æ°á»£c render ra, nÃ³ sáº½ hiá»ƒn thá»‹ component `CommentList` vá»›i cÃ¡c props Ä‘Æ°á»£c truyá»n vÃ o tá»« `newComponent`. Viá»‡c nÃ y sáº½ giÃºp component `CommentList` sá»­ dá»¥ng Ä‘Æ°á»£c cÃ¡c dá»¯ liá»‡u vÃ  sá»± kiá»‡n tá»« `newComponent`, Ä‘á»“ng thá»i váº«n giá»¯ Ä‘Æ°á»£c tÃ­nh nÄƒng cá»§a mÃ¬nh nhÆ° lÃ  má»™t component riÃªng biá»‡t.

## Giáº£i thÃ­ch 1 cÃ¡ch dá»… hiá»ƒu, tÆ°á»ng minh, cáº·n cáº½, tá»«ng bÆ°á»›c má»™t:

```jsx
const withSubscription = (WrappedComponent) => {
  const newComponent = (props) => {
    useEffect(() => {
      subscribe("ÄÄƒng kÃ½!");
      return () => {
        unsubscribe("Há»§y Ä‘Äƒng kÃ½!");
      };
    }, []);
    return <WrappedComponent {...props} />;
  };
  return newComponent;
};

const NewCommentList = withSubscription(CommentList);
```

- Khi viáº¿t má»™t á»©ng dá»¥ng React, chÃºng ta cÃ³ thá»ƒ cáº§n Ã¡p dá»¥ng má»™t chá»©c nÄƒng nháº¥t Ä‘á»‹nh cho nhiá»u component khÃ¡c nhau. Thay vÃ¬ pháº£i láº·p láº¡i viá»‡c triá»ƒn khai chá»©c nÄƒng Ä‘Ã³ á»Ÿ má»—i component, chÃºng ta cÃ³ thá»ƒ táº¡o má»™t higher-order component (HOC) Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng code vÃ  giÃºp cho viá»‡c báº£o trÃ¬ vÃ  cáº­p nháº­t code dá»… dÃ ng hÆ¡n.

- á» Ä‘oáº¡n code trÃªn, `withSubscription` lÃ  má»™t HOC Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a dÆ°á»›i dáº¡ng má»™t hÃ m. NÃ³ nháº­n vÃ o má»™t component (giÃ¡ trá»‹ cá»§a `WrappedComponent`) vÃ  tráº£ vá» má»™t component má»›i (giÃ¡ trá»‹ cá»§a `newComponent`).

- `newComponent` lÃ  má»™t functional component vÃ  nháº­n vÃ o má»™t Ä‘á»‘i sá»‘ `props`. Trong functional component nÃ y, `useEffect` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n viá»‡c Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½. Khi component Ä‘Æ°á»£c render láº§n Ä‘áº§u tiÃªn, `subscribe` sáº½ Ä‘Æ°á»£c gá»i Ä‘á»ƒ Ä‘Äƒng kÃ½, vÃ  khi component bá»‹ xÃ³a khá»i DOM, `unsubscribe` sáº½ Ä‘Æ°á»£c gá»i Ä‘á»ƒ há»§y Ä‘Äƒng kÃ½.

- Sau Ä‘Ã³, `newComponent` tráº£ vá» component `WrappedComponent` (thÃ´ng qua syntax ...`props`) vá»›i cÃ¡c props Ä‘Æ°á»£c truyá»n vÃ o. Cuá»‘i cÃ¹ng, `newComponent` Ä‘Æ°á»£c tráº£ vá» vÃ  Ä‘Æ°á»£c gÃ¡n vÃ o biáº¿n NewCommentList.

- Khi sá»­ dá»¥ng `withSubscription` HOC, chÃºng ta khÃ´ng truyá»n trá»±c tiáº¿p component `WrappedComponent` vÃ o HOC, mÃ  thay vÃ o Ä‘Ã³ ta sá»­ dá»¥ng biáº¿n `NewCommentList` Ä‘á»ƒ lÆ°u component má»›i Ä‘Æ°á»£c tráº£ vá» tá»« HOC. Äiá»u nÃ y giÃºp cho code dá»… Ä‘á»c vÃ  dá»… báº£o trÃ¬ hÆ¡n, vÃ¬ chÃºng ta chá»‰ cáº§n quan tÃ¢m Ä‘áº¿n component má»›i Ä‘Æ°á»£c táº¡o ra tá»« HOC mÃ  khÃ´ng cáº§n pháº£i quan tÃ¢m Ä‘áº¿n component ban Ä‘áº§u cá»§a chÃºng ta.

- **_Trong vÃ­ dá»¥ cá»§a chÃºng ta, `CommentList` lÃ  má»™t component mÃ  chÃºng ta muá»‘n bá»c bá»Ÿi HOC `withSubscription` Ä‘á»ƒ thÃªm chá»©c nÄƒng Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½._**

- **_Khi sá»­ dá»¥ng HOC `withSubscription`, chÃºng ta khÃ´ng thá»ƒ truyá»n trá»±c tiáº¿p `WrappedComponent` vÃ o HOC, vÃ¬ `WrappedComponent` khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bÃªn trong pháº¡m vi cá»§a HOC._**

- **_Thay vÃ o Ä‘Ã³, chÃºng ta cáº§n truyá»n vÃ o `withSubscription` má»™t tham sá»‘ lÃ  má»™t component (trong trÆ°á»ng há»£p nÃ y lÃ  `CommentList`) vÃ  HOC `withSubscription` sáº½ tráº£ vá» má»™t component má»›i. Äiá»u nÃ y giÃºp cho chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng component má»›i nÃ y, Ä‘Ã£ Ä‘Æ°á»£c bá»c bá»Ÿi HOC `withSubscription`, trong toÃ n bá»™ á»©ng dá»¥ng React cá»§a chÃºng ta._**

- **_VÃ¬ váº­y, náº¿u chÃºng ta muá»‘n sá»­ dá»¥ng `WrappedComponent` thay cho `CommentList`, chÃºng ta sáº½ pháº£i viáº¿t láº¡i HOC `withSubscription` Ä‘á»ƒ truyá»n tham sá»‘ lÃ  `WrappedComponent` thay vÃ¬ `CommentList`. Äiá»u nÃ y khÃ´ng pháº£i lÃ  má»™t cÃ¡ch tiáº¿p cáº­n tá»‘t trong láº­p trÃ¬nh React vÃ¬ nÃ³ sáº½ lÃ m cho mÃ£ nguá»“n khÃ³ hiá»ƒu vÃ  khÃ³ báº£o trÃ¬ hÆ¡n._**

> **Viá»‡c sá»­ dá»¥ng CommentList lÃ m tham sá»‘ trong withSubscription giÃºp cho chÃºng ta tÃ¡i sá»­ dá»¥ng code vÃ  giÃºp cho viá»‡c báº£o trÃ¬ vÃ  cáº­p nháº­t code dá»… dÃ ng hÆ¡n. Náº¿u chÃºng ta muá»‘n Ã¡p dá»¥ng chá»©c nÄƒng Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ cho má»™t component khÃ¡c, chÃºng ta chá»‰ cáº§n truyá»n component Ä‘Ã³ vÃ o withSubscription nhÆ° lÃ  má»™t tham sá»‘ vÃ  sá»­ dá»¥ng component má»›i Ä‘Æ°á»£c tráº£ vá» tá»« HOC.**

### Sau Ä‘Ã¢y chÃºng ta hÃ£y cÃ¹ng phÃ¢n tÃ­ch code Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n vá» Higher Order Components (HOC):

- ÄÃ¢y lÃ  má»™t Ä‘oáº¡n code React sá»­ dá»¥ng higher-order component (HOC) Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng logic cho nhiá»u component khÃ¡c nhau. HÃ£y giáº£i thÃ­ch tá»«ng dÃ²ng code nhÆ° sau:

```jsx
const CommentList = (props) => {
  return <div>Comment List</div>;
};
```

- ÄÃ¢y lÃ  má»™t functional component CommentList tráº£ vá» má»™t Ä‘oáº¡n JSX Ä‘á»ƒ hiá»ƒn thá»‹ "Comment List".

```jsx
const BlogList = (props) => {
  return <div>Blog List</div>;
};
```

- ÄÃ¢y lÃ  má»™t functional component BlogList tÆ°Æ¡ng tá»± nhÆ° CommentList, nhÆ°ng tráº£ vá» má»™t Ä‘oáº¡n JSX Ä‘á»ƒ hiá»ƒn thá»‹ "Blog List".

```jsx
const withSubscription = (WrappedComponent) => {
  const newComponent = (props) => {
    useEffect(() => {
      subscribe("ÄÄƒng kÃ½!");
      return () => {
        unsubscribe("Há»§y Ä‘Äƒng kÃ½!");
      };
    }, []);
    return <WrappedComponent {...props} />;
  };
  return newComponent;
};
```

- **_ÄÃ¢y lÃ  má»™t higher-order component (HOC) vá»›i tÃªn lÃ  withSubscription, nháº­n vÃ o má»™t component lÃ  WrappedComponent, vÃ  tráº£ vá» má»™t component má»›i. newComponent lÃ  má»™t functional component Ä‘Æ°á»£c táº¡o ra bá»Ÿi withSubscription, nháº­n vÃ o props cá»§a component ban Ä‘áº§u._**

- **_Trong useEffect cá»§a newComponent, hÃ m subscribe sáº½ Ä‘Æ°á»£c gá»i khi component Ä‘Æ°á»£c render láº§n Ä‘áº§u tiÃªn, vÃ  hÃ m unsubscribe sáº½ Ä‘Æ°á»£c gá»i khi component bá»‹ xÃ³a khá»i DOM. useEffect Ä‘Æ°á»£c thiáº¿t láº­p Ä‘á»ƒ chá»‰ cháº¡y má»™t láº§n (thÃ´ng qua máº£ng rá»—ng []), nghÄ©a lÃ  chá»‰ Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ má»™t láº§n duy nháº¥t._**

- **_Cuá»‘i cÃ¹ng, newComponent tráº£ vá» component WrappedComponent thÃ´ng qua syntax {...props}, chuyá»ƒn cÃ¡c props Ä‘Æ°á»£c truyá»n vÃ o newComponent xuá»‘ng WrappedComponent._**

```jsx
const NewCommentList = withSubscription(CommentList);
const NewBlogList = withSubscription(BlogList);
```

- **_CÃ¡c component má»›i Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch gá»i withSubscription vá»›i cÃ¡c component ban Ä‘áº§u, vÃ  Ä‘Æ°á»£c lÆ°u trá»¯ trong biáº¿n NewCommentList vÃ  NewBlogList tÆ°Æ¡ng á»©ng._**

- **_VÃ­ dá»¥, náº¿u ta sá»­ dá»¥ng NewCommentList, nÃ³ sáº½ chá»©a Ä‘á»±ng logic Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong withSubscription, vÃ  hiá»ƒn thá»‹ Ä‘oáº¡n JSX "Comment List" Ä‘Æ°á»£c tráº£ vá» tá»« component CommentList. TÆ°Æ¡ng tá»±, NewBlogList sáº½ chá»©a logic Ä‘Äƒng kÃ½ vÃ  há»§y Ä‘Äƒng kÃ½, vÃ  hiá»ƒn thá»‹ Ä‘oáº¡n JSX "Blog List" tá»« component BlogList._**

### Truyá»n nhá»¯ng prop khÃ´ng liÃªn quan vÃ o component mÃ  khÃ´ng lÃ m thay Ä‘á»•i cÃ¡ch dÃ¹ng cá»§a component gá»‘c

```jsx
const CommentList = ({ commentList,profile }) => {
  console.log(profile)
  return <div>Comment List</div>
}

const BlogList = ({ blogList, profile }) => {
  console.log(profile)
  return <div>Blog List</div>
}


const connect = (WrappedComponent, newProps) => {
  return (props) => {
    return <WrappedComponent {...props} {...newProps} />
  }
}

const NewCommentList = connect(CommentList, {profile: {name: 'Duoc'}})
const NewBlogList = connect(BlogList, {profile: {name: 'Duoc'}})

const App = () => (
  <div>
    <NewCommentList commentList={commentList}>
    <NewBlogList blogList={blogList}>
  </div>
)
```

## ÄÃ¢y lÃ  giáº£i thÃ­ch code cá»§a chÃºng ta xem luá»“ng code Ä‘Æ°á»£c cháº¡y nhÆ° tháº¿ nÃ o ?

- BÆ°á»›c 1: Khai bÃ¡o 2 functional component CommentList vÃ  BlogList nháº­n props lÃ  commentList vÃ  blogList cÃ¹ng má»™t prop lÃ  profile Ä‘á»ƒ log ra console.

```jsx
const CommentList = ({ commentList, profile }) => {
  console.log(profile);
  return <div>Comment List</div>;
};

const BlogList = ({ blogList, profile }) => {
  console.log(profile);
  return <div>Blog List</div>;
};
```

- BÆ°á»›c 2: Khai bÃ¡o hÃ m connect nháº­n vÃ o WrappedComponent vÃ  newProps. HÃ m connect tráº£ vá» má»™t functional component má»›i nháº­n props vÃ  truyá»n cÃ¡c props ban Ä‘áº§u vÃ o WrappedComponent, Ä‘á»“ng thá»i truyá»n thÃªm cÃ¡c props má»›i (newProps) vÃ o WrappedComponent. VÃ¬ WrappedComponent vÃ  newProps cÃ³ thá»ƒ cÃ³ cáº¥u trÃºc khÃ¡c nhau nÃªn ta sá»­ dá»¥ng toÃ¡n tá»­ spread Ä‘á»ƒ truyá»n táº¥t cáº£ cÃ¡c props.

```jsx
const connect = (WrappedComponent, newProps) => {
  return (props) => {
    return <WrappedComponent {...props} {...newProps} />;
  };
};
```

- BÆ°á»›c 3: Sá»­ dá»¥ng hÃ m connect Ä‘á»ƒ táº¡o ra 2 functional component má»›i, NewCommentList vÃ  NewBlogList. Má»—i functional component má»›i Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch gá»i hÃ m connect vá»›i WrappedComponent lÃ  CommentList hoáº·c BlogList vÃ  truyá»n vÃ o newProps lÃ  profile: `{name: 'Duoc'}`.

```jsx
const NewCommentList = connect(CommentList, { profile: { name: "Duoc" } });
const NewBlogList = connect(BlogList, { profile: { name: "Duoc" } });
```

- BÆ°á»›c 4: Sá»­ dá»¥ng 2 functional component má»›i (NewCommentList vÃ  NewBlogList) Ä‘á»ƒ render ra giao diá»‡n trong component App. Má»—i component má»›i Ä‘Æ°á»£c truyá»n vÃ o props cá»§a nÃ³, tÆ°Æ¡ng á»©ng vá»›i commentList cho NewCommentList vÃ  blogList cho NewBlogList.

```jsx
const App = () => (
  <div>
    <NewCommentList commentList={commentList} />
    <NewBlogList blogList={blogList} />
  </div>
);
```

> **NhÆ° váº­y, khi render ra giao diá»‡n, cáº£ CommentList vÃ  BlogList Ä‘á»u sáº½ nháº­n Ä‘Æ°á»£c thÃªm prop má»›i lÃ  profile cÃ³ giÃ¡ trá»‹ lÃ  {name: 'Duoc'} thÃ´ng qua viá»‡c sá»­ dá»¥ng higher-order component connect.**

**_Trong má»™t sá»‘ trÆ°á»ng há»£p thÃ¬ chÃºng ta cÅ©ng cÃ³ thá»ƒ custom hook Ä‘á»ƒ xá»­ lÃ½ use case trÃªn mÃ  khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n HOC_**

## Má»™t sá»‘ lÆ°u Ã½ khi dÃ¹ng HOC

- Äá»«ng dÃ¹ng HOC bÃªn trong render method hoáº·c trong function component

```jsx
render() {
  // Má»™t phiÃªn báº£n má»›i cá»§a EnhancedComponent Ä‘Æ°á»£c táº¡o ra má»—i khi render
  // EnhancedComponent1 !== EnhancedComponent2
  const EnhancedComponent = enhance(MyComponent);
  // GÃ¢y nÃªn viá»‡c EnhancedComponent bá»‹ unmount/remount má»—i láº§n render!
  return <EnhancedComponent />;
}
```

ÄÃ¢y khÃ´ng chá»‰ lÃ  váº¥n Ä‘á» vá» hiá»‡u suáº¥t mÃ  cÃ²n lÃ  logic, nÃ³ sáº½ lÃ m component bá»‹ unmount liÃªn tá»¥c má»—i khi re-render

- `ref` sáº½ khÃ´ng Ä‘Æ°á»£c truyá»n xuá»‘ng component, vÃ¬ `ref` khÃ´ng thá»±c sá»± lÃ  má»™t prop, nÃ³ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi React. Giáº£i phÃ¡p cho váº¥n Ä‘á» nÃ y lÃ  chÃºng ta dÃ¹ng `React.forwardRef` API
