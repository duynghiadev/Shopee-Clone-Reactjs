## ƒê√¢y l√† Docs t·ª± Research:

- ‚ùì ƒê√¢y l√† c√°c c√¢u h·ªèi trong video:

- L√†m sao ƒë·ªÉ `getQueriesData` n√≥ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t nh·ªâ, th∆∞·ªùng n√≥ ch·ªâ l·∫•y l·∫ßn ƒë·∫ßu `fetchapi` ?

  - üëâ Trong React Query, khi b·∫°n g·ªçi ph∆∞∆°ng th·ª©c `getQueriesData` ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ cache, n√≥ s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ cache n·∫øu c√≥ s·∫µn. Tuy nhi√™n, n·∫øu d·ªØ li·ªáu ch∆∞a c√≥ trong cache ho·∫∑c n·∫øu cache ƒë√£ h·∫øt h·∫°n (stale), React Query s·∫Ω t·ª± ƒë·ªông th·ª±c hi·ªán m·ªôt cu·ªôc g·ªçi m·∫°ng ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ ngu·ªìn d·ªØ li·ªáu (API ch·∫≥ng h·∫°n).

  - Khi b·∫°n th·ª±c hi·ªán m·ªôt query l·∫ßn ƒë·∫ßu ti√™n b·∫±ng c√°ch s·ª≠ d·ª•ng hook `useQuery`, React Query s·∫Ω g·ª≠i m·ªôt y√™u c·∫ßu m·∫°ng ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ ngu·ªìn d·ªØ li·ªáu v√† l∆∞u tr·ªØ k·∫øt qu·∫£ trong cache. Khi b·∫°n g·ªçi `getQueriesData`, n·∫øu d·ªØ li·ªáu trong cache v·∫´n c√≤n h·ª£p l·ªá (ch∆∞a h·∫øt h·∫°n), React Query s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√≥ m√† kh√¥ng g·ª≠i y√™u c·∫ßu m·∫°ng. Tuy nhi√™n, n·∫øu d·ªØ li·ªáu ƒë√£ h·∫øt h·∫°n, React Query s·∫Ω t·ª± ƒë·ªông g·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t v√† c·∫≠p nh·∫≠t cache tr∆∞·ªõc khi tr·∫£ v·ªÅ k·∫øt qu·∫£ cho `getQueriesData`.

  - V√¨ v·∫≠y, khi s·ª≠ d·ª•ng `getQueriesData`, b·∫°n c√≥ th·ªÉ y√™n t√¢m r·∫±ng d·ªØ li·ªáu tr·∫£ v·ªÅ s·∫Ω l√† phi√™n b·∫£n m·ªõi nh·∫•t t·ª´ ngu·ªìn d·ªØ li·ªáu, ngay c·∫£ khi cache ƒë√£ h·∫øt h·∫°n. React Query s·∫Ω t·ª± ƒë·ªông qu·∫£n l√Ω qu√° tr√¨nh c·∫≠p nh·∫≠t d·ªØ li·ªáu v√† ƒë·∫£m b·∫£o b·∫°n nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu m·ªõi nh·∫•t khi c·∫ßn thi·∫øt.

---

- ‚ùì Ch∆∞a hi·ªÉu c√°ch th·∫±ng react query n√†y c√≥ th·ªÉ thay th·∫ø cho redux ch·ªó n√†o? Th·∫±ng n√†y d·ª±a v√†o key th√¨ qu·∫£n l√Ω key ki·ªÉu g√¨ trong project cho kh·ªèi lo·∫°n ƒë√¢y ?

  - üëâ Redux c≈©ng d·ª±a v√†o key ƒë·ªÉ ph√¢n bi·ªát `action` m√†, V·∫•n ƒë·ªÅ redux l√† n√≥ r∆∞·ªùm r√† (√Ω ki·∫øn n√†y ·ªü trong b√†i h·ªçc)

  - üëâ T·ª± Search: üëà

  - React Query kh√¥ng thay th·∫ø Redux ho√†n to√†n, nh∆∞ng n√≥ cung c·∫•p m·ªôt gi·∫£i ph√°p hi·ªáu qu·∫£ cho vi·ªác qu·∫£n l√Ω tr·∫°ng th√°i ·ª©ng d·ª•ng v√† t∆∞∆°ng t√°c v·ªõi ngu·ªìn d·ªØ li·ªáu.

  - Redux l√† m·ªôt th∆∞ vi·ªán qu·∫£n l√Ω tr·∫°ng th√°i to√†n c·ª•c (global), th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ c√°c tr·∫°ng th√°i quan tr·ªçng v√† chia s·∫ª ch√∫ng gi·ªØa c√°c th√†nh ph·∫ßn trong ·ª©ng d·ª•ng. Redux h·ªØu √≠ch khi b·∫°n c·∫ßn qu·∫£n l√Ω tr·∫°ng th√°i ph·ª©c t·∫°p v√† c√≥ nhu c·∫ßu s·ª≠ d·ª•ng c√°c `middleware` ho·∫∑c `side effects`.

  - Trong khi ƒë√≥, React Query t·∫≠p trung v√†o qu·∫£n l√Ω d·ªØ li·ªáu li√™n quan ƒë·∫øn truy v·∫•n v√† x·ª≠ l√Ω c√°c t√°c v·ª• m·∫°ng. N√≥ gi√∫p b·∫°n th·ª±c hi·ªán c√°c truy v·∫•n d·ªØ li·ªáu, qu·∫£n l√Ω cache v√† t·ª± ƒë·ªông l√†m m·ªõi d·ªØ li·ªáu theo th·ªùi gian th·ª±c. React Query t·∫°o ra m·ªôt l·ªõp tr·ª´u t∆∞·ª£ng ƒë·ªÉ x·ª≠ l√Ω c√°c ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn d·ªØ li·ªáu, gi√∫p gi·∫£m b·ªõt s·ª± ph·ª©c t·∫°p c·ªßa vi·ªác qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c v·ªõi d·ªØ li·ªáu t·ª´ ngu·ªìn.

  - React Query c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng k·∫øt h·ª£p v·ªõi Redux trong m·ªôt ·ª©ng d·ª•ng. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng Redux ƒë·ªÉ qu·∫£n l√Ω c√°c tr·∫°ng th√°i to√†n c·ª•c v√† React Query ƒë·ªÉ qu·∫£n l√Ω c√°c truy v·∫•n v√† cache d·ªØ li·ªáu. ƒêi·ªÅu n√†y gi√∫p b·∫°n t·∫≠n d·ª•ng ƒë∆∞·ª£c l·ª£i √≠ch c·ªßa c·∫£ hai th∆∞ vi·ªán v√† tu·ª≥ ch·ªânh theo nhu c·∫ßu c·ª• th·ªÉ c·ªßa d·ª± √°n.

  - V·ªÅ vi·ªác qu·∫£n l√Ω key trong React Query, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng b·∫•t k·ª≥ lo·∫°i key n√†o ph√π h·ª£p v·ªõi d·ª± √°n c·ªßa m√¨nh. Key th∆∞·ªùng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a d∆∞·ªõi d·∫°ng m·ªôt m·∫£ng (`array`) ho·∫∑c m·ªôt chu·ªói (`string`) ƒë·∫°i di·ªán cho truy v·∫•n c·ª• th·ªÉ. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c gi√° tr·ªã duy nh·∫•t nh∆∞ `ID` ng∆∞·ªùi d√πng, t√™n truy v·∫•n, ho·∫∑c b·∫•t k·ª≥ gi√° tr·ªã n√†o m√† b·∫°n cho l√† ph√π h·ª£p ƒë·ªÉ ƒë·ªãnh danh truy v·∫•n. ƒêi·ªÅu n√†y gi√∫p React Query x√°c ƒë·ªãnh v√† qu·∫£n l√Ω c√°c truy v·∫•n ri√™ng bi·ªát m·ªôt c√°ch ch√≠nh x√°c.

---

- ## ‚ùì‚ùì‚ùì C√°c c√¢u h·ªèi th·∫Øc m·∫Øc (t·ª± research):

## T·ªïng k·∫øt l·∫°i ch∆∞∆°ng React Query ?

- React Query l√† m·ªôt th∆∞ vi·ªán qu·∫£n l√Ω tr·∫°ng th√°i v√† cache d·ªØ li·ªáu trong ·ª©ng d·ª•ng React. N√≥ cung c·∫•p c√°c kh√°i ni·ªám v√† API cho ph√©p t∆∞∆°ng t√°c d·ªÖ d√†ng v·ªõi d·ªØ li·ªáu t·ª´ c√°c ngu·ªìn kh√°c nhau nh∆∞ API, localStorage, hay b·∫•t k·ª≥ ngu·ªìn d·ªØ li·ªáu n√†o kh√°c.

- D∆∞·ªõi ƒë√¢y l√† nh·ªØng kh√°i ni·ªám ch√≠nh v√† t√≠nh nƒÉng quan tr·ªçng c·ªßa React Query:

1. `Query`: M·ªôt query ƒë·∫°i di·ªán cho m·ªôt truy v·∫•n d·ªØ li·ªáu t·ª´ m·ªôt ngu·ªìn nh·∫•t ƒë·ªãnh. React Query cung c·∫•p hook `useQuery` ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n n√†y.

2. `Mutations`: Mutations ƒë·∫°i di·ªán cho c√°c ho·∫°t ƒë·ªông thay ƒë·ªïi d·ªØ li·ªáu nh∆∞ t·∫°o, c·∫≠p nh·∫≠t ho·∫∑c x√≥a. React Query cung c·∫•p hook `useMutation` ƒë·ªÉ th·ª±c hi·ªán c√°c mutations.

3. `Query Invalidation`: React Query h·ªó tr·ª£ vi·ªác l√†m m·ªõi (refresh) d·ªØ li·ªáu th√¥ng qua ph∆∞∆°ng th·ª©c `invalidateQueries`, cho ph√©p ch√∫ng ta x√≥a cache c·ªßa m·ªôt ho·∫∑c nhi·ªÅu queries.

4. `Automatic Caching`: React Query t·ª± ƒë·ªông l∆∞u tr·ªØ d·ªØ li·ªáu truy v·∫•n v√† qu·∫£n l√Ω vi·ªác c·∫≠p nh·∫≠t d·ªØ li·ªáu khi c√≥ s·ª± thay ƒë·ªïi. N√≥ s·ª≠ d·ª•ng c∆° ch·∫ø cache th√¥ng minh ƒë·ªÉ t·∫≠n d·ª•ng l·∫°i d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c truy v·∫•n tr∆∞·ªõc ƒë√≥ m√† kh√¥ng c·∫ßn g·ª≠i y√™u c·∫ßu m·∫°ng.

5. `Prefetching`: React Query cung c·∫•p t√≠nh nƒÉng prefetching, cho ph√©p ch√∫ng ta t·∫£i tr∆∞·ªõc d·ªØ li·ªáu trong background tr∆∞·ªõc khi n√≥ ƒë∆∞·ª£c y√™u c·∫ßu, t·ªëi ∆∞u h√≥a tr·∫£i nghi·ªám ng∆∞·ªùi d√πng.

6. `Optimistic Updates`: T√≠nh nƒÉng optimistic updates cho ph√©p ch√∫ng ta c·∫≠p nh·∫≠t giao di·ªán ngay l·∫≠p t·ª©c m√† kh√¥ng c·∫ßn ch·ªù ƒë·ª£i ph·∫£n h·ªìi t·ª´ server khi th·ª±c hi·ªán mutations.

- React Query gi√∫p tƒÉng hi·ªáu su·∫•t ·ª©ng d·ª•ng, gi·∫£m s·ªë l·∫ßn g·ªçi m·∫°ng kh√¥ng c·∫ßn thi·∫øt, cung c·∫•p kh·∫£ nƒÉng x·ª≠ l√Ω l·ªói v√† cung c·∫•p m·ªôt c√°ch ti·∫øp c·∫≠n d·ªÖ d√πng v√† linh ho·∫°t trong qu·∫£n l√Ω d·ªØ li·ªáu.

---

## Nh·ªØng ki·∫øn th·ª©c nh·∫≠n ƒë∆∞·ª£c khi h·ªçc xong kho√° React Query ?

- Khi ho√†n th√†nh vi·ªác h·ªçc kho√° React Query, b·∫°n s·∫Ω c√≥ ki·∫øn th·ª©c v·ªÅ c√°c kh√°i ni·ªám v√† k·ªπ thu·∫≠t ch√≠nh sau:

1. `C∆° b·∫£n v·ªÅ React Query`: B·∫°n s·∫Ω hi·ªÉu ƒë∆∞·ª£c React Query l√† g√¨, t·∫°i sao n√≥ h·ªØu √≠ch trong qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c d·ªØ li·ªáu trong ·ª©ng d·ª•ng React.

2. `C√°ch s·ª≠ d·ª•ng useQuery hook`: B·∫°n s·∫Ω bi·∫øt c√°ch s·ª≠ d·ª•ng `useQuery` hook ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n d·ªØ li·ªáu, qu·∫£n l√Ω cache v√† x·ª≠ l√Ω c√°c tr·∫°ng th√°i kh√°c nhau (nh∆∞ loading, error) c·ªßa truy v·∫•n.

3. `Qu·∫£n l√Ω cache d·ªØ li·ªáu`: B·∫°n s·∫Ω hi·ªÉu c√°ch React Query qu·∫£n l√Ω cache d·ªØ li·ªáu v√† t·ª± ƒë·ªông l√†m m·ªõi d·ªØ li·ªáu theo th·ªùi gian th·ª±c.

4. `T√≠ch h·ª£p v·ªõi mutation`: B·∫°n s·∫Ω bi·∫øt c√°ch s·ª≠ d·ª•ng mutation ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c c·∫≠p nh·∫≠t d·ªØ li·ªáu th√™m, s·ª≠a, x√≥a (POST, PUT, DELETE) v√† l√†m m·ªõi cache. L∆∞u √Ω ch·ªâ c√≥ l·∫•y d·ªØ li·ªáu (GET) l√† s·ª≠ d·ª•ng query .

5. `Qu·∫£n l√Ω dependencies`: B·∫°n s·∫Ω hi·ªÉu c√°ch x√°c ƒë·ªãnh v√† qu·∫£n l√Ω c√°c ph·ª• thu·ªôc gi·ªØa c√°c truy v·∫•n, cho ph√©p l√†m m·ªõi t·ª± ƒë·ªông c√°c truy v·∫•n li√™n quan khi c√≥ thay ƒë·ªïi.

6. `T√≠ch h·ª£p v·ªõi prefetching`: B·∫°n s·∫Ω bi·∫øt c√°ch s·ª≠ d·ª•ng t√≠nh nƒÉng prefetching ƒë·ªÉ t·∫£i d·ªØ li·ªáu tr∆∞·ªõc v√† cung c·∫•p tr·∫£i nghi·ªám nhanh h∆°n cho ng∆∞·ªùi d√πng.

7. `T∆∞∆°ng t√°c v·ªõi cache tr·ª±c ti·∫øp`: B·∫°n s·∫Ω hi·ªÉu c√°ch truy c·∫≠p v√† c·∫≠p nh·∫≠t cache tr·ª±c ti·∫øp th√¥ng qua `useQueryClient` hook.

8. `X·ª≠ l√Ω l·ªói v√† th√¥ng b√°o`: B·∫°n s·∫Ω bi·∫øt c√°ch x·ª≠ l√Ω l·ªói trong React Query v√† hi·ªÉn th·ªã th√¥ng b√°o cho ng∆∞·ªùi d√πng khi c√≥ l·ªói x·∫£y ra.

9. `C·∫•u h√¨nh v√† t√πy ch·ªânh`: B·∫°n s·∫Ω hi·ªÉu c√°ch c·∫•u h√¨nh (config) v√† t√πy ch·ªânh (custom) React Query theo nhu c·∫ßu d·ª± √°n, bao g·ªìm th·ªùi gian stale, s·ªë l·∫ßn t√°i th·ª≠, ƒë·ªô ∆∞u ti√™n v√† c√°c t√πy ch·ªçn kh√°c.

10. `Qu·∫£n l√Ω tr·∫°ng th√°i ·ª©ng d·ª•ng`: B·∫°n s·∫Ω bi·∫øt c√°ch s·ª≠ d·ª•ng React Query ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i ·ª©ng d·ª•ng v√† l√†m vi·ªác v·ªõi c√°c truy v·∫•n d·ªØ li·ªáu trong to√†n b·ªô ·ª©ng d·ª•ng.

- V·ªõi nh·ªØng ki·∫øn th·ª©c n√†y, b·∫°n s·∫Ω c√≥ kh·∫£ nƒÉng s·ª≠ d·ª•ng React Query ƒë·ªÉ x√¢y d·ª±ng c√°c ·ª©ng d·ª•ng React hi·ªáu qu·∫£, qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c d·ªØ li·ªáu m·ªôt c√°ch linh ho·∫°t v√† d·ªÖ d√†ng.

---

## ƒêi·ªÉm m·∫°nh v√† ƒëi·ªÉm y·∫øu c·ªßa React Query ?

- React Query c√≥ m·ªôt s·ªë ƒëi·ªÉm m·∫°nh v√† ƒëi·ªÉm y·∫øu sau ƒë√¢y:

- ‚úÖ ƒêi·ªÉm m·∫°nh:

  - ƒê∆°n gi·∫£n v√† d·ªÖ s·ª≠ d·ª•ng: React Query cung c·∫•p c√∫ ph√°p d·ªÖ hi·ªÉu v√† g·ªçn nh·∫π, gi√∫p vi·ªác qu·∫£n l√Ω d·ªØ li·ªáu v√† th·ª±c hi·ªán c√°c truy v·∫•n API tr·ªü n√™n ƒë∆°n gi·∫£n v√† d·ªÖ d√†ng.

  - Qu·∫£n l√Ω b·ªô nh·ªõ cache m·∫°nh m·∫Ω: React Query t·ª± ƒë·ªông qu·∫£n l√Ω b·ªô nh·ªõ cache cho d·ªØ li·ªáu truy v·∫•n, gi√∫p tƒÉng hi·ªáu su·∫•t v√† gi·∫£m s·ªë l∆∞·ª£ng cu·ªôc g·ªçi API kh√¥ng c·∫ßn thi·∫øt. C√°c truy v·∫•n ƒë∆∞·ª£c l∆∞u tr·ªØ trong b·ªô nh·ªõ cache v√† c√≥ th·ªÉ ƒë∆∞·ª£c t√°i s·ª≠ d·ª•ng khi c·∫ßn thi·∫øt.

  - H·ªó tr·ª£ cho t·∫•t c·∫£ c√°c lo·∫°i truy v·∫•n: React Query h·ªó tr·ª£ c√°c lo·∫°i truy v·∫•n phong ph√∫ nh∆∞ GET, POST, PUT, DELETE v√† cung c·∫•p c√°c ph∆∞∆°ng th·ª©c v√† t√≠nh nƒÉng linh ho·∫°t ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông truy v·∫•n ph·ª©c t·∫°p.

  - Cung c·∫•p c√°c t√≠nh nƒÉng ti√™n ti·∫øn: React Query cung c·∫•p c√°c t√≠nh nƒÉng m·∫°nh m·∫Ω nh∆∞ `prefetching`, `pagination`, `realtime` `updates`, v√† `optimistic updates`, gi√∫p c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v√† tƒÉng kh·∫£ nƒÉng t∆∞∆°ng t√°c c·ªßa ·ª©ng d·ª•ng.

- ‚ùå ƒêi·ªÉm y·∫øu:

  - H·ªçc c√∫ ph√°p ban ƒë·∫ßu: React Query c√≥ m·ªôt s·ªë kh√°i ni·ªám m·ªõi v√† ph·∫£i h·ªçc c√∫ ph√°p v√† c√°c API c·ªßa n√≥. ƒêi·ªÅu n√†y c√≥ th·ªÉ ƒë√≤i h·ªèi m·ªôt th·ªùi gian ƒë·ªÉ l√†m quen v√† hi·ªÉu r√µ c√°ch th·ª©c ho·∫°t ƒë·ªông c·ªßa n√≥.

  - Ph·ª• thu·ªôc v√†o k·ªπ nƒÉng JavaScript: React Query l√† m·ªôt th∆∞ vi·ªán JavaScript v√† y√™u c·∫ßu b·∫°n c√≥ ki·∫øn th·ª©c v·ªÅ JavaScript ƒë·ªÉ s·ª≠ d·ª•ng hi·ªáu qu·∫£. N·∫øu b·∫°n kh√¥ng quen v·ªõi JavaScript, c√≥ th·ªÉ m·∫•t th·ªùi gian ƒë·ªÉ l√†m quen v√† th√≠ch nghi v·ªõi React Query.

  - T√≠ch h·ª£p v·ªõi c√°c c√¥ng ngh·ªá kh√°c: M·∫∑c d√π React Query cung c·∫•p c√°c t√≠nh nƒÉng v√† API m·∫°nh m·∫Ω, nh∆∞ng c√≥ th·ªÉ c·∫ßn t√≠ch h·ª£p v·ªõi c√°c c√¥ng ngh·ªá kh√°c nh∆∞ Redux, React Router ho·∫∑c c√°c th∆∞ vi·ªán qu·∫£n l√Ω tr·∫°ng th√°i kh√°c. Vi·ªác t√≠ch h·ª£p n√†y c√≥ th·ªÉ ƒë√≤i h·ªèi ki·∫øn th·ª©c b·ªï sung v√† s·ª± ƒë·ªìng b·ªô gi·ªØa c√°c c√¥ng ngh·ªá kh√°c nhau.

  - T√≥m l·∫°i, React Query l√† m·ªôt th∆∞ vi·ªán m·∫°nh m·∫Ω v√† ti·ªán √≠ch ƒë·ªÉ qu·∫£n l√Ω d·ªØ li·ªáu v√† truy v·∫•n API trong ·ª©ng d·ª•ng React. M·∫∑c d√π c√≥ m·ªôt s·ªë ƒëi·ªÉm y·∫øu, nh∆∞ng v·ªõi nh·ªØng ƒëi·ªÉm m·∫°nh c·ªßa n√≥, n√≥ ƒë√£ tr·ªü th√†nh m·ªôt c√¥ng c·ª• ph·ªï bi·∫øn cho vi·ªác ph√°t tri·ªÉn ·ª©ng d·ª•ng React chuy√™n nghi·ªáp.

---

## Cho c√°c v√≠ d·ª• v·ªÅ React Query c∆° b·∫£n ?

- D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë v√≠ d·ª• c∆° b·∫£n v·ªÅ vi·ªác s·ª≠ d·ª•ng React Query:

## 1. S·ª≠ d·ª•ng `useQuery` ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu t·ª´ API:

```jsx
import { useQuery } from 'react-query'

function UserProfile({ userId }) {
  const { data, isLoading, error } = useQuery('userData', () => fetch(`/api/users/${userId}`).then((res) => res.json()))

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (error) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
    </div>
  )
}
```

‚ùì Gi·∫£i th√≠ch code chi ti·∫øt:

- ƒêo·∫°n code tr√™n l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ vi·ªác s·ª≠ d·ª•ng React Query ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu t·ª´ m·ªôt API. D∆∞·ªõi ƒë√¢y l√† c√°ch ho·∫°t ƒë·ªông c·ªßa code:

1. S·ª≠ d·ª•ng hook `useQuery` t·ª´ React Query ƒë·ªÉ t·∫°o m·ªôt truy v·∫•n. Truy·ªÅn v√†o `userData` l√† key ƒë·ªÉ x√°c ƒë·ªãnh truy v·∫•n n√†y.

2. Trong h√†m callback c·ªßa `useQuery`, ch√∫ng ta g·ªçi `fetch` API ƒë·ªÉ l·∫•y d·ªØ li·ªáu ng∆∞·ªùi d√πng t·ª´ `/api/users/${userId}`. K·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ API ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng ph∆∞∆°ng th·ª©c `res.json()`.

3. K·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ `useQuery` bao g·ªìm `data`, `isLoading` v√† `error`.

- `data`: D·ªØ li·ªáu c·ªßa truy v·∫•n, trong tr∆∞·ªùng h·ª£p n√†y l√† th√¥ng tin ng∆∞·ªùi d√πng nh∆∞ name v√† email.
- `isLoading`: Tr·∫°ng th√°i ƒëang t·∫£i d·ªØ li·ªáu (`isLoading` l√† `true`). N·∫øu ƒëang t·∫£i, hi·ªÉn th·ªã th√¥ng b√°o `"Loading..."`.
- `error`: L·ªói x·∫£y ra trong qu√° tr√¨nh truy v·∫•n. N·∫øu c√≥ l·ªói, hi·ªÉn th·ªã th√¥ng b√°o l·ªói.

4. D·ª±a v√†o tr·∫°ng th√°i `isLoading` v√† `error`, ch√∫ng ta hi·ªÉn th·ªã giao di·ªán t∆∞∆°ng ·ª©ng. N·∫øu ƒëang t·∫£i, hi·ªÉn th·ªã th√¥ng b√°o `"Loading..."`. N·∫øu c√≥ l·ªói, hi·ªÉn th·ªã th√¥ng b√°o l·ªói. N·∫øu kh√¥ng c√≥ l·ªói v√† d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l·∫•y th√†nh c√¥ng, hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng bao g·ªìm name v√† email.

- V·ªõi React Query, ch√∫ng ta c√≥ th·ªÉ d·ªÖ d√†ng th·ª±c hi·ªán vi·ªác truy v·∫•n d·ªØ li·ªáu t·ª´ API v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa truy v·∫•n. React Query t·ª± ƒë·ªông qu·∫£n l√Ω vi·ªác caching, l√†m m·ªõi d·ªØ li·ªáu v√† x·ª≠ l√Ω c√°c tr·∫°ng th√°i li√™n quan ƒë·∫øn truy v·∫•n. ƒêi·ªÅu n√†y gi√∫p ti·∫øt ki·ªám c√¥ng s·ª©c v√† gi·∫£m b·ªõt vi·ªác l·∫∑p l·∫°i code x·ª≠ l√Ω truy v·∫•n d·ªØ li·ªáu trong React components.

---

## 2. S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c t·∫°o, c·∫≠p nh·∫≠t ho·∫∑c x√≥a d·ªØ li·ªáu:

```jsx
import { useMutation } from 'react-query'

function CreateUserForm() {
  const createUser = useMutation((formData) =>
    fetch('/api/users', {
      method: 'POST',
      body: JSON.stringify(formData)
    }).then((res) => res.json())
  )

  const handleSubmit = (e) => {
    e.preventDefault()
    const formData = new FormData(e.target)
    createUser.mutate(Object.fromEntries(formData))
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='name' placeholder='Name' required />
      <input type='email' name='email' placeholder='Email' required />
      <button type='submit' disabled={createUser.isLoading}>
        {createUser.isLoading ? 'Creating...' : 'Create User'}
      </button>
    </form>
  )
}
```

‚ùì Gi·∫£i th√≠ch code chi ti·∫øt:

- ƒêo·∫°n code tr√™n l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng `useMutation` t·ª´ React Query ƒë·ªÉ th·ª±c hi·ªán m·ªôt mutation, c·ª• th·ªÉ l√† t·∫°o m·ªõi ng∆∞·ªùi d√πng th√¥ng qua API.

- D∆∞·ªõi ƒë√¢y l√† c√°ch ho·∫°t ƒë·ªông c·ªßa code:

1. S·ª≠ d·ª•ng hook `useMutation` t·ª´ React Query ƒë·ªÉ t·∫°o m·ªôt mutation. Truy·ªÅn v√†o m·ªôt h√†m callback, trong ƒë√≥ ch√∫ng ta s·ª≠ d·ª•ng `fetch` API ƒë·ªÉ g·ª≠i m·ªôt y√™u c·∫ßu POST ƒë·∫øn `/api/users` v·ªõi d·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ `formData`. K·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ API ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng ph∆∞∆°ng th·ª©c `res.json()`.

2. `useMutation` tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng c√≥ c√°c thu·ªôc t√≠nh v√† ph∆∞∆°ng th·ª©c li√™n quan ƒë·∫øn mutation:

- `mutate`: M·ªôt ph∆∞∆°ng th·ª©c ƒë·ªÉ th·ª±c hi·ªán mutation. Trong tr∆∞·ªùng h·ª£p n√†y, ch√∫ng ta g·ªçi `createUser.mutate` ƒë·ªÉ g·ª≠i y√™u c·∫ßu t·∫°o ng∆∞·ªùi d√πng v·ªõi d·ªØ li·ªáu t·ª´ `formData`.
- `isLoading`: Tr·∫°ng th√°i ƒëang t·∫£i. Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng `createUser.isLoading` ƒë·ªÉ ki·ªÉm tra xem mutation ƒëang ti·∫øn h√†nh hay kh√¥ng.

3. Trong h√†m `handleSubmit`, ch√∫ng ta x·ª≠ l√Ω s·ª± ki·ªán submit c·ªßa form. Ch√∫ng ta ngƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa form b·∫±ng c√°ch g·ªçi `e.preventDefault()`. Sau ƒë√≥, ch√∫ng ta t·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng `formData` t·ª´ c√°c tr∆∞·ªùng d·ªØ li·ªáu trong form s·ª≠ d·ª•ng `new FormData(e.target)`. Cu·ªëi c√πng, ch√∫ng ta g·ªçi `createUser.mutate` v·ªõi ƒë·ªëi s·ªë l√† ƒë·ªëi t∆∞·ª£ng `formData` ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th√¥ng qua `Object.fromEntries(formData)`.

4. Trong ph·∫ßn render, ch√∫ng ta hi·ªÉn th·ªã m·ªôt form v·ªõi hai tr∆∞·ªùng nh·∫≠p d·ªØ li·ªáu (name v√† email) v√† m·ªôt n√∫t "Create User" ƒë·ªÉ g·ª≠i y√™u c·∫ßu t·∫°o m·ªõi ng∆∞·ªùi d√πng. N√∫t "Create User" s·∫Ω b·ªã v√¥ hi·ªáu h√≥a (`disabled`) khi mutation ƒëang ti·∫øn h√†nh (d·ª±a tr√™n `createUser.isLoading`). VƒÉn b·∫£n c·ªßa n√∫t c≈©ng thay ƒë·ªïi t√πy thu·ªôc v√†o tr·∫°ng th√°i t·∫£i (`createUser.isLoading`).

- V·ªõi React Query, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng `useMutation` ƒë·ªÉ d·ªÖ d√†ng th·ª±c hi·ªán c√°c thao t√°c mutation nh∆∞ t·∫°o, c·∫≠p nh·∫≠t ho·∫∑c x√≥a d·ªØ li·ªáu (POST, PUT, DELETE). React Query s·∫Ω t·ª± ƒë·ªông qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa mutation v√† cung c·∫•p c√°c ph∆∞∆°ng th·ª©c v√† thu·ªôc t√≠nh ƒë·ªÉ theo d√µi v√† ƒëi·ªÅu khi·ªÉn qu√° tr√¨nh mutation.

---

## 3. S·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ x√≥a b·ªô nh·ªõ cache ho·∫∑c l√†m m·ªõi d·ªØ li·ªáu:

```jsx
import { useQueryClient } from 'react-query'

function ProfilePage({ userId }) {
  const queryClient = useQueryClient()

  const handleLogout = () => {
    // X√≥a b·ªô nh·ªõ cache c·ªßa t·∫•t c·∫£ c√°c truy v·∫•n
    queryClient.clear()

    // L√†m m·ªõi d·ªØ li·ªáu truy v·∫•n "userData"
    queryClient.invalidateQueries('userData')
  }

  return (
    <div>
      <h2>Welcome, User!</h2>
      <button onClick={handleLogout}>Logout</button>
    </div>
  )
}
```

‚ùì Gi·∫£i th√≠ch code chi ti·∫øt:

- ƒêo·∫°n code tr√™n l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng `useQueryClient` t·ª´ React Query ƒë·ªÉ qu·∫£n l√Ω b·ªô nh·ªõ cache v√† th·ª±c hi·ªán c√°c t√°c v·ª• li√™n quan ƒë·∫øn qu·∫£n l√Ω cache v√† truy v·∫•n.

- D∆∞·ªõi ƒë√¢y l√† c√°ch ho·∫°t ƒë·ªông c·ªßa code:

1. S·ª≠ d·ª•ng hook `useQueryClient` t·ª´ React Query ƒë·ªÉ nh·∫≠n m·ªôt instance c·ªßa `queryClient`, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ qu·∫£n l√Ω b·ªô nh·ªõ cache v√† th·ª±c hi·ªán c√°c thao t√°c li√™n quan ƒë·∫øn cache v√† truy v·∫•n.

2. Trong h√†m `handleLogout`, ch√∫ng ta th·ª±c hi·ªán hai t√°c v·ª•:

- `queryClient.clear()`: X√≥a b·ªô nh·ªõ cache c·ªßa t·∫•t c·∫£ c√°c truy v·∫•n. Ph∆∞∆°ng th·ª©c n√†y s·∫Ω x√≥a h·∫øt t·∫•t c·∫£ c√°c truy v·∫•n ƒë√£ ƒë∆∞·ª£c l∆∞u tr·ªØ trong cache, ƒë·∫£m b·∫£o r·∫±ng d·ªØ li·ªáu cache ƒë∆∞·ª£c l√†m m·ªõi ho√†n to√†n.
- `queryClient.invalidateQueries('userData')`: L√†m m·ªõi d·ªØ li·ªáu cho truy v·∫•n c√≥ key l√† `'userData'`. Ph∆∞∆°ng th·ª©c n√†y s·∫Ω x√≥a cache c·ªßa truy v·∫•n `'userData'`, ƒë·ªìng th·ªùi k√≠ch ho·∫°t m·ªôt truy v·∫•n m·ªõi ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ ngu·ªìn d·ªØ li·ªáu. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng sau khi ƒëƒÉng xu·∫•t, khi ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p l·∫°i, d·ªØ li·ªáu ng∆∞·ªùi d√πng m·ªõi nh·∫•t s·∫Ω ƒë∆∞·ª£c t·∫£i l·∫°i t·ª´ API.

3. Trong ph·∫ßn render, ch√∫ng ta hi·ªÉn th·ªã m·ªôt ti√™u ƒë·ªÅ ch√†o m·ª´ng ng∆∞·ªùi d√πng v√† m·ªôt n√∫t `"Logout"` ƒë·ªÉ th·ª±c hi·ªán ƒëƒÉng xu·∫•t. Khi ng∆∞·ªùi d√πng nh·∫•p v√†o n√∫t `"Logout"`, h√†m `handleLogout` s·∫Ω ƒë∆∞·ª£c g·ªçi ƒë·ªÉ x√≥a cache v√† l√†m m·ªõi d·ªØ li·ªáu truy v·∫•n `'userData'`.

- V·ªõi React Query, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ truy c·∫≠p v√† qu·∫£n l√Ω b·ªô nh·ªõ cache. Ch√∫ng ta c√≥ th·ªÉ x√≥a cache c·ªßa c√°c truy v·∫•n c·ª• th·ªÉ, l√†m m·ªõi d·ªØ li·ªáu t·ª´ ngu·ªìn d·ªØ li·ªáu v√† th·ª±c hi·ªán c√°c t√°c v·ª• qu·∫£n l√Ω cache kh√°c.

- ‚úÖ Tr√™n ƒë√¢y l√† 3 v√≠ d·ª• c∆° b·∫£n ƒë·ªÉ minh h·ªça vi·ªác s·ª≠ d·ª•ng React Query. C√≥ r·∫•t nhi·ªÅu t√≠nh nƒÉng v√† kh·∫£ nƒÉng trong React Query ƒë·ªÉ kh√°m ph√° v√† t√πy ch·ªânh theo nhu c·∫ßu c·ªßa d·ª± √°n.

---

## Cho c√°c v√≠ d·ª• v·ªÅ React Query n√¢ng cao ?

‚ùå‚ùå D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë v√≠ d·ª• v·ªÅ c√°ch s·ª≠ d·ª•ng React Query trong c√°c t√¨nh hu·ªëng n√¢ng cao:

1. Caching v√† L∆∞u tr·ªØ d·ªØ li·ªáu:

- S·ª≠ d·ª•ng React Query ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu tr√™n client-side v√† t·∫≠n d·ª•ng cache ƒë·ªÉ tr√°nh vi·ªác g·ªçi API li√™n t·ª•c khi d·ªØ li·ªáu kh√¥ng thay ƒë·ªïi.
- S·ª≠ d·ª•ng c√°c t√πy ch·ªçn nh∆∞ `staleTime` v√† `cacheTime` ƒë·ªÉ x√°c ƒë·ªãnh th·ªùi gian h·∫øt h·∫°n c·ªßa d·ªØ li·ªáu trong cache v√† c√°ch c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªõi.

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng caching v√† l∆∞u tr·ªØ d·ªØ li·ªáu trong React Query:

```jsx
import { useQuery } from 'react-query'

function UserProfile({ userId }) {
  const { data, isLoading } = useQuery(
    ['userData', userId],
    () => fetch(`/api/users/${userId}`).then((res) => res.json()),
    {
      // Caching d·ªØ li·ªáu trong 5 gi√¢y
      staleTime: 5000
    }
  )

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
    </div>
  )
}
```

- Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ l·∫•y d·ªØ li·ªáu ng∆∞·ªùi d√πng t·ª´ API. Ch√∫ng ta s·ª≠ d·ª•ng m·ªôt m·∫£ng `['userData', userId]` l√†m kh√≥a query ƒë·ªÉ ƒë·ªãnh danh query. N·∫øu kh√≥a query n√†y kh√¥ng thay ƒë·ªïi, React Query s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√£ l∆∞u tr·ªØ trong b·ªô nh·ªõ cache m√† kh√¥ng th·ª±c hi·ªán cu·ªôc g·ªçi m·∫°ng m·ªõi.

- Ngo√†i ra, ch√∫ng ta c≈©ng ƒë·∫∑t t√πy ch·ªçn `staleTime` l√† 5000 (t√≠nh b·∫±ng millisecond) ƒë·ªÉ ch·ªâ ƒë·ªãnh th·ªùi gian d·ªØ li·ªáu c√≥ th·ªÉ ƒë∆∞·ª£c coi l√† "c≈©" tr∆∞·ªõc khi n√≥ ƒë∆∞·ª£c coi l√† "h·∫øt h·∫°n" v√† c·∫ßn ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ API. Trong tr∆∞·ªùng h·ª£p n√†y, n·∫øu d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u tr·ªØ trong cache v√† ch∆∞a h·∫øt h·∫°n (th·ªùi gian staleTime ch∆∞a tr√¥i qua), React Query s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu t·ª´ cache m√† kh√¥ng g·ªçi API.

- ƒêi·ªÅu n√†y gi√∫p tƒÉng hi·ªáu su·∫•t ·ª©ng d·ª•ng b·∫±ng c√°ch tr√°nh c√°c cu·ªôc g·ªçi m·∫°ng kh√¥ng c·∫ßn thi·∫øt v√† s·ª≠ d·ª•ng d·ªØ li·ªáu ƒë√£ l∆∞u tr·ªØ trong cache ƒë·ªÉ hi·ªÉn th·ªã cho ng∆∞·ªùi d√πng nhanh ch√≥ng.

---

2. Pagination:

- S·ª≠ d·ª•ng React Query ƒë·ªÉ th·ª±c hi·ªán vi·ªác truy v·∫•n d·ªØ li·ªáu ph√¢n trang (`pagination`) t·ª´ API.
- S·ª≠ d·ª•ng `useInfiniteQuery` ƒë·ªÉ t·∫£i d·ªØ li·ªáu ph√¢n trang v√¥ h·∫°n v√† t·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu m·ªõi khi ng∆∞·ªùi d√πng cu·ªôn trang.

- ‚ùå‚ùå D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng `pagination` (c∆° b·∫£n) trong React Query:

```jsx
import { useQuery } from 'react-query'

function UserList() {
  const PAGE_SIZE = 10 // K√≠ch th∆∞·ªõc trang

  const { data, isLoading } = useQuery('userList', () =>
    fetch(`/api/users?page=1&pageSize=${PAGE_SIZE}`).then((res) => res.json())
  )

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User List</h2>
      {data.users.map((user) => (
        <div key={user.id}>
          <p>Name: {user.name}</p>
          <p>Email: {user.email}</p>
        </div>
      ))}
    </div>
  )
}
```

- Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ l·∫•y danh s√°ch ng∆∞·ªùi d√πng t·ª´ API v·ªõi trang ƒë·∫ßu ti√™n v√† k√≠ch th∆∞·ªõc trang ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a l√† `PAGE_SIZE`. Ch√∫ng ta s·ª≠ d·ª•ng kh√≥a query l√† `'userList'` ƒë·ªÉ ƒë·ªãnh danh query.

- Trang hi·ªán t·∫°i v√† k√≠ch th∆∞·ªõc trang ƒë∆∞·ª£c truy·ªÅn v√†o URL c·ªßa API (`/api/users?page=1&pageSize=${PAGE_SIZE}`) ƒë·ªÉ ch·ªâ ƒë·ªãnh trang v√† k√≠ch th∆∞·ªõc d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ API.

- Sau khi d·ªØ li·ªáu ƒë∆∞·ª£c tr·∫£ v·ªÅ, ch√∫ng ta c√≥ th·ªÉ l·∫∑p qua m·∫£ng `data.users` ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng. M·ªói ng∆∞·ªùi d√πng ƒë∆∞·ª£c hi·ªÉn th·ªã trong m·ªôt ph·∫ßn t·ª≠ `<div>`, v·ªõi th√¥ng tin nh∆∞ name v√† email.

- ƒê·ªÉ tri·ªÉn khai ch·ª©c nƒÉng ph√¢n trang, ch√∫ng ta c√≥ th·ªÉ thay ƒë·ªïi gi√° tr·ªã page trong URL v√† g·ªçi l·∫°i `useQuery` ƒë·ªÉ l·∫•y d·ªØ li·ªáu trang m·ªõi. Ch√∫ng ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c n√∫t ho·∫∑c c√°c th√†nh ph·∫ßn ƒëi·ªÅu h∆∞·ªõng kh√°c ƒë·ªÉ cho ph√©p ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng gi·ªØa c√°c trang.

- ‚ùå‚ùå V√≠ d·ª• Pagination (n√¢ng cao) c√≥ th√™m c√°c n√∫t `nextPage` v√† n√∫t `prevPage`

- ƒê·ªÉ th√™m ch·ª©c nƒÉng ƒëi·ªÅu h∆∞·ªõng gi·ªØa c√°c trang trong ch·ª©c nƒÉng ph√¢n trang, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng React Query ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n m·ªõi khi ng∆∞·ªùi d√πng chuy·ªÉn ƒë·ªïi gi·ªØa c√°c trang. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng n√∫t `"Previous"` v√† `"Next"` ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng gi·ªØa c√°c trang, bao g·ªìm ch·ª©c nƒÉng t√πy ch·ªçn ƒë·ªÉ hi·ªÉn th·ªã ch·ªâ m·ª•c c·ªßa t·ª´ng ng∆∞·ªùi d√πng v√† cho ph√©p ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng tr·ª±c ti·∫øp ƒë·∫øn m·ªôt trang c·ª• th·ªÉ:

```jsx
import { useState } from 'react'
import { useQuery, useQueryClient } from 'react-query'

function UserList() {
  const PAGE_SIZE = 10 // K√≠ch th∆∞·ªõc trang
  const queryClient = useQueryClient()
  const [pageIndex, setPageIndex] = useState(1)

  const { data, isLoading } = useQuery(['userList', pageIndex], () =>
    fetch(`/api/users?page=${pageIndex}&pageSize=${PAGE_SIZE}`).then((res) => res.json())
  )

  const handlePreviousPage = () => {
    const prevPageIndex = pageIndex - 1
    setPageIndex(prevPageIndex)
    queryClient.prefetchQuery(['userList', prevPageIndex])
  }

  const handleNextPage = () => {
    const nextPageIndex = pageIndex + 1
    setPageIndex(nextPageIndex)
    queryClient.prefetchQuery(['userList', nextPageIndex])
  }

  const handleGoToPage = (pageNumber) => {
    setPageIndex(pageNumber)
    queryClient.prefetchQuery(['userList', pageNumber])
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User List</h2>
      {data.users.map((user, index) => (
        <div key={user.id}>
          <p>
            {(pageIndex - 1) * PAGE_SIZE + index + 1}. Name: {user.name}
          </p>
          <p>Email: {user.email}</p>
        </div>
      ))}
      <div>
        <button onClick={handlePreviousPage} disabled={pageIndex === 1}>
          Previous
        </button>
        <button onClick={handleNextPage} disabled={pageIndex === data.totalPages}>
          Next
        </button>
      </div>
      <div>
        {Array.from({ length: data.totalPages }, (_, index) => index + 1).map((pageNumber) => (
          <button key={pageNumber} onClick={() => handleGoToPage(pageNumber)}>
            {pageNumber}
          </button>
        ))}
      </div>
    </div>
  )
}
```

- Trong phi√™n b·∫£n n√†y, ch√∫ng ta s·ª≠ d·ª•ng state `pageIndex` ƒë·ªÉ theo d√µi trang hi·ªán t·∫°i m√† ng∆∞·ªùi d√πng ƒëang xem. H√†m `handleGoToPage` cho ph√©p ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng tr·ª±c ti·∫øp ƒë·∫øn m·ªôt trang c·ª• th·ªÉ b·∫±ng c√°ch c·∫≠p nh·∫≠t `pageIndex` v√† g·ªçi `queryClient.prefetchQuery` ƒë·ªÉ t·∫£i d·ªØ li·ªáu trang m·ªõi.

- Ngo√†i ra, ch√∫ng ta c≈©ng hi·ªÉn th·ªã ch·ªâ m·ª•c c·ªßa t·ª´ng ng∆∞·ªùi d√πng b·∫±ng c√°ch t√≠nh to√°n `((pageIndex - 1) * PAGE_SIZE) + index + 1`. ƒêi·ªÅu n√†y cho ph√©p ch√∫ng ta hi·ªÉn th·ªã s·ªë th·ª© t·ª± duy nh·∫•t cho t·ª´ng ng∆∞·ªùi d√πng trong to√†n b·ªô danh s√°ch.

- Cu·ªëi c√πng, ch√∫ng ta c≈©ng hi·ªÉn th·ªã c√°c n√∫t s·ªë trang ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ ƒëi·ªÅu h∆∞·ªõng tr·ª±c ti·∫øp ƒë·∫øn m·ªôt trang c·ª• th·ªÉ. M·ªói n√∫t s·ªë trang s·∫Ω g·ªçi `handleGoToPage` v·ªõi s·ªë trang t∆∞∆°ng ·ª©ng khi ng∆∞·ªùi d√πng nh·∫•p v√†o.

## ‚ùå‚ùå Gi·∫£i th√≠ch chi ti·∫øt ƒëo·∫°n code tr√™n:

- Trong ƒëo·∫°n code tr√™n, ch√∫ng ta s·ª≠ d·ª•ng React Query ƒë·ªÉ ph√¢n trang danh s√°ch ng∆∞·ªùi d√πng. D∆∞·ªõi ƒë√¢y l√† c√°c ph·∫ßn quan tr·ªçng trong ƒëo·∫°n code:

- Khai b√°o v√† kh·ªüi t·∫°o c√°c bi·∫øn:

  - `PAGE_SIZE`: K√≠ch th∆∞·ªõc trang, x√°c ƒë·ªãnh s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng hi·ªÉn th·ªã tr√™n m·ªói trang (trong v√≠ d·ª• n√†y l√† 10 ng∆∞·ªùi tr√™n 1 page).
  - `queryClient`: S·ª≠ d·ª•ng hook `useQueryClient` ƒë·ªÉ t·∫°o m·ªôt instance c·ªßa `queryClient`, ƒë·∫°i di·ªán cho qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa React Query.
  - `pageIndex` v√† `setPageIndex`: S·ª≠ d·ª•ng hook `useState` ƒë·ªÉ l∆∞u tr·ªØ trang hi·ªán t·∫°i m√† ng∆∞·ªùi d√πng ƒëang xem v√† c·∫≠p nh·∫≠t gi√° tr·ªã c·ªßa `pageIndex`.

- S·ª≠ d·ª•ng hook `useQuery` ƒë·ªÉ l·∫•y d·ªØ li·ªáu danh s√°ch ng∆∞·ªùi d√πng:

  - Ch√∫ng ta s·ª≠ d·ª•ng key `['userList', pageIndex]` ƒë·ªÉ x√°c ƒë·ªãnh truy v·∫•n v√† tr·∫°ng th√°i c·ªßa n√≥.
  - Trong h√†m callback, ch√∫ng ta s·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i y√™u c·∫ßu ƒë·∫øn API v√† l·∫•y d·ªØ li·ªáu ng∆∞·ªùi d√πng theo `pageIndex` v√† `PAGE_SIZE`.
  - K·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ API s·∫Ω ƒë∆∞·ª£c g√°n v√†o bi·∫øn `data`, v√† tr·∫°ng th√°i `isLoading` s·∫Ω ch·ªâ ra li·ªáu d·ªØ li·ªáu ƒëang ƒë∆∞·ª£c t·∫£i hay kh√¥ng.

- X·ª≠ l√Ω ph√¢n trang v√† hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng:

  - Trong ph·∫ßn render, ch√∫ng ta hi·ªÉn th·ªã th√¥ng tin danh s√°ch ng∆∞·ªùi d√πng v√† s·ªë trang.
  - M·ªói ng∆∞·ªùi d√πng ƒë∆∞·ª£c hi·ªÉn th·ªã v·ªõi t√™n v√† email c·ªßa h·ªç.
  - Ch√∫ng ta t√≠nh to√°n ch·ªâ m·ª•c c·ªßa t·ª´ng ng∆∞·ªùi d√πng b·∫±ng c√¥ng th·ª©c `((pageIndex - 1) * PAGE_SIZE) + index + 1` ƒë·ªÉ hi·ªÉn th·ªã s·ªë th·ª© t·ª± duy nh·∫•t cho t·ª´ng ng∆∞·ªùi d√πng trong to√†n b·ªô danh s√°ch.
  - Ch√∫ng ta cung c·∫•p hai n√∫t `"Previous"` v√† `"Next"` ƒë·ªÉ ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng gi·ªØa c√°c trang tr∆∞·ªõc v√† sau. N√∫t `"Previous"` s·∫Ω ƒë∆∞·ª£c v√¥ hi·ªáu h√≥a n·∫øu ng∆∞·ªùi d√πng ƒëang ·ªü trang ƒë·∫ßu ti√™n, v√† n√∫t `"Next"` s·∫Ω ƒë∆∞·ª£c v√¥ hi·ªáu h√≥a n·∫øu ng∆∞·ªùi d√πng ƒëang ·ªü trang cu·ªëi c√πng.
  - Ch√∫ng ta s·ª≠ d·ª•ng m·ªôt m·∫£ng ƒë·ªÉ hi·ªÉn th·ªã c√°c n√∫t s·ªë trang, m·ªói n√∫t s·∫Ω c√≥ s·ªë trang t∆∞∆°ng ·ª©ng. Khi ng∆∞·ªùi d√πng nh·∫•p v√†o m·ªôt n√∫t s·ªë trang, ch√∫ng ta g·ªçi h√†m `handleGoToPage` v·ªõi s·ªë trang t∆∞∆°ng ·ª©ng ƒë·ªÉ ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn trang ƒë√≥.
  - C√°c n√∫t s·ªë trang c≈©ng ƒë∆∞·ª£c k√≠ch ho·∫°t theo tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa `pageIndex` v√† `data.totalPages`.

- X·ª≠ l√Ω s·ª± ki·ªán v√† prefetch truy v·∫•n:

  - Khi ng∆∞·ªùi d√πng nh·∫•p v√†o n√∫t `"Previous"` ho·∫∑c `"Next"`, ch√∫ng ta c·∫≠p nh·∫≠t `pageIndex` v√† s·ª≠ d·ª•ng `queryClient.prefetchQuery` ƒë·ªÉ prefetch truy v·∫•n cho trang tr∆∞·ªõc ho·∫∑c sau ƒë√≥.
  - Khi ng∆∞·ªùi d√πng nh·∫•p v√†o m·ªôt n√∫t s·ªë trang, ch√∫ng ta c≈©ng c·∫≠p nh·∫≠t `pageIndex` v√† prefetch truy v·∫•n cho trang ƒë√≥.
  - Vi·ªác prefetch truy v·∫•n gi√∫p t·∫£i tr∆∞·ªõc d·ªØ li·ªáu cho c√°c trang ti·∫øp theo, c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng khi h·ªç chuy·ªÉn ƒë·∫øn c√°c trang m·ªõi.

## ‚ùì‚ùì `((pageIndex - 1) * PAGE_SIZE) + index + 1`. T√¥i ch∆∞a hi·ªÉu c√°ch t√≠nh ch·ªâ m·ª•c hi·ªán s·ªë th·ª© t·ª± c·ªßa ng∆∞·ªùi d√πng, h√£y gi·∫£i th√≠ch c√¥ng th·ª©c ƒë√≥ ?

- C√¥ng th·ª©c `((pageIndex - 1) * PAGE_SIZE) + index + 1` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t√≠nh ch·ªâ m·ª•c ho·∫∑c s·ªë th·ª© t·ª± c·ªßa m·ªôt ng∆∞·ªùi d√πng trong m·ªôt danh s√°ch ph√¢n trang.

- Gi·∫£ s·ª≠ b·∫°n ƒëang l√†m vi·ªác v·ªõi m·ªôt danh s√°ch ng∆∞·ªùi d√πng ƒë∆∞·ª£c chia th√†nh c√°c trang c√≥ k√≠ch th∆∞·ªõc l√† `PAGE_SIZE` (s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng tr√™n m·ªói trang). C√¥ng th·ª©c n√†y s·∫Ω t√≠nh to√°n ch·ªâ m·ª•c c·ªßa ng∆∞·ªùi d√πng trong danh s√°ch t·ªïng th·ªÉ, kh√¥ng ph·ª• thu·ªôc v√†o trang hi·ªán t·∫°i.

- C√°ch t√≠nh to√°n nh∆∞ sau:

  - `pageIndex` l√† ch·ªâ m·ª•c c·ªßa trang hi·ªán t·∫°i, b·∫Øt ƒë·∫ßu t·ª´ 1. V√≠ d·ª•, trang ƒë·∫ßu ti√™n s·∫Ω c√≥ `pageIndex = 1`, trang th·ª© hai s·∫Ω c√≥ `pageIndex = 2`, v√† c·ª© ti·∫øp t·ª•c nh∆∞ v·∫≠y.
  - `PAGE_SIZE` l√† s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng tr√™n m·ªói trang.
  - `index` l√† ch·ªâ m·ª•c c·ªßa ng∆∞·ªùi d√πng trong ph·∫°m vi trang hi·ªán t·∫°i, b·∫Øt ƒë·∫ßu t·ª´ 0. V√≠ d·ª•, ng∆∞·ªùi d√πng ƒë·∫ßu ti√™n tr√™n trang s·∫Ω c√≥ `index = 0`, ng∆∞·ªùi d√πng th·ª© hai s·∫Ω c√≥ `index = 1`, v√† c·ª© ti·∫øp t·ª•c nh∆∞ v·∫≠y.

- C√¥ng th·ª©c s·∫Ω t√≠nh to√°n ch·ªâ m·ª•c c·ªßa ng∆∞·ªùi d√πng trong danh s√°ch t·ªïng th·ªÉ nh∆∞ sau:

  - `(pageIndex - 1) * PAGE_SIZE`: T√≠nh to√°n s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng ƒë√£ xu·∫•t hi·ªán tr∆∞·ªõc trang hi·ªán t·∫°i. V√≠ d·ª•, n·∫øu `pageIndex = 2` v√† `PAGE_SIZE = 10`, th√¨ c√≥ 10 ng∆∞·ªùi d√πng ƒë√£ xu·∫•t hi·ªán tr√™n trang ƒë·∫ßu ti√™n, n√™n c√¥ng th·ª©c n√†y s·∫Ω tr·∫£ v·ªÅ 10.
  - `index + 1`: C·ªông th√™m ch·ªâ m·ª•c c·ªßa ng∆∞·ªùi d√πng trong ph·∫°m vi trang hi·ªán t·∫°i (t√≠nh t·ª´ 0), sau ƒë√≥ tƒÉng th√™m 1 ƒë·ªÉ ƒë∆∞a v·ªÅ s·ªë th·ª© t·ª±. V√≠ d·ª•, n·∫øu `index = 3`, th√¨ c√¥ng th·ª©c n√†y s·∫Ω tr·∫£ v·ªÅ 4.

- K·∫øt qu·∫£ c·ªßa c√¥ng th·ª©c l√† ch·ªâ m·ª•c ho·∫∑c s·ªë th·ª© t·ª± c·ªßa ng∆∞·ªùi d√πng trong danh s√°ch t·ªïng th·ªÉ, b·∫Øt ƒë·∫ßu t·ª´ 1.

## ‚ùì‚ùì T√¥i ch∆∞a h√¨nh dung ra. H√£y cho v√≠ d·ª• t√≠nh th·ª≠ ?

- Ch√∫ng ta s·∫Ω l·∫•y v√≠ d·ª• v·ªõi `PAGE_SIZE = 10`, t·ª©c l√† c√≥ 10 ng∆∞·ªùi d√πng tr√™n m·ªói trang. Gi·∫£ s·ª≠ ch√∫ng ta ƒëang ·ªü `pageIndex = 3` (trang th·ª© 3) v√† xem x√©t ng∆∞·ªùi d√πng c√≥ `index = 5` (ng∆∞·ªùi d√πng th·ª© 6 tr√™n trang hi·ªán t·∫°i).

- √Åp d·ª•ng c√¥ng th·ª©c `((pageIndex - 1) * PAGE_SIZE) + index + 1`, ta c√≥:

- (3 - 1) \* 10 = 20: C√≥ 20 ng∆∞·ªùi d√πng ƒë√£ xu·∫•t hi·ªán tr∆∞·ªõc trang hi·ªán t·∫°i (2 trang ƒë·∫ßu).
- 5 + 1 = 6: Ng∆∞·ªùi d√πng th·ª© 6 tr√™n trang hi·ªán t·∫°i.

- K·∫øt h·ª£p hai gi√° tr·ªã n√†y, ta t√≠nh ƒë∆∞·ª£c ch·ªâ m·ª•c ho·∫∑c s·ªë th·ª© t·ª± c·ªßa ng∆∞·ªùi d√πng trong danh s√°ch t·ªïng th·ªÉ:

- 20 + 6 = 26: Ng∆∞·ªùi d√πng n√†y l√† ng∆∞·ªùi d√πng th·ª© 26 trong danh s√°ch t·ªïng th·ªÉ.

- V·∫≠y, trong tr∆∞·ªùng h·ª£p n√†y, ng∆∞·ªùi d√πng th·ª© 6 tr√™n trang 3 s·∫Ω c√≥ ch·ªâ m·ª•c ho·∫∑c s·ªë th·ª© t·ª± l√† 26.

---

3. Synchronization (ƒê·ªìng b·ªô h√≥a):

- S·ª≠ d·ª•ng React Query ƒë·ªÉ ƒë·ªìng b·ªô h√≥a d·ªØ li·ªáu gi·ªØa c√°c th√†nh ph·∫ßn v√† trang trong ·ª©ng d·ª•ng.
- S·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• nh∆∞ ghi d·ªØ li·ªáu m·ªõi v√†o cache, x√≥a cache v√† l√†m m·ªõi d·ªØ li·ªáu.

- ƒê·ªÉ minh h·ªça v√≠ d·ª• v·ªÅ ƒë·ªìng b·ªô h√≥a trong React Query, ta c√≥ th·ªÉ t∆∞·ªüng t∆∞·ª£ng m·ªôt ·ª©ng d·ª•ng chat real-time. Khi ng∆∞·ªùi d√πng g·ª≠i m·ªôt tin nh·∫Øn m·ªõi, ta mu·ªën tin nh·∫Øn ƒë√≥ xu·∫•t hi·ªán ngay l·∫≠p t·ª©c tr√™n giao di·ªán c·ªßa ng∆∞·ªùi nh·∫≠n m√† kh√¥ng c·∫ßn ph·∫£i `refresh` l·∫°i trang.

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• gi·∫£n ƒë∆°n v·ªÅ ƒë·ªìng b·ªô h√≥a tin nh·∫Øn trong m·ªôt ·ª©ng d·ª•ng chat s·ª≠ d·ª•ng React Query:

```jsx
import { useEffect } from 'react'
import { useQuery, useMutation, useQueryClient } from 'react-query'

function ChatRoom() {
  const queryClient = useQueryClient()

  const { data: messages, isLoading } = useQuery('messages', () => fetch('/api/messages').then((res) => res.json()))

  const addMessage = useMutation((newMessage) =>
    fetch('/api/messages', {
      method: 'POST',
      body: JSON.stringify(newMessage)
    }).then((res) => res.json())
  )

  useEffect(() => {
    const subscription = subscribeToRealtimeMessages((newMessage) => {
      // Khi nh·∫≠n ƒë∆∞·ª£c m·ªôt tin nh·∫Øn real-time m·ªõi
      queryClient.setQueryData('messages', (oldMessages) => [...oldMessages, newMessage])
    })

    return () => {
      // H·ªßy ƒëƒÉng k√Ω khi component b·ªã unmount
      subscription.unsubscribe()
    }
  }, [])

  const handleSendMessage = (message) => {
    addMessage.mutate(message)
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>Chat Room</h2>
      <MessageList messages={messages} />
      <SendMessageForm onSendMessage={handleSendMessage} />
    </div>
  )
}

function MessageList({ messages }) {
  return (
    <ul>
      {messages.map((message) => (
        <li key={message.id}>{message.text}</li>
      ))}
    </ul>
  )
}

function SendMessageForm({ onSendMessage }) {
  const handleSubmit = (e) => {
    e.preventDefault()
    const message = e.target.elements.message.value
    onSendMessage(message)
    e.target.reset()
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='message' placeholder='Type a message' required />
      <button type='submit'>Send</button>
    </form>
  )
}
```

- Trong v√≠ d·ª• tr√™n, ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ l·∫•y danh s√°ch tin nh·∫Øn t·ª´ API. Khi c√≥ tin nh·∫Øn m·ªõi ƒë∆∞·ª£c th√™m v√†o th√¥ng qua mutation `addMessage`, ch√∫ng ta s·ª≠ d·ª•ng `setQueryData` ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu c·ªßa truy v·∫•n `'messages'`. ƒêi·ªÅu n√†y s·∫Ω g√¢y ra vi·ªác re-render (k√≠ch ho·∫°t vi·ªác render l·∫°i) t·ª± ƒë·ªông v√† tin nh·∫Øn m·ªõi s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ngay l·∫≠p t·ª©c tr√™n giao di·ªán c·ªßa ng∆∞·ªùi nh·∫≠n.

- Th√™m v√†o ƒë√≥, ch√∫ng ta s·ª≠ d·ª•ng `useEffect` ƒë·ªÉ ƒëƒÉng k√Ω m·ªôt `subscription` ƒë·ªÉ l·∫Øng nghe tin nh·∫Øn real-time m·ªõi. Khi c√≥ tin nh·∫Øn m·ªõi ƒë·∫øn, ch√∫ng ta s·ª≠ d·ª•ng `setQueryData` ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu c·ªßa truy v·∫•n `'messages'`, t·ª´ ƒë√≥ k√≠ch ho·∫°t vi·ªác re-render (k√≠ch ho·∫°t vi·ªác render l·∫°i) v√† tin nh·∫Øn m·ªõi s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ngay l·∫≠p t·ª©c.

- ƒêi·ªÅu n√†y cho ph√©p ·ª©ng d·ª•ng chat c·ªßa ch√∫ng ta ƒë·ªìng b·ªô h√≥a tin nh·∫Øn gi·ªØa c√°c ng∆∞·ªùi d√πng v√† hi·ªÉn th·ªã nhanh ch√≥ng c√°c tin nh·∫Øn m·ªõi.

## üëâ Gi·∫£i th√≠ch chi ti·∫øt ƒëo·∫°n code tr√™n:

- Trong ƒëo·∫°n m√£ tr√™n, ch√∫ng ta c√≥ m·ªôt th√†nh ph·∫ßn (component) `ChatRoom` l√† m·ªôt component React ch·ªãu tr√°ch nhi·ªám hi·ªÉn th·ªã m·ªôt ph√≤ng chat. H√£y gi·∫£i th√≠ch t·ª´ng ph·∫ßn c·ªßa m√£ n√†y:

- Import dependencies: Ch√∫ng ta import hook `useEffect` t·ª´ th∆∞ vi·ªán React v√† c√°c hook `useQuery`, `useMutation`, `useQueryClient` t·ª´ th∆∞ vi·ªán React Query ƒë·ªÉ s·ª≠ d·ª•ng trong component.

- Kh·ªüi t·∫°o v√† s·ª≠ d·ª•ng hook `useQueryClient` v√† `useQuery`: Ch√∫ng ta s·ª≠ d·ª•ng hook `useQueryClient` ƒë·ªÉ l·∫•y instance c·ªßa `queryClient`, m·ªôt ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c cung c·∫•p b·ªüi React Query ƒë·ªÉ qu·∫£n l√Ω cache v√† th·ª±c hi·ªán c√°c t√°c v·ª• li√™n quan ƒë·∫øn truy v·∫•n. Ch√∫ng ta c≈©ng s·ª≠ d·ª•ng hook `useQuery` ƒë·ªÉ g·ª≠i m·ªôt truy v·∫•n ƒë·∫øn `/api/messages` ƒë·ªÉ l·∫•y d·ªØ li·ªáu tin nh·∫Øn t·ª´ server. K·∫øt qu·∫£ c·ªßa truy v·∫•n ƒë∆∞·ª£c l∆∞u trong bi·∫øn `messages`.

- Kh·ªüi t·∫°o v√† s·ª≠ d·ª•ng hook `useMutation`: Ch√∫ng ta s·ª≠ d·ª•ng hook `useMutation` ƒë·ªÉ t·∫°o m·ªôt mutation `addMessage`. Mutation n√†y ƒë·∫°i di·ªán cho h√†nh ƒë·ªông g·ª≠i tin nh·∫Øn m·ªõi l√™n server th√¥ng qua ph∆∞∆°ng th·ª©c POST c·ªßa endpoint `/api/messages`. Khi g·ªçi h√†m `addMessage.mutate(message)`, n√≥ s·∫Ω g·ª≠i tin nh·∫Øn m·ªõi l√™n server v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ t·ª´ server.

- S·ª≠ d·ª•ng hook `useEffect` ƒë·ªÉ ƒëƒÉng k√Ω v√† h·ªßy ƒëƒÉng k√Ω s·ª± ki·ªán real-time: Trong `useEffect`, ch√∫ng ta ƒëƒÉng k√Ω m·ªôt `subscription` ƒë·ªÉ l·∫Øng nghe c√°c tin nh·∫Øn real-time m·ªõi. Khi nh·∫≠n ƒë∆∞·ª£c m·ªôt tin nh·∫Øn m·ªõi, ch√∫ng ta s·ª≠ d·ª•ng `queryClient.setQueryData` ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu trong cache. B·∫±ng c√°ch truy·ªÅn v√†o key `messages` v√† m·ªôt h√†m callback, ch√∫ng ta th√™m tin nh·∫Øn m·ªõi v√†o danh s√°ch tin nh·∫Øn hi·ªán c√≥.

- X·ª≠ l√Ω s·ª± ki·ªán g·ª≠i tin nh·∫Øn: Khi ng∆∞·ªùi d√πng g·ª≠i tin nh·∫Øn th√¥ng qua form `SendMessageForm`, ch√∫ng ta g·ªçi h√†m `handleSendMessage` v√† truy·ªÅn n·ªôi dung tin nh·∫Øn v√†o. H√†m n√†y s·ª≠ d·ª•ng mutation `addMessage.mutate` ƒë·ªÉ g·ª≠i tin nh·∫Øn l√™n server.

- X·ª≠ l√Ω tr·∫°ng th√°i t·∫£i: N·∫øu ƒëang t·∫£i d·ªØ li·ªáu (`isLoading` l√† `true`), ch√∫ng ta hi·ªÉn th·ªã th√¥ng b√°o `"Loading..."`.

- Render giao di·ªán: Tr·∫£ v·ªÅ m·ªôt giao di·ªán ph√≤ng chat, bao g·ªìm ti√™u ƒë·ªÅ `"Chat Room"`, component `MessageList` ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch tin nh·∫Øn v√† component `SendMessageForm` ƒë·ªÉ cho ph√©p ng∆∞·ªùi d√πng g·ª≠i tin nh·∫Øn.

- `Component MessageList`: Nh·∫≠n danh s√°ch tin nh·∫Øn (`messages`) v√† hi·ªÉn th·ªã ch√∫ng d∆∞·ªõi d·∫°ng danh s√°ch (`ul`). M·ªói tin nh·∫Øn ƒë∆∞·ª£c hi·ªÉn th·ªã b·∫±ng m·ªôt m·ª•c (`li`) v·ªõi key l√† `message.id` v√† hi·ªÉn th·ªã n·ªôi dung tin nh·∫Øn (`message.text`).

- `Component SendMessageForm`:

  - Nh·∫≠n h√†m `onSendMessage` ƒë·ªÉ x·ª≠ l√Ω vi·ªác g·ª≠i tin nh·∫Øn m·ªõi. Khi ng∆∞·ªùi d√πng submit form, ch√∫ng ta l·∫•y n·ªôi dung tin nh·∫Øn t·ª´ `input` v√† g·ªçi h√†m `onSendMessage` ƒë·ªÉ g·ª≠i tin nh·∫Øn. Form s·∫Ω ƒë∆∞·ª£c reset sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng.

  - `onSendMessage` l√† m·ªôt prop c·ªßa component `SendMessageForm`. Khi ng∆∞·ªùi d√πng nh·∫•n submit trong form, h√†m `handleSubmit` ƒë∆∞·ª£c g·ªçi v√† n√≥ l·∫•y n·ªôi dung tin nh·∫Øn t·ª´ input. Sau ƒë√≥, h√†m `onSendMessage` ƒë∆∞·ª£c g·ªçi v√† truy·ªÅn n·ªôi dung tin nh·∫Øn t·ªõi ƒë√≥. Trong tr∆∞·ªùng h·ª£p n√†y, `onSendMessage={handleSendMessage}` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ g√°n h√†m `handleSendMessage` v√†o prop `onSendMessage` c·ªßa component `SendMessageForm`, v√¨ v·∫≠y khi ng∆∞·ªùi d√πng nh·∫•n submit, h√†m `handleSendMessage` s·∫Ω ƒë∆∞·ª£c g·ªçi ƒë·ªÉ x·ª≠ l√Ω vi·ªác g·ª≠i tin nh·∫Øn m·ªõi.

- ‚úÖ ƒêo·∫°n m√£ tr√™n m√¥ t·∫£ m·ªôt c√°ch s·ª≠ d·ª•ng React Query ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c v·ªõi d·ªØ li·ªáu tin nh·∫Øn trong m·ªôt ·ª©ng d·ª•ng chat.

## ‚ùì‚ùì ·ªû trong v√≠ d·ª• ƒë√≥, khi re-render l·∫°i c√≥ l√†m cho trang load l·∫°i kh√¥ng ?

- Trong v√≠ d·ª• tr√™n, khi c√≥ tin nh·∫Øn m·ªõi ƒë∆∞·ª£c th√™m v√†o v√† d·ªØ li·ªáu truy v·∫•n 'messages' ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng c√°ch s·ª≠ d·ª•ng `setQueryData`, React Query s·∫Ω t·ª± ƒë·ªông re-render c√°c th√†nh ph·∫ßn li√™n quan ƒë·∫øn truy v·∫•n ƒë√≥. Tuy nhi√™n, vi·ªác re-render n√†y kh√¥ng g√¢y ra vi·ªác load l·∫°i to√†n b·ªô trang.

- React Query s·ª≠ d·ª•ng c∆° ch·∫ø virtual DOM ƒë·ªÉ ch·ªâ c·∫≠p nh·∫≠t c√°c th√†nh ph·∫ßn b·ªã thay ƒë·ªïi trong c√¢y DOM th·ª±c t·∫ø, m√† kh√¥ng l√†m reload l·∫°i to√†n b·ªô trang web. Nh∆∞ v·∫≠y, ch·ªâ c√≥ ph·∫ßn giao di·ªán li√™n quan ƒë·∫øn danh s√°ch tin nh·∫Øn (component `MessageList`) s·∫Ω ƒë∆∞·ª£c re-render, trong khi c√°c th√†nh ph·∫ßn kh√°c v·∫´n ƒë∆∞·ª£c gi·ªØ nguy√™n tr·∫°ng th√°i v√† kh√¥ng b·ªã load l·∫°i.

- ƒêi·ªÅu n√†y gi√∫p t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t ·ª©ng d·ª•ng v√† ƒë·∫£m b·∫£o r·∫±ng vi·ªác c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªõi kh√¥ng l√†m m·∫•t ƒëi tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa c√°c th√†nh ph·∫ßn kh√°c tr√™n trang.

- ‚ùå‚ùå V√≠ d·ª• v·ªÅ ƒë·ªìng b·ªô v√† g·ª≠i tin nh·∫Øn n√¢ng cao h∆°n v·ªÅ React Query: ‚ùå‚ùå

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• n√¢ng cao h∆°n v·ªÅ ƒë·ªìng b·ªô h√≥a v√† g·ª≠i tin nh·∫Øn trong React Query:

```jsx
import { useState } from 'react'
import { useQuery, useMutation, useQueryClient } from 'react-query'

function ChatRoom() {
  const queryClient = useQueryClient()
  const [messageInput, setMessageInput] = useState('')

  // Truy v·∫•n ƒë·ªÉ l·∫•y danh s√°ch tin nh·∫Øn
  const { data: messages, isLoading: isLoadingMessages } = useQuery('messages', () =>
    fetch('/api/messages').then((res) => res.json())
  )

  // Mutation ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi
  const sendMessage = useMutation(
    (newMessage) =>
      fetch('/api/messages', {
        method: 'POST',
        body: JSON.stringify(newMessage) // Chuy·ªÉn t·ª´ object -> chu·ªói json
      }).then((res) => res.json()) // chuy·ªÉn t·ª´ chu·ªói json -> object
  )

  const handleSendMessage = async () => {
    if (messageInput.trim() === '') {
      return
    }

    const newMessage = {
      content: messageInput
    }

    await sendMessage.mutate(newMessage)

    // Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, ta s·∫Ω c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn
    queryClient.invalidateQueries('messages')

    setMessageInput('')
  }

  if (isLoadingMessages) {
    return <div>Loading messages...</div>
  }

  return (
    <div>
      <h2>Chat Room</h2>
      <div>
        {messages.map((message) => (
          <div key={message.id}>
            <p>{message.content}</p>
            <p>Sent by: {message.sender}</p>
          </div>
        ))}
      </div>
      <div>
        <input type='text' value={messageInput} onChange={(e) => setMessageInput(e.target.value)} />
        <button onClick={handleSendMessage}>Send</button>
      </div>
    </div>
  )
}
```

- Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng truy v·∫•n `useQuery` ƒë·ªÉ l·∫•y danh s√°ch tin nh·∫Øn t·ª´ API v√† mutation `useMutation` ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi. Khi ng∆∞·ªùi d√πng g·ª≠i tin nh·∫Øn, ch√∫ng ta s·ª≠ d·ª•ng `mutate` ƒë·ªÉ g·ªçi API g·ª≠i tin nh·∫Øn v√† sau ƒë√≥ c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn b·∫±ng c√°ch s·ª≠ d·ª•ng `invalidateQueries`. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng danh s√°ch tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c ƒë·ªìng b·ªô h√≥a v·ªõi d·ªØ li·ªáu m·ªõi nh·∫•t.

- Th√™m v√†o ƒë√≥, ch√∫ng ta ki·ªÉm tra xem `messageInput` c√≥ gi√° tr·ªã tr·ªëng hay kh√¥ng tr∆∞·ªõc khi g·ª≠i tin nh·∫Øn ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh h·ª£p l·ªá c·ªßa d·ªØ li·ªáu nh·∫≠p.

- V·ªõi v√≠ d·ª• n√†y, b·∫°n c√≥ th·ªÉ n√¢ng cao b·∫±ng c√°ch th√™m ch·ª©c nƒÉng nh∆∞ x√≥a tin nh·∫Øn, ch·ªânh s·ª≠a tin nh·∫Øn, g·ª≠i tin nh·∫Øn ri√™ng t∆∞ cho ng∆∞·ªùi d√πng kh√°c, v√† c√°c ch·ª©c nƒÉng ph·ª©c t·∫°p h∆°n n·ªØa t√πy thu·ªôc v√†o y√™u c·∫ßu c·ª• th·ªÉ c·ªßa ·ª©ng d·ª•ng c·ªßa b·∫°n.

## üëâ Gi·∫£i th√≠ch ƒëo·∫°n code chi ti·∫øt:

- ƒêo·∫°n code tr√™n tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng Chat Room ƒë∆°n gi·∫£n s·ª≠ d·ª•ng React Query. D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch t·ª´ng ph·∫ßn c·ªßa ƒëo·∫°n code:

- S·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ l·∫•y instance c·ªßa `queryClient`, m·ªôt ƒë·ªëi t∆∞·ª£ng qu·∫£n l√Ω c√°c truy v·∫•n trong React Query.

- S·ª≠ d·ª•ng `useState` ƒë·ªÉ l∆∞u tr·ªØ gi√° tr·ªã c·ªßa √¥ nh·∫≠p tin nh·∫Øn (`messageInput`).

- S·ª≠ d·ª•ng `useQuery` ƒë·ªÉ truy v·∫•n danh s√°ch tin nh·∫Øn t·ª´ server. Truy v·∫•n n√†y ƒë∆∞·ª£c ƒë·∫∑t t√™n l√† `'messages'`, v√† n√≥ g·ªçi API `/api/messages` ƒë·ªÉ l·∫•y d·ªØ li·ªáu. K·∫øt qu·∫£ truy v·∫•n ƒë∆∞·ª£c l∆∞u trong bi·∫øn `messages`, v√† bi·∫øn `isLoadingMessages` cho bi·∫øt tr·∫°ng th√°i c·ªßa vi·ªác t·∫£i d·ªØ li·ªáu.

- S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o mutation `sendMessage`. Mutation n√†y d√πng ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi l√™n server th√¥ng qua API `/api/messages`. Khi mutation n√†y ƒë∆∞·ª£c g·ªçi, tin nh·∫Øn m·ªõi ƒë∆∞·ª£c g·ª≠i ƒëi v√† k·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ server ƒë∆∞·ª£c tr·∫£ v·ªÅ t·ª´ `mutate`.

- H√†m `handleSendMessage` ƒë∆∞·ª£c g·ªçi khi ng∆∞·ªùi d√πng nh·∫•n n√∫t `"Send"`. Tr∆∞·ªõc khi g·ª≠i tin nh·∫Øn, h√†m ki·ªÉm tra xem √¥ nh·∫≠p tin nh·∫Øn c√≥ r·ªóng hay kh√¥ng. N·∫øu r·ªóng, kh√¥ng l√†m g√¨ c·∫£. N·∫øu kh√¥ng, tin nh·∫Øn m·ªõi ƒë∆∞·ª£c t·∫°o v·ªõi n·ªôi dung t·ª´ √¥ nh·∫≠p tin nh·∫Øn v√† g·ªçi `sendMessage.mutate(newMessage)` ƒë·ªÉ g·ª≠i tin nh·∫Øn l√™n server. Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, danh s√°ch tin nh·∫Øn ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`. Cu·ªëi c√πng, √¥ nh·∫≠p tin nh·∫Øn ƒë∆∞·ª£c ƒë·∫∑t l·∫°i th√†nh r·ªóng.

- Trong tr∆∞·ªùng h·ª£p ƒëang t·∫£i tin nh·∫Øn, hi·ªÉn th·ªã th√¥ng b√°o `"Loading messages..."`.

- Hi·ªÉn th·ªã danh s√°ch tin nh·∫Øn v√† giao di·ªán g·ª≠i tin nh·∫Øn. M·ªói tin nh·∫Øn ƒë∆∞·ª£c hi·ªÉn th·ªã b·∫±ng c√°ch l·∫∑p qua m·∫£ng `messages` v√† hi·ªÉn th·ªã n·ªôi dung tin nh·∫Øn v√† ng∆∞·ªùi g·ª≠i t∆∞∆°ng ·ª©ng. √î nh·∫≠p tin nh·∫Øn v√† n√∫t `"Send"` cho ph√©p ng∆∞·ªùi d√πng nh·∫≠p tin nh·∫Øn m·ªõi v√† g·ª≠i ƒëi.

- ‚úÖ ƒêo·∫°n code tr√™n tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng Chat Room ƒë∆°n gi·∫£n s·ª≠ d·ª•ng React Query. N√≥ s·ª≠ d·ª•ng c√°c hooks c·ªßa React Query nh∆∞ `useQuery` v√† `useMutation` ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu v√† th·ª±c hi·ªán c√°c thay ƒë·ªïi, ƒë·ªìng th·ªùi s·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ qu·∫£n l√Ω c√°c truy v·∫•n v√† c·∫≠p nh·∫≠t d·ªØ li·ªáu. V·ªõi React Query, vi·ªác qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c v·ªõi API tr·ªü n√™n d·ªÖ d√†ng v√† linh ho·∫°t h∆°n.

- ‚ùå‚ùå Th√™m 1 v√†i ch·ª©c nƒÉng n√¢ng cao h∆°n: ‚ùå‚ùå

- D∆∞·ªõi ƒë√¢y l√† m·ªôt phi√™n b·∫£n ph√°t tri·ªÉn c·ªßa v√≠ d·ª• tr∆∞·ªõc ƒë√≥, bao g·ªìm ch·ª©c nƒÉng x√≥a tin nh·∫Øn, ch·ªânh s·ª≠a tin nh·∫Øn v√† g·ª≠i tin nh·∫Øn ri√™ng t∆∞ cho ng∆∞·ªùi d√πng kh√°c:

```jsx
import { useState } from 'react'
import { useQuery, useMutation, useQueryClient } from 'react-query'

function ChatRoom() {
  const queryClient = useQueryClient()
  const [messageInput, setMessageInput] = useState('')
  const [editingMessageId, setEditingMessageId] = useState(null)
  const [privateRecipient, setPrivateRecipient] = useState('')

  // Truy v·∫•n ƒë·ªÉ l·∫•y danh s√°ch tin nh·∫Øn
  const { data: messages, isLoading: isLoadingMessages } = useQuery('messages', () =>
    fetch('/api/messages').then((res) => res.json())
  )

  // Mutation ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi
  const sendMessage = useMutation(
    (newMessage) =>
      fetch('/api/messages', {
        method: 'POST',
        body: JSON.stringify(newMessage) // chuy·ªÉn t·ª´  object -> chu·ªói JSON
      }).then((res) => res.json()) // chuy·ªÉn t·ª´ chu·ªói JSON -> object javascript
  )

  // Mutation ƒë·ªÉ x√≥a tin nh·∫Øn
  const deleteMessage = useMutation(
    (messageId) =>
      fetch(`/api/messages/${messageId}`, {
        method: 'DELETE'
      }).then((res) => res.json()) // chuy·ªÉn t·ª´ chu·ªói JSON -> object javascript
  )

  // Mutation ƒë·ªÉ c·∫≠p nh·∫≠t tin nh·∫Øn
  const updateMessage = useMutation(
    (updatedMessage) =>
      fetch(`/api/messages/${updatedMessage.id}`, {
        method: 'PUT',
        body: JSON.stringify(updatedMessage) // chuy·ªÉn t·ª´  object -> chu·ªói JSON
      }).then((res) => res.json()) // chuy·ªÉn t·ª´ chu·ªói JSON -> object javascript
  )

  // Mutation ƒë·ªÉ g·ª≠i tin nh·∫Øn ri√™ng t∆∞
  const sendPrivateMessage = useMutation(
    (newPrivateMessage) =>
      fetch('/api/messages/private', {
        method: 'POST',
        body: JSON.stringify(newPrivateMessage) // chuy·ªÉn t·ª´  object -> chu·ªói JSON
      }).then((res) => res.json()) // chuy·ªÉn t·ª´ chu·ªói JSON -> object javascript
  )

  // X·ª≠ l√Ω g·ª≠i tin nh·∫Øn m·ªõi
  const handleSendMessage = async () => {
    if (messageInput.trim() === '') {
      return
    }

    const newMessage = {
      content: messageInput
    }

    await sendMessage.mutate(newMessage)

    // Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, ta s·∫Ω c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn
    queryClient.invalidateQueries('messages')

    setMessageInput('')
  }

  const handleDeleteMessage = async (messageId) => {
    await deleteMessage.mutate(messageId)

    // Sau khi x√≥a tin nh·∫Øn th√†nh c√¥ng, ta s·∫Ω c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn
    queryClient.invalidateQueries('messages')
  }

  const handleEditMessage = (messageId) => {
    setEditingMessageId(messageId)
  }

  const handleUpdateMessage = async (updatedContent) => {
    const updatedMessage = {
      id: editingMessageId,
      content: updatedContent
    }

    await updateMessage.mutate(updatedMessage)

    // Sau khi c·∫≠p nh·∫≠t tin nh·∫Øn th√†nh c√¥ng, ta s·∫Ω c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn
    queryClient.invalidateQueries('messages')

    setEditingMessageId(null)
  }

  // X·ª≠ l√Ω g·ª≠i tin nh·∫Øn ri√™ng t∆∞
  const handleSendPrivateMessage = async () => {
    if (messageInput.trim() === '' || privateRecipient.trim() === '') {
      return
    }

    const newPrivateMessage = {
      content: messageInput,
      recipient: privateRecipient
    }
    await sendPrivateMessage.mutate(newPrivateMessage)

    // Sau khi g·ª≠i tin nh·∫Øn ri√™ng t∆∞ th√†nh c√¥ng, ta s·∫Ω c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn
    queryClient.invalidateQueries('messages')

    setMessageInput('')
    setPrivateRecipient('')
  }

  if (isLoadingMessages) {
    return <div>Loading messages...</div>
  }

  return (
    <div>
      <h2>Chat Room</h2>
      <div>
        {messages.map((message) => (
          <div key={message.id}>
            {editingMessageId === message.id ? (
              <div>
                <input type='text' value={message.content} onChange={(e) => handleUpdateMessage(e.target.value)} />
                <button onClick={() => setEditingMessageId(null)}>Cancel</button>
              </div>
            ) : (
              <div>
                <p>{message.content}</p>
                <p>Sent by: {message.sender}</p>
                <button onClick={() => handleDeleteMessage(message.id)}>Delete</button>
                <button onClick={() => handleEditMessage(message.id)}>Edit</button>
              </div>
            )}
          </div>
        ))}
      </div>
      <div>
        <input type='text' value={messageInput} onChange={(e) => setMessageInput(e.target.value)} />
        <button onClick={handleSendMessage}>Send</button>
      </div>
    </div>
  )
}
```

- Trong v√≠ d·ª• tr√™n, ch√∫ng ta ƒë√£ s·ª≠ d·ª•ng hai mutation ƒë·ªÉ x·ª≠ l√Ω c√°c h√†nh ƒë·ªông x√≥a v√† c·∫≠p nh·∫≠t tin nh·∫Øn. Khi x√≥a tin nh·∫Øn, ch√∫ng ta g·ªçi mutation `deleteMessage` v√† sau ƒë√≥ c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`. T∆∞∆°ng t·ª±, khi c·∫≠p nh·∫≠t tin nh·∫Øn, ch√∫ng ta g·ªçi mutation `updateMessage` v√† sau ƒë√≥ c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng d·ªØ li·ªáu tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√† ƒë·ªìng b·ªô h√≥a ƒë√∫ng khi c√≥ s·ª± thay ƒë·ªïi.

- Th√™m v√†o ƒë√≥, ch√∫ng ta ƒë√£ th√™m ch·ª©c nƒÉng ch·ªânh s·ª≠a tin nh·∫Øn b·∫±ng c√°ch cho ph√©p ng∆∞·ªùi d√πng nh·∫•p v√†o n√∫t `"Edit"` ƒë·ªÉ k√≠ch ho·∫°t ch·∫ø ƒë·ªô ch·ªânh s·ª≠a v√† c·∫≠p nh·∫≠t n·ªôi dung tin nh·∫Øn. Khi ng∆∞·ªùi d√πng nh·∫•p v√†o n√∫t `"Cancel"`, ch√∫ng ta h·ªßy b·ªè ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.

- Ngo√†i ra, ch√∫ng ta c≈©ng ƒë√£ th√™m ch·ª©c nƒÉng g·ª≠i tin nh·∫Øn ri√™ng t∆∞ cho ng∆∞·ªùi d√πng kh√°c. Ng∆∞·ªùi d√πng c√≥ th·ªÉ nh·∫≠p n·ªôi dung tin nh·∫Øn v√†o √¥ input v√† nh·∫•p v√†o n√∫t `"Send"` ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi. Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, ch√∫ng ta c·∫≠p nh·∫≠t danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`.

- V·ªõi c√°c ch·ª©c nƒÉng n√†y, ch√∫ng ta c√≥ m·ªôt chat room ƒë∆°n gi·∫£n nh∆∞ng ƒë·∫ßy ƒë·ªß v·ªõi kh·∫£ nƒÉng g·ª≠i, x√≥a, ch·ªânh s·ª≠a v√† ƒë·ªìng b·ªô h√≥a tin nh·∫Øn.

## üëâ Gi·∫£i th√≠ch ƒëo·∫°n code chi ti·∫øt:

- ƒêo·∫°n code tr√™n tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng Chat Room s·ª≠ d·ª•ng React Query v·ªõi c√°c ch·ª©c nƒÉng nh∆∞ g·ª≠i tin nh·∫Øn, x√≥a tin nh·∫Øn, ch·ªânh s·ª≠a tin nh·∫Øn v√† g·ª≠i tin nh·∫Øn ri√™ng t∆∞ cho ng∆∞·ªùi d√πng kh√°c. D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch chi ti·∫øt v·ªÅ t·ª´ng ph·∫ßn trong ƒëo·∫°n code:

- `Khai b√°o c√°c state v√† hooks`:

  - `messageInput:` L∆∞u tr·ªØ n·ªôi dung tin nh·∫Øn m·ªõi nh·∫≠p t·ª´ ng∆∞·ªùi d√πng.
  - `editingMessageId:` L∆∞u tr·ªØ ID c·ªßa tin nh·∫Øn ƒëang ƒë∆∞·ª£c ch·ªânh s·ª≠a (n·∫øu c√≥).
  - S·ª≠ d·ª•ng hook `useState` ƒë·ªÉ kh·ªüi t·∫°o gi√° tr·ªã ban ƒë·∫ßu cho c√°c state v√† hooks.

- `Truy v·∫•n d·ªØ li·ªáu tin nh·∫Øn`:

  - S·ª≠ d·ª•ng `useQuery` ƒë·ªÉ truy v·∫•n danh s√°ch tin nh·∫Øn t·ª´ API.
  - Query key l√† `'messages'`, v√† trong callback, ta s·ª≠ d·ª•ng `fetch` ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ `'/api/messages'`.

- `Mutation ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi (sendMessage)`:

  - S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o mutation ƒë·ªÉ g·ª≠i tin nh·∫Øn m·ªõi.
  - Truy·ªÅn v√†o m·ªôt async function nh·∫≠n d·ªØ li·ªáu tin nh·∫Øn (`newMessage`).
  - S·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i POST request t·ªõi `'/api/messages'` v·ªõi n·ªôi dung tin nh·∫Øn v√† chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ th√†nh JSON.

- `Mutation ƒë·ªÉ x√≥a tin nh·∫Øn (deleteMessage)`:

  - S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o mutation ƒë·ªÉ x√≥a tin nh·∫Øn.
  - Truy·ªÅn v√†o m·ªôt async function nh·∫≠n ID c·ªßa tin nh·∫Øn (`messageId`).
  - S·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i DELETE request t·ªõi `'/api/messages/${messageId}'` v√† chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ th√†nh JSON.

- `Mutation ƒë·ªÉ c·∫≠p nh·∫≠t tin nh·∫Øn (updateMessage)`:

  - S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o mutation ƒë·ªÉ c·∫≠p nh·∫≠t tin nh·∫Øn.
  - Truy·ªÅn v√†o m·ªôt async function nh·∫≠n d·ªØ li·ªáu tin nh·∫Øn ƒë√£ ch·ªânh s·ª≠a (`updatedMessage`).
  - S·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i PUT request t·ªõi `'/api/messages/${updatedMessage.id}'` v·ªõi n·ªôi dung tin nh·∫Øn ƒë√£ ch·ªânh s·ª≠a v√† chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ th√†nh JSON.

- `Mutation g·ª≠i tin nh·∫Øn ri√™ng t∆∞ (sendPrivateMessage)`:

  - G·ª≠i m·ªôt y√™u c·∫ßu POST t·ªõi `/api/messages/private` v·ªõi body l√† ƒë·ªëi t∆∞·ª£ng `newPrivateMessage` ƒë√£ ƒë∆∞·ª£c chuy·ªÉn th√†nh chu·ªói JSON.
  - Nh·∫≠n l·∫°i k·∫øt qu·∫£ t·ª´ API v√† chuy·ªÉn th√†nh ƒë·ªëi t∆∞·ª£ng JSON.
  - H√†m `sendPrivateMessage.mutate` tr·∫£ v·ªÅ k·∫øt qu·∫£ c·ªßa y√™u c·∫ßu g·ª≠i tin nh·∫Øn ri√™ng t∆∞.

- `X·ª≠ l√Ω g·ª≠i tin nh·∫Øn m·ªõi (handleSendMessage)`:

  - Ki·ªÉm tra n·∫øu n·ªôi dung tin nh·∫Øn l√† tr·ªëng th√¨ kh√¥ng th·ª±c hi·ªán g·ª≠i tin nh·∫Øn. Do c√≥ ph∆∞∆°ng th·ª©c `trim()` c·ªßa JavaScript.
  - T·∫°o ƒë·ªëi t∆∞·ª£ng `newMessage` t·ª´ n·ªôi dung tin nh·∫Øn.
  - G·ªçi h√†m `sendMessage.mutate(newMessage)` ƒë·ªÉ g·ª≠i tin nh·∫Øn b·∫±ng mutation ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.
  - Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, ta c·∫≠p nh·∫≠t l·∫°i danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`.
  - Cu·ªëi c√πng, ƒë·∫∑t gi√° tr·ªã cho `messageInput` l√† chu·ªói r·ªóng ƒë·ªÉ x√≥a n·ªôi dung tin nh·∫Øn ƒë√£ nh·∫≠p.

- `X·ª≠ l√Ω x√≥a tin nh·∫Øn (handleDeleteMessage)`:

  - G·ªçi h√†m `deleteMessage.mutate(messageId)` ƒë·ªÉ x√≥a tin nh·∫Øn b·∫±ng mutation ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.
  - Sau khi x√≥a tin nh·∫Øn th√†nh c√¥ng, ta c·∫≠p nh·∫≠t l·∫°i danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`.

- `X·ª≠ l√Ω ch·ªânh s·ª≠a tin nh·∫Øn (handleEditMessage)`:

  - ƒê·∫∑t gi√° tr·ªã cho `editingMessageId` b·∫±ng ID c·ªßa tin nh·∫Øn ƒë∆∞·ª£c nh·∫≠n v√†o.
  - Khi `editingMessageId` kh√°c null, giao di·ªán tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.

- `X·ª≠ l√Ω c·∫≠p nh·∫≠t tin nh·∫Øn sau ch·ªânh s·ª≠a (handleUpdateMessage)`:

  - T·∫°o ƒë·ªëi t∆∞·ª£ng `updatedMessage` t·ª´ `editingMessageId` v√† n·ªôi dung tin nh·∫Øn ƒë√£ ch·ªânh s·ª≠a.
  - G·ªçi h√†m `updateMessage.mutate(updatedMessage)` ƒë·ªÉ c·∫≠p nh·∫≠t tin nh·∫Øn b·∫±ng mutation ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.
  - Sau khi c·∫≠p nh·∫≠t tin nh·∫Øn th√†nh c√¥ng, ta c·∫≠p nh·∫≠t l·∫°i danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')`.
  - Cu·ªëi c√πng, ƒë·∫∑t gi√° tr·ªã cho `editingMessageId` l√† null ƒë·ªÉ tho√°t kh·ªèi ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.

- `X·ª≠ l√Ω g·ª≠i tin nh·∫Øn ri√™ng t∆∞ (handleSendPrivateMessage)`:

  - Ki·ªÉm tra n·ªôi dung tin nh·∫Øn v√† ng∆∞·ªùi nh·∫≠n c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin hay kh√¥ng. N·∫øu kh√¥ng, h√†m s·∫Ω k·∫øt th√∫c v√† kh√¥ng th·ª±c hi·ªán g·ª≠i tin nh·∫Øn.
  - T·∫°o ƒë·ªëi t∆∞·ª£ng `newPrivateMessage` t·ª´ n·ªôi dung tin nh·∫Øn v√† ng∆∞·ªùi nh·∫≠n.
  - G·ªçi h√†m `sendPrivateMessage.mutate(newPrivateMessage)` ƒë·ªÉ g·ª≠i tin nh·∫Øn ri√™ng t∆∞ b·∫±ng mutation ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.
  - Sau khi g·ª≠i tin nh·∫Øn th√†nh c√¥ng, ta c·∫≠p nh·∫≠t l·∫°i danh s√°ch tin nh·∫Øn b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('messages')` ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã tin nh·∫Øn m·ªõi nh·∫•t.
  - Cu·ªëi c√πng, ƒë·∫∑t l·∫°i gi√° tr·ªã c·ªßa `messageInput` v√† `privateRecipient` th√†nh chu·ªói r·ªóng ƒë·ªÉ x√≥a n·ªôi dung tin nh·∫Øn v√† th√¥ng tin ng∆∞·ªùi nh·∫≠n ƒë√£ nh·∫≠p, chu·∫©n b·ªã cho vi·ªác g·ª≠i tin nh·∫Øn ti·∫øp theo.

- `Render giao di·ªán`:

  - Ki·ªÉm tra n·∫øu ƒëang t·∫£i tin nh·∫Øn, hi·ªÉn th·ªã th√¥ng b√°o `"Loading messages..."`.
  - Hi·ªÉn th·ªã danh s√°ch tin nh·∫Øn v√† c√°c n√∫t g·ª≠i, x√≥a, ch·ªânh s·ª≠a tin nh·∫Øn.
  - N·∫øu tin nh·∫Øn ƒëang ƒë∆∞·ª£c ch·ªânh s·ª≠a, hi·ªÉn th·ªã input v√† n√∫t `"Cancel"` ƒë·ªÉ h·ªßy ch·ªânh s·ª≠a.

- ‚úÖ T·ªïng quan, ƒëo·∫°n code tr√™n tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng Chat Room cho ph√©p g·ª≠i tin nh·∫Øn, x√≥a tin nh·∫Øn, ch·ªânh s·ª≠a tin nh·∫Øn v√† g·ª≠i tin nh·∫Øn ri√™ng t∆∞. N√≥ s·ª≠ d·ª•ng React Query ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i v√† t∆∞∆°ng t√°c v·ªõi API m·ªôt c√°ch d·ªÖ d√†ng v√† linh ho·∫°t.

---

4. Mutations (Thay ƒë·ªïi d·ªØ li·ªáu):

- S·ª≠ d·ª•ng React Query ƒë·ªÉ th·ª±c hi·ªán c√°c thay ƒë·ªïi d·ªØ li·ªáu nh∆∞ t·∫°o m·ªõi, c·∫≠p nh·∫≠t ho·∫∑c x√≥a d·ªØ li·ªáu th√¥ng qua mutations.
- S·ª≠ d·ª•ng `useMutation` ƒë·ªÉ g·ª≠i c√°c y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu ƒë·∫øn API v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa y√™u c·∫ßu.

---

5. Real-time Data (D·ªØ li·ªáu th·ªùi gian th·ª±c):

- S·ª≠ d·ª•ng React Query k·∫øt h·ª£p v·ªõi `WebSocket` ho·∫∑c c√¥ng ngh·ªá kh√°c ƒë·ªÉ nh·∫≠n d·ªØ li·ªáu th·ªùi gian th·ª±c t·ª´ server v√† t·ª± ƒë·ªông c·∫≠p nh·∫≠t d·ªØ li·ªáu tr√™n giao di·ªán ng∆∞·ªùi d√πng.

---

6. Error Handling (X·ª≠ l√Ω l·ªói):

- S·ª≠ d·ª•ng React Query ƒë·ªÉ x·ª≠ l√Ω l·ªói khi g·ªçi API v√† hi·ªÉn th·ªã th√¥ng b√°o l·ªói cho ng∆∞·ªùi d√πng.
- S·ª≠ d·ª•ng `onError` option ho·∫∑c `useErrorBoundary` ƒë·ªÉ x·ª≠ l√Ω l·ªói v√† th·ª±c hi·ªán c√°c h√†nh ƒë·ªông ph√π h·ª£p.

---

## React query c√≥ thay th·∫ø redux kh√¥ng ?

---

## Trong c√°c d·ª± √°n th√¨ c√¥ng ngh·ªá React Query c√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu kh√¥ng ?

---

## ‚úÖ‚úÖ Nh·∫Øc l·∫°i ki·∫øn th·ª©c c≈©:

üëâ `invalidateQueries` l√†m cho v√¥ hi·ªáu cache l√† sao ? T√¥i ch∆∞a hi·ªÉu l·∫Øm ? H√£y gi·∫£i th√≠ch nhi·ªÅu h∆°n, chi ti·∫øt h∆°n, v√† r√µ r√†ng h∆°n ?

- ƒê·ªÉ hi·ªÉu r√µ `invalidateQueries` l√†m g√¨, ch√∫ng ta c·∫ßn hi·ªÉu cache l√† g√¨ v√† n√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o trong React Query.

- Cache l√† m·ªôt kho d·ªØ li·ªáu t·∫°m th·ªùi ƒë∆∞·ª£c l∆∞u tr·ªØ ƒë·ªÉ ph·ª•c v·ª• cho vi·ªác truy xu·∫•t d·ªØ li·ªáu nhanh h∆°n. Thay v√¨ ph·∫£i t·∫£i d·ªØ li·ªáu t·ª´ API m·ªói l·∫ßn, React Query s·∫Ω l∆∞u k·∫øt qu·∫£ c·ªßa query v√†o cache.

- Khi b·∫°n th·ª±c hi·ªán query ti·∫øp theo, React Query s·∫Ω ki·ªÉm tra xem n√≥ c√≥ n·∫±m trong cache hay kh√¥ng. N·∫øu c√≥, n√≥ s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu t·ª´ cache thay v√¨ g·ªçi API. ƒêi·ªÅu n√†y gi√∫p c·∫£i thi·ªán hi·ªáu nƒÉng ·ª©ng d·ª•ng.

- Tuy nhi√™n, n·∫øu d·ªØ li·ªáu b·ªã thay ƒë·ªïi b·ªüi m·ªôt mutation, d·ªØ li·ªáu trong cache s·∫Ω l·ªói th·ªùi. ƒê·ªÉ kh·∫Øc ph·ª•c, ch√∫ng ta c·∫ßn v√¥ hi·ªáu h√≥a (invalidate) cache.

- `invalidateQueries` s·∫Ω:

- Xo√° d·ªØ li·ªáu c·ªßa c√°c query ƒë√£ ch·ªâ ƒë·ªãnh kh·ªèi cache
- Bu·ªôc React Query ph·∫£i g·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t cho nh·ªØng query ƒë√≥
- C·∫≠p nh·∫≠t k·∫øt qu·∫£ m·ªõi v√†o cache.

- N√≥i c√°ch kh√°c, `invalidateQueries` ƒë·∫£m b·∫£o r·∫±ng d·ªØ li·ªáu ƒë∆∞·ª£c tr·∫£ v·ªÅ t·ª´ cache lu√¥n l√† d·ªØ li·ªáu m·ªõi nh·∫•t, ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.

- V√≠ d·ª•, n·∫øu b·∫°n c·∫≠p nh·∫≠t m·ªôt todo, b·∫°n c·∫ßn g·ªçi `invalidateQueries('todos')` ƒë·ªÉ bu·ªôc todos query ph·∫£i l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t v√† c·∫≠p nh·∫≠t cache.

- Hi v·ªçng ƒëi·ªÅu n√†y gi√∫p b·∫°n hi·ªÉu r√µ h∆°n v·ªÅ `invalidateQueries` v√† cache trong React Query!

## ƒê√¢y l√† Docs c·ªßa ƒê∆∞·ª£c Dev:

Cu·ªëi c√πng th√¨ ch√∫ng ta c≈©ng ƒë√£ ƒëi ƒë·∫øn video cu·ªëi c√πng trong series n√†y, trong video n√†y th√¨ m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n nh·ªØng ki·∫øn th·ª©c cu·ªëi c√πng trong React Query. Yay üòÅ, hy v·ªçng qua series n√†y c√°c b·∫°n ƒë√£ h·ªçc ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÅu th√∫ v·ªã.

üíìKi·∫øn th·ª©c c√°c b·∫°n s·∫Ω ƒë∆∞·ª£c h·ªçc trong video n√†y:

üéâ Hi·ªÉu r√µ h∆°n c√°ch ho·∫°t ƒë·ªông c·ªßa fetching v·ªõi staleTime
üéâ T·∫°o spinner loading global d·ª±a tr√™n query v√† mutation
üéâ Bi·∫øt ƒë∆∞·ª£c c√°ch d√πng AbortController
üéâ Cancel Request trong React Query

üï∞Ô∏èN·ªôi dung ch√≠nh

```bash
00:00 - √în t·∫≠p l·∫°i staleTime
07:46 - Fetching Indicators
14:06 - Query Cancellation
```
