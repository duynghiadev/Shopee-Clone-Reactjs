## ÄÃ¢y lÃ  Docs tá»± research:

## HTTP Request lÃ  gÃ¬? CÃ¡c phÆ°Æ¡ng thá»©c HTTP request ?

- HTTP (Hypertext Transfer Protocol) lÃ  má»™t giao thá»©c truyá»n táº£i dá»¯ liá»‡u qua máº¡ng Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i trÃªn internet. NÃ³ Ä‘á»‹nh nghÄ©a cÃ¡ch cÃ¡c mÃ¡y tÃ­nh giao tiáº¿p vÃ  trao Ä‘á»•i thÃ´ng tin vá»›i nhau.

- Trong HTTP, cÃ¡c phÆ°Æ¡ng thá»©c (methods) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chá»‰ Ä‘á»‹nh má»¥c Ä‘Ã­ch hoáº·c hÃ nh Ä‘á»™ng mÃ  má»™t yÃªu cáº§u HTTP muá»‘n thá»±c hiá»‡n trÃªn tÃ i nguyÃªn.

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ phÆ°Æ¡ng thá»©c cÆ¡ báº£n trong HTTP:

1. `GET`: Sá»­ dá»¥ng Ä‘á»ƒ láº¥y thÃ´ng tin tá»« má»™t tÃ i nguyÃªn Ä‘Ã£ cho. YÃªu cáº§u GET khÃ´ng thay Ä‘á»•i dá»¯ liá»‡u trÃªn mÃ¡y chá»§ vÃ  chá»‰ tráº£ vá» dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c yÃªu cáº§u.

2. `POST`: Sá»­ dá»¥ng Ä‘á»ƒ gá»­i dá»¯ liá»‡u má»›i Ä‘áº¿n mÃ¡y chá»§ Ä‘á»ƒ táº¡o má»™t tÃ i nguyÃªn má»›i. YÃªu cáº§u POST thÆ°á»ng Ä‘i kÃ¨m vá»›i dá»¯ liá»‡u Ä‘Æ°á»£c gá»­i trong pháº§n thÃ¢n cá»§a yÃªu cáº§u.

3. `PUT`: Sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t hoáº·c táº¡o má»›i má»™t tÃ i nguyÃªn vá»›i ná»™i dung Ä‘Ã£ Ä‘Æ°á»£c cung cáº¥p. YÃªu cáº§u PUT thay Ä‘á»•i hoáº·c táº¡o má»›i tÃ i nguyÃªn theo Ä‘Æ°á»ng dáº«n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.

4. `DELETE`: Sá»­ dá»¥ng Ä‘á»ƒ xÃ³a má»™t tÃ i nguyÃªn Ä‘Ã£ cho. YÃªu cáº§u DELETE xÃ³a tÃ i nguyÃªn theo Ä‘Æ°á»ng dáº«n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.

- NgoÃ i ra, cÃ²n cÃ³ cÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c nhÆ° `OPTIONS`, `HEAD`, `PATCH`, `TRACE`, `CONNECT` Ä‘Æ°á»£c sá»­ dá»¥ng cho cÃ¡c má»¥c Ä‘Ã­ch Ä‘áº·c biá»‡t trong HTTP.

- Khi gá»­i má»™t yÃªu cáº§u HTTP, phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong pháº§n Ä‘áº§u yÃªu cáº§u gá»i lÃ  "phÆ°Æ¡ng thá»©c yÃªu cáº§u" (`request method`). MÃ¡y chá»§ nháº­n yÃªu cáº§u vÃ  xá»­ lÃ½ tÆ°Æ¡ng á»©ng vá»›i phÆ°Æ¡ng thá»©c Ä‘Ã³ Ä‘á»ƒ tráº£ vá» káº¿t quáº£ hoáº·c thá»±c hiá»‡n hÃ nh Ä‘á»™ng tÆ°Æ¡ng á»©ng.

- CÃ¡c phÆ°Æ¡ng thá»©c HTTP cung cáº¥p kháº£ nÄƒng thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng khÃ¡c nhau trÃªn tÃ i nguyÃªn, cho phÃ©p giao tiáº¿p vÃ  thay Ä‘á»•i dá»¯ liá»‡u trÃªn web.

## âŒâŒ LÆ°u Ã½: GET khÃ¡c vá»›i POST trong HTTP lÃ  gÃ¬ ? cÃ¡i nÃ o khi sá»­ dá»¥ng thÃ¬ thÃ´ng tin hiá»‡n lÃªn Ä‘Æ°á»ng dáº«n url ? cÃ i nÃ o khÃ´ng hiá»‡n thÃ´ng tin lÃªn url ?

- Trong HTTP, `GET` vÃ  `POST` lÃ  hai phÆ°Æ¡ng thá»©c khÃ¡c nhau Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truyá»n táº£i dá»¯ liá»‡u giá»¯a mÃ¡y chá»§ vÃ  trÃ¬nh duyá»‡t web.

- PhÆ°Æ¡ng thá»©c `GET` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ yÃªu cáº§u tÃ i nguyÃªn tá»« mÃ¡y chá»§ web vÃ  tráº£ vá» ná»™i dung cá»§a tÃ i nguyÃªn Ä‘Ã³. Khi sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `GET`, thÃ´ng tin yÃªu cáº§u cá»§a báº¡n Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m vÃ o URL dÆ°á»›i dáº¡ng `query string`, do Ä‘Ã³ thÃ´ng tin sáº½ hiá»ƒn thá»‹ trÃªn Ä‘Æ°á»ng dáº«n URL.

- PhÆ°Æ¡ng thá»©c `POST` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i dá»¯ liá»‡u Ä‘áº¿n mÃ¡y chá»§ web (`client gá»­i Ä‘áº¿n server`) Ä‘á»ƒ thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nháº¥t Ä‘á»‹nh. ThÃ´ng tin yÃªu cáº§u cá»§a báº¡n Ä‘Æ°á»£c gá»­i trong pháº§n `body` cá»§a yÃªu cáº§u HTTP vÃ  khÃ´ng hiá»ƒn thá»‹ trÃªn Ä‘Æ°á»ng dáº«n URL.

- VÃ¬ váº­y, khi sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `GET`, thÃ´ng tin yÃªu cáº§u sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn URL, trong khi Ä‘Ã³ khi sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `POST`, thÃ´ng tin sáº½ khÃ´ng Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn URL. PhÆ°Æ¡ng thá»©c `POST` thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng khi báº¡n cáº§n gá»­i dá»¯ liá»‡u lá»›n hoáº·c dá»¯ liá»‡u nháº¡y cáº£m, vÃ  khÃ´ng muá»‘n thÃ´ng tin Ä‘Ã³ Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn Ä‘Æ°á»ng dáº«n URL.

## HÃ£y Ä‘á»‹nh nghÄ©a hÃ m useMutation trong React Query ?

- Trong React Query, hÃ m `useMutation` nháº­n vÃ o má»™t hÃ m thá»±c thi thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u, thÆ°á»ng lÃ  má»™t hÃ m gá»i API Ä‘á»ƒ táº¡o, cáº­p nháº­t hoáº·c xÃ³a dá»¯ liá»‡u. HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi báº¡n muá»‘n thá»±c hiá»‡n má»™t thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

- CÃº phÃ¡p cá»§a `useMutation` nhÆ° sau:

```jsx
const mutation = useMutation(mutationFunction, options)
```

- `mutationFunction` lÃ  má»™t hÃ m mÃ  khi gá»i, nÃ³ sáº½ thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u. HÃ m nÃ y thÆ°á»ng gá»i API Ä‘á»ƒ gá»­i yÃªu cáº§u tá»›i mÃ¡y chá»§.
- `options` (tÃ¹y chá»n) lÃ  má»™t Ä‘á»‘i tÆ°á»£ng chá»©a cÃ¡c tuá»³ chá»n Ä‘á»ƒ tÃ¹y chá»‰nh hÃ nh vi cá»§a `useMutation`. ÄÃ¢y lÃ  má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ thá»ƒ bao gá»“m cÃ¡c thuá»™c tÃ­nh nhÆ° `onSuccess`, `onError`, `onSettled`, `onMutate`, `retry`, v.v.

- Khi sá»­ dá»¥ng `useMutation`, nÃ³ sáº½ tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng `mutation` vá»›i cÃ¡c thuá»™c tÃ­nh vÃ  phÆ°Æ¡ng thá»©c há»¯u Ã­ch Ä‘á»ƒ quáº£n lÃ½ tráº¡ng thÃ¡i vÃ  káº¿t quáº£ cá»§a thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u. Má»™t sá»‘ thuá»™c tÃ­nh quan trá»ng cá»§a Ä‘á»‘i tÆ°á»£ng `mutation` bao gá»“m:

  - `mutate`: Má»™t hÃ m Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kÃ­ch hoáº¡t thá»±c thi thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.
  - `isLoading`: Má»™t giÃ¡ trá»‹ `boolean` cho biáº¿t liá»‡u thao tÃ¡c Ä‘ang Ä‘Æ°á»£c thá»±c hiá»‡n hay khÃ´ng.
  - `isError`: Má»™t giÃ¡ trá»‹ `boolean` cho biáº¿t liá»‡u cÃ³ xáº£y ra lá»—i trong quÃ¡ trÃ¬nh thá»±c hiá»‡n thao tÃ¡c hay khÃ´ng.
  - `isSuccess`: Má»™t giÃ¡ trá»‹ `boolean` cho biáº¿t liá»‡u thao tÃ¡c Ä‘Ã£ thÃ nh cÃ´ng hay khÃ´ng.
  - `data`: Dá»¯ liá»‡u tráº£ vá» tá»« thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u (náº¿u thÃ nh cÃ´ng).

- Qua Ä‘Ã³, `useMutation` cho phÃ©p báº¡n dá»… dÃ ng quáº£n lÃ½ tráº¡ng thÃ¡i vÃ  káº¿t quáº£ cá»§a thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u trong React Query.

## Thuá»™c tÃ­nh trong React Query bao gá»“m nhá»¯ng gÃ¬ ?

- Trong React Query, khi sá»­ dá»¥ng `useMutation`, thuá»™c tÃ­nh Ä‘Æ°á»£c truyá»n vÃ o trong Ä‘á»‘i tÆ°á»£ng `mutationFunction` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng JSON (JavaScript Object Notation) chá»©a cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ (key-value) cá»§a dá»¯ liá»‡u báº¡n muá»‘n thay Ä‘á»•i. VÃ­ dá»¥:

```jsx
const mutation = useMutation(createUser, options)
```

- Trong vÃ­ dá»¥ trÃªn, `createUser` lÃ  má»™t hÃ m thá»±c hiá»‡n thao tÃ¡c táº¡o ngÆ°á»i dÃ¹ng (hoáº·c thay Ä‘á»•i dá»¯ liá»‡u khÃ¡c). Äá»‘i tÆ°á»£ng JSON chá»©a dá»¯ liá»‡u cáº§n thay Ä‘á»•i sáº½ Ä‘Æ°á»£c truyá»n vÃ o hÃ m nÃ y.

- VÃ­ dá»¥, náº¿u báº¡n muá»‘n táº¡o má»™t ngÆ°á»i dÃ¹ng má»›i vá»›i tÃªn lÃ  "David", tuá»•i lÃ  25, báº¡n cÃ³ thá»ƒ truyá»n má»™t Ä‘á»‘i tÆ°á»£ng JSON nhÆ° sau:

```jsx
const newUser = {
  name: 'David',
  age: 25
  // cÃ¡c thuá»™c tÃ­nh khÃ¡c náº¿u cáº§n
}

const mutation = useMutation(() => createUser(newUser), options)
```

- Trong Ä‘Ã³, `newUser` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng JSON chá»©a cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹. Má»—i khÃ³a Ä‘áº¡i diá»‡n cho má»™t thuá»™c tÃ­nh (vÃ­ dá»¥: 'name', 'age') vÃ  giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng lÃ  dá»¯ liá»‡u báº¡n muá»‘n thay Ä‘á»•i (vÃ­ dá»¥: 'David', 25).

- Khi thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u báº±ng cÃ¡ch gá»i `mutation.mutate()`, Ä‘á»‘i tÆ°á»£ng `mutationFunction` (trong vÃ­ dá»¥ lÃ  `createUser`) sáº½ Ä‘Æ°á»£c gá»i vÃ  nháº­n Ä‘á»‘i tÆ°á»£ng JSON nÃ y lÃ m Ä‘á»‘i sá»‘ Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

## VÃ­ dá»¥ trÃªn lÃ  truyá»n 1 dá»¯ liá»‡u tÄ©nh rá»“i. HÃ£y cho vÃ­ dá»¥ khÃ¡c truyá»n vÃ o má»™t Ä‘á»‘i tÆ°á»£ng Ä‘á»™ng ?

- Táº¥t nhiÃªn! DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ khÃ¡c, truyá»n vÃ o má»™t Ä‘á»‘i tÆ°á»£ng Ä‘á»™ng khi sá»­ dá»¥ng `useMutation` trong React Query:

- Gá»“m cÃ³ 2 Ä‘oáº¡n code: (chÃ½ Ä‘á»c tá»« trÃªn xuá»‘ng dÆ°á»›i)

```jsx
const mutation = useMutation(updateUser, {
  onSuccess: () => {
    // Xá»­ lÃ½ thÃ nh cÃ´ng sau khi mutation hoÃ n thÃ nh
    console.log('Cáº­p nháº­t ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng')
  },
  onError: (error) => {
    // Xá»­ lÃ½ khi cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh mutation
    console.error('Lá»—i khi cáº­p nháº­t ngÆ°á»i dÃ¹ng:', error)
  }
})

const handleUpdateUser = () => {
  const updatedUser = {
    id: 1,
    name: 'John Doe',
    age: 30
    // cÃ¡c thuá»™c tÃ­nh khÃ¡c náº¿u cáº§n
  }

  mutation.mutate(updatedUser)
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m `handleUpdateUser` Ä‘á»ƒ thá»±c hiá»‡n viá»‡c cáº­p nháº­t ngÆ°á»i dÃ¹ng. Tham sá»‘ Ä‘áº§u tiÃªn lÃ  Ä‘á»‘i tÆ°á»£ng `updatedUser` chá»©a thÃ´ng tin vá» ngÆ°á»i dÃ¹ng muá»‘n cáº­p nháº­t, bao gá»“m `id`, `name`, `age` vÃ  cÃ¡c thuá»™c tÃ­nh khÃ¡c (náº¿u cáº§n). Tham sá»‘ thá»© hai Ä‘Ã³ lÃ  option cá»§a hÃ m `useMutation`. Tham sá»‘ option nÃ y cÃ³ thá»ƒ tuá»³ chá»‰nh hÃ nh vi vÃ  xá»­ lÃ½ sau khi `mutation` hoÃ n thÃ nh hoáº·c xáº£y ra lá»—i.

- Khi gá»i `mutation.mutate(updatedUser)`, Ä‘á»‘i tÆ°á»£ng `updatedUser` sáº½ Ä‘Æ°á»£c truyá»n vÃ o `mutationFunction` (trong vÃ­ dá»¥ lÃ  `updateUser`) Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c cáº­p nháº­t dá»¯ liá»‡u.

- Trong `mutationFunction` (`updateUser`), báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng thÃ´ng tin tá»« Ä‘á»‘i tÆ°á»£ng `updatedUser` Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c cáº§n thiáº¿t, vÃ­ dá»¥:

```jsx
const updateUser = async (user) => {
  try {
    const response = await axios.put(`/api/users/${user.id}`, user)
    return response.data
  } catch (error) {
    throw new Error('Failed to update user')
  }
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `axios` Ä‘á»ƒ gá»­i yÃªu cáº§u PUT Ä‘áº¿n API vá»›i Ä‘Æ°á»ng dáº«n `/api/users/{userId}` Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng. Äá»‘i tÆ°á»£ng `user` Ä‘Æ°á»£c truyá»n vÃ o yÃªu cáº§u PUT chÃ­nh lÃ  `updatedUser` mÃ  chÃºng ta Ä‘Ã£ truyá»n vÃ o `mutation.mutate()`.

- Hy vá»ng ráº±ng vÃ­ dá»¥ nÃ y giÃºp báº¡n hiá»ƒu cÃ¡ch truyá»n má»™t Ä‘á»‘i tÆ°á»£ng Ä‘á»™ng khi sá»­ dá»¥ng `useMutation` trong React Query.

## Giáº£i thÃ­ch 2 Ä‘oáº¡n code á»Ÿ trÃªn:

âœ… Äoáº¡n code thá»© 1 (giáº£i thÃ­ch):

```jsx
const mutation = useMutation(updateUser, {
  onSuccess: () => {
    // Xá»­ lÃ½ thÃ nh cÃ´ng sau khi mutation hoÃ n thÃ nh
    console.log('Cáº­p nháº­t ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng')
  },
  onError: (error) => {
    // Xá»­ lÃ½ khi cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh mutation
    console.error('Lá»—i khi cáº­p nháº­t ngÆ°á»i dÃ¹ng:', error)
  }
})

const handleUpdateUser = () => {
  const updatedUser = {
    id: 1,
    name: 'John Doe',
    age: 30
    // cÃ¡c thuá»™c tÃ­nh khÃ¡c náº¿u cáº§n
  }

  mutation.mutate(updatedUser)
}
```

- Trong Ä‘oáº¡n code trÃªn, chÃºng ta sá»­ dá»¥ng `useMutation` tá»« React Query Ä‘á»ƒ táº¡o má»™t `mutation` (thay Ä‘á»•i dá»¯ liá»‡u) má»›i.

- `useMutation` nháº­n vÃ o hai tham sá»‘ chÃ­nh: `updateUser` vÃ  `options`.

  - `updateUser` lÃ  má»™t hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ thá»±c hiá»‡n viá»‡c cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng. Äá»‘i tÆ°á»£ng `updatedUser` Ä‘Æ°á»£c truyá»n vÃ o hÃ m nÃ y lÃ  Ä‘á»‘i tÆ°á»£ng chá»©a thÃ´ng tin cáº­p nháº­t, bao gá»“m `id`, `name`, `age` vÃ  cÃ¡c thuá»™c tÃ­nh khÃ¡c (náº¿u cÃ³).

  - `options` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng chá»©a cÃ¡c tuá»³ chá»n cho `mutation`. Trong Ä‘oáº¡n code trÃªn, báº¡n cÃ³ thá»ƒ thÃªm cÃ¡c tuá»³ chá»n nhÆ° `onSuccess`, `onError`, hoáº·c `onSettled` Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tráº¡ng thÃ¡i hoáº·c hÃ nh Ä‘á»™ng liÃªn quan Ä‘áº¿n `mutation`.

  - Trong vÃ­ dá»¥ trÃªn, chÃºng ta Ä‘Ã£ thÃªm má»™t Ä‘á»‘i tÆ°á»£ng `options` vÃ o hÃ m `useMutation`. Trong options, chÃºng ta Ä‘Ã£ sá»­ dá»¥ng hai thuá»™c tÃ­nh:

  - `onSuccess`: ÄÃ¢y lÃ  má»™t hÃ m Ä‘Æ°á»£c gá»i khi mutation hoÃ n thÃ nh thÃ nh cÃ´ng. Trong vÃ­ dá»¥ nÃ y, chÃºng ta chá»‰ Ä‘Æ¡n giáº£n ghi thÃ´ng bÃ¡o "Cáº­p nháº­t ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng" vÃ o console. Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i hoáº·c má»Ÿ rá»™ng hÃ nh Ä‘á»™ng tÆ°Æ¡ng á»©ng vá»›i thÃ nh cÃ´ng cá»§a mutation.

  - `onError`: ÄÃ¢y lÃ  má»™t hÃ m Ä‘Æ°á»£c gá»i khi cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh mutation. Trong vÃ­ dá»¥ nÃ y, chÃºng ta ghi thÃ´ng bÃ¡o lá»—i vÃ  hiá»ƒn thá»‹ ná»™i dung lá»—i trong console. Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i hoáº·c xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng lá»—i khÃ¡c tÃ¹y theo yÃªu cáº§u cá»§a báº¡n.

  - Vá»›i viá»‡c thÃªm options vÃ o `useMutation`, báº¡n cÃ³ thá»ƒ tuá»³ chá»‰nh hÃ nh vi vÃ  xá»­ lÃ½ sau khi mutation hoÃ n thÃ nh hoáº·c xáº£y ra lá»—i.

- Tiáº¿p theo, chÃºng ta Ä‘á»‹nh nghÄ©a hÃ m `handleUpdateUser` Ä‘á»ƒ thá»±c hiá»‡n viá»‡c cáº­p nháº­t ngÆ°á»i dÃ¹ng. Trong hÃ m nÃ y, chÃºng ta khai bÃ¡o má»™t Ä‘á»‘i tÆ°á»£ng `updatedUser` vá»›i cÃ¡c thuá»™c tÃ­nh cáº§n cáº­p nháº­t. Trong vÃ­ dá»¥ nÃ y, chÃºng ta cáº­p nháº­t ngÆ°á»i dÃ¹ng cÃ³ `id` lÃ  1, `name` lÃ  'John Doe', vÃ  `age` lÃ  30. Báº¡n cÃ³ thá»ƒ thÃªm hoáº·c chá»‰nh sá»­a cÃ¡c thuá»™c tÃ­nh khÃ¡c theo nhu cáº§u.

- Cuá»‘i cÃ¹ng, chÃºng ta gá»i `mutation.mutate(updatedUser)` Ä‘á»ƒ kÃ­ch hoáº¡t mutation vÃ  thá»±c hiá»‡n viá»‡c cáº­p nháº­t ngÆ°á»i dÃ¹ng. Äá»‘i tÆ°á»£ng `updatedUser` sáº½ Ä‘Æ°á»£c truyá»n vÃ o hÃ m `updateUser` Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng.

- Sau khi mutation hoÃ n thÃ nh, React Query sáº½ tá»± Ä‘á»™ng quáº£n lÃ½ tráº¡ng thÃ¡i vÃ  cung cáº¥p cÃ¡c giÃ¡ trá»‹ nhÆ° `isLoading`, `isError`, `isSuccess` Ä‘á»ƒ báº¡n cÃ³ thá»ƒ xá»­ lÃ½ káº¿t quáº£ hoáº·c hiá»ƒn thá»‹ giao diá»‡n tÆ°Æ¡ng á»©ng.

âœ… Äoáº¡n code thá»© 2 (giáº£i thÃ­ch):

```jsx
const updateUser = async (user) => {
  try {
    const response = await axios.put(`/api/users/${user.id}`, user)
    return response.data
  } catch (error) {
    throw new Error('Failed to update user')
  }
}
```

- Trong Ä‘oáº¡n code trÃªn, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m `updateUser` Ä‘á»ƒ thá»±c hiá»‡n viá»‡c cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng báº±ng cÃ¡ch gá»­i má»™t yÃªu cáº§u PUT Ä‘áº¿n endpoint `/api/users/{user.id}` trÃªn mÃ¡y chá»§.

  - Äáº§u tiÃªn, chÃºng ta sá»­ dá»¥ng thÆ° viá»‡n Axios Ä‘á»ƒ gá»­i yÃªu cáº§u PUT báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `axios.put()`. Äá»‘i sá»‘ Ä‘áº§u tiÃªn cá»§a phÆ°Æ¡ng thá»©c nÃ y lÃ  URL endpoint, trong Ä‘Ã³ chÃºng ta sá»­ dá»¥ng `user.id` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng cáº§n cáº­p nháº­t. Äá»‘i sá»‘ thá»© hai lÃ  `user`, Ä‘áº¡i diá»‡n cho Ä‘á»‘i tÆ°á»£ng chá»©a thÃ´ng tin cáº§n cáº­p nháº­t (trong vÃ­ dá»¥ nÃ y lÃ  `updatedUser`).

  - Sau khi gá»­i yÃªu cáº§u PUT, chÃºng ta chá» Ä‘á»£i pháº£n há»“i tá»« mÃ¡y chá»§ báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a `await`. Pháº£n há»“i Ä‘Æ°á»£c lÆ°u trá»¯ trong biáº¿n `response`.
  - Náº¿u yÃªu cáº§u Ä‘Æ°á»£c xá»­ lÃ½ thÃ nh cÃ´ng vÃ  nháº­n Ä‘Æ°á»£c pháº£n há»“i tá»« mÃ¡y chá»§, chÃºng ta tráº£ vá» dá»¯ liá»‡u tá»« pháº£n há»“i báº±ng cÃ¡ch sá»­ dá»¥ng `response.data`.
  - Trong trÆ°á»ng há»£p xáº£y ra lá»—i trong quÃ¡ trÃ¬nh gá»­i yÃªu cáº§u hoáº·c nháº­n pháº£n há»“i, má»™t ngoáº¡i lá»‡ (exception) sáº½ Ä‘Æ°á»£c nÃ©m ra báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a `throw new Error()`. Trong Ä‘oáº¡n code trÃªn, chÃºng ta nÃ©m ra má»™t ngoáº¡i lá»‡ vá»›i thÃ´ng bÃ¡o `'Failed to update user'`.

- Khi sá»­ dá»¥ng `useMutation` vÃ  truyá»n hÃ m `updateUser` vÃ o, React Query sáº½ quáº£n lÃ½ quÃ¡ trÃ¬nh `mutation`, xá»­ lÃ½ tráº¡ng thÃ¡i vÃ  cung cáº¥p cÃ¡c giÃ¡ trá»‹ nhÆ° `isLoading`, `isError`, `isSuccess` vÃ  `data` Ä‘á»ƒ xá»­ lÃ½ káº¿t quáº£ hoáº·c hiá»ƒn thá»‹ giao diá»‡n tÆ°Æ¡ng á»©ng.

## HÃ£y Ä‘á»‹nh nghÄ©a hÃ m useQuery trong React Query ?

ğŸ‘‰ Pháº§n nÃ y giáº£i thÃ­ch trong bÃ i há»c trÆ°á»›c ráº¥t ká»¹, báº¡n cÃ³ thá»ƒ má»Ÿ láº¡i file bÃ i cÅ© vÃ  xem láº¡i nhÃ© !!

ğŸ‘‰ Trong bÃ i nÃ y chá»‰ nÃªu sÆ¡ qua khÃ¡i niá»‡m Ä‘á»ƒ náº¯m láº¡i kiáº¿n thá»©c cÅ© thÃ´i nhÃ© !!

- Trong React Query, hÃ m `useQuery` lÃ  má»™t hook dÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c truy váº¥n dá»¯ liá»‡u. NÃ³ cho phÃ©p báº¡n láº¥y dá»¯ liá»‡u tá»« má»™t nguá»“n dá»¯ liá»‡u (cháº³ng háº¡n nhÆ° API) vÃ  tá»± Ä‘á»™ng quáº£n lÃ½ viá»‡c cáº­p nháº­t, caching vÃ  tÃ¡i sá»­ dá»¥ng dá»¯ liá»‡u.

- HÃ m `useQuery` cÃ³ cÃ¡c tham sá»‘ sau:

1. `queryKey` (required): Má»™t giÃ¡ trá»‹ hoáº·c máº£ng giÃ¡ trá»‹ Ä‘áº¡i diá»‡n cho khÃ³a truy váº¥n. KhÃ³a truy váº¥n xÃ¡c Ä‘á»‹nh loáº¡i dá»¯ liá»‡u vÃ  thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ láº¥y dá»¯ liá»‡u, cháº³ng háº¡n nhÆ° tÃªn API endpoint hoáº·c cÃ¡c tham sá»‘ truy váº¥n.

2. `queryFn` (required): Má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ (async) hoáº·c hÃ m tráº£ vá» má»™t Promise, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n vÃ  láº¥y dá»¯ liá»‡u tá»« nguá»“n dá»¯ liá»‡u. HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i bá»Ÿi React Query Ä‘á»ƒ láº¥y dá»¯ liá»‡u vÃ  tráº£ vá» káº¿t quáº£.

3. `config` (optional): Má»™t Ä‘á»‘i tÆ°á»£ng cáº¥u hÃ¬nh bá»• sung Ä‘á»ƒ Ä‘iá»u chá»‰nh hÃ nh vi cá»§a truy váº¥n. CÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh bao gá»“m:

   - `enabled`: XÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i cÃ³ cho phÃ©p truy váº¥n cháº¡y hay khÃ´ng. Máº·c Ä‘á»‹nh lÃ  true.

   - `staleTime`: Thá»i gian (milliseconds) mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c coi lÃ  "stale" (cÅ©) trÆ°á»›c khi truy váº¥n tá»± Ä‘á»™ng fetch dá»¯ liá»‡u má»›i tá»« nguá»“n dá»¯ liá»‡u. Máº·c Ä‘á»‹nh lÃ  0 (khÃ´ng sá»­ dá»¥ng caching).

   - `cacheTime`: Thá»i gian (milliseconds) mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trong cache trÆ°á»›c khi nÃ³ bá»‹ coi lÃ  "expired" (háº¿t háº¡n) vÃ  truy váº¥n sáº½ fetch dá»¯ liá»‡u má»›i. Máº·c Ä‘á»‹nh lÃ  `Infinity` (lÆ°u trá»¯ vÄ©nh viá»…n).

   - `onSuccess`: Má»™t hÃ m callback Ä‘Æ°á»£c gá»i khi truy váº¥n thÃ nh cÃ´ng vÃ  cÃ³ dá»¯ liá»‡u má»›i. HÃ m nÃ y cÃ³ tham sá»‘ lÃ  dá»¯ liá»‡u má»›i.

   - `onError`: Má»™t hÃ m callback Ä‘Æ°á»£c gá»i khi truy váº¥n gáº·p lá»—i. HÃ m nÃ y cÃ³ tham sá»‘ lÃ  Ä‘á»‘i tÆ°á»£ng lá»—i.

   - CÃ¡c tÃ¹y chá»n khÃ¡c nhÆ° `retry`, `retryDelay`, `onSettled`,...

- HÃ m `useQuery` tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng query, chá»©a cÃ¡c thÃ´ng tin liÃªn quan Ä‘áº¿n tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u cá»§a truy váº¥n, cÅ©ng nhÆ° cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i truy váº¥n nhÆ° `refetch`, `fetchMore`, `remove`,...

- Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»‘i tÆ°á»£ng query nÃ y Ä‘á»ƒ hiá»ƒn thá»‹ tráº¡ng thÃ¡i cá»§a truy váº¥n vÃ  dá»¯ liá»‡u tÆ°Æ¡ng á»©ng trong giao diá»‡n ngÆ°á»i dÃ¹ng. Khi cÃ³ sá»± thay Ä‘á»•i trong truy váº¥n (vÃ­ dá»¥: thÃ nh cÃ´ng, lá»—i, cáº­p nháº­t dá»¯ liá»‡u), React Query sáº½ tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n cá»§a báº¡n.

## hÃ£y cho vÃ­ dá»¥ vá» useQuery cÃ³ cÃ¡c tham sá»‘ cÆ¡ báº£n ?

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `useQuery` trong React Query Ä‘á»ƒ láº¥y danh sÃ¡ch bÃ i viáº¿t tá»« má»™t API:

```jsx
import { useQuery } from 'react-query'

const fetchPosts = async () => {
  const response = await fetch('api/posts')
  const data = await response.json()
  return data
}

function PostList() {
  const { data, isLoading, isError, error } = useQuery('posts', fetchPosts)

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post List</h1>
      <ul>
        {data.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  )
}
```

- Trong vÃ­ dá»¥ nÃ y, chÃºng ta sá»­ dá»¥ng `useQuery` Ä‘á»ƒ láº¥y danh sÃ¡ch bÃ i viáº¿t tá»« API. Äá»‘i sá»‘ Ä‘áº§u tiÃªn cá»§a `useQuery` lÃ  `queryKey`, trong trÆ°á»ng há»£p nÃ y lÃ  `'posts'`, Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u vÃ  thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ láº¥y danh sÃ¡ch bÃ i viáº¿t. Äá»‘i sá»‘ thá»© hai lÃ  `queryFn`, má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n vÃ  láº¥y dá»¯ liá»‡u tá»« API.

- Äá»‘i tÆ°á»£ng tráº£ vá» tá»« `useQuery` chá»©a cÃ¡c tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u cá»§a truy váº¥n, bao gá»“m `data` (danh sÃ¡ch bÃ i viáº¿t), `isLoading` (tráº¡ng thÃ¡i Ä‘ang táº£i), `isError` (tráº¡ng thÃ¡i lá»—i), vÃ  `error` (Ä‘á»‘i tÆ°á»£ng lá»—i). ChÃºng ta sá»­ dá»¥ng cÃ¡c tráº¡ng thÃ¡i nÃ y Ä‘á»ƒ hiá»ƒn thá»‹ ná»™i dung tÆ°Æ¡ng á»©ng trong giao diá»‡n ngÆ°á»i dÃ¹ng.

- Khi truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n, React Query sáº½ tá»± Ä‘á»™ng quáº£n lÃ½ viá»‡c láº¥y dá»¯ liá»‡u, caching vÃ  cáº­p nháº­t giao diá»‡n khi cÃ³ sá»± thay Ä‘á»•i trong tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u cá»§a truy váº¥n.

## Giáº£i thÃ­ch code:

-

## HÃ£y cho vÃ­ dá»¥ vá» useQuery cÃ³ Ä‘áº§y Ä‘á»§ cÃ¡c phÆ°Æ¡ng thá»©c queryKey, queryFn, staleTime, cacheTime, onSuccess, onError, refetch... ?

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `useQuery` vá»›i cÃ¡c phÆ°Æ¡ng thá»©c vÃ  tÃ¹y chá»n (optional) khÃ¡c nhau trong React Query:

```jsx
import { useQuery } from 'react-query'

const fetchUser = async (userId) => {
  const response = await fetch(`api/users/${userId}`)
  const data = await response.json()
  return data
}

function UserProfile({ userId }) {
  const queryConfig = {
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
    staleTime: 5000, // Thá»i gian háº¿t háº¡n cache lÃ  5 giÃ¢y (cÅ©)
    cacheTime: 60000, // Thá»i gian lÆ°u trá»¯ cache lÃ  1 phÃºt

    onSuccess: (data) => {
      console.log('Fetch user data success:', data)
    },

    onError: (error) => {
      console.error('Fetch user data error:', error)
    }
  }

  const { data, isLoading, isError, error, refetch } = useQuery(queryConfig)

  if (isLoading) {
    return <div>Loading user profile...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>User Profile</h1>
      <p>User ID: {userId}</p>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
      <button onClick={() => refetch()}>Refresh</button>
    </div>
  )
}
```

- Trong vÃ­ dá»¥ nÃ y, chÃºng ta sá»­ dá»¥ng `useQuery` Ä‘á»ƒ láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« API dá»±a trÃªn `userId`. ChÃºng ta cung cáº¥p cÃ¡c tÃ¹y chá»n vÃ  phÆ°Æ¡ng thá»©c khÃ¡c nhau trong Ä‘á»‘i tÆ°á»£ng `queryConfig` Ä‘á»ƒ tÃ¹y chá»‰nh cÃ¡ch truy váº¥n hoáº¡t Ä‘á»™ng.

- `queryKey` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  má»™t máº£ng `['user', userId]` Ä‘á»ƒ Ä‘áº¡i diá»‡n cho khÃ³a truy váº¥n. Náº¿u `userId` thay Ä‘á»•i, truy váº¥n sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c kÃ­ch hoáº¡t láº¡i.

  - Trong React Query, `queryKey` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»‹nh danh vÃ  xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u. Trong trÆ°á»ng há»£p cá»§a báº¡n, `queryKey` Ä‘Æ°á»£c Ä‘áº·t thÃ nh má»™t máº£ng `['user', userId]`.

  - Pháº§n tá»­ Ä‘áº§u tiÃªn cá»§a máº£ng, `'user'`, lÃ  má»™t chuá»—i Ä‘á»‹nh danh (identifier) cho truy váº¥n. NÃ³ Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u hoáº·c ngá»¯ cáº£nh cá»§a truy váº¥n. Äiá»u nÃ y giÃºp React Query quáº£n lÃ½ vÃ  lÆ°u trá»¯ káº¿t quáº£ truy váº¥n dá»¯ liá»‡u trong bá»™ nhá»› cache.

  - Pháº§n tá»­ thá»© hai cá»§a máº£ng, `userId`, lÃ  má»™t giÃ¡ trá»‹ Ä‘áº¡i diá»‡n cho thÃ´ng tin cá»¥ thá»ƒ mÃ  truy váº¥n Ä‘ang yÃªu cáº§u. ThÃ´ng thÆ°á»ng, Ä‘Ã¢y lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t, vÃ­ dá»¥ nhÆ° ID cá»§a ngÆ°á»i dÃ¹ng, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u tá»« mÃ¡y chá»§.

  - Khi báº¡n sá»­ dá»¥ng `queryKey` trong React Query, nÃ³ giÃºp xÃ¡c Ä‘á»‹nh má»™t truy váº¥n dá»¯ liá»‡u cá»¥ thá»ƒ. Vá»›i cÃ¹ng má»™t `queryKey`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u hooks vÃ  hÃ m React Query khÃ¡c nhau Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng liÃªn quan Ä‘áº¿n truy váº¥n nÃ y, vÃ­ dá»¥ nhÆ° `useQuery`, `useMutation`, `invalidateQueries`, vÃ  nhiá»u hÃ m khÃ¡c.

  - Vá»›i `queryKey: ['user', userId]`, React Query sáº½ sá»­ dá»¥ng Ä‘á»‹nh danh truy váº¥n lÃ  `'user'` vÃ  thÃ´ng tin cá»¥ thá»ƒ lÃ  `userId` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vÃ  quáº£n lÃ½ káº¿t quáº£ truy váº¥n dá»¯ liá»‡u liÃªn quan Ä‘áº¿n ngÆ°á»i dÃ¹ng cÃ³ ID tÆ°Æ¡ng á»©ng.

  - Vá»›i viá»‡c sá»­ dá»¥ng má»™t cáº·p `[key, value]` nhÆ° `['user', userId]`, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh danh truy váº¥n vÃ  láº¥y dá»¯ liá»‡u tÆ°Æ¡ng á»©ng tá»« cache cá»§a React Query. Viá»‡c sá»­ dá»¥ng Ä‘á»‹nh danh truy váº¥n giÃºp React Query tá»± Ä‘á»™ng quáº£n lÃ½ viá»‡c truy váº¥n dá»¯ liá»‡u vÃ  Ä‘á»“ng bá»™ hÃ³a káº¿t quáº£ giá»¯a cache vÃ  mÃ¡y chá»§.

  - `'user'` lÃ  Ä‘Æ°á»ng dáº«n url hay sao ?

  ğŸ‘‰ Trong ngá»¯ cáº£nh cá»§a React Query, `'user'` khÃ´ng Ä‘áº¡i diá»‡n cho má»™t Ä‘Æ°á»ng dáº«n (URL), mÃ  lÃ  má»™t chuá»—i Ä‘á»‹nh danh (identifier) cho truy váº¥n dá»¯ liá»‡u.

  ğŸ‘‰ Khi sá»­ dá»¥ng React Query, chÃºng ta thÆ°á»ng Ä‘á»‹nh nghÄ©a cÃ¡c truy váº¥n dá»¯ liá»‡u báº±ng cÃ¡ch sá»­ dá»¥ng má»™t chuá»—i Ä‘á»‹nh danh Ä‘á»ƒ xÃ¡c Ä‘á»‹nh loáº¡i dá»¯ liá»‡u hoáº·c ngá»¯ cáº£nh cá»§a truy váº¥n. Äiá»u nÃ y giÃºp React Query quáº£n lÃ½ vÃ  lÆ°u trá»¯ káº¿t quáº£ cá»§a truy váº¥n trong bá»™ nhá»› cache.

  ğŸ‘‰ VÃ­ dá»¥, trong trÆ°á»ng há»£p báº¡n muá»‘n truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« mÃ¡y chá»§, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `'user'` lÃ m Ä‘á»‹nh danh cho truy váº¥n nÃ y. Khi báº¡n gá»i `useQuery('user', ...)`, React Query sáº½ quáº£n lÃ½ káº¿t quáº£ truy váº¥n ngÆ°á»i dÃ¹ng vÃ  cung cáº¥p cÃ¡c giÃ¡ trá»‹ nhÆ° `isLoading`, `isError`, `isSuccess` vÃ  `data` liÃªn quan Ä‘áº¿n truy váº¥n nÃ y.

  ğŸ‘‰ VÃ¬ váº­y, `'user'` lÃ  má»™t chuá»—i Ä‘á»‹nh danh (identifier) cho truy váº¥n, khÃ´ng pháº£i Ä‘Æ°á»ng dáº«n (`URL`). ÄÆ°á»ng dáº«n sáº½ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh thÃ´ng qua cÃ¡ch gá»i API hoáº·c káº¿t há»£p vá»›i Ä‘á»‹nh danh truy váº¥n Ä‘á»ƒ táº¡o thÃ nh má»™t `URL` Ä‘áº§y Ä‘á»§ khi gá»­i yÃªu cáº§u Ä‘áº¿n mÃ¡y chá»§.

- âŒâŒ khi mÃ¬nh truy váº¥n Ä‘áº¿n `user`, mÃ  trong `user` Ä‘Ã³ cÃ³ 10 ngÆ°á»i thÃ¬ 10 ngÆ°á»i Ä‘Ã³ Ä‘Æ°á»£c lÆ°u trong vÃ´ trong 1 `userId` hay sao ?

  - Khi báº¡n truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng vÃ  cÃ³ 10 ngÆ°á»i trong káº¿t quáº£ truy váº¥n Ä‘Ã³, thÃ´ng tin cá»§a tá»«ng ngÆ°á»i dÃ¹ng sáº½ khÃ´ng Ä‘Æ°á»£c lÆ°u trong má»™t `userId` duy nháº¥t. Thay vÃ o Ä‘Ã³, má»—i ngÆ°á»i dÃ¹ng sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  quáº£n lÃ½ riÃªng láº» trong cache cá»§a React Query.

  - Khi sá»­ dá»¥ng React Query, má»—i má»¥c dá»¯ liá»‡u trong káº¿t quáº£ truy váº¥n Ä‘Æ°á»£c lÆ°u trá»¯ theo khÃ³a Ä‘á»‹nh danh (key) duy nháº¥t trong bá»™ nhá»› cache. Trong trÆ°á»ng há»£p cá»§a báº¡n, má»—i ngÆ°á»i dÃ¹ng trong danh sÃ¡ch Ä‘Æ°á»£c tráº£ vá» tá»« truy váº¥n dá»¯ liá»‡u sáº½ cÃ³ má»™t khÃ³a Ä‘á»‹nh danh riÃªng, khÃ´ng pháº£i chá»‰ lÃ  má»™t `userId` duy nháº¥t.

  - VÃ­ dá»¥, náº¿u báº¡n truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng vÃ  cÃ³ 10 ngÆ°á»i trong káº¿t quáº£, thÃ¬ trong cache cá»§a React Query sáº½ cÃ³ 10 má»¥c dá»¯ liá»‡u tÆ°Æ¡ng á»©ng vá»›i má»—i ngÆ°á»i dÃ¹ng. Má»—i má»¥c dá»¯ liá»‡u sáº½ cÃ³ má»™t khÃ³a Ä‘á»‹nh danh duy nháº¥t, vÃ­ dá»¥ `'user-1'`, `'user-2'`, ..., `'user-10'`. Äiá»u nÃ y giÃºp React Query quáº£n lÃ½ vÃ  truy xuáº¥t dá»¯ liá»‡u cá»§a tá»«ng ngÆ°á»i dÃ¹ng má»™t cÃ¡ch riÃªng láº».

  - Khi báº¡n truy cáº­p hoáº·c thay Ä‘á»•i dá»¯ liá»‡u cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng khÃ³a Ä‘á»‹nh danh tÆ°Æ¡ng á»©ng Ä‘á»ƒ thao tÃ¡c vá»›i dá»¯ liá»‡u Ä‘Ã³ trong cache cá»§a React Query.

- `queryFn` lÃ  má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n vÃ  láº¥y dá»¯ liá»‡u tá»« API. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta sá»­ dá»¥ng hÃ m `fetchUser` Ä‘á»ƒ láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« API dá»±a trÃªn `userId`.
- `staleTime` lÃ  thá»i gian háº¿t háº¡n vÃ  dá»¯ liá»‡u Ä‘Æ°á»£c coi lÃ  Ä‘Ã£ stale (cÅ©), trong trÆ°á»ng há»£p nÃ y lÃ  5 giÃ¢y. Sau thá»i gian nÃ y, náº¿u truy váº¥n Ä‘Æ°á»£c kÃ­ch hoáº¡t láº¡i, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t.
- `cacheTime` lÃ  thá»i gian lÆ°u trá»¯ cache, trong trÆ°á»ng há»£p nÃ y lÃ  1 phÃºt. Sau thá»i gian nÃ y, cache sáº½ bá»‹ xÃ³a khá»i bá»™ nhá»› vÃ  truy váº¥n sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t.
- `onSuccess` lÃ  má»™t hÃ m Ä‘Æ°á»£c gá»i khi truy váº¥n thÃ nh cÃ´ng. Trong vÃ­ dá»¥ nÃ y, chÃºng ta log thÃ´ng tin ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng vÃ o console.
- `onError` lÃ  má»™t hÃ m Ä‘Æ°á»£c gá»i khi truy váº¥n gáº·p lá»—i. Trong vÃ­ dá»¥ nÃ y, chÃºng ta log lá»—i truy váº¥n vÃ o console.
- `refetch` lÃ  má»™t phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c cung cáº¥p bá»Ÿi `useQuery` Ä‘á»ƒ gá»­i yÃªu cáº§u truy váº¥n láº¡i vÃ  cáº­p nháº­t dá»¯ liá»‡u. ChÃºng ta sá»­ dá»¥ng nÃºt "Refresh" Ä‘á»ƒ kÃ­ch hoáº¡t `refetch` khi ngÆ°á»i dÃ¹ng nháº¥p vÃ o.

- Vá»›i cáº¥u hÃ¬nh truy váº¥n vÃ  cÃ¡c phÆ°Æ¡ng thá»©c nÃ y, chÃºng ta cÃ³ thá»ƒ tÃ¹y chá»‰nh vÃ  sá»­ dá»¥ng `useQuery` Ä‘á»ƒ láº¥y vÃ  quáº£n lÃ½ dá»¯ liá»‡u tá»« API má»™t cÃ¡ch linh hoáº¡t trong á»©ng dá»¥ng React.

## DÆ°á»›i Ä‘Ã¢y lÃ  pháº§n giáº£i thÃ­ch Ä‘oáº¡n code trÃªn:

- Äoáº¡n code trÃªn lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng `useQuery` trong React Query Ä‘á»ƒ láº¥y thÃ´ng tin vá» má»™t ngÆ°á»i dÃ¹ng vÃ  hiá»ƒn thá»‹ trÃªn giao diá»‡n ngÆ°á»i dÃ¹ng. DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch tá»«ng pháº§n cá»§a mÃ£:

1. Import thÆ° viá»‡n vÃ  hÃ m `useQuery` tá»« React Query:

```jsx
import { useQuery } from 'react-query'
```

2. Äá»‹nh nghÄ©a hÃ m `fetchUser` Ä‘á»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« API:

```jsx
const fetchUser = async (userId) => {
  const response = await fetch(`api/users/${userId}`)
  const data = await response.json()
  return data
}
```

- Äoáº¡n code trÃªn Ä‘á»‹nh nghÄ©a má»™t hÃ m `fetchUser` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« mÃ¡y chá»§ sá»­ dá»¥ng API. DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch tá»«ng dÃ²ng code:

  1. `const fetchUser = async (userId) => {`: ÄÃ¢y lÃ  viá»‡c báº¯t Ä‘áº§u khai bÃ¡o má»™t hÃ m báº¥t Ä‘á»“ng bá»™ (async) cÃ³ tÃªn `fetchUser` vá»›i tham sá»‘ `userId`. HÃ m nÃ y sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« mÃ¡y chá»§.

  2. `const response = await fetch(api/users/${userId});`: DÃ²ng nÃ y sá»­ dá»¥ng hÃ m `fetch` Ä‘á»ƒ gá»­i má»™t yÃªu cáº§u `GET` Ä‘áº¿n Ä‘Æ°á»ng dáº«n `api/users/${userId}`. Biáº¿n `response` sáº½ chá»©a káº¿t quáº£ tráº£ vá» tá»« mÃ¡y chá»§.

  3. `const data = await response.json();`: DÃ²ng nÃ y sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `json()` cá»§a Ä‘á»‘i tÆ°á»£ng `response` Ä‘á»ƒ chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u tráº£ vá» thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript. HÃ m nÃ y tráº£ vá» má»™t Promise, vÃ¬ váº­y chÃºng ta sá»­ dá»¥ng tá»« khÃ³a `await` Ä‘á»ƒ Ä‘á»£i viá»‡c chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u thÃ nh cÃ´ng.

  4. `return data;`: DÃ²ng nÃ y tráº£ vá» dá»¯ liá»‡u ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript tá»« hÃ m `fetchUser`.

- Tá»•ng quan, hÃ m `fetchUser` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i má»™t yÃªu cáº§u truy váº¥n Ä‘áº¿n mÃ¡y chá»§ Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng dá»±a trÃªn `userId`. Sau khi nháº­n Ä‘Æ°á»£c káº¿t quáº£ tá»« mÃ¡y chá»§, dá»¯ liá»‡u Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript vÃ  tráº£ vá».

3. Äá»‹nh nghÄ©a component `UserProfile` nháº­n vÃ o `userId` lÃ m props:

```jsx
function UserProfile({ userId }) {
  // ...
}
```

4. Khai bÃ¡o biáº¿n `queryConfig` Ä‘á»ƒ cáº¥u hÃ¬nh truy váº¥n:

```jsx
const queryConfig = {
  queryKey: ['user', userId],
  queryFn: () => fetchUser(userId),
  staleTime: 5000,
  cacheTime: 60000,
  onSuccess: (data) => {
    console.log('Fetch user data success:', data)
  },
  onError: (error) => {
    console.error('Fetch user data error:', error)
  }
}
```

- Äoáº¡n mÃ£ trÃªn Ä‘á»‹nh nghÄ©a má»™t Ä‘á»‘i tÆ°á»£ng `queryConfig` chá»©a cÃ¡c cáº¥u hÃ¬nh cho má»™t truy váº¥n dá»¯ liá»‡u trong React Query. DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch tá»«ng thuá»™c tÃ­nh trong `queryConfig`:

  - `queryKey: ['user', userId]`: `queryKey` xÃ¡c Ä‘á»‹nh khÃ³a cá»§a truy váº¥n dá»¯ liá»‡u. Trong trÆ°á»ng há»£p nÃ y, `queryKey` lÃ  má»™t máº£ng chá»©a hai pháº§n tá»­. Pháº§n tá»­ Ä‘áº§u tiÃªn lÃ  chuá»—i `'user'`, Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n, vÃ  pháº§n tá»­ thá»© hai lÃ  giÃ¡ trá»‹ `userId` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ.

  - `queryFn: () => fetchUser(userId)`: `queryFn` lÃ  má»™t hÃ m Ä‘Æ°á»£c gá»i khi truy váº¥n dá»¯ liá»‡u Ä‘Æ°á»£c thá»±c hiá»‡n. Trong trÆ°á»ng há»£p nÃ y, `queryFn` sá»­ dá»¥ng hÃ m `fetchUser` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« mÃ¡y chá»§, vá»›i `userId` Ä‘Æ°á»£c truyá»n vÃ o nhÆ° má»™t tham sá»‘.

  - `staleTime: 5000`: `staleTime` xÃ¡c Ä‘á»‹nh thá»i gian (tÃ­nh báº±ng mili giÃ¢y) sau khi dá»¯ liá»‡u trá»Ÿ thÃ nh cÅ© (stale). Khi dá»¯ liá»‡u trá»Ÿ thÃ nh cÅ©, React Query sáº½ thá»±c hiá»‡n má»™t yÃªu cáº§u Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§. Trong trÆ°á»ng há»£p nÃ y, sau khi dá»¯ liá»‡u trá»Ÿ thÃ nh cÅ© trong vÃ²ng 5 giÃ¢y (5000 mili giÃ¢y), React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i.

  - `cacheTime: 60000`: `cacheTime` xÃ¡c Ä‘á»‹nh thá»i gian (tÃ­nh báº±ng mili giÃ¢y) mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache cá»§a React Query trÆ°á»›c khi bá»‹ xÃ³a Ä‘i. Trong trÆ°á»ng há»£p nÃ y, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c lÆ°u trong cache trong vÃ²ng 1 phÃºt (60000 mili giÃ¢y) trÆ°á»›c khi bá»‹ xÃ³a.

  - `onSuccess: (data) => { console.log('Fetch user data success:', data) }`: `onSuccess` lÃ  má»™t hÃ m callback Ä‘Æ°á»£c gá»i khi truy váº¥n dá»¯ liá»‡u thÃ nh cÃ´ng. Trong trÆ°á»ng há»£p nÃ y, khi dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y thÃ nh cÃ´ng tá»« mÃ¡y chá»§, hÃ m callback nÃ y sáº½ Ä‘Æ°á»£c gá»i vÃ  hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o thÃ nh cÃ´ng trÃªn `console` vá»›i dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n (`data`).

  - `onError: (error) => { console.error('Fetch user data error:', error) }`: `onError` lÃ  má»™t hÃ m callback Ä‘Æ°á»£c gá»i khi truy váº¥n dá»¯ liá»‡u gáº·p lá»—i. Trong trÆ°á»ng há»£p nÃ y, khi truy váº¥n dá»¯ liá»‡u gáº·p lá»—i, hÃ m callback nÃ y sáº½ Ä‘Æ°á»£c gá»i vÃ  hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o lá»—i trÃªn `console` vá»›i thÃ´ng tin vá» lá»—i (`error`).

- Tá»•ng quan, Ä‘oáº¡n mÃ£ trÃªn Ä‘á»‹nh nghÄ©a cÃ¡c cáº¥u hÃ¬nh cho má»™t truy váº¥n dá»¯ liá»‡u trong React Query, bao gá»“m khÃ³a truy váº¥n (`queryKey`), hÃ m truy váº¥n (`queryFn`), thá»i gian cÅ© hÃ³a dá»¯ liá»‡u (`staleTime`), thá»i gian lÆ°u trá»¯ trong cache (`cacheTime`), vÃ  cÃ¡c hÃ m callback Ä‘á»ƒ xá»­ lÃ½ káº¿t quáº£ truy váº¥n thÃ nh cÃ´ng (`onSuccess`) vÃ  lá»—i (`onError`).

âŒâŒ onSuccess: (data) => { console.log('Fetch user data success:', data) }
âŒâŒ hÃ£y viáº¿t láº¡i hÃ m callback nÃ y báº±ng cÃ¡ch khÃ¡c sá»­ dá»¥ng function bÃ¬nh thÆ°á»ng:

âœ…âœ… Báº¡n cÃ³ thá»ƒ viáº¿t láº¡i Ä‘oáº¡n mÃ£ onSuccess báº±ng cÃ¡ch sá»­ dá»¥ng function nhÆ° sau:

```jsx
function handleSuccess(data) {
  console.log('Fetch user data success:', data)
}

const queryConfig = {
  // CÃ¡c cáº¥u hÃ¬nh khÃ¡c...
  onSuccess: handleSuccess
}
```

- Trong Ä‘oáº¡n mÃ£ trÃªn, tÃ´i Ä‘Ã£ táº¡o má»™t hÃ m `handleSuccess` Ä‘á»ƒ xá»­ lÃ½ khi dá»¯ liá»‡u truy váº¥n thÃ nh cÃ´ng. Sau Ä‘Ã³, tÃ´i gÃ¡n hÃ m nÃ y cho thuá»™c tÃ­nh `onSuccess` trong Ä‘á»‘i tÆ°á»£ng `queryConfig`. Khi truy váº¥n dá»¯ liá»‡u thÃ nh cÃ´ng, hÃ m `handleSuccess` sáº½ Ä‘Æ°á»£c gá»i vÃ  thÃ´ng tin dá»¯ liá»‡u (`data`) sáº½ Ä‘Æ°á»£c log ra console.

- LÆ°u Ã½ ráº±ng tÃ´i chá»‰ Ä‘á»‹nh tÃªn hÃ m `handleSuccess` mÃ  khÃ´ng gá»i trá»±c tiáº¿p báº±ng cáº·p dáº¥u ngoáº·c trÃ²n `()`. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng hÃ m chá»‰ Ä‘Æ°á»£c gá»i khi xáº£y ra sá»± kiá»‡n thÃ nh cÃ´ng vÃ  khÃ´ng Ä‘Æ°á»£c gá»i ngay tá»« Ä‘áº§u.

5. Sá»­ dá»¥ng `useQuery` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n vÃ  nháº­n káº¿t quáº£ tráº£ vá»:

```jsx
const { data, isLoading, isError, error, refetch } = useQuery(queryConfig)
```

- DÃ²ng code trÃªn sá»­ dá»¥ng hook `useQuery` tá»« `React Query` Ä‘á»ƒ thá»±c hiá»‡n má»™t truy váº¥n dá»¯ liá»‡u dá»±a trÃªn `queryConfig` (cáº¥u hÃ¬nh truy váº¥n). Khi sá»­ dá»¥ng `useQuery`, chÃºng ta cÃ³ thá»ƒ trÃ­ch xuáº¥t cÃ¡c thuá»™c tÃ­nh quan trá»ng tá»« káº¿t quáº£ truy váº¥n thÃ´ng qua viá»‡c gÃ¡n chÃºng cho cÃ¡c biáº¿n tÆ°Æ¡ng á»©ng:

- Trong hook `useQuery` cá»§a `React Query`, cÃ¡c dá»¯ liá»‡u vÃ  chá»©c nÄƒng sau Ä‘Ã¢y Ä‘Ã£ Ä‘Æ°á»£c cung cáº¥p sáºµn:

  - `data`: Chá»©a dá»¯ liá»‡u tráº£ vá» tá»« truy váº¥n thÃ nh cÃ´ng. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `data` Ä‘á»ƒ hiá»ƒn thá»‹ hoáº·c xá»­ lÃ½ dá»¯ liá»‡u trong giao diá»‡n.
  - `isLoading`: ÄÆ°á»£c Ä‘áº·t thÃ nh `true` trong quÃ¡ trÃ¬nh truy váº¥n Ä‘ang diá»…n ra, vÃ  `false` khi truy váº¥n hoÃ n thÃ nh hoáº·c gáº·p lá»—i.
  - `isError`: ÄÆ°á»£c Ä‘áº·t thÃ nh `true` náº¿u truy váº¥n gáº·p lá»—i, vÃ  `false` náº¿u khÃ´ng cÃ³ lá»—i xáº£y ra.
  - `error`: Chá»©a thÃ´ng tin vá» lá»—i náº¿u cÃ³. Náº¿u `isError` lÃ  `true`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `error` Ä‘á»ƒ xem vÃ  xá»­ lÃ½ thÃ´ng tin lá»—i trong giao diá»‡n.
  - `refetch`: Má»™t hÃ m Ä‘Æ°á»£c cung cáº¥p bá»Ÿi `React Query` Ä‘á»ƒ gá»­i láº¡i yÃªu cáº§u truy váº¥n. Khi gá»i `refetch()`, truy váº¥n sáº½ Ä‘Æ°á»£c gá»­i láº¡i vÃ  káº¿t quáº£ má»›i sáº½ Ä‘Æ°á»£c cáº­p nháº­t.

- Báº±ng cÃ¡ch trÃ­ch xuáº¥t cÃ¡c biáº¿n nÃ y tá»« `useQuery`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng chÃºng Ä‘á»ƒ Ä‘iá»u khiá»ƒn vÃ  hiá»ƒn thá»‹ tráº¡ng thÃ¡i vÃ  dá»¯ liá»‡u truy váº¥n trong giao diá»‡n cá»§a báº¡n.

6. Xá»­ lÃ½ cÃ¡c tráº¡ng thÃ¡i truy váº¥n vÃ  hiá»ƒn thá»‹ ná»™i dung tÆ°Æ¡ng á»©ng trÃªn giao diá»‡n ngÆ°á»i dÃ¹ng:

```jsx
if (isLoading) {
  return <div>Loading user profile...</div>
}

if (isError) {
  return <div>Error: {error.message}</div>
}

return (
  <div>
    <h1>User Profile</h1>
    <p>User ID: {userId}</p>
    <p>Name: {data.name}</p>
    <p>Email: {data.email}</p>
    <button onClick={() => refetch()}>Refresh</button>
  </div>
)
```

- Náº¿u Ä‘ang trong quÃ¡ trÃ¬nh táº£i dá»¯ liá»‡u (`isLoading`), hiá»ƒn thá»‹ thÃ´ng bÃ¡o "Loading user profile...".
- Náº¿u xáº£y ra lá»—i trong quÃ¡ trÃ¬nh truy váº¥n (`isError`), hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i vÃ  thÃ´ng Ä‘iá»‡p lá»—i tÆ°Æ¡ng á»©ng.
- Náº¿u truy váº¥n thÃ nh cÃ´ng, hiá»ƒn thá»‹ thÃ´ng tin ngÆ°á»i dÃ¹ng bao gá»“m `ID`, `name` vÃ  `email`. CÃ³ má»™t nÃºt `"Refresh"` Ä‘á»ƒ gá»i láº¡i hÃ m `refetch` vÃ  láº¥y dá»¯ liá»‡u má»›i tá»« API.

- TÃ³m láº¡i, Ä‘oáº¡n code trÃªn sá»­ dá»¥ng `useQuery` Ä‘á»ƒ láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« API vÃ  hiá»ƒn thá»‹ trÃªn giao diá»‡n ngÆ°á»i dÃ¹ng. NÃ³ xá»­ lÃ½ cÃ¡c tráº¡ng thÃ¡i truy váº¥n vÃ  cung cáº¥p kháº£ nÄƒng lÃ m má»›i dá»¯ liá»‡u thÃ´ng qua hÃ m `refetch`.

## âŒâŒ LÆ°u Ã½: hÃ m `refetch` nÃ y Ã  mÃ¬nh khÃ´ng cáº§n khai bÃ¡o nhÆ°ng nÃ³ váº«n sáº½ `refetch` láº¡i cho mÃ¬nh Ã . HÃ m `refetch` nÃ³ cÃ³ sáºµn máº·c Ä‘á»‹nh trong react query hay sao ?

- ÄÃºng, hÃ m `refetch` khÃ´ng cáº§n khai bÃ¡o mÃ  nÃ³ Ä‘Ã£ Ä‘Æ°á»£c cung cáº¥p sáºµn bá»Ÿi React Query. Khi báº¡n sá»­ dá»¥ng `useQuery` Ä‘á»ƒ táº¡o truy váº¥n, React Query sáº½ tá»± Ä‘á»™ng táº¡o ra má»™t sá»‘ phÆ°Æ¡ng thá»©c vÃ  thuá»™c tÃ­nh cho Ä‘á»‘i tÆ°á»£ng truy váº¥n tráº£ vá». Má»™t trong sá»‘ Ä‘Ã³ lÃ  phÆ°Æ¡ng thá»©c `refetch`.

- PhÆ°Æ¡ng thá»©c `refetch` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i láº¡i truy váº¥n vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i tá»« `server`. Khi báº¡n gá»i `refetch()`, React Query sáº½ thá»±c hiá»‡n láº¡i truy váº¥n theo cáº¥u hÃ¬nh ban Ä‘áº§u vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o `data` náº¿u truy váº¥n thÃ nh cÃ´ng. Äiá»u nÃ y giÃºp báº¡n cÃ³ thá»ƒ lÃ m má»›i dá»¯ liá»‡u má»™t cÃ¡ch Ä‘Æ¡n giáº£n vÃ  dá»… dÃ ng khi ngÆ°á»i dÃ¹ng yÃªu cáº§u.

- VÃ¬ váº­y, khÃ´ng cáº§n pháº£i khai bÃ¡o riÃªng biá»‡t, phÆ°Æ¡ng thá»©c `refetch` Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p trong `useQuery` vÃ  sáºµn cÃ³ Ä‘á»ƒ sá»­ dá»¥ng. Báº¡n chá»‰ cáº§n gá»i `refetch()` khi cáº§n lÃ m má»›i dá»¯ liá»‡u truy váº¥n.

âŒâŒâŒ Start: Giáº£i thÃ­ch vá» staleTime vÃ  cacheTime âŒâŒâŒ

## âŒâŒ HÃ£y hiá»ƒu rÃµ vá» staleTime vÃ  cacheTime ? DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ­ dá»¥ vá» staleTime vÃ  cacheTime ? Pháº£i tháº­t sá»± hiá»ƒu 2 thuá»™c tÃ­nh nÃ y nhÃ©, cÃ¡i nÃ y ráº¥t quan trá»ng vÃ  cÅ©ng ráº¥t dá»… lá»™n ?

- vÃ­ dá»¥ `staleTime` cÃ³ 2 giÃ¢y vÃ  `cacheTime` 1 phÃºt. CÃ³ nghÄ©a lÃ  khi `staleTime` háº¿t háº¡n thÃ¬ nÃ³ gá»i Ä‘áº¿n `cacheTime`, máº·c dÃ¹ dá»¯ liá»‡u Ä‘Ã³ Ä‘Ã£ cÅ© nhÆ°ng nÃ³ váº«n pháº£i dÃ¹ng. `staleTime` báº¯t buá»™c pháº£i dÃ¹ng dá»¯ liá»‡u cá»§a `cacheTime` cho Ä‘áº¿n 1 phÃºt. Sau khi quÃ¡ 1 phÃºt thÃ¬ `cacheTime` gá»i lÃ m dá»¯ liá»‡u má»›i sau Ä‘Ã³ `staleTime` láº¡i dÃ¹ng dá»¯ liá»‡u cá»§a `cacheTime` cÃ³ Ä‘Ãºng nhÆ° váº­y khÃ´ng ? (vÃ­ dá»¥ nÃ y hÆ¡i quáº±ng)

- KhÃ´ng, hiá»ƒu láº§m trong viá»‡c hiá»ƒu Ã½ nghÄ©a cá»§a `staleTime` vÃ  `cacheTime`. HÃ£y xem láº¡i Ã½ nghÄ©a cá»§a hai thuá»™c tÃ­nh nÃ y:

  - `staleTime`: ÄÃ¢y lÃ  thá»i gian mÃ  dá»¯ liá»‡u trong cache váº«n Ä‘Æ°á»£c coi lÃ  "stale" (cÅ©) trÆ°á»›c khi cáº§n pháº£i lÃ m má»›i. Sau khi thá»i gian `staleTime` Ä‘Ã£ qua, React Query sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n má»™t truy váº¥n ná»n Ä‘á»ƒ lÃ m má»›i dá»¯ liá»‡u vÃ  Ä‘áº£m báº£o dá»¯ liá»‡u má»›i nháº¥t Ä‘Æ°á»£c cung cáº¥p.

  - `cacheTime`: ÄÃ¢y lÃ  thá»i gian tá»‘i Ä‘a mÃ  dá»¯ liá»‡u truy váº¥n Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› cache trÆ°á»›c khi Ä‘Æ°á»£c coi lÃ  cÅ© vÃ  cáº§n pháº£i lÃ m má»›i. Khi thá»i gian tá»« láº§n truy váº¥n gáº§n nháº¥t Ä‘áº¿n hiá»‡n táº¡i vÆ°á»£t quÃ¡ `cacheTime`, React Query sáº½ thá»±c hiá»‡n má»™t truy váº¥n má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« mÃ¡y chá»§ thay vÃ¬ sá»­ dá»¥ng dá»¯ liá»‡u tá»« cache.

- Vá»›i vÃ­ dá»¥ cá»§a báº¡n vá» `staleTime` lÃ  2 giÃ¢y vÃ  `cacheTime` lÃ  1 phÃºt, Ã½ nghÄ©a cá»§a hai thuá»™c tÃ­nh nÃ y lÃ :

  - Khi truy váº¥n dá»¯ liá»‡u, náº¿u thá»i gian tá»« láº§n truy váº¥n gáº§n nháº¥t Ä‘áº¿n hiá»‡n táº¡i vÆ°á»£t quÃ¡ `staleTime` (2 giÃ¢y trong trÆ°á»ng há»£p nÃ y), dá»¯ liá»‡u trong cache váº«n cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  tráº£ vá» cho cÃ¡c yÃªu cáº§u truy váº¥n mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u má»›i Ä‘áº¿n mÃ¡y chá»§. Tuy nhiÃªn, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  "stale" Ä‘á»ƒ chá»‰ ra ráº±ng nÃ³ cÃ³ thá»ƒ khÃ´ng cÃ²n lÃ  dá»¯ liá»‡u má»›i nháº¥t.

  - Sau khi thá»i gian tá»« láº§n truy váº¥n gáº§n nháº¥t Ä‘áº¿n hiá»‡n táº¡i vÆ°á»£t quÃ¡ `cacheTime` (1 phÃºt trong trÆ°á»ng há»£p nÃ y), React Query sáº½ thá»±c hiá»‡n má»™t truy váº¥n má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« mÃ¡y chá»§ thay vÃ¬ sá»­ dá»¥ng dá»¯ liá»‡u tá»« cache. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u truy váº¥n Ä‘Æ°á»£c cung cáº¥p lÃ  má»›i nháº¥t vÃ  khÃ´ng bá»‹ quÃ¡ cÅ©.

- Tuy nhiÃªn, sau khi thá»i gian `cacheTime` Ä‘Ã£ qua (1 phÃºt), `staleTime` (2 giÃ¢y) khÃ´ng "gá»i" láº¡i `cacheTime`. `staleTime` chá»‰ Ä‘á»‹nh thá»i gian tá»‘i Ä‘a mÃ  dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng mÃ  khÃ´ng cáº§n lÃ m má»›i, trong khi `cacheTime` lÃ  thá»i gian tá»‘i Ä‘a mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trong cache trÆ°á»›c khi coi lÃ  cÅ©.

## âŒâŒ Váº­y thÃ¬ dá»¯ liá»‡u cá»§a staleTime Ä‘Æ°á»£c láº¥y tá»« cacheTime hay sao ?

- Báº¡n Ä‘Ã£ thá»±c sá»± hiá»ƒu láº§m. Trong React Query, `staleTime` khÃ´ng láº¥y dá»¯ liá»‡u tá»« `cacheTime`. `staleTime` chá»‰ lÃ  má»™t khoáº£ng thá»i gian xÃ¡c Ä‘á»‹nh sau khi mÃ  dá»¯ liá»‡u trong cache váº«n Ä‘Æ°á»£c coi lÃ  "stale" (cÅ©) trÆ°á»›c khi cáº§n pháº£i lÃ m má»›i.

- Khi thá»i gian tá»« láº§n truy váº¥n gáº§n nháº¥t Ä‘áº¿n hiá»‡n táº¡i vÆ°á»£t quÃ¡ `staleTime`, dá»¯ liá»‡u trong cache váº«n cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  tráº£ vá» cho cÃ¡c yÃªu cáº§u truy váº¥n mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u má»›i Ä‘áº¿n mÃ¡y chá»§. Tuy nhiÃªn, dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  "stale" Ä‘á»ƒ chá»‰ ra ráº±ng nÃ³ cÃ³ thá»ƒ khÃ´ng cÃ²n lÃ  dá»¯ liá»‡u má»›i nháº¥t.

- Sau khi thá»i gian `staleTime` Ä‘Ã£ qua, React Query sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n má»™t truy váº¥n ná»n Ä‘á»ƒ lÃ m má»›i dá»¯ liá»‡u vÃ  Ä‘áº£m báº£o dá»¯ liá»‡u má»›i nháº¥t Ä‘Æ°á»£c cung cáº¥p. Truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n mÃ¡y chá»§ Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i, khÃ´ng liÃªn quan Ä‘áº¿n `cacheTime`.

- VÃ¬ váº­y, `staleTime` khÃ´ng dá»±a vÃ o `cacheTime` Ä‘á»ƒ láº¥y dá»¯ liá»‡u. ChÃºng lÃ  hai thuá»™c tÃ­nh riÃªng biá»‡t trong React Query Ä‘á»ƒ quáº£n lÃ½ viá»‡c lÃ m má»›i dá»¯ liá»‡u tá»« cache.

âŒâŒâŒ Finish: Giáº£i thÃ­ch vá» staleTime vÃ  cacheTime âŒâŒâŒ

## Náº¿u useQuery dÃ¹ng Ä‘á»ƒ GET thÃ¬ useMutation dÃ¹ng Ä‘á»ƒ POST, PUT, DELETE ? HÃ£y nÃªu sá»± khÃ¡c nhau ?

- ÄÃºng, trong React Query, `useMutation` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c POST, PUT vÃ  DELETE (thay Ä‘á»•i dá»¯ liá»‡u) liÃªn quan Ä‘áº¿n viá»‡c gá»­i yÃªu cáº§u tá»›i server. DÆ°á»›i Ä‘Ã¢y lÃ  sá»± khÃ¡c nhau chÃ­nh giá»¯a `useQuery` vÃ  `useMutation`:

1. `TÃ¡c Ä‘á»™ng lÃªn dá»¯ liá»‡u:` `useQuery` chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u (GET) tá»« server, trong khi `useMutation` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u nhÆ° táº¡o má»›i (POST), cáº­p nháº­t (PUT) vÃ  xÃ³a (DELETE) dá»¯ liá»‡u trÃªn server.

2. `HÃ nh Ä‘á»™ng:` `useQuery` táº¡o ra má»™t `instance` truy váº¥n dá»¯ liá»‡u, giÃºp ta láº¥y dá»¯ liá»‡u tá»« server vÃ  lÆ°u trá»¯ vÃ o cache. Trong khi Ä‘Ã³, `useMutation` táº¡o ra má»™t `instance` thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u, giÃºp ta gá»­i yÃªu cáº§u thay Ä‘á»•i dá»¯ liá»‡u tá»›i server vÃ  xá»­ lÃ½ káº¿t quáº£ tráº£ vá».

3. `TÃ­nh nÄƒng cung cáº¥p:` `useQuery` cung cáº¥p cÃ¡c tÃ­nh nÄƒng nhÆ° caching, tá»± Ä‘á»™ng fetch láº¡i dá»¯ liá»‡u khi cáº§n thiáº¿t, background fetching, vÃ  nhiá»u tÃ¹y chá»n khÃ¡c liÃªn quan Ä‘áº¿n truy váº¥n dá»¯ liá»‡u. Trong khi Ä‘Ã³, `useMutation` cung cáº¥p cÃ¡c tÃ­nh nÄƒng nhÆ° tá»± Ä‘á»™ng lÃ m má»›i cache sau khi thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u thÃ nh cÃ´ng, xá»­ lÃ½ lá»—i vÃ  thÃ nh cÃ´ng, vÃ  nhiá»u tÃ¹y chá»n khÃ¡c liÃªn quan Ä‘áº¿n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

4. `Callback functions:` Trong `useMutation`, ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c callback functions nhÆ° `onSuccess`, `onError`, `onSettled` Ä‘á»ƒ xá»­ lÃ½ káº¿t quáº£ vÃ  cÃ¡c tráº¡ng thÃ¡i cá»§a thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

- TÃ³m láº¡i, `useMutation` lÃ  má»™t hook trong React Query Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u (POST, PUT, DELETE) vÃ  cung cáº¥p cÃ¡c tÃ­nh nÄƒng vÃ  tÃ¹y chá»n liÃªn quan Ä‘áº¿n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

- Tiáº¿p tá»¥c vá»›i sá»± khÃ¡c nhau giá»¯a `useQuery` vÃ  `useMutation` trong React Query:

1. `Tham sá»‘ Ä‘áº§u vÃ o:` Khi sá»­ dá»¥ng `useQuery`, ta truyá»n `queryKey` vÃ  `queryFn` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh key cá»§a truy váº¥n vÃ  hÃ m Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« server. Trong khi Ä‘Ã³, khi sá»­ dá»¥ng `useMutation`, ta truyá»n `mutationFn` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh hÃ m thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

2. `Tráº¡ng thÃ¡i vÃ  káº¿t quáº£:` `useQuery` cung cáº¥p cÃ¡c tráº¡ng thÃ¡i nhÆ° `isLoading`, `isError`, `isSuccess` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i cá»§a truy váº¥n dá»¯ liá»‡u vÃ  `data` Ä‘á»ƒ lÆ°u trá»¯ káº¿t quáº£ tráº£ vá» tá»« server. Trong khi Ä‘Ã³, `useMutation` cung cáº¥p cÃ¡c tráº¡ng thÃ¡i nhÆ° `isLoading`, `isError`, `isSuccess` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i cá»§a thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u vÃ  khÃ´ng tráº£ vá» káº¿t quáº£ tá»« server.

- Khi sá»­ dá»¥ng hook `useQuery`, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u tá»« mÃ¡y chá»§.
- Khi sá»­ dá»¥ng hook `useMutation`, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u, cháº³ng háº¡n nhÆ° táº¡o, cáº­p nháº­t hoáº·c xÃ³a dá»¯ liá»‡u trÃªn mÃ¡y chá»§.

3. `Cáº­p nháº­t cache:` Khi sá»­ dá»¥ng `useQuery`, React Query tá»± Ä‘á»™ng cáº­p nháº­t cache khi cÃ³ dá»¯ liá»‡u má»›i tá»« server hoáº·c khi cache háº¿t háº¡n. Trong khi Ä‘Ã³, khi sá»­ dá»¥ng `useMutation`, ta cáº§n xá»­ lÃ½ cáº­p nháº­t cache thá»§ cÃ´ng sau khi thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u thÃ nh cÃ´ng.

4. `Tá»‘i Æ°u hÃ³a:` `useQuery` cung cáº¥p cÃ¡c tÃ­nh nÄƒng tá»‘i Æ°u hÃ³a nhÆ° `caching`, `background fetching` vÃ  `refetching` tá»± Ä‘á»™ng dá»±a trÃªn cÃ¡c tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng. Trong khi Ä‘Ã³, `useMutation` táº­p trung vÃ o viá»‡c thá»±c hiá»‡n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u má»™t cÃ¡ch Ä‘Ã¡ng tin cáº­y vÃ  xá»­ lÃ½ káº¿t quáº£ tÆ°Æ¡ng á»©ng.

- TÃ³m láº¡i, `useQuery` vÃ  `useMutation` lÃ  hai hook trong React Query Ä‘Æ°á»£c sá»­ dá»¥ng cho má»¥c Ä‘Ã­ch khÃ¡c nhau. `useQuery` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u (GET) tá»« server vÃ  cung cáº¥p cÃ¡c tÃ­nh nÄƒng liÃªn quan Ä‘áº¿n truy váº¥n dá»¯ liá»‡u. `useMutation` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u (POST, PUT, DELETE) vÃ  cung cáº¥p cÃ¡c tÃ­nh nÄƒng liÃªn quan Ä‘áº¿n thao tÃ¡c thay Ä‘á»•i dá»¯ liá»‡u.

## ThÃªm student vá»›i useMutation trong React Query ?

- Äá»ƒ thÃªm má»™t sinh viÃªn má»›i sá»­ dá»¥ng `useMutation` trong React Query, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c bÆ°á»›c sau:

1. Äá»‹nh nghÄ©a hÃ m thá»±c hiá»‡n thao tÃ¡c thÃªm sinh viÃªn (`POST`) lÃªn server:

```jsx
const addStudent = async (newStudent) => {
  const response = await fetch('api/students', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(newStudent)
  })

  if (!response.ok) {
    throw new Error('Failed to add student')
  }

  const data = await response.json()
  return data
}
```

2. Sá»­ dá»¥ng `useMutation` Ä‘á»ƒ táº¡o má»™t mutation hook Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c thÃªm sinh viÃªn:

```jsx
import { useMutation } from 'react-query'

const AddStudentForm = () => {
  const mutation = useMutation(addStudent)

  const handleSubmit = (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newStudent = Object.fromEntries(formData.entries())
    mutation.mutate(newStudent)
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='name' placeholder='Name' required />
      <input type='text' name='age' placeholder='Age' required />
      <button type='submit' disabled={mutation.isLoading}>
        {mutation.isLoading ? 'Adding...' : 'Add Student'}
      </button>
      {mutation.isError && <div>Error: {mutation.error.message}</div>}
      {mutation.isSuccess && <div>Student added successfully!</div>}
    </form>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, `mutation` lÃ  má»™t object Ä‘Æ°á»£c tráº£ vá» tá»« hook `useMutation`. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `mutation.mutate` Ä‘á»ƒ kÃ­ch hoáº¡t thao tÃ¡c thÃªm sinh viÃªn khi form Ä‘Æ°á»£c submit. `mutation.isLoading`, `mutation.isError`, vÃ  `mutation.isSuccess` lÃ  cÃ¡c tráº¡ng thÃ¡i Ä‘á»ƒ xá»­ lÃ½ giao diá»‡n khi thao tÃ¡c Ä‘ang diá»…n ra, gáº·p lá»—i, hoáº·c thÃ nh cÃ´ng.

- LÆ°u Ã½ ráº±ng, viá»‡c xá»­ lÃ½ cáº­p nháº­t cache sau khi thÃªm sinh viÃªn thÃ nh cÃ´ng cáº§n phá»¥ thuá»™c vÃ o cáº¥u hÃ¬nh vÃ  quyáº¿t Ä‘á»‹nh cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `queryClient.invalidateQueries` Ä‘á»ƒ cáº­p nháº­t cache cho danh sÃ¡ch sinh viÃªn hoáº·c trang chi tiáº¿t sinh viÃªn.

- ÄÃ¢y chá»‰ lÃ  má»™t vÃ­ dá»¥ cÆ¡ báº£n vá» viá»‡c sá»­ dá»¥ng `useMutation` Ä‘á»ƒ thÃªm sinh viÃªn. Báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh vÃ  bá»• sung thÃªm theo nhu cáº§u cá»§a á»©ng dá»¥ng cá»§a mÃ¬nh.

## Giáº£i thÃ­ch chi tiáº¿t Ä‘oáº¡n code trÃªn:

```jsx
const addStudent = async (newStudent) => {
  const response = await fetch('api/students', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(newStudent)
  })

  if (!response.ok) {
    throw new Error('Failed to add student')
  }

  const data = await response.json()
  return data
}
```

- Äoáº¡n code trÃªn Ä‘á»‹nh nghÄ©a má»™t hÃ m `addStudent` Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c thÃªm sinh viÃªn má»›i (POST) lÃªn server thÃ´ng qua API endpoint `'api/students`'.

- HÃ m `addStudent` sá»­ dá»¥ng `fetch` Ä‘á»ƒ gá»­i má»™t request POST Ä‘áº¿n endpoint `'api/students'` vá»›i cÃ¡c thÃ´ng tin cá»§a sinh viÃªn má»›i Ä‘Æ°á»£c Ä‘Æ°a vÃ o trong body cá»§a request dÆ°á»›i dáº¡ng JSON. Äá»ƒ thá»±c hiá»‡n Ä‘iá»u nÃ y, `fetch` Ä‘Æ°á»£c gá»i vá»›i cÃ¡c tham sá»‘ nhÆ° sau:

- `method: 'POST':` Thuá»™c tÃ­nh `method` xÃ¡c Ä‘á»‹nh phÆ°Æ¡ng thá»©c HTTP Ä‘Æ°á»£c sá»­ dá»¥ng trong yÃªu cáº§u. Trong trÆ°á»ng há»£p nÃ y, phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  POST. PhÆ°Æ¡ng thá»©c POST Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i dá»¯ liá»‡u tá»« client lÃªn mÃ¡y chá»§ Ä‘á»ƒ táº¡o hoáº·c cáº­p nháº­t tÃ i nguyÃªn.

- `headers: {'Content-Type': 'application/json'}:` Thuá»™c tÃ­nh `headers` Ä‘á»‹nh nghÄ©a cÃ¡c tiÃªu Ä‘á» (headers) cá»§a yÃªu cáº§u HTTP. Trong trÆ°á»ng há»£p nÃ y, Ä‘oáº¡n mÃ£ chá»‰ Ä‘á»‹nh má»™t tiÃªu Ä‘á» `'Content-Type'` vá»›i giÃ¡ trá»‹ `'application/json'`. TiÃªu Ä‘á» nÃ y cho biáº¿t ráº±ng dá»¯ liá»‡u trong yÃªu cáº§u Ä‘Æ°á»£c gá»­i dÆ°á»›i dáº¡ng JSON. Äiá»u nÃ y giÃºp mÃ¡y chá»§ hiá»ƒu cÃ¡ch xá»­ lÃ½ vÃ  phÃ¢n tÃ­ch ná»™i dung yÃªu cáº§u.

- `body: JSON.stringify(newStudent):` Thuá»™c tÃ­nh `body` Ä‘á»‹nh nghÄ©a ná»™i dung cá»§a yÃªu cáº§u HTTP. Trong trÆ°á»ng há»£p nÃ y, `JSON.stringify(newStudent)` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i Ä‘á»‘i tÆ°á»£ng (object) `newStudent` thÃ nh chuá»—i JSON (JSON String). Chuá»—i JSON nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c gÃ¡n cho thuá»™c tÃ­nh `body`. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u cá»§a `newStudent` Ä‘Æ°á»£c gá»­i Ä‘i dÆ°á»›i dáº¡ng chuá»—i JSON trong yÃªu cáº§u POST.

- Khi yÃªu cáº§u HTTP POST nÃ y Ä‘Æ°á»£c gá»­i Ä‘i, nÃ³ sáº½ chá»©a má»™t tiÃªu Ä‘á» `'Content-Type': 'application/json'` Ä‘á»ƒ chá»‰ Ä‘á»‹nh kiá»ƒu ná»™i dung lÃ  JSON vÃ  má»™t pháº§n body chá»©a dá»¯ liá»‡u cá»§a `newStudent` Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh chuá»—i JSON.

- `if (!response.ok):` ÄÃ¢y lÃ  má»™t cÃ¢u Ä‘iá»u kiá»‡n kiá»ƒm tra xem pháº£n há»“i tá»« mÃ¡y chá»§ cÃ³ thÃ nh cÃ´ng hay khÃ´ng. Pháº£n há»“i Ä‘Æ°á»£c coi lÃ  thÃ nh cÃ´ng náº¿u tráº¡ng thÃ¡i HTTP lÃ  trong khoáº£ng tá»« 200 Ä‘áº¿n 299 (bao gá»“m cáº£ 200 vÃ  299). Äiá»u kiá»‡n `!response.ok` kiá»ƒm tra xem tráº¡ng thÃ¡i HTTP cÃ³ náº±m ngoÃ i khoáº£ng thÃ nh cÃ´ng hay khÃ´ng.

- `throw new Error('Failed to add student'):` Náº¿u pháº£n há»“i khÃ´ng thÃ nh cÃ´ng, má»™t ngoáº¡i lá»‡ (exception) Ä‘Æ°á»£c nÃ©m báº±ng cÃ¡ch sá»­ dá»¥ng `throw`. Trong trÆ°á»ng há»£p nÃ y, má»™t Ä‘á»‘i tÆ°á»£ng lá»—i má»›i Ä‘Æ°á»£c táº¡o vá»›i thÃ´ng bÃ¡o `'Failed to add student'`. Ngoáº¡i lá»‡ nÃ y sáº½ Ä‘Æ°á»£c truyá»n cho pháº§n xá»­ lÃ½ lá»—i bÃªn ngoÃ i hÃ m hiá»‡n táº¡i Ä‘á»ƒ xá»­ lÃ½ tiáº¿p theo.

- `const data = await response.json():` Náº¿u pháº£n há»“i thÃ nh cÃ´ng, dá»¯ liá»‡u trong pháº£n há»“i Ä‘Æ°á»£c Ä‘á»c vÃ  chuyá»ƒn Ä‘á»•i tá»« Ä‘á»‹nh dáº¡ng JSON sang Ä‘á»‘i tÆ°á»£ng JavaScript báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `response.json()`. Káº¿t quáº£ cá»§a phÆ°Æ¡ng thá»©c nÃ y lÃ  má»™t lá»i há»©a (promise) Ä‘Æ°á»£c giáº£i quyáº¿t (resolved) khi dá»¯ liá»‡u JSON Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript.

- `return data:` Káº¿t quáº£ cá»§a hÃ m lÃ  Ä‘á»‘i tÆ°á»£ng dá»¯ liá»‡u (`data`). Náº¿u má»i thá»© thÃ nh cÃ´ng, dá»¯ liá»‡u nÃ y sáº½ Ä‘Æ°á»£c tráº£ vá» cho ngÆ°á»i gá»i hÃ m Ä‘á»ƒ sá»­ dá»¥ng tiáº¿p.

- TÃ³m láº¡i, Ä‘oáº¡n mÃ£ trÃªn kiá»ƒm tra vÃ  xá»­ lÃ½ pháº£n há»“i tá»« mÃ¡y chá»§ sau má»™t yÃªu cáº§u HTTP. Náº¿u pháº£n há»“i thÃ nh cÃ´ng, nÃ³ tráº£ vá» dá»¯ liá»‡u tá»« pháº£n há»“i dÆ°á»›i dáº¡ng Ä‘á»‘i tÆ°á»£ng JavaScript. Náº¿u pháº£n há»“i khÃ´ng thÃ nh cÃ´ng, nÃ³ nÃ©m má»™t ngoáº¡i lá»‡ Ä‘á»ƒ xá»­ lÃ½ lá»—i.

## âŒâŒ LÆ°u Ã½: Táº¡i sao khÃ´ng dÃ¹ng `response.parse()` mÃ  láº¡i sá»­ dá»¥ng `response.json()`. Trong khi 2 dáº¡ng Ä‘Ã³ Ä‘á»u tráº£ vá» dáº¡ng Ä‘á»‘i tÆ°á»£ng jsvascript ?

- Tháº­t Ä‘Ãºng lÃ  cÃ³ má»™t sá»± khÃ¡c biá»‡t giá»¯a `response.parse()` vÃ  `response.json()`, vÃ  trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, chÃºng ta sáº½ sá»­ dá»¥ng `response.json()` Ä‘á»ƒ chuyá»ƒn Ä‘á»•i pháº£n há»“i tá»« JSON sang Ä‘á»‘i tÆ°á»£ng JavaScript. DÆ°á»›i Ä‘Ã¢y lÃ  sá»± khÃ¡c biá»‡t chÃ­nh giá»¯a hai phÆ°Æ¡ng thá»©c nÃ y:

1. `response.parse():` PhÆ°Æ¡ng thá»©c `parse()` khÃ´ng tá»“n táº¡i trong Ä‘á»‘i tÆ°á»£ng `response` cá»§a má»™t yÃªu cáº§u HTTP. Thay vÃ o Ä‘Ã³, phÆ°Æ¡ng thá»©c `parse()` lÃ  má»™t phÆ°Æ¡ng thá»©c cá»§a Ä‘á»‘i tÆ°á»£ng `JSON` trong JavaScript. NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i má»™t chuá»—i JSON thÃ nh má»™t Ä‘á»‘i tÆ°á»£ng JavaScript.

2. `response.json():` PhÆ°Æ¡ng thá»©c `json()` lÃ  má»™t phÆ°Æ¡ng thá»©c cá»§a Ä‘á»‘i tÆ°á»£ng `response` trong JavaScript. Khi gá»i phÆ°Æ¡ng thá»©c nÃ y trÃªn Ä‘á»‘i tÆ°á»£ng `response`, nÃ³ tráº£ vá» má»™t lá»i há»©a (promise) mÃ  khi giáº£i quyáº¿t (resolved), nÃ³ tráº£ vá» dá»¯ liá»‡u JSON Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript.

- Sá»± khÃ¡c biá»‡t chÃ­nh giá»¯a hai phÆ°Æ¡ng thá»©c nÃ y lÃ  `response.json()` khÃ´ng chá»‰ chuyá»ƒn Ä‘á»•i JSON thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript, mÃ  nÃ³ cÅ©ng xá»­ lÃ½ viá»‡c Ä‘á»c vÃ  xá»­ lÃ½ dá»¯ liá»‡u tá»« pháº£n há»“i HTTP. NÃ³ tá»± Ä‘á»™ng Ä‘á»c vÃ  chuyá»ƒn Ä‘á»•i pháº£n há»“i thÃ nh dá»¯ liá»‡u JSON vÃ  tráº£ vá» má»™t há»©a chá»©a Ä‘á»‘i tÆ°á»£ng JavaScript Ä‘Ã£ chuyá»ƒn Ä‘á»•i.

- VÃ¬ váº­y, khi lÃ m viá»‡c vá»›i pháº£n há»“i tá»« má»™t yÃªu cáº§u HTTP, chÃºng ta sá»­ dá»¥ng `response.json()` Ä‘á»ƒ thuáº­n tiá»‡n Ä‘á»c vÃ  chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u JSON thÃ nh Ä‘á»‘i tÆ°á»£ng JavaScript.

```jsx
import { useMutation } from 'react-query'

const AddStudentForm = () => {
  const mutation = useMutation(addStudent)

  const handleSubmit = (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newStudent = Object.fromEntries(formData.entries())
    mutation.mutate(newStudent)
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='name' placeholder='Name' required />
      <input type='text' name='age' placeholder='Age' required />
      <button type='submit' disabled={mutation.isLoading}>
        {mutation.isLoading ? 'Adding...' : 'Add Student'}
      </button>
      {mutation.isError && <div>Error: {mutation.error.message}</div>}
      {mutation.isSuccess && <div>Student added successfully!</div>}
    </form>
  )
}
```

- Äoáº¡n code trÃªn Ä‘á»‹nh nghÄ©a má»™t component `AddStudentForm` sá»­ dá»¥ng `useMutation` tá»« React Query Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c thÃªm sinh viÃªn má»›i.

- Trong component `AddStudentForm`, hÃ m `useMutation` Ä‘Æ°á»£c gá»i vá»›i Ä‘á»‘i sá»‘ lÃ  hÃ m `addStudent` (Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c Ä‘Ã³) Ä‘á»ƒ táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng `mutation`. Äá»‘i tÆ°á»£ng `mutation` chá»©a cÃ¡c phÆ°Æ¡ng thá»©c vÃ  tráº¡ng thÃ¡i liÃªn quan Ä‘áº¿n viá»‡c thá»±c hiá»‡n mutation (POST) vÃ  xá»­ lÃ½ káº¿t quáº£.

- Trong hÃ m `handleSubmit`, khi ngÆ°á»i dÃ¹ng gá»­i form báº±ng cÃ¡ch nháº¥n nÃºt `submit`, sá»± kiá»‡n `submit` Ä‘Æ°á»£c kÃ­ch hoáº¡t. HÃ m `handleSubmit` Ä‘Æ°á»£c gá»i vÃ  truyá»n vÃ o Ä‘á»‘i tÆ°á»£ng sá»± kiá»‡n event nhÆ° tham sá»‘.

- Äá»ƒ trÃ¡nh viá»‡c trÃ¬nh duyá»‡t gá»­i request vÃ  refresh trang, hÃ m `event.preventDefault()` Ä‘Æ°á»£c gá»i Ä‘á»ƒ ngÄƒn cháº·n hÃ nh vi máº·c Ä‘á»‹nh cá»§a form.

- Sau Ä‘Ã³, thÃ´ng tin tá»« form Ä‘Æ°á»£c láº¥y báº±ng cÃ¡ch táº¡o má»™t Ä‘á»‘i tÆ°á»£ng `formData` tá»« `event.target`, Ä‘áº¡i diá»‡n cho form Ä‘Æ°á»£c gá»­i Ä‘i. `FormData` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng tÃ­ch há»£p sáºµn trong JavaScript cho phÃ©p truy cáº­p vÃ  xá»­ lÃ½ dá»¯ liá»‡u form.

- Tiáº¿p theo, `formData.entries()` tráº£ vá» má»™t iterator chá»©a táº¥t cáº£ cáº·p khÃ³a-giÃ¡ trá»‹ (key-value) trong form data. `Object.fromEntries()` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i iterator nÃ y thÃ nh má»™t Ä‘á»‘i tÆ°á»£ng JSON `newStudent`, trong Ä‘Ã³ khÃ³a lÃ  tÃªn cá»§a cÃ¡c trÆ°á»ng form vÃ  giÃ¡ trá»‹ lÃ  giÃ¡ trá»‹ Ä‘Ã£ nháº­p.

- Cuá»‘i cÃ¹ng, `mutation.mutate(newStudent)` Ä‘Æ°á»£c gá»i Ä‘á»ƒ kÃ­ch hoáº¡t quÃ¡ trÃ¬nh mutation (POST) vá»›i Ä‘á»‘i tÆ°á»£ng `newStudent` lÃ  dá»¯ liá»‡u cáº§n thÃªm. QuÃ¡ trÃ¬nh nÃ y sáº½ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi React Query, bao gá»“m gá»­i request lÃªn server, xá»­ lÃ½ káº¿t quáº£ vÃ  cáº­p nháº­t cache náº¿u cáº§n.

- Äoáº¡n code trÃªn giÃºp káº¿t ná»‘i form vÃ  viá»‡c thá»±c hiá»‡n thao tÃ¡c thÃªm sinh viÃªn má»›i thÃ´ng qua `useMutation`, vÃ  cho phÃ©p xá»­ lÃ½ cÃ¡c tÆ°Æ¡ng tÃ¡c vá»›i form vÃ  quÃ¡ trÃ¬nh mutation má»™t cÃ¡ch dá»… dÃ ng trong React.

## âŒâŒ HÃ£y Ä‘á»‹nh nghÄ©a phÆ°Æ¡ng thá»©c entries() trong JavaScript lÃ  gÃ¬ ?

- PhÆ°Æ¡ng thá»©c `entries()` lÃ  má»™t phÆ°Æ¡ng thá»©c cá»§a Ä‘á»‘i tÆ°á»£ng `Object` trong JavaScript. NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tráº£ vá» má»™t máº£ng chá»©a cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ (`key-value`) cá»§a má»™t Ä‘á»‘i tÆ°á»£ng.

- Khi Ã¡p dá»¥ng phÆ°Æ¡ng thá»©c `entries()` lÃªn má»™t Ä‘á»‘i tÆ°á»£ng, nÃ³ sáº½ táº¡o ra má»™t máº£ng cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹, trong Ä‘Ã³ má»—i cáº·p bao gá»“m má»™t khÃ³a (key) vÃ  giÃ¡ trá»‹ (value) cá»§a thuá»™c tÃ­nh trong Ä‘á»‘i tÆ°á»£ng.

- VÃ­ dá»¥, xÃ©t má»™t Ä‘á»‘i tÆ°á»£ng `person` nhÆ° sau:

```jsx
const person = {
  name: 'John',
  age: 30,
  occupation: 'Engineer'
}
```

- Khi Ã¡p dá»¥ng `Object.entries(person)`, káº¿t quáº£ sáº½ lÃ  má»™t máº£ng chá»©a cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ nhÆ° sau:

```jsx
;[
  ['name', 'John'],
  ['age', 30],
  ['occupation', 'Engineer']
]
```

- Má»—i pháº§n tá»­ trong máº£ng lÃ  má»™t máº£ng con chá»©a má»™t cáº·p khÃ³a-giÃ¡ trá»‹, trong Ä‘Ã³ pháº§n tá»­ Ä‘áº§u tiÃªn lÃ  khÃ³a vÃ  pháº§n tá»­ thá»© hai lÃ  giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng.

- PhÆ°Æ¡ng thá»©c `entries()` ráº¥t há»¯u Ã­ch khi báº¡n muá»‘n láº·p qua cÃ¡c thuá»™c tÃ­nh cá»§a má»™t Ä‘á»‘i tÆ°á»£ng vÃ  thá»±c hiá»‡n cÃ¡c thao tÃ¡c trÃªn tá»«ng cáº·p khÃ³a-giÃ¡ trá»‹ trong Ä‘á»‘i tÆ°á»£ng Ä‘Ã³.

## âŒâŒ VÃ­ dá»¥ vá» entries() trong JavaScript ?

- Äá»ƒ minh há»a cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `entries()`, hÃ£y xem xÃ©t vÃ­ dá»¥ sau:

```jsx
const person = {
  name: 'John',
  age: 30,
  occupation: 'Engineer'
}

// Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c entries() Ä‘á»ƒ láº·p qua cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ trong Ä‘á»‘i tÆ°á»£ng person
for (const [key, value] of Object.entries(person)) {
  console.log(`${key}: ${value}`)
}
```

- Äáº§u tiÃªn, chÃºng ta cÃ³ má»™t Ä‘á»‘i tÆ°á»£ng `person` Ä‘áº¡i diá»‡n cho thÃ´ng tin vá» má»™t ngÆ°á»i. ChÃºng ta muá»‘n láº·p qua cÃ¡c thuá»™c tÃ­nh cá»§a Ä‘á»‘i tÆ°á»£ng nÃ y vÃ  hiá»ƒn thá»‹ cáº·p khÃ³a-giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng.

- Báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `Object.entries(person)`, chÃºng ta chuyá»ƒn Ä‘á»•i Ä‘á»‘i tÆ°á»£ng `person` thÃ nh má»™t máº£ng chá»©a cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹.

- Sau Ä‘Ã³, chÃºng ta sá»­ dá»¥ng má»™t vÃ²ng láº·p `for...of` Ä‘á»ƒ láº·p qua máº£ng cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹. Trong má»—i láº§n láº·p, chÃºng ta gÃ¡n khÃ³a vÃ  giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng cho cÃ¡c biáº¿n `key` vÃ  `value`. Sau Ä‘Ã³, chÃºng ta hiá»ƒn thá»‹ cáº·p khÃ³a-giÃ¡ trá»‹ báº±ng cÃ¡ch sá»­ dá»¥ng `console.log()`.

- Káº¿t quáº£ cá»§a Ä‘oáº¡n mÃ£ trÃªn sáº½ lÃ :

```jsx
name: John
age: 30
occupation: Engineer
```

- Má»—i dÃ²ng Ä‘áº¡i diá»‡n cho má»™t cáº·p khÃ³a-giÃ¡ trá»‹ trong Ä‘á»‘i tÆ°á»£ng `person`, trong Ä‘Ã³ `key` lÃ  khÃ³a (vÃ­ dá»¥: 'name', 'age', 'occupation') vÃ  `value` lÃ  giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng (vÃ­ dá»¥: 'John', 30, 'Engineer').

- Äiá»u nÃ y cho tháº¥y chÃºng ta Ä‘Ã£ láº·p qua cÃ¡c thuá»™c tÃ­nh cá»§a Ä‘á»‘i tÆ°á»£ng `person` vÃ  hiá»ƒn thá»‹ cáº·p khÃ³a-giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng.

## Xá»­ lÃ½ lá»—i 422 khi submit form bá»‹ lá»—i trong React Query ?

- Äá»ƒ xá»­ lÃ½ lá»—i 422 khi submit form bá»‹ lá»—i trong React Query, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng thuá»™c tÃ­nh `onError` cá»§a Ä‘á»‘i tÆ°á»£ng mutation tráº£ vá» bá»Ÿi `useMutation`. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch xá»­ lÃ½ lá»—i 422:

```jsx
import { useMutation } from 'react-query'

const AddStudentForm = () => {
  const mutation = useMutation(addStudent, {
    onError: (error) => {
      if (error.response?.status === 422) {
        // Xá»­ lÃ½ lá»—i 422 á»Ÿ Ä‘Ã¢y
        // VÃ­ dá»¥: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i hoáº·c cáº­p nháº­t tráº¡ng thÃ¡i lá»—i
      }
    }
  })

  const handleSubmit = (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newStudent = Object.fromEntries(formData.entries())
    mutation.mutate(newStudent)
  }

  // ...
}
```

## Reset error vÃ  data trong React Query ?

- Trong React Query, Ä‘á»ƒ reset lá»—i (`error`) vÃ  dá»¯ liá»‡u (`data`) cá»§a má»™t truy váº¥n, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c cÃ³ sáºµn trong Ä‘á»‘i tÆ°á»£ng truy váº¥n Ä‘Æ°á»£c tráº£ vá» tá»« `useQuery`. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ phÆ°Æ¡ng thá»©c Ä‘á»ƒ reset lá»—i vÃ  dá»¯ liá»‡u trong React Query:

1. Reset lá»—i (`error`):

- Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `resetErrorBoundary` Ä‘á»ƒ Ä‘áº·t láº¡i lá»—i cho má»™t truy váº¥n cá»¥ thá»ƒ:

```jsx
import { useQuery } from 'react-query'

const { resetErrorBoundary } = useQuery(queryKey, queryFn)

// Äáº·t láº¡i lá»—i cho truy váº¥n
resetErrorBoundary()
```

- Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `reset` Ä‘á»ƒ Ä‘áº·t láº¡i lá»—i cho táº¥t cáº£ cÃ¡c truy váº¥n trong cache:

```jsx
import { useQueryClient } from 'react-query'

const queryClient = useQueryClient()

// Äáº·t láº¡i lá»—i cho táº¥t cáº£ cÃ¡c truy váº¥n trong cache
queryClient.resetErrors()
```

2. Reset dá»¯ liá»‡u (`data`):

- Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `reset` Ä‘á»ƒ Ä‘áº·t láº¡i dá»¯ liá»‡u cho má»™t truy váº¥n cá»¥ thá»ƒ:

```jsx
import { useQuery } from 'react-query'

const { reset } = useQuery(queryKey, queryFn)

// Äáº·t láº¡i dá»¯ liá»‡u cho truy váº¥n
reset()
```

- Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `removeQueries` Ä‘á»ƒ xÃ³a dá»¯ liá»‡u vÃ  truy váº¥n khá»i cache:

```jsx
import { useQueryClient } from 'react-query'

const queryClient = useQueryClient()

// XÃ³a dá»¯ liá»‡u vÃ  truy váº¥n khá»i cache
queryClient.removeQueries(queryKey)
```

- LÆ°u Ã½ ráº±ng viá»‡c reset lá»—i vÃ  dá»¯ liá»‡u chá»‰ áº£nh hÆ°á»Ÿng trong pháº¡m vi cá»§a má»™t truy váº¥n cá»¥ thá»ƒ hoáº·c táº¥t cáº£ cÃ¡c truy váº¥n trong cache.

## Reset láº¡i lá»—i cÃ³ nghÄ©a lÃ  xoÃ¡ háº¿t táº¥t cáº£ cÃ¡c lá»—i tá»« trÆ°á»›c Ä‘Ã³ háº£ ?

- KhÃ´ng, khi chÃºng ta nÃ³i vá» viá»‡c `reset láº¡i lá»—i` trong React Query, Ä‘iá»u Ä‘Ã³ chá»‰ Ã¡p dá»¥ng cho cÃ¡c lá»—i liÃªn quan Ä‘áº¿n truy váº¥n mÃ  báº¡n Ä‘ang thá»±c hiá»‡n. Viá»‡c reset lá»—i sáº½ xÃ³a lá»—i hiá»‡n táº¡i vÃ  cho phÃ©p truy váº¥n Ä‘Æ°á»£c thá»±c thi láº¡i.

- Khi sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `resetErrorBoundary` hoáº·c `reset` trong React Query, nÃ³ chá»‰ Ä‘áº·t láº¡i lá»—i cho truy váº¥n cá»¥ thá»ƒ mÃ  báº¡n Ä‘ang lÃ m viá»‡c, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c lá»—i tá»« cÃ¡c truy váº¥n khÃ¡c hoáº·c cÃ¡c lá»—i Ä‘Ã£ xáº£y ra trong quÃ¡ khá»©.

- Äá»ƒ xoÃ¡ háº¿t táº¥t cáº£ cÃ¡c lá»—i tá»« trÆ°á»›c Ä‘Ã³ trong quÃ¡ khá»© trong React Query, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `queryClient.resetErrors()`. PhÆ°Æ¡ng thá»©c nÃ y sáº½ xÃ³a toÃ n bá»™ cÃ¡c lá»—i cá»§a táº¥t cáº£ cÃ¡c truy váº¥n trong `cache`, khÃ´ng chá»‰ riÃªng truy váº¥n hiá»‡n táº¡i.

- VÃ¬ váº­y, viá»‡c reset lá»—i chá»‰ tÃ¡c Ä‘á»™ng Ä‘áº¿n truy váº¥n cá»¥ thá»ƒ hoáº·c táº¥t cáº£ cÃ¡c truy váº¥n trong `cache`, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c lá»—i tá»« trÆ°á»›c Ä‘Ã³ cá»§a cÃ¡c truy váº¥n khÃ¡c.

## Reset láº¡i data cÃ³ nghÄ©a lÃ  xoÃ¡ háº¿t táº¥t cáº£ cÃ¡c dá»¯ tá»« trÆ°á»›c Ä‘Ã³ vÃ  trong cache lun háº£ ?

- Khi báº¡n sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `reset` trong React Query Ä‘á»ƒ `reset` láº¡i dá»¯ liá»‡u cá»§a má»™t truy váº¥n, nÃ³ sáº½ xoÃ¡ dá»¯ liá»‡u cá»§a truy váº¥n Ä‘Ã³ khá»i `cache`. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  dá»¯ liá»‡u cá»§a truy váº¥n sáº½ khÃ´ng cÃ²n tá»“n táº¡i trong `cache` vÃ  khi truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c fetch tá»« nguá»“n dá»¯ liá»‡u gá»‘c.

- Tuy nhiÃªn, viá»‡c `reset` láº¡i dá»¯ liá»‡u chá»‰ áº£nh hÆ°á»Ÿng Ä‘áº¿n truy váº¥n cá»¥ thá»ƒ mÃ  báº¡n gá»i phÆ°Æ¡ng thá»©c `reset` vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c truy váº¥n khÃ¡c. Náº¿u báº¡n muá»‘n xoÃ¡ háº¿t táº¥t cáº£ cÃ¡c dá»¯ liá»‡u trong `cache` cá»§a táº¥t cáº£ cÃ¡c truy váº¥n bao gá»“m dá»¯ liá»‡u trÆ°á»›c Ä‘Ã³, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `queryClient.clear()` Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³.

- VÃ¬ váº­y, khi báº¡n `reset` láº¡i dá»¯ liá»‡u cá»§a má»™t truy váº¥n báº±ng cÃ¡ch sá»­ dá»¥ng `reset`, nÃ³ chá»‰ xoÃ¡ dá»¯ liá»‡u cá»§a truy váº¥n Ä‘Ã³ khá»i `cache` vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c dá»¯ liá»‡u cá»§a truy váº¥n khÃ¡c trong `cache`.

## Reset formState vá»›i mutationAsync trong React Query ?

- Trong React Query, Ä‘á»ƒ reset formState sau khi thá»±c hiá»‡n má»™t mutation (POST, PUT, DELETE) báº±ng cÃ¡ch sá»­ dá»¥ng `mutationAsync`, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c bÆ°á»›c sau:

1. Äá»‹nh nghÄ©a má»™t biáº¿n thá»ƒ hiá»‡n tráº¡ng thÃ¡i cá»§a form, vÃ­ dá»¥: `const [formData, setFormData] = useState(initialFormData);`. `initialFormData` lÃ  giÃ¡ trá»‹ ban Ä‘áº§u cá»§a form.

2. Trong hÃ m `handleSubmit` cá»§a form, sau khi gá»i `mutationAsync`, báº¡n cÃ³ thá»ƒ reset formState báº±ng cÃ¡ch gÃ¡n láº¡i giÃ¡ trá»‹ ban Ä‘áº§u cho biáº¿n `formData`, vÃ­ dá»¥: `setFormData(initialFormData);`.

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ minh há»a:

```jsx
import { useMutation } from 'react-query'

const initialFormData = {
  // Khá»Ÿi táº¡o giÃ¡ trá»‹ ban Ä‘áº§u cá»§a form
  // ...
}

const [formData, setFormData] = useState(initialFormData)

const AddStudentForm = () => {
  const mutation = useMutation(addStudent)

  const handleSubmit = async (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newStudent = Object.fromEntries(formData.entries())

    try {
      await mutation.mutationAsync(newStudent)
      // Reset formState sau khi thÃ nh cÃ´ng
      setFormData(initialFormData)
    } catch (error) {
      // Xá»­ lÃ½ lá»—i khi mutation tháº¥t báº¡i
    }
  }

  return <form onSubmit={handleSubmit}>{/* CÃ¡c trÆ°á»ng form */}</form>
}
```

- Trong vÃ­ dá»¥ trÃªn, sau khi mutation thÃ nh cÃ´ng, chÃºng ta gá»i `setFormData(initialFormData)` Ä‘á»ƒ Ä‘áº·t láº¡i giÃ¡ trá»‹ ban Ä‘áº§u cho form. Äiá»u nÃ y sáº½ lÃ m cho form trá»Ÿ vá» tráº¡ng thÃ¡i rá»—ng hoáº·c tráº¡ng thÃ¡i ban Ä‘áº§u cá»§a form, tÃ¹y thuá»™c vÃ o giÃ¡ trá»‹ Ä‘Æ°á»£c khá»Ÿi táº¡o ban Ä‘áº§u trong `initialFormData`.

- LÆ°u Ã½ ráº±ng `setFormData` lÃ  má»™t hÃ m tá»« hook `useState`, vÃ  báº¡n cáº§n pháº£i Ä‘á»‹nh nghÄ©a biáº¿n `formData` vÃ  hÃ m `setFormData` Ä‘á»ƒ sá»­ dá»¥ng nÃ³.

## `const formData = new FormData(event.target)`. FormData cÃ³ sáºµn hay sao mÃ  tÃ´i khÃ´ng tháº¥y khai bÃ¡o ?

- `FormData` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ sáºµn trong JavaScript vÃ  khÃ´ng cáº§n pháº£i khai bÃ¡o hoáº·c import tá»« cÃ¡c thÆ° viá»‡n bÃªn ngoÃ i. Äá»‘i tÆ°á»£ng `FormData` cho phÃ©p báº¡n táº¡o vÃ  quáº£n lÃ½ dá»¯ liá»‡u form dá»… dÃ ng trong JavaScript.

- Trong vÃ­ dá»¥ cá»§a chÃºng ta, `FormData` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o má»™t Ä‘á»‘i tÆ°á»£ng formData tá»« sá»± kiá»‡n `submit` cá»§a form (`event.target`). Khi truyá»n `event.target` vÃ o constructor cá»§a `FormData`, nÃ³ sáº½ tá»± Ä‘á»™ng trÃ­ch xuáº¥t cÃ¡c giÃ¡ trá»‹ tá»« cÃ¡c trÆ°á»ng form vÃ  táº¡o má»™t Ä‘á»‘i tÆ°á»£ng `FormData` tÆ°Æ¡ng á»©ng.

- Sau Ä‘Ã³, chÃºng ta sá»­ dá»¥ng formData Ä‘á»ƒ táº¡o Ä‘á»‘i tÆ°á»£ng `newStudent` thÃ´ng qua phÆ°Æ¡ng thá»©c `Object.fromEntries(formData.entries())`. Äiá»u nÃ y chuyá»ƒn Ä‘á»•i Ä‘á»‘i tÆ°á»£ng `FormData` thÃ nh má»™t Ä‘á»‘i tÆ°á»£ng JavaScript thÃ´ng thÆ°á»ng vá»›i cÃ¡c cáº·p key-value tÆ°Æ¡ng á»©ng vá»›i cÃ¡c trÆ°á»ng form.

- VÃ¬ `FormData` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ sáºµn trong JavaScript, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ mÃ  khÃ´ng cáº§n khai bÃ¡o hoáº·c import tá»« cÃ¡c thÆ° viá»‡n bÃªn ngoÃ i.

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

Náº¿u useQuery dÃ¹ng Ä‘á»ƒ GET thÃ¬ useMutation dÃ¹ng Ä‘á»ƒ POST, PUT, DELETE. Video nÃ y tiáº¿p ná»‘i video láº§n trÆ°á»›c chÃºng ta sáº½ thá»±c hiá»‡n chá»©c nÄƒng thÃªm há»c sinh ğŸ‰

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ CÃ¡ch phÃ¢n trang vÃ  tá»‘i Æ°u UX vá»›i React Query
ğŸ‰ Nhá»¯ng state quan trá»ng trong React Query
ğŸ‰ CÆ¡ cháº¿ caching cá»§a React Query

ğŸ•°ï¸Ná»™i dung chÃ­nh

```jsx
00:00 - add student vá»›i useMutation
28:38 - Xá»­ lÃ½ lá»—i 422 khi submit form bá»‹ lá»—i
48:20 - reset error vÃ  data
50:45 - reset formState vá»›i mutationAsync
```
