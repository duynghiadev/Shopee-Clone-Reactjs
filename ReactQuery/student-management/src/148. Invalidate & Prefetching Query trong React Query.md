## ÄÃ¢y lÃ  Docs tá»± research:

- â“ ÄÃ¢y lÃ  cÃ¢u há»i trong bÃ i nÃ y:

- â“ CÃ¢u há»i: Anh Æ¡i, em tháº¥y trong `useQuery()` Ä‘Ã£ cÃ³ sáºµn hÃ m `refetch()`, em cÅ©ng hay dÃ¹ng hÃ m nÃ y má»—i khi cáº§n refetch data sau khi `mutate`. Váº­y hÃ m `refetch()` nÃ y khÃ¡c tháº¿ nÃ o vá»›i 2 cÃ¡i `queryClient.setQueyData()` vÃ  `queryClient.invalidateQueries()` lÃ  gÃ¬ áº¥y anh ?

- âœ… Tráº£ lá»i: `refetch` => Gá»i 1 cÃ¡i query instance trong component. `invalidateQueries` => Gá»i láº¡i 1 hoáº·c nhiá»u query, cÃ³ thá»ƒ dÃ¹ng cho cÃ¡c component khÃ¡c cÅ©ng Ä‘Æ°á»£c. `setQueryData` => Cáº­p nháº­t data má»›i (khÃ´ng fetch láº¡i API)

## Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n khÃ¡c `invalidateQueries`:

- Táº¥t nhiÃªn! CÃ¹ng tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query.

- PhÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong React Query. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i cÃ¡c tÃ¹y chá»n Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch truy váº¥n Ä‘Æ°á»£c lÃ m má»›i.

- CÃº phÃ¡p:

```jsx
queryClient.invalidateQueries(key, options)
```

- Trong Ä‘Ã³:

  - `key` lÃ  key hoáº·c má»™t máº£ng cÃ¡c key cá»§a cÃ¡c truy váº¥n cáº§n lÃ m má»›i.
  - `options` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng (object) tÃ¹y chá»n (khÃ´ng báº¯t buá»™c) Ä‘á»ƒ kiá»ƒm soÃ¡t hÃ nh vi lÃ m má»›i.

- CÃ¡c tÃ¹y chá»n phá»• biáº¿n khi sá»­ dá»¥ng `invalidateQueries` bao gá»“m:

  1. `exact`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, chá»‰ cÃ³ cÃ¡c truy váº¥n cÃ³ key chÃ­nh xÃ¡c trÃ¹ng khá»›p vá»›i key má»›i sáº½ Ä‘Æ°á»£c lÃ m má»›i, cÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

  2. `refetchActive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh `fetching` sáº½ Ä‘Æ°á»£c há»§y vÃ  lÃ m má»›i.

  3. `refetchInactive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n khÃ´ng hoáº¡t Ä‘á»™ng (`inactive`) sáº½ Ä‘Æ°á»£c lÃ m má»›i. Má»™t truy váº¥n Ä‘Æ°á»£c coi lÃ  khÃ´ng hoáº¡t Ä‘á»™ng náº¿u khÃ´ng cÃ³ listeners nÃ o Ä‘ang láº¯ng nghe sá»± thay Ä‘á»•i trong nÃ³.

  4. `throwOnError`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh lÃ m má»›i truy váº¥n, nÃ³ sáº½ nÃ©m ra lá»—i Ä‘á»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bÃªn ngoÃ i.

- VÃ­ dá»¥ sá»­ dá»¥ng `invalidateQueries` vá»›i cÃ¡c tÃ¹y chá»n:

```jsx
import { useQueryClient } from 'react-query';

const TodoList = () => {
  const queryClient = useQueryClient();

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId);

    // LÃ m má»›i truy váº¥n 'todos' vÃ  chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c
    queryClient.invalidateQueries('todos', {
      exact: true
    });
  };

  return (
    // ...
  );
};
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n `'todos'` vÃ  chá»‰ lÃ m má»›i truy váº¥n cÃ³ key chÃ­nh xÃ¡c lÃ  `'todos'`. CÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

- ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ cÆ¡ báº£n vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query. Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡c tÃ¹y chá»n khÃ¡c vÃ  cÃ¡c kháº£ nÄƒng linh hoáº¡t khÃ¡c cá»§a React Query trong tÃ i liá»‡u chÃ­nh thá»©c cá»§a nÃ³.

## Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query (`invalidateQueries`) trong React Query:

- Trong React Query, `invalidateQueries` lÃ  má»™t phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c cung cáº¥p bá»Ÿi `useQueryClient` Ä‘á»ƒ lÃ m má»›i (invalidate) cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache. Khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c nÃ y, React Query sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i tá»« nguá»“n dá»¯ liá»‡u (vÃ­ dá»¥: tá»« API).

- DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query:

1. Äáº§u tiÃªn, chÃºng ta cáº§n láº¥y instance cá»§a `queryClient` báº±ng cÃ¡ch sá»­ dá»¥ng `useQueryClient` trong component:

```jsx
import { useQueryClient } from 'react-query'

const MyComponent = () => {
  const queryClient = useQueryClient()

  // ...
}
```

2. Sau Ä‘Ã³, khi muá»‘n lÃ m má»›i má»™t hoáº·c nhiá»u truy váº¥n, chÃºng ta gá»i phÆ°Æ¡ng thá»©c `invalidateQueries` trÃªn `queryClient`:

```jsx
queryClient.invalidateQueries('todos')
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta gá»i `invalidateQueries('todos')` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`. Äiá»u nÃ y sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i cho cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`.

- NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ truyá»n má»™t máº£ng cÃ¡c key Ä‘á»ƒ lÃ m má»›i nhiá»u truy váº¥n cÃ¹ng má»™t lÃºc:

```jsx
queryClient.invalidateQueries(['todos', 'user', 'posts'])
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`, `'user'` vÃ  `'posts'`. Táº¥t cáº£ cÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c xÃ³a khá»i cache vÃ  truy váº¥n láº¡i tá»« nguá»“n dá»¯ liá»‡u.

- `invalidateQueries` cÅ©ng há»— trá»£ má»™t sá»‘ tÃ¹y chá»n Ä‘á»ƒ Ä‘iá»u chá»‰nh cÃ¡ch lÃ m má»›i truy váº¥n, nhÆ° `exact` Ä‘á»ƒ chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c báº±ng key hoáº·c `refetchActive` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n Ä‘ang Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng. Äá»ƒ biáº¿t thÃªm chi tiáº¿t, báº¡n cÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u chÃ­nh thá»©c cá»§a React Query.

## HÆ°á»›ng dáº«n vÃ  vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng React Query, bao gá»“m cáº£ viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` ?

- Äá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query, báº¡n cáº§n lÃ m nhÆ° sau:

1. Äáº§u tiÃªn, Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ cÃ i Ä‘áº·t React Query vÃ  Ä‘Ã£ import cÃ¡c hÃ m cáº§n thiáº¿t tá»« thÆ° viá»‡n:

```jsx
import { useQueryClient } from 'react-query'
```

2. Trong component cá»§a báº¡n, sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y má»™t instance cá»§a `QueryClient`:

```jsx
const queryClient = useQueryClient()
```

3. BÃ¢y giá» báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong `QueryClient`. PhÆ°Æ¡ng thá»©c nÃ y nháº­n vÃ o má»™t key hoáº·c má»™t máº£ng cÃ¡c key Ä‘á»ƒ chá»‰ Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n lÃ m má»›i:

```jsx
queryClient.invalidateQueries('todos') // LÃ m má»›i truy váº¥n cÃ³ key lÃ  'todos'
queryClient.invalidateQueries(['user', userId]) // LÃ m má»›i truy váº¥n cÃ³ key lÃ  ['user', userId]
queryClient.invalidateQueries() // LÃ m má»›i táº¥t cáº£ cÃ¡c truy váº¥n trong QueryClient
```

- VÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng `invalidateQueries`:

```jsx
import { useQuery, useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId)

    // LÃ m má»›i truy váº¥n 'todos' sau khi xÃ³a
    queryClient.invalidateQueries('todos')
  }

  return (
    <div>
      {/* Hiá»ƒn thá»‹ danh sÃ¡ch todo */}
      {todos.map((todo) => (
        <div key={todo.id}>
          <span>{todo.title}</span>
          <button onClick={() => handleDeleteTodo(todo.id)}>XÃ³a</button>
        </div>
      ))}
    </div>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt "XÃ³a" Ä‘á»ƒ xÃ³a má»™t todo, chÃºng ta gá»i API Ä‘á»ƒ thá»±c hiá»‡n xÃ³a todo Ä‘Ã³. Sau khi xÃ³a thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n 'todos', tá»« Ä‘Ã³ Ä‘áº£m báº£o ráº±ng danh sÃ¡ch todos Ä‘Æ°á»£c cáº­p nháº­t má»›i nháº¥t.

## Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation trong React Query:

## Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query:

## Cáº­p nháº­t data query thÃ´ng qua setQueryData trong React Query:

## refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate trong React Query:

## Sá»­ dá»¥ng tÃ­nh nÄƒng prefetching query trong React Query:

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

á» video láº§n trÆ°á»›c náº¿u anh em Ä‘á»ƒ Ã½ thÃ¬ mÃ¬nh cÃ³ má»™t bug nho nhá» trong pháº§n Student Info Ä‘Ã³ lÃ  khÃ´ng hiá»ƒn thá»‹ Ä‘Ãºng gender, video nÃ y mÃ¬nh sáº½ fix luÃ´n.

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query
ğŸ‰ Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation
ğŸ‰ Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query

ğŸ•°ï¸Ná»™i dung chÃ­nh

00:00 - Cáº­p nháº­t data query thÃ´ng qua setQueryData
05:38 - refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate
12:14 - SÆ° dá»¥ng tÃ­nh nÄƒng prefetching query

![SWR trong React Query](image-1.png)
