## ÄÃ¢y lÃ  Docs tá»± research:

- â“ ÄÃ¢y lÃ  cÃ¢u há»i trong bÃ i nÃ y:

- â“ CÃ¢u há»i: Anh Æ¡i, em tháº¥y trong `useQuery()` Ä‘Ã£ cÃ³ sáºµn hÃ m `refetch()`, em cÅ©ng hay dÃ¹ng hÃ m nÃ y má»—i khi cáº§n refetch data sau khi `mutate`. Váº­y hÃ m `refetch()` nÃ y khÃ¡c tháº¿ nÃ o vá»›i 2 cÃ¡i `queryClient.setQueyData()` vÃ  `queryClient.invalidateQueries()` lÃ  gÃ¬ áº¥y anh ?

- âœ… Tráº£ lá»i: `refetch` => Gá»i 1 cÃ¡i query instance trong component. `invalidateQueries` => Gá»i láº¡i 1 hoáº·c nhiá»u query, cÃ³ thá»ƒ dÃ¹ng cho cÃ¡c component khÃ¡c cÅ©ng Ä‘Æ°á»£c. `setQueryData` => Cáº­p nháº­t data má»›i (khÃ´ng fetch láº¡i API)

## Ã”n láº¡i bÃ i cÅ©: ğŸ’¥ğŸ’¥ğŸ’¥

## Trong react query trong Ä‘Ã³ cÃ³ queryKey. Trong queryKey cÃ³ 2 tham sá»‘, 2 tham sá»‘ Ä‘Ã³ lÃ  gÃ¬ ?

- Trong React Query, `queryKey` lÃ  má»™t máº£ng gá»“m cÃ¡c tham sá»‘ Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»™t truy váº¥n dá»¯ liá»‡u cá»¥ thá»ƒ. Má»—i pháº§n tá»­ trong máº£ng `queryKey` Ä‘áº¡i diá»‡n cho má»™t pháº§n quan trá»ng trong viá»‡c xÃ¡c Ä‘á»‹nh truy váº¥n.

- ThÆ°á»ng thÃ¬ `queryKey` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vá»›i cáº¥u trÃºc `[type, ...params]`, trong Ä‘Ã³:

  - `type`: LÃ  má»™t chuá»—i (string) Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n, vÃ­ dá»¥ nhÆ° "user", "todos", "posts",...
  - `params`: LÃ  cÃ¡c tham sá»‘ bá»• sung khÃ¡c (náº¿u cÃ³) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u má»™t cÃ¡ch cá»¥ thá»ƒ. CÃ¡c tham sá»‘ nÃ y thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»™t Ä‘á»‘i tÆ°á»£ng hoáº·c má»™t giÃ¡ trá»‹ duy nháº¥t liÃªn quan Ä‘áº¿n truy váº¥n.

- VÃ­ dá»¥, náº¿u báº¡n muá»‘n truy váº¥n dá»¯ liá»‡u cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ vá»›i `userId` lÃ  1, thÃ¬ `queryKey` cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  `['user', 1]`. Trong Ä‘Ã³, `'user'` lÃ  loáº¡i dá»¯ liá»‡u `"user"`, vÃ  1 lÃ  `userId`.

- TÃ¹y thuá»™c vÃ o cÃ¡ch báº¡n Ä‘á»‹nh nghÄ©a truy váº¥n vÃ  cáº¥u trÃºc dá»¯ liá»‡u cá»§a á»©ng dá»¥ng, sá»‘ lÆ°á»£ng vÃ  Ã½ nghÄ©a cá»§a cÃ¡c tham sá»‘ trong `queryKey` cÃ³ thá»ƒ khÃ¡c nhau. Báº¡n cÃ³ thá»ƒ tuá»³ chá»‰nh `queryKey` Ä‘á»ƒ phÃ¹ há»£p vá»›i nhu cáº§u cá»§a truy váº¥n dá»¯ liá»‡u cá»§a mÃ¬nh.

## âŒâŒ Tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` cÃ³ pháº£i lÃ  nÃ³ tiáº¿p ná»‘i vá»›i `router` trÃªn `server` khÃ´ng. VÃ­ dá»¥ tÃ´i cÃ³ `localhost://blog/post`, trong link Ä‘Ã³ cÃ³ `/post`, thÃ¬ Ä‘Ã³ cÃ³ pháº£i lÃ  `type` cá»§a `queryKey` khÃ´ng ?

- KhÃ´ng, tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` khÃ´ng pháº£i lÃ  tiáº¿p ná»‘i vá»›i `router` trÃªn `server`. NÃ³ chá»‰ Ä‘Æ¡n giáº£n lÃ  má»™t chuá»—i (string) Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n.

- Trong trÆ°á»ng há»£p cá»§a báº¡n, náº¿u báº¡n cÃ³ má»™t trang web `localhost://blog/post` vÃ  báº¡n muá»‘n truy váº¥n dá»¯ liá»‡u vá» bÃ i viáº¿t (`post`), báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `'post'` lÃ m tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh loáº¡i dá»¯ liá»‡u lÃ  bÃ i viáº¿t.

- VÃ­ dá»¥: `queryKey: ['post', ...]`

- Viá»‡c tiáº¿p ná»‘i vá»›i `router` trÃªn `server` thÆ°á»ng Ä‘Æ°á»£c xá»­ lÃ½ bÃªn phÃ­a `server` vÃ  khÃ´ng liÃªn quan trá»±c tiáº¿p Ä‘áº¿n `queryKey` trong React Query. `queryKey` chá»‰ Ä‘Æ¡n giáº£n lÃ  má»™t pháº§n trong viá»‡c xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u mÃ  React Query sáº½ quáº£n lÃ½ vÃ  Ä‘iá»u khiá»ƒn.

## Váº­y thÃ¬ tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` phá»¥ thuá»™c vÃ o cÃ¡i gÃ¬, nÃ³ Ä‘áº·t tÃªn `type` cho tham sá»‘ Ä‘áº§u tiÃªn nÃ³ phá»¥ thuá»™c vÃ o Ä‘Ã¢u, hay lÃ  mÃ¬nh Ä‘áº·t tÃªn gÃ¬ cÅ©ng Ä‘Æ°á»£c ?

- Tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` khÃ´ng phá»¥ thuá»™c vÃ o báº¥t ká»³ yáº¿u tá»‘ cá»¥ thá»ƒ nÃ o vÃ  báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃªn cho nÃ³ theo Ã½ muá»‘n. NÃ³ khÃ´ng cÃ³ quy táº¯c cá»©ng nháº¯c vá» cÃ¡ch Ä‘áº·t tÃªn, vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ chuá»—i nÃ o lÃ m giÃ¡ trá»‹ cho tham sá»‘ Ä‘áº§u tiÃªn.

- Tuy nhiÃªn, Ä‘á»ƒ giá»¯ cho tÃªn tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` dá»… hiá»ƒu vÃ  dá»… quáº£n lÃ½, báº¡n cÃ³ thá»ƒ chá»n cÃ¡c giÃ¡ trá»‹ cÃ³ liÃªn quan Ä‘áº¿n loáº¡i dá»¯ liá»‡u báº¡n Ä‘ang truy váº¥n. VÃ­ dá»¥, náº¿u báº¡n Ä‘ang truy váº¥n dá»¯ liá»‡u vá» bÃ i viáº¿t, báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃªn tham sá»‘ Ä‘áº§u tiÃªn lÃ  `'post'`. Tuy nhiÃªn, báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ tÃªn nÃ o phÃ¹ há»£p vá»›i dá»± Ã¡n cá»§a mÃ¬nh, vÃ­ dá»¥ nhÆ° `'data'`, `'item'`, `'resource'`, vv.

## Viá»‡c Ä‘áº·t tÃªn nhÆ° tháº¿ thÃ¬ khi nÃ³ lÆ°u trong `cache` thÃ¬ nÃ³ cÃ³ `key` lÃ  `post` cÃ³ pháº£i khÃ´ng ?

- KhÃ´ng, khi dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong cache, khÃ´ng pháº£i lÃ  tÃªn cá»§a tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m `key` trong `cache`. Trong React Query, cÃ¡c key trong cache Ä‘Æ°á»£c quáº£n lÃ½ tá»± Ä‘á»™ng vÃ  Ä‘Æ°á»£c táº¡o ra dá»±a trÃªn cÃ¡c tham sá»‘ cá»§a `queryKey`, khÃ´ng phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ cá»§a cÃ¡c tham sá»‘ Ä‘Ã³.

- Khi báº¡n thá»±c hiá»‡n má»™t truy váº¥n vÃ  sá»­ dá»¥ng `queryKey` Ä‘á»ƒ Ä‘á»‹nh danh nÃ³, React Query sáº½ táº¡o má»™t key duy nháº¥t cho truy váº¥n Ä‘Ã³ trong cache. Key nÃ y sáº½ dá»±a trÃªn cÃ¡c giÃ¡ trá»‹ cá»§a cÃ¡c tham sá»‘ trong `queryKey` vÃ  Ä‘Æ°á»£c táº¡o ra theo quy táº¯c cá»§a React Query.

- VÃ¬ váº­y, trong vÃ­ dá»¥ cá»§a báº¡n vá»›i `queryKey: ['post', id]`, dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong cache sáº½ khÃ´ng cÃ³ key lÃ  `'post'`, mÃ  sáº½ cÃ³ má»™t key duy nháº¥t Ä‘Æ°á»£c táº¡o ra bá»Ÿi React Query dá»±a trÃªn giÃ¡ trá»‹ cá»§a `id` vÃ  quy táº¯c cá»§a nÃ³.

## Váº­y `'post'` trong tham sá»‘ Ä‘áº§u tiÃªn trong queryKey Ä‘Æ°á»£c Ä‘áº·t Ä‘á»ƒ lÃ m gÃ¬ ? NÃ³ khÃ´ng cÃ³ tÃ¡c dá»¥ng gÃ¬ háº£ ?

- Trong `queryKey`, tham sá»‘ Ä‘áº§u tiÃªn (trong trÆ°á»ng há»£p cá»§a báº¡n lÃ  `'post'`) khÃ´ng cÃ³ tÃ¡c dá»¥ng trá»±c tiáº¿p trong viá»‡c quáº£n lÃ½ cache hoáº·c Ä‘á»‹nh danh truy váº¥n. NÃ³ chá»‰ lÃ  má»™t giÃ¡ trá»‹ bá»• sung mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ phÃ¢n loáº¡i cÃ¡c loáº¡i truy váº¥n hoáº·c nháº­n biáº¿t má»¥c Ä‘Ã­ch cá»§a truy váº¥n Ä‘Ã³.

- VÃ­ dá»¥, náº¿u báº¡n cÃ³ nhiá»u loáº¡i truy váº¥n trong á»©ng dá»¥ng cá»§a mÃ¬nh nhÆ° `'post'`, `'user'`, `'comment'`, thÃ¬ sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong `queryKey` lÃ  má»™t cÃ¡ch Ä‘á»ƒ phÃ¢n loáº¡i cÃ¡c truy váº¥n vÃ  lÃ m cho code dá»… Ä‘á»c hÆ¡n. Tuy nhiÃªn, React Query khÃ´ng sá»­ dá»¥ng giÃ¡ trá»‹ nÃ y trong quÃ¡ trÃ¬nh quáº£n lÃ½ cache hay táº¡o key cho cache.

- Do Ä‘Ã³, náº¿u báº¡n chá»‰ cÃ³ má»™t loáº¡i truy váº¥n duy nháº¥t vÃ  khÃ´ng cáº§n phÃ¢n loáº¡i cÃ¡c truy váº¥n, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t máº£ng `queryKey` chá»‰ vá»›i má»™t tham sá»‘, vÃ­ dá»¥ nhÆ° `[id]`, vÃ  bá» qua giÃ¡ trá»‹ Ä‘áº§u tiÃªn.

## âŒâŒ Äáº·t tÃªn cho giÃ¡ trá»‹ truy váº¥n lÃ  `'post'`, thÃ¬ khi cÃ³ má»™t cÃ¡i queryKey khÃ¡c cÅ©ng cÃ³ tham sá»‘ Ä‘áº§u tiÃªn lÃ  `'post'` lÃºc nÃ y 2 cÃ¡i truy váº¥n cÃ¹ng tÃªn sáº½ gá»i láº¡i cÃ¹ng nhau Ä‘Ãºng khÃ´ng ?

- Trong React Query, cÃ¡c truy váº¥n khÃ´ng chá»‰ phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ cá»§a tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem chÃºng cÃ³ cÃ¹ng má»™t truy váº¥n hay khÃ´ng. Thay vÃ o Ä‘Ã³, React Query sá»­ dá»¥ng cÆ¡ cháº¿ Ä‘á»‹nh danh truy váº¥n dá»±a trÃªn toÃ n bá»™ `queryKey`.

- Khi báº¡n khá»Ÿi táº¡o má»™t truy váº¥n má»›i vá»›i má»™t `queryKey` cá»¥ thá»ƒ, React Query sáº½ táº¡o ra má»™t key duy nháº¥t cho truy váº¥n Ä‘Ã³ báº±ng cÃ¡ch káº¿t há»£p cÃ¡c giÃ¡ trá»‹ trong `queryKey`. Do Ä‘Ã³, ngay cáº£ khi cÃ³ hai `queryKey` vá»›i cÃ¹ng giÃ¡ trá»‹ `'post'` trong tham sá»‘ Ä‘áº§u tiÃªn, nhÆ°ng cÃ³ cÃ¡c giÃ¡ trá»‹ khÃ¡c trong cÃ¡c tham sá»‘ khÃ¡c, chÃºng sáº½ Ä‘Æ°á»£c xem lÃ  hai truy váº¥n riÃªng biá»‡t vÃ  khÃ´ng gá»i láº¡i cÃ¹ng nhau.

- VÃ­ dá»¥:

```jsx
const queryKey1 = ['post', 1]
const queryKey2 = ['post', 2]

// Hai queryKey khÃ¡c nhau, khÃ´ng gá»i láº¡i cÃ¹ng nhau
queryClient.fetchQuery(queryKey1)
queryClient.fetchQuery(queryKey2)
```

- Do Ä‘Ã³, khi Ä‘áº·t tÃªn cho giÃ¡ trá»‹ trong `queryKey`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¹ng má»™t giÃ¡ trá»‹ cho tham sá»‘ Ä‘áº§u tiÃªn náº¿u nÃ³ há»£p lÃ½ vá»›i báº£n thiáº¿t káº¿ cá»§a á»©ng dá»¥ng cá»§a báº¡n. Tuy nhiÃªn, hÃ£y cháº¯c cháº¯n ráº±ng cÃ¡c giÃ¡ trá»‹ khÃ¡c trong `queryKey` khÃ¡c nhau Ä‘á»ƒ cÃ¡c truy váº¥n khÃ´ng gá»i láº¡i nhau nháº§m láº«n.

## âŒâŒ Váº­y thÃ¬ tham sá»‘ thá»© 2 lÃ  `id`, nÃ³ lÃ  duy nháº¥t. MÃ  nÃ³ dá»±a vÃ o link `API` tá»« `server` Ä‘á»ƒ nÃ³ láº¥y dá»¯ liá»‡u hay sao ?

- Tham sá»‘ thá»© hai trong `queryKey` thÆ°á»ng lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t nhÆ° `ID`, vÃ  nÃ³ thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»‹nh danh má»™t má»¥c dá»¯ liá»‡u cá»¥ thá»ƒ trong há»‡ thá»‘ng hoáº·c API tá»« server.

- Khi báº¡n thá»±c hiá»‡n má»™t truy váº¥n vá»›i `queryKey` chá»©a má»™t giÃ¡ trá»‹ `ID`, vÃ­ dá»¥ nhÆ° `['post', 1]`, React Query sá»­ dá»¥ng giÃ¡ trá»‹ `ID` nÃ y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u cáº§n truy váº¥n tá»« server. CÃ¡ch xá»­ lÃ½ chi tiáº¿t sáº½ phá»¥ thuá»™c vÃ o cÃ¡ch báº¡n cáº¥u hÃ¬nh truy váº¥n vÃ  tÆ°Æ¡ng tÃ¡c vá»›i API cá»§a mÃ¬nh.

- ThÃ´ng thÆ°á»ng, báº¡n sáº½ sá»­ dá»¥ng giÃ¡ trá»‹ `ID` Ä‘á»ƒ chá»‰ Ä‘á»‹nh má»™t má»¥c dá»¯ liá»‡u cá»¥ thá»ƒ, vÃ­ dá»¥ nhÆ° láº¥y thÃ´ng tin má»™t bÃ i viáº¿t theo `ID`, hoáº·c láº¥y chi tiáº¿t má»™t ngÆ°á»i dÃ¹ng dá»±a trÃªn `ID` cá»§a há». Truyá»n giÃ¡ trá»‹ `ID` nÃ y trong `queryKey` cho truy váº¥n sáº½ giÃºp React Query nháº­n biáº¿t rÃµ ráº±ng truy váº¥n Ä‘Ã³ tÆ°Æ¡ng á»©ng vá»›i má»™t dá»¯ liá»‡u cá»¥ thá»ƒ vÃ  cáº§n Ä‘Æ°á»£c cáº­p nháº­t hoáº·c lÃ m má»›i khi cÃ³ thay Ä‘á»•i.

- Tuy nhiÃªn, cÃ¡ch mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n tá»« server dá»±a trÃªn `queryKey` vÃ  giÃ¡ trá»‹ `ID` sáº½ phá»¥ thuá»™c vÃ o cÃ¡ch báº¡n triá»ƒn khai API cá»§a mÃ¬nh. Báº¡n cáº§n xÃ¡c Ä‘á»‹nh vÃ  xá»­ lÃ½ logic phÃ¹ há»£p trong hÃ m truy váº¥n (`queryFn`) Ä‘á»ƒ gá»­i yÃªu cáº§u Ä‘áº¿n API vÃ  láº¥y dá»¯ liá»‡u tÆ°Æ¡ng á»©ng vá»›i giÃ¡ trá»‹ `ID` tá»« server.

## Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n khÃ¡c `invalidateQueries`:

- Táº¥t nhiÃªn! CÃ¹ng tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query.

- PhÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong React Query. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i cÃ¡c tÃ¹y chá»n Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch truy váº¥n Ä‘Æ°á»£c lÃ m má»›i.

- CÃº phÃ¡p:

```jsx
queryClient.invalidateQueries(key, options)
```

- Trong Ä‘Ã³:

  - `key` lÃ  key hoáº·c má»™t máº£ng cÃ¡c key cá»§a cÃ¡c truy váº¥n cáº§n lÃ m má»›i.
  - `options` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng (object) tÃ¹y chá»n (khÃ´ng báº¯t buá»™c) Ä‘á»ƒ kiá»ƒm soÃ¡t hÃ nh vi lÃ m má»›i.

- CÃ¡c tÃ¹y chá»n phá»• biáº¿n khi sá»­ dá»¥ng `invalidateQueries` bao gá»“m:

  1. `exact`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, chá»‰ cÃ³ cÃ¡c truy váº¥n cÃ³ key chÃ­nh xÃ¡c trÃ¹ng khá»›p vá»›i key má»›i sáº½ Ä‘Æ°á»£c lÃ m má»›i, cÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

  2. `refetchActive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh `fetching` sáº½ Ä‘Æ°á»£c há»§y vÃ  lÃ m má»›i.

  3. `refetchInactive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n khÃ´ng hoáº¡t Ä‘á»™ng (`inactive`) sáº½ Ä‘Æ°á»£c lÃ m má»›i. Má»™t truy váº¥n Ä‘Æ°á»£c coi lÃ  khÃ´ng hoáº¡t Ä‘á»™ng náº¿u khÃ´ng cÃ³ listeners nÃ o Ä‘ang láº¯ng nghe sá»± thay Ä‘á»•i trong nÃ³.

  4. `throwOnError`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh lÃ m má»›i truy váº¥n, nÃ³ sáº½ nÃ©m ra lá»—i Ä‘á»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bÃªn ngoÃ i.

- VÃ­ dá»¥ sá»­ dá»¥ng `invalidateQueries` vá»›i cÃ¡c tÃ¹y chá»n:

```jsx
import { useQueryClient } from 'react-query';

const TodoList = () => {
  const queryClient = useQueryClient();

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId);

    // LÃ m má»›i truy váº¥n 'todos' vÃ  chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c
    queryClient.invalidateQueries('todos', {
      exact: true
    });
  };

  return (
    // ...
  );
};
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n `'todos'` vÃ  chá»‰ lÃ m má»›i truy váº¥n cÃ³ key chÃ­nh xÃ¡c lÃ  `'todos'`. CÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

- ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ cÆ¡ báº£n vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query. Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡c tÃ¹y chá»n khÃ¡c vÃ  cÃ¡c kháº£ nÄƒng linh hoáº¡t khÃ¡c cá»§a React Query trong tÃ i liá»‡u chÃ­nh thá»©c cá»§a nÃ³.

## HÃ£y giáº£i thÃ­ch khÃ¡i niá»‡m vá» `invalidateQueries` vÃ  cÃ¡ch triá»ƒn khai sá»­ dá»¥ng nÃ³ trong code nhÆ° tháº¿ nÃ o ?

- Trong React Query, khÃ¡i niá»‡m `"invalidateQueries"` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m má»›i (invalidate) cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› cache. Khi má»™t truy váº¥n Ä‘Æ°á»£c lÃ m má»›i, React Query sáº½ tá»± Ä‘á»™ng gá»­i má»™t yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- CÃ¡ch sá»­ dá»¥ng `"invalidateQueries"` lÃ  thÃ´ng qua phÆ°Æ¡ng thá»©c `"invalidateQueries"` cá»§a Ä‘á»‘i tÆ°á»£ng `queryClient`, mÃ  báº¡n cÃ³ thá»ƒ láº¥y báº±ng cÃ¡ch sá»­ dá»¥ng hook `"useQueryClient"` tá»« thÆ° viá»‡n react-query. VÃ­ dá»¥:

```jsx
import { useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo

    // LÃ m má»›i truy váº¥n 'todos'
    queryClient.invalidateQueries('todos')
  }

  // ...
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `"invalidateQueries"` Ä‘á»ƒ lÃ m má»›i truy váº¥n cÃ³ key lÃ  `'todos'`. Khi phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c gá»i, React Query sáº½ tá»± Ä‘á»™ng xÃ³a truy váº¥n `'todos'` khá»i bá»™ nhá»› cache vÃ  gá»­i má»™t yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- NgoÃ i ra, `"invalidateQueries"` cÅ©ng há»— trá»£ cÃ¡c tÃ¹y chá»n Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch lÃ m má»›i truy váº¥n, nhÆ°:

  - `exact`: XÃ¡c Ä‘á»‹nh liá»‡u chá»‰ cÃ³ truy váº¥n cÃ³ key chÃ­nh xÃ¡c trÃ¹ng khá»›p vá»›i key Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh má»›i sáº½ Ä‘Æ°á»£c lÃ m má»›i hay khÃ´ng.
  - `refetchActive`: XÃ¡c Ä‘á»‹nh liá»‡u cÃ¡c truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh `fetching` sáº½ Ä‘Æ°á»£c há»§y vÃ  lÃ m má»›i hay khÃ´ng.
  - `refetchInactive`: XÃ¡c Ä‘á»‹nh liá»‡u cÃ¡c truy váº¥n khÃ´ng hoáº¡t Ä‘á»™ng (inactive) sáº½ Ä‘Æ°á»£c lÃ m má»›i hay khÃ´ng.
  - `throwOnError`: XÃ¡c Ä‘á»‹nh liá»‡u náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh lÃ m má»›i truy váº¥n, cÃ³ nÃ©m ra lá»—i Ä‘á»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bÃªn ngoÃ i hay khÃ´ng.

- CÃ¡c tÃ¹y chá»n nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n vÃ o phÆ°Æ¡ng thá»©c `"invalidateQueries"` Ä‘á»ƒ Ä‘iá»u chá»‰nh hÃ nh vi lÃ m má»›i truy váº¥n.

- `InvalidateQueries` lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ trong React Query, cho phÃ©p lÃ m má»›i cÃ¡c truy váº¥n má»™t cÃ¡ch linh hoáº¡t vÃ  dá»… dÃ ng khi cáº§n thiáº¿t, Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u trong cache cá»§a chÃºng ta luÃ´n Ä‘Æ°á»£c cáº­p nháº­t vÃ  Ä‘á»“ng bá»™ vá»›i nguá»“n dá»¯ liá»‡u.

## â“â“ CÃ²n khÃ¡i niá»‡m nÃ o khÃ¡c vá»›i khÃ¡i niá»‡m trÃªn khÃ´ng ?

- KhÃ¡i niá»‡m khÃ¡c liÃªn quan Ä‘áº¿n `"invalidateQueries"` trong React Query lÃ  `"refetchQueries"`. `"refetchQueries"` cho phÃ©p lÃ m má»›i má»™t danh sÃ¡ch cÃ¡c truy váº¥n cá»¥ thá»ƒ sau khi má»™t truy váº¥n hoáº·c `mutation` Ä‘Ã£ Ä‘Æ°á»£c thá»±c hiá»‡n thÃ nh cÃ´ng.

- Khi sá»­ dá»¥ng `"refetchQueries"`, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh danh sÃ¡ch cÃ¡c truy váº¥n cáº§n lÃ m má»›i báº±ng cÃ¡ch sá»­ dá»¥ng key cá»§a tá»«ng truy váº¥n. Khi má»™t `mutation` hoáº·c má»™t truy váº¥n thÃ nh cÃ´ng (vá»›i tÃ¹y chá»n "onSuccess"), React Query sáº½ tá»± Ä‘á»™ng lÃ m má»›i cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong `"refetchQueries"`.

- VÃ­ dá»¥:

```jsx
const createPost = async (newPost) => {
  // Gá»­i yÃªu cáº§u Ä‘á»ƒ táº¡o bÃ i viáº¿t má»›i

  // LÃ m má»›i cÃ¡c truy váº¥n liÃªn quan sau khi táº¡o bÃ i viáº¿t thÃ nh cÃ´ng
  queryClient.refetchQueries(['posts', 'userPosts'])
}
```

- Trong vÃ­ dá»¥ trÃªn, sau khi táº¡o bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ lÃ m má»›i hai truy váº¥n cÃ³ keys lÃ  `'posts'` vÃ  `'userPosts'`. CÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c gá»­i láº¡i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- Qua Ä‘Ã³, `"refetchQueries"` cung cáº¥p má»™t cÃ¡ch linh hoáº¡t hÆ¡n Ä‘á»ƒ lÃ m má»›i nhiá»u truy váº¥n cÃ¹ng má»™t lÃºc sau khi cÃ³ sá»± thay Ä‘á»•i trong dá»¯ liá»‡u.

## âŒâŒ Giáº£i thÃ­ch Ã½ nÃ y trong Ä‘oáº¡n trÃªn: - Trong vÃ­ dá»¥ trÃªn, sau khi táº¡o bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ lÃ m má»›i hai truy váº¥n cÃ³ keys lÃ  `'posts'` vÃ  `'userPosts'`. CÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c gá»­i láº¡i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u ? CÃ³ nghÄ©a lÃ  nÃ³ láº¥y dá»¯ liá»‡u má»›i nháº¥t Ä‘á»ƒ nÃ³ lÆ°u trong `cache` hay lÃ  nÃ³ `render` lÃªn giao diá»‡n ngÆ°á»i dÃ¹ng ?

- Khi sá»­ dá»¥ng `"refetchQueries"` trong React Query, nÃ³ sáº½ gá»­i láº¡i cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong danh sÃ¡ch `refetchQueries` Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u trÃªn server. Sau Ä‘Ã³, dá»¯ liá»‡u má»›i Ä‘Æ°á»£c nháº­n sáº½ Ä‘Æ°á»£c lÆ°u trong cache cá»§a React Query vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng.

- VÃ­ dá»¥, khi chÃºng ta táº¡o má»™t bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ gá»­i láº¡i cÃ¡c truy váº¥n `'posts'` vÃ  `'userPosts'` Ä‘á»ƒ láº¥y danh sÃ¡ch bÃ i viáº¿t má»›i nháº¥t. Khi cÃ¡c truy váº¥n nÃ y thÃ nh cÃ´ng, dá»¯ liá»‡u má»›i sáº½ Ä‘Æ°á»£c lÆ°u trong cache cá»§a React Query. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng dá»¯ liá»‡u má»›i nÃ y Ä‘á»ƒ cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng, hiá»ƒn thá»‹ danh sÃ¡ch bÃ i viáº¿t má»›i nháº¥t vÃ  cÃ¡c bÃ i viáº¿t cá»§a ngÆ°á»i dÃ¹ng tÆ°Æ¡ng á»©ng.

- TÃ³m láº¡i, `"refetchQueries"` giÃºp chÃºng ta lÃ m má»›i cÃ¡c truy váº¥n vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t tá»« server, tá»« Ä‘Ã³ lÆ°u vÃ o cache vÃ  sá»­ dá»¥ng Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng.

## Theo trÃ¬nh tá»± lÃ  nÃ³ lÆ°u vÃ o trong cache cá»§a server trÆ°á»›c rá»“i nÃ³ má»›i render lÃªn giao diá»‡n ngÆ°á»i dÃ¹ng pháº£i khÃ´ng ?

- KhÃ´ng, trong trÆ°á»ng há»£p cá»§a React Query, dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p trong cache cá»§a `server`. React Query sá»­ dá»¥ng má»™t cache riÃªng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u trÃªn phÃ­a `client`, Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi thÆ° viá»‡n React Query.

- Khi má»™t truy váº¥n Ä‘Æ°á»£c gá»­i tá»« React Query, dá»¯ liá»‡u tráº£ vá» tá»« `server` sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache cá»§a React Query trÃªn phÃ­a `client`. Sau Ä‘Ã³, dá»¯ liá»‡u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c truy xuáº¥t vÃ  sá»­ dá»¥ng mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u láº¡i Ä‘áº¿n `server`. Khi cÃ³ sá»± thay Ä‘á»•i trong dá»¯ liá»‡u hoáº·c khi chÃºng ta yÃªu cáº§u lÃ m má»›i dá»¯ liá»‡u, React Query sáº½ gá»­i yÃªu cáº§u tá»›i `server` Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t vÃ  cáº­p nháº­t láº¡i cache.

- Sau khi dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache cá»§a React Query, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng. Khi cÃ³ thay Ä‘á»•i trong cache hoáº·c khi chÃºng ta gá»­i yÃªu cáº§u lÃ m má»›i dá»¯ liá»‡u, React Query sáº½ tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng dá»±a trÃªn dá»¯ liá»‡u má»›i trong cache mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u má»›i Ä‘áº¿n `server`.

- VÃ¬ váº­y, trong quÃ¡ trÃ¬nh sá»­ dá»¥ng React Query, dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  quáº£n lÃ½ trong cache cá»§a React Query trÃªn phÃ­a `client` vÃ  dÃ¹ng Ä‘á»ƒ render giao diá»‡n ngÆ°á»i dÃ¹ng mÃ  khÃ´ng tÃ¡c Ä‘á»™ng trá»±c tiáº¿p vÃ o cache cá»§a `server`.

## â“â“ `invalidateQueries` vÃ  `refetchQueries` Ä‘iá»ƒm giá»‘ng nhau cá»§a nÃ³ lÃ  gÃ¬ ?

- Cáº£ hai phÆ°Æ¡ng thá»©c `invalidateQueries` vÃ  `refetchQueries` trong React Query Ä‘á»u liÃªn quan Ä‘áº¿n viá»‡c cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n.

- Äiá»ƒm giá»‘ng nhau cá»§a hai phÆ°Æ¡ng thá»©c nÃ y lÃ  cáº£ hai Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n. Khi sá»­ dá»¥ng cáº£ `invalidateQueries` vÃ  `refetchQueries`, React Query sáº½ gá»­i cÃ¡c yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« mÃ¡y chá»§ vÃ  cáº­p nháº­t láº¡i káº¿t quáº£ truy váº¥n.

- Tuy nhiÃªn, cÃ³ má»™t sá»± khÃ¡c biá»‡t quan trá»ng giá»¯a hai phÆ°Æ¡ng thá»©c nÃ y:

1. `invalidateQueries`: PhÆ°Æ¡ng thá»©c nÃ y chá»‰ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡, nhÆ°ng khÃ´ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§. NÃ³ thÃ´ng bÃ¡o cho React Query biáº¿t ráº±ng dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n nÃ y Ä‘Ã£ khÃ´ng cÃ²n há»£p lá»‡ vÃ  cáº§n Ä‘Æ°á»£c lÃ m má»›i. React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i khi cáº§n thiáº¿t, vÃ­ dá»¥ nhÆ° khi truy cáº­p láº¡i trang hoáº·c khi sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `refetch` hoáº·c `useQueryClient`.

2. `refetchQueries`: PhÆ°Æ¡ng thá»©c nÃ y gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ cho cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Báº±ng cÃ¡ch sá»­ dá»¥ng `refetchQueries`, báº¡n cÃ³ thá»ƒ tÆ°á»ng minh yÃªu cáº§u React Query gá»­i yÃªu cáº§u má»›i vÃ  cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh ngay láº­p tá»©c.

- TÃ³m láº¡i, Ä‘iá»ƒm giá»‘ng nhau cá»§a `invalidateQueries` vÃ  `refetchQueries` lÃ  cáº£ hai Ä‘á»u liÃªn quan Ä‘áº¿n viá»‡c cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n, nhÆ°ng cÃ¡ch thá»©c vÃ  quyá»n kiá»ƒm soÃ¡t cáº­p nháº­t dá»¯ liá»‡u cá»§a chÃºng cÃ³ sá»± khÃ¡c biá»‡t.

## â“â“ `invalidateQueries` vÃ  `refetchQueries` Ä‘iá»ƒm khÃ¡c nhau cá»§a nÃ³ lÃ  gÃ¬ ?

- Äiá»ƒm khÃ¡c nhau chÃ­nh giá»¯a `invalidateQueries` vÃ  `refetchQueries` trong React Query lÃ :

1. `invalidateQueries`: PhÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡. Khi báº¡n gá»i phÆ°Æ¡ng thá»©c nÃ y, React Query sáº½ ghi nháº­n ráº±ng dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã£ khÃ´ng cÃ²n há»£p lá»‡ vÃ  cáº§n Ä‘Æ°á»£c lÃ m má»›i. Tuy nhiÃªn, phÆ°Æ¡ng thá»©c nÃ y khÃ´ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ ngay láº­p tá»©c. Thay vÃ o Ä‘Ã³, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i khi cáº§n thiáº¿t, cháº³ng háº¡n khi truy cáº­p láº¡i trang hoáº·c khi sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `refetch` hoáº·c `useQueryClient`.

2. `refetchQueries`: PhÆ°Æ¡ng thá»©c `refetchQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ cho cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Khi báº¡n gá»i phÆ°Æ¡ng thá»©c nÃ y vÃ  chá»‰ Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n lÃ m má»›i, React Query sáº½ tá»©c thÃ¬ gá»­i yÃªu cáº§u má»›i vÃ  cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã³.

- Váº­y Ä‘iá»ƒm khÃ¡c nhau chÃ­nh lÃ  `invalidateQueries` chá»‰ Ä‘Ã¡nh dáº¥u truy váº¥n lÃ  khÃ´ng há»£p lá»‡, trong khi `refetchQueries` gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i ngay láº­p tá»©c cho cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.

## â“â“ CÃ²n cÃ¡i nÃ o khÃ¡c vá»›i khÃ¡i niá»‡m trÃªn khÃ´ng ?

- Má»™t khÃ¡i niá»‡m khÃ¡c liÃªn quan Ä‘áº¿n `"invalidateQueries"` trong React Query lÃ  `"resetQueries"`. `"resetQueries"` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘áº·t láº¡i (reset) dá»¯ liá»‡u cá»§a má»™t hay nhiá»u truy váº¥n vá» tráº¡ng thÃ¡i ban Ä‘áº§u.

- Khi sá»­ dá»¥ng `"resetQueries"`, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh danh sÃ¡ch cÃ¡c truy váº¥n cáº§n Ä‘áº·t láº¡i báº±ng cÃ¡ch sá»­ dá»¥ng key cá»§a tá»«ng truy váº¥n. Khi má»™t hÃ nh Ä‘á»™ng hoáº·c má»™t sá»± kiá»‡n xáº£y ra vÃ  báº¡n muá»‘n Ä‘áº·t láº¡i dá»¯ liá»‡u cÃ¡c truy váº¥n Ä‘á»ƒ báº¯t Ä‘áº§u láº¡i tá»« tráº¡ng thÃ¡i ban Ä‘áº§u, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `"resetQueries"` Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³.

- VÃ­ dá»¥:

```jsx
const handleLogout = async () => {
  // Thá»±c hiá»‡n Ä‘Äƒng xuáº¥t

  // Äáº·t láº¡i dá»¯ liá»‡u cÃ¡c truy váº¥n liÃªn quan vá» tráº¡ng thÃ¡i ban Ä‘áº§u
  queryClient.resetQueries(['user', 'posts'])
}
```

- Trong vÃ­ dá»¥ trÃªn, khi ngÆ°á»i dÃ¹ng thá»±c hiá»‡n Ä‘Äƒng xuáº¥t (Log out), chÃºng ta sá»­ dá»¥ng `"resetQueries"` Ä‘á»ƒ Ä‘áº·t láº¡i dá»¯ liá»‡u cá»§a hai truy váº¥n cÃ³ keys lÃ  `'user'` vÃ  `'posts'`, Ä‘á»ƒ báº¯t Ä‘áº§u láº¡i tá»« tráº¡ng thÃ¡i ban Ä‘áº§u. Äiá»u nÃ y cÃ³ thá»ƒ há»¯u Ã­ch khi cáº§n Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u hiá»ƒn thá»‹ sau khi Ä‘Äƒng xuáº¥t lÃ  dá»¯ liá»‡u má»›i nháº¥t vÃ  khÃ´ng bá»‹ lÆ°u láº¡i tá»« phiÃªn Ä‘Äƒng nháº­p trÆ°á»›c.

- Tá»•ng quan, `"resetQueries"` lÃ  má»™t cÃ¡ch Ä‘á»ƒ Ä‘áº·t láº¡i dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n vá» tráº¡ng thÃ¡i ban Ä‘áº§u, trong khi `"invalidateQueries"` lÃ  má»™t cÃ¡ch Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡ vÃ  chuáº©n bá»‹ cho viá»‡c lÃ m má»›i chÃºng. Cáº£ hai Ä‘á»u giÃºp quáº£n lÃ½ vÃ  Ä‘iá»u khiá»ƒn dá»¯ liá»‡u trong React Query.

## Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query (`invalidateQueries`) trong React Query:

- Trong React Query, `invalidateQueries` lÃ  má»™t phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c cung cáº¥p bá»Ÿi `useQueryClient` Ä‘á»ƒ lÃ m má»›i (invalidate) cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache. Khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c nÃ y, React Query sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i tá»« nguá»“n dá»¯ liá»‡u (vÃ­ dá»¥: tá»« API).

- DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query:

1. Äáº§u tiÃªn, chÃºng ta cáº§n láº¥y instance cá»§a `queryClient` báº±ng cÃ¡ch sá»­ dá»¥ng `useQueryClient` trong component:

```jsx
import { useQueryClient } from 'react-query'

const MyComponent = () => {
  const queryClient = useQueryClient()

  // ...
}
```

2. Sau Ä‘Ã³, khi muá»‘n lÃ m má»›i má»™t hoáº·c nhiá»u truy váº¥n, chÃºng ta gá»i phÆ°Æ¡ng thá»©c `invalidateQueries` trÃªn `queryClient`:

```jsx
queryClient.invalidateQueries('todos')
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta gá»i `invalidateQueries('todos')` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`. Äiá»u nÃ y sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i cho cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`.

- NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ truyá»n má»™t máº£ng cÃ¡c key Ä‘á»ƒ lÃ m má»›i nhiá»u truy váº¥n cÃ¹ng má»™t lÃºc:

```jsx
queryClient.invalidateQueries(['todos', 'user', 'posts'])
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`, `'user'` vÃ  `'posts'`. Táº¥t cáº£ cÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c xÃ³a khá»i cache vÃ  truy váº¥n láº¡i tá»« nguá»“n dá»¯ liá»‡u.

- `invalidateQueries` cÅ©ng há»— trá»£ má»™t sá»‘ tÃ¹y chá»n Ä‘á»ƒ Ä‘iá»u chá»‰nh cÃ¡ch lÃ m má»›i truy váº¥n, nhÆ° `exact` Ä‘á»ƒ chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c báº±ng key hoáº·c `refetchActive` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n Ä‘ang Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng. Äá»ƒ biáº¿t thÃªm chi tiáº¿t, báº¡n cÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u chÃ­nh thá»©c cá»§a React Query.

## HÆ°á»›ng dáº«n vÃ  vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng React Query, bao gá»“m cáº£ viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` ?

- Äá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query, báº¡n cáº§n lÃ m nhÆ° sau:

1. Äáº§u tiÃªn, Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ cÃ i Ä‘áº·t React Query vÃ  Ä‘Ã£ import cÃ¡c hÃ m cáº§n thiáº¿t tá»« thÆ° viá»‡n:

```jsx
import { useQueryClient } from 'react-query'
```

2. Trong component cá»§a báº¡n, sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y má»™t instance cá»§a `QueryClient`:

```jsx
const queryClient = useQueryClient()
```

3. BÃ¢y giá» báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong `QueryClient`. PhÆ°Æ¡ng thá»©c nÃ y nháº­n vÃ o má»™t key hoáº·c má»™t máº£ng cÃ¡c key Ä‘á»ƒ chá»‰ Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n lÃ m má»›i:

```jsx
queryClient.invalidateQueries('todos') // LÃ m má»›i truy váº¥n cÃ³ key lÃ  'todos'
queryClient.invalidateQueries(['user', userId]) // LÃ m má»›i truy váº¥n cÃ³ key lÃ  ['user', userId]
queryClient.invalidateQueries() // LÃ m má»›i táº¥t cáº£ cÃ¡c truy váº¥n trong QueryClient
```

- VÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng `invalidateQueries`:

```jsx
import { useQuery, useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId)

    // LÃ m má»›i truy váº¥n 'todos' sau khi xÃ³a
    queryClient.invalidateQueries('todos')
  }

  return (
    <div>
      {/* Hiá»ƒn thá»‹ danh sÃ¡ch todo */}
      {todos.map((todo) => (
        <div key={todo.id}>
          <span>{todo.title}</span>
          <button onClick={() => handleDeleteTodo(todo.id)}>XÃ³a</button>
        </div>
      ))}
    </div>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt "XÃ³a" Ä‘á»ƒ xÃ³a má»™t todo, chÃºng ta gá»i API Ä‘á»ƒ thá»±c hiá»‡n xÃ³a todo Ä‘Ã³. Sau khi xÃ³a thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n 'todos', tá»« Ä‘Ã³ Ä‘áº£m báº£o ráº±ng danh sÃ¡ch todos Ä‘Æ°á»£c cáº­p nháº­t má»›i nháº¥t.

## ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ khÃ¡c vá» invalidateQueries trong react query:

- Trong React Query, `invalidateQueries` lÃ  má»™t phÆ°Æ¡ng thá»©c cho phÃ©p ta xÃ³a bá» cache cá»§a má»™t hoáº·c nhiá»u truy váº¥n (queries) Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯. Äiá»u nÃ y cho phÃ©p ta thá»±c hiá»‡n láº¡i truy váº¥n Ä‘Ã³ vÃ  cáº­p nháº­t láº¡i dá»¯ liá»‡u má»›i nháº¥t.

- VÃ­ dá»¥, giáº£ sá»­ ta cÃ³ má»™t truy váº¥n `getUserData` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« API nhÆ° sau:

```jsx
import { useQuery } from 'react-query'

function ProfilePage({ userId }) {
  const { data, isLoading } = useQuery(['userData', userId], () =>
    fetch(`/api/users/${userId}`).then((res) => res.json())
  )

  if (isLoading) {
    return <div>Loading...</div>
  }

  return <div>{data.name}</div>
}
```

- Äoáº¡n code trÃªn lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng hook `useQuery` trong React Query Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« má»™t API.

  - Äáº§u tiÃªn, chÃºng ta sá»­ dá»¥ng hook `useQuery` tá»« React Query vÃ  truyá»n vÃ o hai tham sá»‘: `key` vÃ  má»™t hÃ m (`function`) callback.
  - Trong Ä‘Ã³, `key` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  má»™t máº£ng `['userData', userId]`, Ä‘áº¡i diá»‡n cho truy váº¥n `"userData"` vá»›i `userId` lÃ  tham sá»‘ phá»¥ thuá»™c. Khi giÃ¡ trá»‹ `userId` thay Ä‘á»•i, truy váº¥n sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng thá»±c hiá»‡n láº¡i.
  - HÃ m callback Ä‘Æ°á»£c cung cáº¥p Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n thá»±c táº¿. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta gá»­i má»™t yÃªu cáº§u `fetch` Ä‘áº¿n Ä‘Æ°á»ng dáº«n `/api/users/${userId}` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« server. Sau Ä‘Ã³, chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `.json()` Ä‘á»ƒ chuyá»ƒn Ä‘á»•i pháº£n há»“i tá»« server sang dá»¯ liá»‡u JSON.
  - Khi truy váº¥n Ä‘ang Ä‘Æ°á»£c thá»±c hiá»‡n, biáº¿n `isLoading` sáº½ lÃ  `true`, vÃ  chÃºng ta cÃ³ thá»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."` trong giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘á»ƒ cho ngÆ°á»i dÃ¹ng biáº¿t ráº±ng dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c táº£i.
  - Khi truy váº¥n hoÃ n thÃ nh vÃ  cÃ³ dá»¯ liá»‡u, biáº¿n `data` sáº½ chá»©a káº¿t quáº£ tráº£ vá» tá»« truy váº¥n. Trong vÃ­ dá»¥ nÃ y, chÃºng ta hiá»ƒn thá»‹ tÃªn ngÆ°á»i dÃ¹ng trong má»™t thÃ nh pháº§n `<div>`.
  - Náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh thá»±c hiá»‡n truy váº¥n, React Query sáº½ tá»± Ä‘á»™ng xá»­ lÃ½ lá»—i vÃ  thÃ´ng bÃ¡o lá»—i cho chÃºng ta. Tuy nhiÃªn, trong vÃ­ dá»¥ nÃ y, chÃºng ta khÃ´ng xá»­ lÃ½ trÆ°á»ng há»£p lá»—i mÃ  chá»‰ Ä‘Æ¡n giáº£n hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."` khi Ä‘ang táº£i dá»¯ liá»‡u.
  - ToÃ n bá»™ giao diá»‡n cá»§a trang sáº½ Ä‘Æ°á»£c cáº­p nháº­t tá»± Ä‘á»™ng khi dá»¯ liá»‡u thay Ä‘á»•i hoáº·c khi cÃ³ lá»—i xáº£y ra trong truy váº¥n.

- á» Ä‘Ã¢y, ta sá»­ dá»¥ng `useQuery` Ä‘á»ƒ láº¥y dá»¯ liá»‡u vá» ngÆ°á»i dÃ¹ng vá»›i `userId` Ä‘Æ°á»£c truyá»n vÃ o. Tuy nhiÃªn, náº¿u ngÆ°á»i dÃ¹ng thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nhÆ° cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n, ta muá»‘n cáº­p nháº­t láº¡i dá»¯ liá»‡u ngÆ°á»i dÃ¹ng má»›i nháº¥t. Äá»ƒ lÃ m Ä‘iá»u nÃ y, ta cÃ³ thá»ƒ sá»­ dá»¥ng `invalidateQueries` nhÆ° sau:

```jsx
import { useQueryClient } from 'react-query'

function ProfilePage({ userId }) {
  const queryClient = useQueryClient()

  const { data, isLoading } = useQuery(['userData', userId], () =>
    fetch(`/api/users/${userId}`).then((res) => res.json())
  )

  const handleUpdateProfile = () => {
    // Gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a ngÆ°á»i dÃ¹ng
    // Sau Ä‘Ã³, ta sáº½ gá»i phÆ°Æ¡ng thá»©c invalidateQueries Ä‘á»ƒ xÃ³a cache cá»§a truy váº¥n "userData"
    queryClient.invalidateQueries('userData')
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <div>{data.name}</div>
      <button onClick={handleUpdateProfile}>Update Profile</button>
    </div>
  )
}
```

- Trong Ä‘oáº¡n code trÃªn, chÃºng ta sá»­ dá»¥ng hook `useQueryClient` tá»« React Query Ä‘á»ƒ láº¥y má»™t instance cá»§a `QueryClient` tá»« React Query context. `QueryClient` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng quáº£n lÃ½ tráº¡ng thÃ¡i vÃ  tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c truy váº¥n Ä‘Æ°á»£c táº¡o bá»Ÿi React Query.

  - ChÃºng ta táº¡o má»™t biáº¿n `queryClient` báº±ng cÃ¡ch gá»i `useQueryClient()`, vÃ  sau Ä‘Ã³ sá»­ dá»¥ng biáº¿n nÃ y Ä‘á»ƒ truy cáº­p cÃ¡c phÆ°Æ¡ng thá»©c vÃ  thuá»™c tÃ­nh cá»§a `QueryClient`.

  - Tiáº¿p theo, chÃºng ta sá»­ dá»¥ng hook `useQuery` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n `"userData"` vÃ  láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« API. Káº¿t quáº£ truy váº¥n Ä‘Æ°á»£c lÆ°u trá»¯ trong biáº¿n `data`, vÃ  biáº¿n `isLoading` xÃ¡c Ä‘á»‹nh xem truy váº¥n Ä‘ang Ä‘Æ°á»£c thá»±c hiá»‡n hay khÃ´ng.

  - ChÃºng ta Ä‘á»‹nh nghÄ©a má»™t hÃ m `handleUpdateProfile` Ä‘á»ƒ xá»­ lÃ½ sá»± kiá»‡n khi ngÆ°á»i dÃ¹ng báº¥m vÃ o nÃºt `"Update Profile"`. Trong hÃ m nÃ y, chÃºng ta cÃ³ thá»ƒ gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a ngÆ°á»i dÃ¹ng.

  - Sau khi cáº­p nháº­t thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` cá»§a `queryClient` Ä‘á»ƒ xÃ³a cache cá»§a truy váº¥n `"userData"`. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng khi ngÆ°á»i dÃ¹ng quay láº¡i trang ngÆ°á»i dÃ¹ng, truy váº¥n sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« API thay vÃ¬ sá»­ dá»¥ng dá»¯ liá»‡u tá»« cache.

  - Náº¿u tráº¡ng thÃ¡i `isLoading` lÃ  `true`, chÃºng ta hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."` trong giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘á»ƒ cho ngÆ°á»i dÃ¹ng biáº¿t ráº±ng dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c táº£i.

  - Náº¿u khÃ´ng cÃ³ lá»—i xáº£y ra vÃ  dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c táº£i thÃ nh cÃ´ng, chÃºng ta hiá»ƒn thá»‹ tÃªn ngÆ°á»i dÃ¹ng trong má»™t thÃ nh pháº§n `<div>`.

  - NÃºt `"Update Profile"` Ä‘Æ°á»£c gáº¯n má»™t sá»± kiá»‡n onClick Ä‘á»ƒ gá»i hÃ m `handleUpdateProfile` khi Ä‘Æ°á»£c báº¥m.

- âœ…âœ… á» Ä‘Ã¢y, ta sá»­ dá»¥ng `useQueryClient` Ä‘á»ƒ láº¥y má»™t instance cá»§a `QueryClient`, sau Ä‘Ã³ ta gá»i `invalidateQueries('userData')` Ä‘á»ƒ xÃ³a cache cá»§a truy váº¥n `userData`. Khi ngÆ°á»i dÃ¹ng click vÃ o nÃºt `"Update Profile"`, ta sáº½ gá»i hÃ m `handleUpdateProfile` vÃ  cáº­p nháº­t láº¡i dá»¯ liá»‡u ngÆ°á»i dÃ¹ng má»›i nháº¥t.

## âŒâŒ invalidateQueries('userData'), nÃ³ xoÃ¡ cache cÃ³ tÃªn lÃ  `userData` háº£ ?

- ÄÃºng, `invalidateQueries('userData')` lÃ  phÆ°Æ¡ng thá»©c Ä‘á»ƒ xoÃ¡ cache cá»§a truy váº¥n cÃ³ tÃªn lÃ  `'userData'`. Khi chÃºng ta gá»i `queryClient.invalidateQueries('userData')`, nÃ³ sáº½ xÃ³a cache cá»§a truy váº¥n `'userData'`, Ä‘á»“ng nghÄ©a vá»›i viá»‡c loáº¡i bá» dá»¯ liá»‡u Ä‘Ã£ lÆ°u trá»¯ trÆ°á»›c Ä‘Ã³ trong cache cho truy váº¥n Ä‘Ã³.

- Sau khi cache bá»‹ xoÃ¡, khi chÃºng ta gá»i láº¡i truy váº¥n `'userData'`, React Query sáº½ thá»±c hiá»‡n truy váº¥n má»›i vÃ  táº£i dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u (vÃ­ dá»¥: API) thay vÃ¬ tráº£ vá» dá»¯ liá»‡u tá»« cache. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng chÃºng ta luÃ´n cÃ³ dá»¯ liá»‡u cáº­p nháº­t nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

## âŒâŒ Khi chÃºng ta xoÃ¡ cache vÃ  quay láº¡i trang trÆ°á»›c Ä‘Ã³ lÃ  lÃºc Ä‘Ã³ ta cÃ³ dá»¯ liá»‡u má»›i nháº¥t. Dá»¯ liá»‡u má»›i nháº¥t Ä‘Ã³ ta láº¥y tá»« Ä‘Ã¢u ? API nÃ³ tá»± cáº­p nháº­t láº¡i dá»¯ liá»‡u háº£ ?

- Khi chÃºng ta xoÃ¡ cache vÃ  quay láº¡i trang trÆ°á»›c Ä‘Ã³, dá»¯ liá»‡u má»›i nháº¥t Ä‘Æ°á»£c láº¥y tá»« nguá»“n dá»¯ liá»‡u, vÃ­ dá»¥ nhÆ° API. Khi chÃºng ta gá»i láº¡i truy váº¥n sau khi xoÃ¡ cache, React Query sáº½ thá»±c hiá»‡n má»™t cuá»™c gá»i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- QuÃ¡ trÃ¬nh cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t tá»« API cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n má»™t trong hai cÃ¡ch:

  1. `Tá»± Ä‘á»™ng cáº­p nháº­t`: Trong má»™t sá»‘ trÆ°á»ng há»£p, API cÃ³ thá»ƒ tá»± Ä‘á»™ng cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ  tráº£ vá» cho chÃºng ta má»—i khi cÃ³ sá»± thay Ä‘á»•i. Äiá»u nÃ y cÃ³ thá»ƒ xáº£y ra khi cÃ³ sá»± thay Ä‘á»•i dá»¯ liá»‡u tá»« cÃ¡c hoáº¡t Ä‘á»™ng khÃ¡c (vÃ­ dá»¥: thÃªm, sá»­a, xoÃ¡), (`POST`, `PUT`, `DELETE`) hoáº·c khi cÃ³ cáº­p nháº­t dá»¯ liá»‡u Ä‘á»‹nh ká»³. Khi chÃºng ta gá»i láº¡i truy váº¥n, React Query sáº½ thá»±c hiá»‡n cuá»™c gá»i Ä‘áº¿n API vÃ  nháº­n dá»¯ liá»‡u má»›i nháº¥t.

  2. `Thá»±c hiá»‡n gá»i API cáº­p nháº­t`: Trong má»™t sá»‘ trÆ°á»ng há»£p, chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n gá»i API Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u má»›i. Äiá»u nÃ y cÃ³ thá»ƒ xáº£y ra khi ngÆ°á»i dÃ¹ng thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nhÆ° nháº¥n nÃºt cáº­p nháº­t hoáº·c gá»­i má»™t yÃªu cáº§u cáº­p nháº­t thÃ´ng qua giao diá»‡n ngÆ°á»i dÃ¹ng. Khi chÃºng ta thá»±c hiá»‡n gá»i API cáº­p nháº­t, React Query sáº½ thá»±c hiá»‡n cuá»™c gá»i Ä‘áº¿n API vÃ  sau Ä‘Ã³ xoÃ¡ cache cá»§a truy váº¥n Ä‘á»ƒ Ä‘áº£m báº£o láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- TÃ³m láº¡i, khi chÃºng ta xoÃ¡ cache vÃ  gá»i láº¡i truy váº¥n, React Query sáº½ thá»±c hiá»‡n cuá»™c gá»i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u hoáº·c cáº­p nháº­t dá»¯ liá»‡u thÃ´ng qua gá»i API cáº­p nháº­t.

## âŒâŒ React Query sáº½ thá»±c hiá»‡n cuá»™c gá»i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u ? CÃ³ nghÄ©a lÃ  React Query nÃ³ tá»± Ä‘á»™ng gá»i hay sao ?

- ÄÃºng, React Query cÃ³ thá»ƒ tá»± Ä‘á»™ng thá»±c hiá»‡n cuá»™c gá»i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u. Khi chÃºng ta gá»i láº¡i truy váº¥n báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `queryClient.invalidateQueries()`, React Query sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n má»™t cuá»™c gá»i Ä‘áº¿n API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t.

- Tuy nhiÃªn, viá»‡c tá»± Ä‘á»™ng gá»i API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t phá»¥ thuá»™c vÃ o cáº¥u hÃ¬nh cá»§a React Query vÃ  cÃ¡ch chÃºng ta Ä‘á»‹nh nghÄ©a truy váº¥n. React Query cung cáº¥p cÃ¡c tÃ¹y chá»n Ä‘á»ƒ Ä‘iá»u chá»‰nh cÃ¡ch cuá»™c gá»i API Ä‘Æ°á»£c thá»±c hiá»‡n, bao gá»“m cÃ¡ch kiá»ƒm soÃ¡t thá»i gian vÃ  táº§n suáº¥t cá»§a cÃ¡c cuá»™c gá»i API. ChÃºng ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a thá»i gian mÃ  má»™t truy váº¥n Ä‘Æ°á»£c coi lÃ  `"stale"` (cÅ©) vÃ  cáº§n Ä‘Æ°á»£c gá»i láº¡i, cÅ©ng nhÆ° táº§n suáº¥t cáº­p nháº­t dá»¯ liá»‡u.

- Vá»›i má»™t cáº¥u hÃ¬nh phÃ¹ há»£p, React Query cÃ³ thá»ƒ tá»± Ä‘á»™ng gá»i API Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t khi cáº§n thiáº¿t, giÃºp chÃºng ta luÃ´n cÃ³ dá»¯ liá»‡u chÃ­nh xÃ¡c vÃ  Ä‘á»“ng bá»™ vá»›i nguá»“n dá»¯ liá»‡u.

## âŒâŒ React Query tá»± Ä‘á»™ng gá»i láº¡i hay khÃ´ng thÃ¬ nÃ³ cÃ²n phá»¥ thuá»™c vÃ o phÆ°Æ¡ng nÃ y `invalidateQueries()` hay sao ?

- React Query khÃ´ng tá»± Ä‘á»™ng gá»i láº¡i cÃ¡c truy váº¥n má»™t cÃ¡ch tá»± Ä‘á»™ng sau khi chÃºng Ä‘Æ°á»£c `invalidate` báº±ng phÆ°Æ¡ng thá»©c `invalidateQueries()`. PhÆ°Æ¡ng thá»©c nÃ y chá»‰ Ä‘Æ¡n giáº£n lÃ  xÃ³a cache cá»§a cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a.

- Khi cache cá»§a má»™t truy váº¥n bá»‹ xÃ³a, React Query khÃ´ng tá»± Ä‘á»™ng gá»i láº¡i truy váº¥n Ä‘Ã³ Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u. Thay vÃ o Ä‘Ã³, Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t, chÃºng ta cáº§n pháº£i sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c nhÆ° `refetch()` hoáº·c truy cáº­p láº¡i trang hoáº·c thÃ nh pháº§n chá»©a truy váº¥n Ä‘Ã³.

- Tuy nhiÃªn, cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ¹y chá»n vÃ  cáº¥u hÃ¬nh cá»§a React Query Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡ch cÃ¡c truy váº¥n Ä‘Æ°á»£c tá»± Ä‘á»™ng gá»i láº¡i trong trÆ°á»ng há»£p cá»¥ thá»ƒ. CÃ¡c tÃ¹y chá»n nhÆ° `staleTime`, `cacheTime`, `refetchOnMount`, `refetchOnWindowFocus`,... cho phÃ©p chÃºng ta Ä‘iá»u chá»‰nh cÃ¡ch React Query xá»­ lÃ½ cÃ¡c truy váº¥n vÃ  tá»± Ä‘á»™ng gá»i láº¡i chÃºng khi cáº§n thiáº¿t.

## Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation trong React Query:

- Äá»ƒ cáº­p nháº­t dá»¯ liá»‡u cá»§a má»™t truy váº¥n thÃ´ng qua mutation trong React Query, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `useMutation`. PhÆ°Æ¡ng thá»©c nÃ y cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a cÃ¡c hÃ nh Ä‘á»™ng mutation thÃªm, sá»­a, xoÃ¡ (POST, PUT, DELETE) vÃ  cung cáº¥p cÃ¡c tÃ¹y chá»n Ä‘á»ƒ xá»­ lÃ½ káº¿t quáº£ cá»§a mutation.

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng mutation Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u:

```jsx
import { useMutation, useQueryClient } from 'react-query'

function UserProfile({ userId }) {
  const queryClient = useQueryClient()

  const updateUserMutation = useMutation(
    (updatedUserData) => {
      // Gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng
      // Tráº£ vá» dá»¯ liá»‡u má»›i sau khi cáº­p nháº­t
      return fetch(`/api/users/${userId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedUserData)
      }).then((response) => response.json())
    },
    {
      // TÃ¹y chá»n onSuccess sáº½ Ä‘Æ°á»£c gá»i khi mutation thÃ nh cÃ´ng
      onSuccess: (data) => {
        // Cáº­p nháº­t cache cá»§a truy váº¥n 'userData' vá»›i dá»¯ liá»‡u má»›i
        queryClient.setQueryData(['userData', userId], data)
      }
    }
  )

  const handleUpdateProfile = () => {
    const updatedData = {
      // Dá»¯ liá»‡u cáº­p nháº­t ngÆ°á»i dÃ¹ng
    }

    updateUserMutation.mutate(updatedData)
  }

  // ...
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t mutation báº±ng cÃ¡ch sá»­ dá»¥ng `useMutation`. Trong hÃ m callback cá»§a mutation, chÃºng ta gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ  tráº£ vá» dá»¯ liá»‡u má»›i sau khi cáº­p nháº­t. Khi mutation thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `onSuccess` Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n `'userData'` vá»›i dá»¯ liá»‡u má»›i. Sau Ä‘Ã³, chÃºng ta gá»i `mutate` Ä‘á»ƒ kÃ­ch hoáº¡t mutation vá»›i dá»¯ liá»‡u cáº­p nháº­t.

- LÆ°u Ã½ ráº±ng `setQueryData` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n `'userData'` trong `onSuccess` callback cá»§a mutation. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng sau khi mutation thÃ nh cÃ´ng, dá»¯ liá»‡u trong truy váº¥n `'userData'` sáº½ Ä‘Æ°á»£c cáº­p nháº­t vÃ  cÃ³ thá»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i trong UI.

## PhÆ°Æ¡ng thá»©c setQueryData á»Ÿ Ä‘Ã¢u mÃ  cÃ³ ? NÃ³ cÃ³ sáºµn trong React Query hay sao ? HÃ£y giáº£i thÃ­ch ?

- Trong React Query, phÆ°Æ¡ng thá»©c `setQueryData` khÃ´ng tá»“n táº¡i. Thay vÃ o Ä‘Ã³, chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `queryClient.setQueryData` Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u trong cache. LÆ°u Ã½ lÃ  pháº£i viáº¿t Ä‘Ãºng cÃº phÃ¡p!!

- PhÆ°Æ¡ng thá»©c `setQueryData` lÃ  má»™t phÆ°Æ¡ng thá»©c cá»§a Ä‘á»‘i tÆ°á»£ng `queryClient` Ä‘Æ°á»£c tráº£ vá» khi chÃºng ta sá»­ dá»¥ng `useQueryClient` hook Ä‘á»ƒ truy cáº­p vÃ o instance cá»§a `queryClient` trong React component.

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ cá»¥ thá»ƒ vá» cÃ¡ch sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n `'userData'` trong trÆ°á»ng há»£p mutation thÃ nh cÃ´ng:

```jsx
import { useMutation, useQueryClient } from 'react-query'

function UserProfile({ userId }) {
  const queryClient = useQueryClient()

  const updateUserMutation = useMutation((updatedUserData) => {
    // Gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng
    // Tráº£ vá» dá»¯ liá»‡u má»›i sau khi cáº­p nháº­t
    return fetch(`/api/users/${userId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(updatedUserData)
    }).then((response) => response.json())
  })

  const handleUpdateProfile = async () => {
    const updatedData = {
      // Dá»¯ liá»‡u cáº­p nháº­t ngÆ°á»i dÃ¹ng
    }

    try {
      const data = await updateUserMutation.mutate(updatedData)

      // Cáº­p nháº­t cache cá»§a truy váº¥n 'userData' vá»›i dá»¯ liá»‡u má»›i
      queryClient.setQueryData(['userData', userId], data)
    } catch (error) {
      // Xá»­ lÃ½ lá»—i khi mutation tháº¥t báº¡i
    }
  }

  // ...
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n `'userData'` trong `handleUpdateProfile` sau khi mutation thÃ nh cÃ´ng.

## Giáº£i thÃ­ch Ä‘oáº¡n code trÃªn:

- Äoáº¡n code trÃªn lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng `setQueryData` trong React Query Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n sau khi má»™t mutation thÃ nh cÃ´ng.

- Äáº§u tiÃªn, chÃºng ta import cÃ¡c hook `useMutation` vÃ  `useQueryClient` tá»« thÆ° viá»‡n React Query.

- Trong component `UserProfile`, chÃºng ta sá»­ dá»¥ng `useQueryClient` Ä‘á»ƒ truy cáº­p Ä‘á»‘i tÆ°á»£ng `queryClient`, vÃ  gÃ¡n nÃ³ vÃ o biáº¿n `queryClient`.

- Tiáº¿p theo, chÃºng ta sá»­ dá»¥ng `useMutation` Ä‘á»ƒ khá»Ÿi táº¡o má»™t mutation `updateUserMutation`. Trong Ä‘Ã³, chÃºng ta cung cáº¥p má»™t hÃ m callback lÃ m tham sá»‘ Ä‘áº§u tiÃªn, Ä‘áº¡i diá»‡n cho viá»‡c gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng.

- Trong hÃ m `handleUpdateProfile`, chÃºng ta thá»±c hiá»‡n cÃ¡c bÆ°á»›c sau:

  - Chuáº©n bá»‹ dá»¯ liá»‡u cáº­p nháº­t ngÆ°á»i dÃ¹ng trong biáº¿n `updatedData`.
  - Sá»­ dá»¥ng `updateUserMutation.mutate` Ä‘á»ƒ gá»i mutation vÃ  Ä‘á»£i káº¿t quáº£ tráº£ vá».
  - Náº¿u mutation thÃ nh cÃ´ng vÃ  tráº£ vá» dá»¯ liá»‡u má»›i, chÃºng ta sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n `'userData'` vá»›i dá»¯ liá»‡u má»›i. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng cache sáº½ Ä‘Æ°á»£c cáº­p nháº­t vÃ  component sáº½ hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i nháº¥t.
  - Náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh mutation, chÃºng ta cÃ³ thá»ƒ xá»­ lÃ½ nÃ³ trong khá»‘i `catch` vÃ  thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng tÆ°Æ¡ng á»©ng.

- Trong pháº§n render, chÃºng ta cÃ³ thá»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« `data` vÃ  sá»­ dá»¥ng `handleUpdateProfile` Ä‘á»ƒ gá»i hÃ m cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng khi nháº¥n vÃ o má»™t nÃºt.

- Tá»•ng quan, Ä‘oáº¡n code trÃªn cho phÃ©p chÃºng ta sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t cache cá»§a truy váº¥n sau khi mutation thÃ nh cÃ´ng, Ä‘áº£m báº£o ráº±ng component sáº½ hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i nháº¥t tá»« cache.

## Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query:

- TÃ­nh nÄƒng prefetching trong React Query cho phÃ©p ta Ä‘oÃ¡n trÆ°á»›c vÃ  náº¡p trÆ°á»›c dá»¯ liá»‡u tá»« cÃ¡c truy váº¥n Ä‘á»ƒ cung cáº¥p tráº£i nghiá»‡m mÆ°á»£t mÃ  vÃ  nhanh chÃ³ng cho ngÆ°á»i dÃ¹ng. Khi ta prefetch dá»¯ liá»‡u, React Query sáº½ tá»± Ä‘á»™ng gá»i cÃ¡c truy váº¥n vÃ  lÆ°u káº¿t quáº£ vÃ o bá»™ nhá»› Ä‘á»‡m trÆ°á»›c khi chÃºng Ä‘Æ°á»£c yÃªu cáº§u.

- Äá»ƒ sá»­ dá»¥ng tÃ­nh nÄƒng prefetching, ta cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m `useQuery` trong React Query vÃ  truyá»n tham sá»‘ `staleTime` cho truy váº¥n. Tham sá»‘ `staleTime` xÃ¡c Ä‘á»‹nh thá»i gian (theo milliseconds) mÃ  dá»¯ liá»‡u trong bá»™ nhá»› Ä‘á»‡m Ä‘Æ°á»£c coi lÃ  cÃ²n há»£p lá»‡ (khÃ´ng cáº§n pháº£i gá»i láº¡i API). Máº·c Ä‘á»‹nh, giÃ¡ trá»‹ cá»§a `staleTime` lÃ  0, tá»©c lÃ  dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c coi lÃ  háº¿t háº¡n vÃ  cáº§n gá»i láº¡i API má»—i khi nÃ³ Ä‘Æ°á»£c yÃªu cáº§u.

- VÃ­ dá»¥:

```jsx
import { useQuery } from 'react-query'

function UserProfile({ userId }) {
  const { data, isLoading } = useQuery(
    ['userData', userId],
    () => fetch(`/api/users/${userId}`).then((res) => res.json()),
    {
      // prefetching vá»›i staleTime lÃ  5 giÃ¢y
      staleTime: 5000
    }
  )

  // CÃ¡c pháº§n xá»­ lÃ½ UI
  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
      <p>Location: {data.location}</p>
    </div>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, ta sá»­ dá»¥ng `useQuery` Ä‘á»ƒ táº¡o má»™t truy váº¥n cÃ³ tÃªn lÃ  `'userData'` vá»›i `userId` lÃ  tham sá»‘ phá»¥ thuá»™c. Ta cÅ©ng truyá»n tham sá»‘ `staleTime` lÃ  5000 milliseconds (5 giÃ¢y). Äiá»u nÃ y cÃ³ nghÄ©a lÃ  khi dá»¯ liá»‡u trong bá»™ Ä‘á»‡m cá»§a truy váº¥n `'userData'` cÃ²n há»£p lá»‡ (chÆ°a quÃ¡ thá»i gian staleTime), React Query sáº½ sá»­ dá»¥ng dá»¯ liá»‡u trong bá»™ Ä‘á»‡m thay vÃ¬ gá»i láº¡i API.

- Khi trang chá»©a component `UserProfile` Ä‘Æ°á»£c hiá»ƒn thá»‹, React Query sáº½ tá»± Ä‘á»™ng prefetch dá»¯ liá»‡u cá»§a truy váº¥n `'userData'` vÃ  lÆ°u vÃ o bá»™ Ä‘á»‡m. Äiá»u nÃ y giÃºp tÄƒng tá»‘c Ä‘á»™ hiá»ƒn thá»‹ dá»¯ liá»‡u khi ngÆ°á»i dÃ¹ng truy cáº­p vÃ o trang, vÃ¬ dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c sáºµn sÃ ng sá»­ dá»¥ng ngay láº­p tá»©c mÃ  khÃ´ng cáº§n pháº£i chá» gá»i API.

- LÆ°u Ã½ ráº±ng tÃ­nh nÄƒng prefetching chá»‰ hoáº¡t Ä‘á»™ng khi ta sá»­ dá»¥ng `useQuery` vÃ  khÃ´ng Ã¡p dá»¥ng cho cÃ¡c mutation hoáº·c cÃ¡c truy váº¥n khÃ¡c nhÆ° `useMutation` hoáº·c `usePaginatedQuery`.

## Giáº£i thÃ­ch code chi tiáº¿t:

- Trong Ä‘oáº¡n code trÃªn, ta sá»­ dá»¥ng `useQuery` tá»« thÆ° viá»‡n React Query Ä‘á»ƒ táº¡o má»™t truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng (`'userData'`) vá»›i `userId` lÃ  tham sá»‘ phá»¥ thuá»™c.

- `{userId}`: ÄÆ°á»£c truyá»n vÃ o component `UserProfile` nhÆ° má»™t prop. ÄÃ¢y lÃ  id cá»§a ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh truy váº¥n cá»¥ thá»ƒ cho má»—i ngÆ°á»i dÃ¹ng.

- `['userData', userId]`: ÄÃ¢y lÃ  key cá»§a truy váº¥n, Ä‘áº¡i diá»‡n cho truy váº¥n `'userData'` cá»¥ thá»ƒ cho ngÆ°á»i dÃ¹ng vá»›i `userId`. Key nÃ y cáº§n Ä‘Æ°á»£c unique Ä‘á»ƒ React Query cÃ³ thá»ƒ quáº£n lÃ½ vÃ  lÆ°u trá»¯ káº¿t quáº£ truy váº¥n.

- `() => fetch(/api/users/${userId}).then((res) => res.json())`: ÄÃ¢y lÃ  hÃ m callback Ä‘Æ°á»£c truyá»n vÃ o `useQuery` vÃ  sáº½ Ä‘Æ°á»£c gá»i Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng tá»« API. Trong vÃ­ dá»¥ nÃ y, ta sá»­ dá»¥ng fetch Ä‘á»ƒ gá»­i yÃªu cáº§u GET Ä‘áº¿n Ä‘á»‹a chá»‰ `/api/users/${userId}` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng. Sau Ä‘Ã³, ta trÃ­ch xuáº¥t dá»¯ liá»‡u tá»« response báº±ng cÃ¡ch sá»­ dá»¥ng `.json()`.

- `{ staleTime: 5000 }`: ÄÃ¢y lÃ  tÃ¹y chá»n `staleTime` Ä‘Æ°á»£c truyá»n vÃ o `useQuery` Ä‘á»ƒ thiáº¿t láº­p thá»i gian háº¿t háº¡n cá»§a dá»¯ liá»‡u trong bá»™ Ä‘á»‡m. Trong vÃ­ dá»¥ nÃ y, `staleTime` Ä‘Æ°á»£c Ä‘áº·t lÃ  5000 milliseconds (5 giÃ¢y), tá»©c lÃ  dá»¯ liá»‡u trong bá»™ Ä‘á»‡m sáº½ Ä‘Æ°á»£c coi lÃ  cÃ²n há»£p lá»‡ trong vÃ²ng 5 giÃ¢y. Khi dá»¯ liá»‡u trong bá»™ Ä‘á»‡m cÃ²n há»£p lá»‡, React Query sáº½ sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã³ mÃ  khÃ´ng cáº§n gá»i láº¡i API.

- `data`: Biáº¿n nÃ y chá»©a káº¿t quáº£ tráº£ vá» tá»« truy váº¥n. Khi dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c táº£i xong tá»« API vÃ  khÃ´ng cÃ²n Ä‘ang loading, data sáº½ chá»©a dá»¯ liá»‡u ngÆ°á»i dÃ¹ng.

- `isLoading`: Biáº¿n nÃ y xÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i cá»§a truy váº¥n. Khi `isLoading` lÃ  `true`, cÃ³ nghÄ©a lÃ  truy váº¥n Ä‘ang Ä‘Æ°á»£c thá»±c hiá»‡n vÃ  dá»¯ liá»‡u Ä‘ang loading.

- Trong cÃ¡c pháº§n xá»­ lÃ½ UI, ta cÃ³ thá»ƒ sá»­ dá»¥ng `data` vÃ  `isLoading` Ä‘á»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u vÃ  thÃ´ng bÃ¡o loading tÆ°Æ¡ng á»©ng.

## Cáº­p nháº­t data query thÃ´ng qua setQueryData trong React Query:

- Trong React Query, chÃºng ta cÃ³ thá»ƒ cáº­p nháº­t dá»¯ liá»‡u cá»§a má»™t truy váº¥n báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `setQueryData` cá»§a `queryClient`. ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u cá»§a má»™t truy váº¥n:

```jsx
import { useQuery, useQueryClient } from 'react-query'

function UserProfile({ userId }) {
  const queryClient = useQueryClient()

  const { data, isLoading } = useQuery(['userData', userId], () =>
    fetch(`/api/users/${userId}`).then((res) => res.json())
  )

  const handleUpdateProfile = () => {
    // Gá»i API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a ngÆ°á»i dÃ¹ng
     const response = await fetch(`/api/users/${userId}`, {
      method: 'PUT',
      body: JSON.stringify({ name: 'New Name', email: 'newemail@example.com' }),
      headers: {
        'Content-Type': 'application/json',
      },
    });

    if (!response.ok) {
      // Xá»­ lÃ½ lá»—i náº¿u cáº§n
      console.error('Failed to update user profile');
      return;
    }

    // Sau khi cáº­p nháº­t thÃ nh cÃ´ng, ta sáº½ cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o query
    const updatedData = { ...data, name: 'New Name', email: 'newemail@example.com' }
    queryClient.setQueryData(['userData', userId], updatedData)
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
      <button onClick={handleUpdateProfile}>Update Profile</button>
    </div>
  )
}
```

- Trong Ä‘oáº¡n code trÃªn, chÃºng ta sá»­ dá»¥ng `useQueryClient` Ä‘á»ƒ láº¥y má»™t thá»ƒ hiá»‡n cá»§a `queryClient`. Sau Ä‘Ã³, trong hÃ m `handleUpdateProfile`, khi chÃºng ta muá»‘n cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a ngÆ°á»i dÃ¹ng, chÃºng ta táº¡o má»™t Ä‘á»‘i tÆ°á»£ng `updatedData` vá»›i dá»¯ liá»‡u má»›i vÃ  sá»­ dá»¥ng `setQueryData` Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u trong cache cá»§a truy váº¥n. Tiáº¿p theo, trong hÃ m `handleUpdateProfile`, chÃºng ta gá»­i má»™t yÃªu cáº§u PUT Ä‘áº¿n API vá»›i dá»¯ liá»‡u má»›i (tÃªn vÃ  email má»›i). Náº¿u yÃªu cáº§u thÃ nh cÃ´ng, chÃºng ta cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o cache báº±ng cÃ¡ch sá»­ dá»¥ng `setQueryData` cá»§a `queryClient`. Sau Ä‘Ã³, giao diá»‡n ngÆ°á»i dÃ¹ng sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng cáº­p nháº­t vá»›i dá»¯ liá»‡u má»›i tá»« cache.

- Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng khi chÃºng ta truy cáº­p trang hoáº·c sá»­ dá»¥ng truy váº¥n khÃ¡c vá»›i cÃ¹ng khÃ³a, dá»¯ liá»‡u Ä‘Æ°á»£c cáº­p nháº­t sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹.

## Giáº£i thÃ­ch Ä‘oáº¡n code chi tiáº¿t:

- Äoáº¡n mÃ£ trÃªn lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng React Query Ä‘á»ƒ láº¥y vÃ  cáº­p nháº­t dá»¯ liá»‡u ngÆ°á»i dÃ¹ng. DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch tá»«ng pháº§n cá»§a Ä‘oáº¡n mÃ£:

1. `import { useQuery, useQueryClient } from 'react-query'`: ChÃºng ta import hai hook `useQuery` vÃ  `useQueryClient` tá»« thÆ° viá»‡n React Query.

- `useQuery`: ÄÃ¢y lÃ  má»™t hook Ä‘Æ°á»£c cung cáº¥p bá»Ÿi React Query Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c truy váº¥n dá»¯ liá»‡u (data query) trong á»©ng dá»¥ng React. Khi sá»­ dá»¥ng `useQuery`, chÃºng ta cÃ³ thá»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u tá»« server vÃ  React Query sáº½ quáº£n lÃ½ viá»‡c cache, tá»± Ä‘á»™ng lÃ m má»›i dá»¯ liá»‡u vÃ  cung cáº¥p cÃ¡c káº¿t quáº£ truy váº¥n thÃ´ng qua cÃ¡c biáº¿n káº¿t quáº£ nhÆ° `data`, `isLoading`, `isError`,...

- `useQueryClient`: ÄÃ¢y lÃ  má»™t hook cung cáº¥p Ä‘á»‘i tÆ°á»£ng `queryClient`, cho phÃ©p truy cáº­p vÃ  tÆ°Æ¡ng tÃ¡c vá»›i instance cá»§a `queryClient` Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi React Query trong á»©ng dá»¥ng. Vá»›i `queryClient`, chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° táº¡o, xÃ³a, vÃ  lÃ m má»›i truy váº¥n, cÅ©ng nhÆ° quáº£n lÃ½ cache vÃ  tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c mutations (biáº¿n Ä‘á»•i dá»¯ liá»‡u).

2. `function UserProfile({ userId }) {`: ÄÃ¢y lÃ  má»™t component React `UserProfile` nháº­n vÃ o má»™t tham sá»‘ `userId` nhÆ° má»™t props.

3. `const queryClient = useQueryClient()`: ChÃºng ta sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y Ä‘á»‘i tÆ°á»£ng `queryClient` tá»« React Query. Äá»‘i tÆ°á»£ng `queryClient` cho phÃ©p chÃºng ta thao tÃ¡c vá»›i cache vÃ  cÃ¡c phÆ°Æ¡ng thá»©c khÃ¡c cá»§a React Query.

4. `const { data, isLoading } = useQuery(['userData', userId], () => fetch(/api/users/${userId}).then((res) => res.json()))`: ChÃºng ta sá»­ dá»¥ng hook `useQuery` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng. Truy váº¥n nÃ y cÃ³ key lÃ  `['userData', userId]`, Ä‘áº¡i diá»‡n cho tÃªn cá»§a truy váº¥n (name query) vÃ  tham sá»‘ phá»¥ thuá»™c (params dependency) lÃ  `userId`. HÃ m callback Ä‘Æ°á»£c cung cáº¥p sáº½ thá»±c hiá»‡n láº¥y dá»¯ liá»‡u tá»« API báº±ng cÃ¡ch gá»­i má»™t yÃªu cáº§u GET Ä‘áº¿n Ä‘á»‹a chá»‰ `/api/users/${userId}` vÃ  chuyá»ƒn Ä‘á»•i káº¿t quáº£ tráº£ vá» thÃ nh Ä‘á»‹nh dáº¡ng JSON.

5. `const handleUpdateProfile = () => { ... }`: ÄÃ¢y lÃ  hÃ m xá»­ lÃ½ sá»± kiá»‡n khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt `"Update Profile"`. Trong hÃ m nÃ y, chÃºng ta gá»­i má»™t yÃªu cáº§u PUT Ä‘áº¿n API Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a ngÆ°á»i dÃ¹ng.

6. `const updatedData = { ...data, name: 'New Name', email: 'newemail@example.com' }`: lÃ  táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng má»›i Ä‘Æ°á»£c gÃ¡n cho biáº¿n `updatedData`. Äá»‘i tÆ°á»£ng nÃ y sáº½ cÃ³ cÃ¡c thuá»™c tÃ­nh giá»‘ng nhau vá»›i Ä‘á»‘i tÆ°á»£ng data ban Ä‘áº§u, nhÆ°ng thuá»™c tÃ­nh `name` sáº½ Ä‘Æ°á»£c thay Ä‘á»•i thÃ nh `'New Name'` vÃ  thuá»™c tÃ­nh `email` sáº½ Ä‘Æ°á»£c thay Ä‘á»•i thÃ nh `'newemail@example.com'`.

- PhÃ©p toÃ¡n `{ ...data }` Ä‘Æ°á»£c gá»i lÃ  `"spread operator"` trong JavaScript vÃ  nÃ³ táº¡o ra má»™t báº£n sao cá»§a Ä‘á»‘i tÆ°á»£ng `data`. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ gÃ¡n cÃ¡c giÃ¡ trá»‹ má»›i cho cÃ¡c thuá»™c tÃ­nh trong Ä‘á»‘i tÆ°á»£ng má»›i nÃ y. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta thay Ä‘á»•i thuá»™c tÃ­nh `name` vÃ  `email` vÃ  Ä‘Æ°á»£c lÆ°u trá»¯ trong biáº¿n `updatedData`.

7. `queryClient.setQueryData(['userData', userId], updatedData)`: ChÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `setQueryData` cá»§a `queryClient` Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o cache. `setQueryData` nháº­n vÃ o key cá»§a truy váº¥n (`['userData', userId]`) vÃ  dá»¯ liá»‡u má»›i (`updatedData`), vÃ  nÃ³ sáº½ cáº­p nháº­t dá»¯ liá»‡u trong cache cá»§a truy váº¥n Ä‘Ã³.

8. Giao diá»‡n ngÆ°á»i dÃ¹ng hiá»ƒn thá»‹ `name` vÃ  `email` cá»§a ngÆ°á»i dÃ¹ng tá»« dá»¯ liá»‡u trong cache (`data.name`, `data.email`). Náº¿u tráº¡ng thÃ¡i `isLoading` lÃ  `true`, chÃºng ta hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."`.

9. Khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt `"Update Profile"`, hÃ m `handleUpdateProfile` Ä‘Æ°á»£c gá»i Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n vÃ  cáº­p nháº­t dá»¯ liá»‡u trong cache báº±ng cÃ¡ch sá»­ dá»¥ng `setQueryData`. Káº¿t quáº£ lÃ  giao diá»‡n ngÆ°á»i dÃ¹ng sáº½ tá»± Ä‘á»™ng cáº­p nháº­t vá»›i dá»¯ liá»‡u má»›i tá»« cache mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i truy váº¥n tá»« API.

## refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate trong React Query:

- Trong React Query, chÃºng ta cÃ³ thá»ƒ lÃ m má»›i (refetch) má»™t query thÃ´ng qua cÆ¡ cháº¿ `invalidate`. Khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c `invalidateQueries` trÃªn Ä‘á»‘i tÆ°á»£ng `queryClient`, nÃ³ sáº½ xoÃ¡ cache cá»§a query tÆ°Æ¡ng á»©ng vÃ  cho phÃ©p truy váº¥n Ä‘Ã³ Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i.

- DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng cÆ¡ cháº¿ `invalidate` Ä‘á»ƒ lÃ m má»›i má»™t query:

```jsx
import { useQuery, useQueryClient } from 'react-query'

function UserProfile({ userId }) {
  const queryClient = useQueryClient()

  const { data, isLoading } = useQuery(['userData', userId], () =>
    fetch(`/api/users/${userId}`).then((res) => res.json())
  )

  const handleRefresh = () => {
    // Gá»i phÆ°Æ¡ng thá»©c invalidateQueries Ä‘á»ƒ lÃ m má»›i query 'userData'
    queryClient.invalidateQueries(['userData', userId])
  }

  if (isLoading) {
    return <div>Loading...</div>
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {data.name}</p>
      <p>Email: {data.email}</p>
      <button onClick={handleRefresh}>Refresh</button>
    </div>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y Ä‘á»‘i tÆ°á»£ng `queryClient` tá»« React Query. Khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt `"Refresh"`, hÃ m `handleRefresh` Ä‘Æ°á»£c gá»i. Trong hÃ m nÃ y, chÃºng ta gá»i `queryClient.invalidateQueries(['userData', userId])` Ä‘á»ƒ xoÃ¡ cache cá»§a query `'userData'` vÃ  cho phÃ©p truy váº¥n Ä‘Ã³ Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i.

- Khi query Ä‘Æ°á»£c `invalidate`, React Query sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n truy váº¥n láº¡i tá»« API vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o cache. Sau Ä‘Ã³, giao diá»‡n ngÆ°á»i dÃ¹ng sáº½ tá»± Ä‘á»™ng cáº­p nháº­t vá»›i dá»¯ liá»‡u má»›i tá»« cache.

- Viá»‡c sá»­ dá»¥ng cÆ¡ cháº¿ `invalidate` giÃºp chÃºng ta lÃ m má»›i truy váº¥n má»™t cÃ¡ch linh hoáº¡t vÃ  dá»… dÃ ng trong React Query mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i toÃ n bá»™ quÃ¡ trÃ¬nh truy váº¥n tá»« API.

## Giáº£i thÃ­ch chi tiáº¿t Ä‘oáº¡n code:

- Äoáº¡n code trÃªn lÃ  má»™t vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng cÆ¡ cháº¿ invalidate trong React Query Ä‘á»ƒ lÃ m má»›i má»™t query. HÃ£y Ä‘i qua tá»«ng pháº§n Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n vá» nÃ³:

1. Import cÃ¡c dependencies: ChÃºng ta import `useQuery` vÃ  `useQueryClient` tá»« React Query Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c hook vÃ  Ä‘á»‘i tÆ°á»£ng liÃªn quan.

- `useQuery`: ÄÃ¢y lÃ  má»™t hook Ä‘Æ°á»£c cung cáº¥p bá»Ÿi React Query Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c truy váº¥n dá»¯ liá»‡u (data query) trong á»©ng dá»¥ng React. Khi sá»­ dá»¥ng `useQuery`, chÃºng ta cÃ³ thá»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u tá»« server vÃ  React Query sáº½ quáº£n lÃ½ viá»‡c cache, tá»± Ä‘á»™ng lÃ m má»›i dá»¯ liá»‡u vÃ  cung cáº¥p cÃ¡c káº¿t quáº£ truy váº¥n thÃ´ng qua cÃ¡c biáº¿n káº¿t quáº£ nhÆ° `data`, `isLoading`, `isError`,...

- `useQueryClient`: ÄÃ¢y lÃ  má»™t hook cung cáº¥p Ä‘á»‘i tÆ°á»£ng `queryClient`, cho phÃ©p truy cáº­p vÃ  tÆ°Æ¡ng tÃ¡c vá»›i instance cá»§a `queryClient` Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi React Query trong á»©ng dá»¥ng. Vá»›i `queryClient`, chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° táº¡o, xÃ³a, vÃ  lÃ m má»›i truy váº¥n, cÅ©ng nhÆ° quáº£n lÃ½ cache vÃ  tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c mutations (biáº¿n Ä‘á»•i dá»¯ liá»‡u).

2. Táº¡o component `UserProfile`: Component nÃ y nháº­n má»™t `userId` lÃ m Ä‘áº§u vÃ o Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng cáº§n hiá»ƒn thá»‹ thÃ´ng tin.

3. Sá»­ dá»¥ng hook `useQueryClient`: ChÃºng ta sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y Ä‘á»‘i tÆ°á»£ng `queryClient` tá»« React Query. Äá»‘i tÆ°á»£ng nÃ y chá»©a cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i cache vÃ  truy váº¥n.

4. Sá»­ dá»¥ng hook `useQuery` Ä‘á»ƒ láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng: ChÃºng ta sá»­ dá»¥ng hook `useQuery` Ä‘á»ƒ táº¡o má»™t query cÃ³ tÃªn lÃ  `'userData'` vá»›i `userId` lÃ  tham sá»‘ phá»¥ thuá»™c. Truy váº¥n nÃ y sáº½ gá»i API Ä‘á»ƒ láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« server. Káº¿t quáº£ tráº£ vá» sáº½ Ä‘Æ°á»£c lÆ°u vÃ o cache vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p thÃ´ng qua `data` vÃ  `isLoading` trong component.

5. Xá»­ lÃ½ sá»± kiá»‡n `Refresh`: Khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt `"Refresh"`, hÃ m `handleRefresh` Ä‘Æ°á»£c gá»i. Trong hÃ m nÃ y, chÃºng ta gá»i `queryClient.invalidateQueries(['userData', userId])` Ä‘á»ƒ xoÃ¡ cache cá»§a query `'userData'` vÃ  cho phÃ©p truy váº¥n Ä‘Ã³ Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i. Äá»‘i sá»‘ truyá»n vÃ o lÃ  má»™t máº£ng chá»©a tÃªn query vÃ  cÃ¡c tham sá»‘ phá»¥ thuá»™c cá»§a query.

6. Hiá»ƒn thá»‹ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng: Náº¿u Ä‘ang trong quÃ¡ trÃ¬nh táº£i dá»¯ liá»‡u (`isLoading` lÃ  `true`), chÃºng ta hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."`. Khi dá»¯ liá»‡u Ä‘Ã£ táº£i xong, chÃºng ta hiá»ƒn thá»‹ thÃ´ng tin ngÆ°á»i dÃ¹ng nhÆ° `name` vÃ  `email` Ä‘Æ°á»£c láº¥y tá»« `data`.

7. Render giao diá»‡n: Component `UserProfile` sáº½ hiá»ƒn thá»‹ má»™t tiÃªu Ä‘á» `"User Profile"` vÃ  thÃ´ng tin ngÆ°á»i dÃ¹ng. NgoÃ i ra, cÃ³ má»™t nÃºt `"Refresh"` Ä‘á»ƒ lÃ m má»›i truy váº¥n thÃ´ng qua cÆ¡ cháº¿ `invalidate`.

- Khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt `"Refresh"`, hÃ m `handleRefresh` sáº½ Ä‘Æ°á»£c gá»i. Viá»‡c gá»i `queryClient.invalidateQueries(['userData', userId])` sáº½ xoÃ¡ cache cá»§a query `'userData'` vÃ  cho phÃ©p truy váº¥n Ä‘Ã³ Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i tá»« API. Khi truy váº¥n hoÃ n thÃ nh, React Query sáº½ cáº­p nháº­t dá»¯ liá»‡u má»›i vÃ o cache vÃ  tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n vá»›i dá»¯ liá»‡u má»›i tá»« cache.

## Sá»­ dá»¥ng tÃ­nh nÄƒng prefetching query trong React Query:

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

á» video láº§n trÆ°á»›c náº¿u anh em Ä‘á»ƒ Ã½ thÃ¬ mÃ¬nh cÃ³ má»™t bug nho nhá» trong pháº§n Student Info Ä‘Ã³ lÃ  khÃ´ng hiá»ƒn thá»‹ Ä‘Ãºng gender, video nÃ y mÃ¬nh sáº½ fix luÃ´n.

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query
ğŸ‰ Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation
ğŸ‰ Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query

ğŸ•°ï¸Ná»™i dung chÃ­nh

00:00 - Cáº­p nháº­t data query thÃ´ng qua setQueryData
05:38 - refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate
12:14 - SÆ° dá»¥ng tÃ­nh nÄƒng prefetching query

![SWR trong React Query](image-1.png)
