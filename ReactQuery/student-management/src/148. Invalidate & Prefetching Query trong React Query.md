## ÄÃ¢y lÃ  Docs tá»± research:

- â“ ÄÃ¢y lÃ  cÃ¢u há»i trong bÃ i nÃ y:

- â“ CÃ¢u há»i: Anh Æ¡i, em tháº¥y trong `useQuery()` Ä‘Ã£ cÃ³ sáºµn hÃ m `refetch()`, em cÅ©ng hay dÃ¹ng hÃ m nÃ y má»—i khi cáº§n refetch data sau khi `mutate`. Váº­y hÃ m `refetch()` nÃ y khÃ¡c tháº¿ nÃ o vá»›i 2 cÃ¡i `queryClient.setQueyData()` vÃ  `queryClient.invalidateQueries()` lÃ  gÃ¬ áº¥y anh ?

- âœ… Tráº£ lá»i: `refetch` => Gá»i 1 cÃ¡i query instance trong component. `invalidateQueries` => Gá»i láº¡i 1 hoáº·c nhiá»u query, cÃ³ thá»ƒ dÃ¹ng cho cÃ¡c component khÃ¡c cÅ©ng Ä‘Æ°á»£c. `setQueryData` => Cáº­p nháº­t data má»›i (khÃ´ng fetch láº¡i API)

## Ã”n láº¡i bÃ i cÅ©: ğŸ’¥ğŸ’¥ğŸ’¥

## Trong react query trong Ä‘Ã³ cÃ³ queryKey. Trong queryKey cÃ³ 2 tham sá»‘, 2 tham sá»‘ Ä‘Ã³ lÃ  gÃ¬ ?

- Trong React Query, `queryKey` lÃ  má»™t máº£ng gá»“m cÃ¡c tham sá»‘ Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»™t truy váº¥n dá»¯ liá»‡u cá»¥ thá»ƒ. Má»—i pháº§n tá»­ trong máº£ng `queryKey` Ä‘áº¡i diá»‡n cho má»™t pháº§n quan trá»ng trong viá»‡c xÃ¡c Ä‘á»‹nh truy váº¥n.

- ThÆ°á»ng thÃ¬ `queryKey` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vá»›i cáº¥u trÃºc `[type, ...params]`, trong Ä‘Ã³:

  - `type`: LÃ  má»™t chuá»—i (string) Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n, vÃ­ dá»¥ nhÆ° "user", "todos", "posts",...
  - `params`: LÃ  cÃ¡c tham sá»‘ bá»• sung khÃ¡c (náº¿u cÃ³) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u má»™t cÃ¡ch cá»¥ thá»ƒ. CÃ¡c tham sá»‘ nÃ y thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»™t Ä‘á»‘i tÆ°á»£ng hoáº·c má»™t giÃ¡ trá»‹ duy nháº¥t liÃªn quan Ä‘áº¿n truy váº¥n.

- VÃ­ dá»¥, náº¿u báº¡n muá»‘n truy váº¥n dá»¯ liá»‡u cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ vá»›i `userId` lÃ  1, thÃ¬ `queryKey` cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  `['user', 1]`. Trong Ä‘Ã³, `'user'` lÃ  loáº¡i dá»¯ liá»‡u `"user"`, vÃ  1 lÃ  `userId`.

- TÃ¹y thuá»™c vÃ o cÃ¡ch báº¡n Ä‘á»‹nh nghÄ©a truy váº¥n vÃ  cáº¥u trÃºc dá»¯ liá»‡u cá»§a á»©ng dá»¥ng, sá»‘ lÆ°á»£ng vÃ  Ã½ nghÄ©a cá»§a cÃ¡c tham sá»‘ trong `queryKey` cÃ³ thá»ƒ khÃ¡c nhau. Báº¡n cÃ³ thá»ƒ tuá»³ chá»‰nh `queryKey` Ä‘á»ƒ phÃ¹ há»£p vá»›i nhu cáº§u cá»§a truy váº¥n dá»¯ liá»‡u cá»§a mÃ¬nh.

## âŒâŒ Tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` cÃ³ pháº£i lÃ  nÃ³ tiáº¿p ná»‘i vá»›i `router` trÃªn `server` khÃ´ng. VÃ­ dá»¥ tÃ´i cÃ³ `localhost://blog/post`, trong link Ä‘Ã³ cÃ³ `/post`, thÃ¬ Ä‘Ã³ cÃ³ pháº£i lÃ  `type` cá»§a `queryKey` khÃ´ng ?

- KhÃ´ng, tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` khÃ´ng pháº£i lÃ  tiáº¿p ná»‘i vá»›i `router` trÃªn `server`. NÃ³ chá»‰ Ä‘Æ¡n giáº£n lÃ  má»™t chuá»—i (string) Ä‘áº¡i diá»‡n cho loáº¡i dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n.

- Trong trÆ°á»ng há»£p cá»§a báº¡n, náº¿u báº¡n cÃ³ má»™t trang web `localhost://blog/post` vÃ  báº¡n muá»‘n truy váº¥n dá»¯ liá»‡u vá» bÃ i viáº¿t (`post`), báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `'post'` lÃ m tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh loáº¡i dá»¯ liá»‡u lÃ  bÃ i viáº¿t.

- VÃ­ dá»¥: `queryKey: ['post', ...]`

- Viá»‡c tiáº¿p ná»‘i vá»›i `router` trÃªn `server` thÆ°á»ng Ä‘Æ°á»£c xá»­ lÃ½ bÃªn phÃ­a `server` vÃ  khÃ´ng liÃªn quan trá»±c tiáº¿p Ä‘áº¿n `queryKey` trong React Query. `queryKey` chá»‰ Ä‘Æ¡n giáº£n lÃ  má»™t pháº§n trong viá»‡c xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u mÃ  React Query sáº½ quáº£n lÃ½ vÃ  Ä‘iá»u khiá»ƒn.

## Váº­y thÃ¬ tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` phá»¥ thuá»™c vÃ o cÃ¡i gÃ¬, nÃ³ Ä‘áº·t tÃªn `type` cho tham sá»‘ Ä‘áº§u tiÃªn nÃ³ phá»¥ thuá»™c vÃ o Ä‘Ã¢u, hay lÃ  mÃ¬nh Ä‘áº·t tÃªn gÃ¬ cÅ©ng Ä‘Æ°á»£c ?

- Tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` khÃ´ng phá»¥ thuá»™c vÃ o báº¥t ká»³ yáº¿u tá»‘ cá»¥ thá»ƒ nÃ o vÃ  báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃªn cho nÃ³ theo Ã½ muá»‘n. NÃ³ khÃ´ng cÃ³ quy táº¯c cá»©ng nháº¯c vá» cÃ¡ch Ä‘áº·t tÃªn, vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ chuá»—i nÃ o lÃ m giÃ¡ trá»‹ cho tham sá»‘ Ä‘áº§u tiÃªn.

- Tuy nhiÃªn, Ä‘á»ƒ giá»¯ cho tÃªn tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` dá»… hiá»ƒu vÃ  dá»… quáº£n lÃ½, báº¡n cÃ³ thá»ƒ chá»n cÃ¡c giÃ¡ trá»‹ cÃ³ liÃªn quan Ä‘áº¿n loáº¡i dá»¯ liá»‡u báº¡n Ä‘ang truy váº¥n. VÃ­ dá»¥, náº¿u báº¡n Ä‘ang truy váº¥n dá»¯ liá»‡u vá» bÃ i viáº¿t, báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃªn tham sá»‘ Ä‘áº§u tiÃªn lÃ  `'post'`. Tuy nhiÃªn, báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ tÃªn nÃ o phÃ¹ há»£p vá»›i dá»± Ã¡n cá»§a mÃ¬nh, vÃ­ dá»¥ nhÆ° `'data'`, `'item'`, `'resource'`, vv.

## Viá»‡c Ä‘áº·t tÃªn nhÆ° tháº¿ thÃ¬ khi nÃ³ lÆ°u trong `cache` thÃ¬ nÃ³ cÃ³ `key` lÃ  `post` cÃ³ pháº£i khÃ´ng ?

- KhÃ´ng, khi dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong cache, khÃ´ng pháº£i lÃ  tÃªn cá»§a tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m `key` trong `cache`. Trong React Query, cÃ¡c key trong cache Ä‘Æ°á»£c quáº£n lÃ½ tá»± Ä‘á»™ng vÃ  Ä‘Æ°á»£c táº¡o ra dá»±a trÃªn cÃ¡c tham sá»‘ cá»§a `queryKey`, khÃ´ng phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ cá»§a cÃ¡c tham sá»‘ Ä‘Ã³.

- Khi báº¡n thá»±c hiá»‡n má»™t truy váº¥n vÃ  sá»­ dá»¥ng `queryKey` Ä‘á»ƒ Ä‘á»‹nh danh nÃ³, React Query sáº½ táº¡o má»™t key duy nháº¥t cho truy váº¥n Ä‘Ã³ trong cache. Key nÃ y sáº½ dá»±a trÃªn cÃ¡c giÃ¡ trá»‹ cá»§a cÃ¡c tham sá»‘ trong `queryKey` vÃ  Ä‘Æ°á»£c táº¡o ra theo quy táº¯c cá»§a React Query.

- VÃ¬ váº­y, trong vÃ­ dá»¥ cá»§a báº¡n vá»›i `queryKey: ['post', id]`, dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong cache sáº½ khÃ´ng cÃ³ key lÃ  `'post'`, mÃ  sáº½ cÃ³ má»™t key duy nháº¥t Ä‘Æ°á»£c táº¡o ra bá»Ÿi React Query dá»±a trÃªn giÃ¡ trá»‹ cá»§a `id` vÃ  quy táº¯c cá»§a nÃ³.

## Váº­y `'post'` trong tham sá»‘ Ä‘áº§u tiÃªn trong queryKey Ä‘Æ°á»£c Ä‘áº·t Ä‘á»ƒ lÃ m gÃ¬ ? NÃ³ khÃ´ng cÃ³ tÃ¡c dá»¥ng gÃ¬ háº£ ?

- Trong `queryKey`, tham sá»‘ Ä‘áº§u tiÃªn (trong trÆ°á»ng há»£p cá»§a báº¡n lÃ  `'post'`) khÃ´ng cÃ³ tÃ¡c dá»¥ng trá»±c tiáº¿p trong viá»‡c quáº£n lÃ½ cache hoáº·c Ä‘á»‹nh danh truy váº¥n. NÃ³ chá»‰ lÃ  má»™t giÃ¡ trá»‹ bá»• sung mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ phÃ¢n loáº¡i cÃ¡c loáº¡i truy váº¥n hoáº·c nháº­n biáº¿t má»¥c Ä‘Ã­ch cá»§a truy váº¥n Ä‘Ã³.

- VÃ­ dá»¥, náº¿u báº¡n cÃ³ nhiá»u loáº¡i truy váº¥n trong á»©ng dá»¥ng cá»§a mÃ¬nh nhÆ° `'post'`, `'user'`, `'comment'`, thÃ¬ sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong `queryKey` lÃ  má»™t cÃ¡ch Ä‘á»ƒ phÃ¢n loáº¡i cÃ¡c truy váº¥n vÃ  lÃ m cho code dá»… Ä‘á»c hÆ¡n. Tuy nhiÃªn, React Query khÃ´ng sá»­ dá»¥ng giÃ¡ trá»‹ nÃ y trong quÃ¡ trÃ¬nh quáº£n lÃ½ cache hay táº¡o key cho cache.

- Do Ä‘Ã³, náº¿u báº¡n chá»‰ cÃ³ má»™t loáº¡i truy váº¥n duy nháº¥t vÃ  khÃ´ng cáº§n phÃ¢n loáº¡i cÃ¡c truy váº¥n, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng má»™t máº£ng `queryKey` chá»‰ vá»›i má»™t tham sá»‘, vÃ­ dá»¥ nhÆ° `[id]`, vÃ  bá» qua giÃ¡ trá»‹ Ä‘áº§u tiÃªn.

## âŒâŒ Äáº·t tÃªn cho giÃ¡ trá»‹ truy váº¥n lÃ  `'post'`, thÃ¬ khi cÃ³ má»™t cÃ¡i queryKey khÃ¡c cÅ©ng cÃ³ tham sá»‘ Ä‘áº§u tiÃªn lÃ  `'post'` lÃºc nÃ y 2 cÃ¡i truy váº¥n cÃ¹ng tÃªn sáº½ gá»i láº¡i cÃ¹ng nhau Ä‘Ãºng khÃ´ng ?

- Trong React Query, cÃ¡c truy váº¥n khÃ´ng chá»‰ phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ cá»§a tham sá»‘ Ä‘áº§u tiÃªn trong `queryKey` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem chÃºng cÃ³ cÃ¹ng má»™t truy váº¥n hay khÃ´ng. Thay vÃ o Ä‘Ã³, React Query sá»­ dá»¥ng cÆ¡ cháº¿ Ä‘á»‹nh danh truy váº¥n dá»±a trÃªn toÃ n bá»™ `queryKey`.

- Khi báº¡n khá»Ÿi táº¡o má»™t truy váº¥n má»›i vá»›i má»™t `queryKey` cá»¥ thá»ƒ, React Query sáº½ táº¡o ra má»™t key duy nháº¥t cho truy váº¥n Ä‘Ã³ báº±ng cÃ¡ch káº¿t há»£p cÃ¡c giÃ¡ trá»‹ trong `queryKey`. Do Ä‘Ã³, ngay cáº£ khi cÃ³ hai `queryKey` vá»›i cÃ¹ng giÃ¡ trá»‹ `'post'` trong tham sá»‘ Ä‘áº§u tiÃªn, nhÆ°ng cÃ³ cÃ¡c giÃ¡ trá»‹ khÃ¡c trong cÃ¡c tham sá»‘ khÃ¡c, chÃºng sáº½ Ä‘Æ°á»£c xem lÃ  hai truy váº¥n riÃªng biá»‡t vÃ  khÃ´ng gá»i láº¡i cÃ¹ng nhau.

- VÃ­ dá»¥:

```jsx
const queryKey1 = ['post', 1]
const queryKey2 = ['post', 2]

// Hai queryKey khÃ¡c nhau, khÃ´ng gá»i láº¡i cÃ¹ng nhau
queryClient.fetchQuery(queryKey1)
queryClient.fetchQuery(queryKey2)
```

- Do Ä‘Ã³, khi Ä‘áº·t tÃªn cho giÃ¡ trá»‹ trong `queryKey`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¹ng má»™t giÃ¡ trá»‹ cho tham sá»‘ Ä‘áº§u tiÃªn náº¿u nÃ³ há»£p lÃ½ vá»›i báº£n thiáº¿t káº¿ cá»§a á»©ng dá»¥ng cá»§a báº¡n. Tuy nhiÃªn, hÃ£y cháº¯c cháº¯n ráº±ng cÃ¡c giÃ¡ trá»‹ khÃ¡c trong `queryKey` khÃ¡c nhau Ä‘á»ƒ cÃ¡c truy váº¥n khÃ´ng gá»i láº¡i nhau nháº§m láº«n.

## âŒâŒ Váº­y thÃ¬ tham sá»‘ thá»© 2 lÃ  `id`, nÃ³ lÃ  duy nháº¥t. MÃ  nÃ³ dá»±a vÃ o link `API` tá»« `server` Ä‘á»ƒ nÃ³ láº¥y dá»¯ liá»‡u hay sao ?

- Tham sá»‘ thá»© hai trong `queryKey` thÆ°á»ng lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t nhÆ° `ID`, vÃ  nÃ³ thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»‹nh danh má»™t má»¥c dá»¯ liá»‡u cá»¥ thá»ƒ trong há»‡ thá»‘ng hoáº·c API tá»« server.

- Khi báº¡n thá»±c hiá»‡n má»™t truy váº¥n vá»›i `queryKey` chá»©a má»™t giÃ¡ trá»‹ `ID`, vÃ­ dá»¥ nhÆ° `['post', 1]`, React Query sá»­ dá»¥ng giÃ¡ trá»‹ `ID` nÃ y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u cáº§n truy váº¥n tá»« server. CÃ¡ch xá»­ lÃ½ chi tiáº¿t sáº½ phá»¥ thuá»™c vÃ o cÃ¡ch báº¡n cáº¥u hÃ¬nh truy váº¥n vÃ  tÆ°Æ¡ng tÃ¡c vá»›i API cá»§a mÃ¬nh.

- ThÃ´ng thÆ°á»ng, báº¡n sáº½ sá»­ dá»¥ng giÃ¡ trá»‹ `ID` Ä‘á»ƒ chá»‰ Ä‘á»‹nh má»™t má»¥c dá»¯ liá»‡u cá»¥ thá»ƒ, vÃ­ dá»¥ nhÆ° láº¥y thÃ´ng tin má»™t bÃ i viáº¿t theo `ID`, hoáº·c láº¥y chi tiáº¿t má»™t ngÆ°á»i dÃ¹ng dá»±a trÃªn `ID` cá»§a há». Truyá»n giÃ¡ trá»‹ `ID` nÃ y trong `queryKey` cho truy váº¥n sáº½ giÃºp React Query nháº­n biáº¿t rÃµ ráº±ng truy váº¥n Ä‘Ã³ tÆ°Æ¡ng á»©ng vá»›i má»™t dá»¯ liá»‡u cá»¥ thá»ƒ vÃ  cáº§n Ä‘Æ°á»£c cáº­p nháº­t hoáº·c lÃ m má»›i khi cÃ³ thay Ä‘á»•i.

- Tuy nhiÃªn, cÃ¡ch mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n tá»« server dá»±a trÃªn `queryKey` vÃ  giÃ¡ trá»‹ `ID` sáº½ phá»¥ thuá»™c vÃ o cÃ¡ch báº¡n triá»ƒn khai API cá»§a mÃ¬nh. Báº¡n cáº§n xÃ¡c Ä‘á»‹nh vÃ  xá»­ lÃ½ logic phÃ¹ há»£p trong hÃ m truy váº¥n (`queryFn`) Ä‘á»ƒ gá»­i yÃªu cáº§u Ä‘áº¿n API vÃ  láº¥y dá»¯ liá»‡u tÆ°Æ¡ng á»©ng vá»›i giÃ¡ trá»‹ `ID` tá»« server.

## Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n khÃ¡c `invalidateQueries`:

- Táº¥t nhiÃªn! CÃ¹ng tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query.

- PhÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong React Query. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i cÃ¡c tÃ¹y chá»n Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch truy váº¥n Ä‘Æ°á»£c lÃ m má»›i.

- CÃº phÃ¡p:

```jsx
queryClient.invalidateQueries(key, options)
```

- Trong Ä‘Ã³:

  - `key` lÃ  key hoáº·c má»™t máº£ng cÃ¡c key cá»§a cÃ¡c truy váº¥n cáº§n lÃ m má»›i.
  - `options` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng (object) tÃ¹y chá»n (khÃ´ng báº¯t buá»™c) Ä‘á»ƒ kiá»ƒm soÃ¡t hÃ nh vi lÃ m má»›i.

- CÃ¡c tÃ¹y chá»n phá»• biáº¿n khi sá»­ dá»¥ng `invalidateQueries` bao gá»“m:

  1. `exact`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, chá»‰ cÃ³ cÃ¡c truy váº¥n cÃ³ key chÃ­nh xÃ¡c trÃ¹ng khá»›p vá»›i key má»›i sáº½ Ä‘Æ°á»£c lÃ m má»›i, cÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

  2. `refetchActive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh `fetching` sáº½ Ä‘Æ°á»£c há»§y vÃ  lÃ m má»›i.

  3. `refetchInactive`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, cÃ¡c truy váº¥n khÃ´ng hoáº¡t Ä‘á»™ng (`inactive`) sáº½ Ä‘Æ°á»£c lÃ m má»›i. Má»™t truy váº¥n Ä‘Æ°á»£c coi lÃ  khÃ´ng hoáº¡t Ä‘á»™ng náº¿u khÃ´ng cÃ³ listeners nÃ o Ä‘ang láº¯ng nghe sá»± thay Ä‘á»•i trong nÃ³.

  4. `throwOnError`: Máº·c Ä‘á»‹nh lÃ  `false`. Khi Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh lÃ m má»›i truy váº¥n, nÃ³ sáº½ nÃ©m ra lá»—i Ä‘á»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bÃªn ngoÃ i.

- VÃ­ dá»¥ sá»­ dá»¥ng `invalidateQueries` vá»›i cÃ¡c tÃ¹y chá»n:

```jsx
import { useQueryClient } from 'react-query';

const TodoList = () => {
  const queryClient = useQueryClient();

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId);

    // LÃ m má»›i truy váº¥n 'todos' vÃ  chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c
    queryClient.invalidateQueries('todos', {
      exact: true
    });
  };

  return (
    // ...
  );
};
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n `'todos'` vÃ  chá»‰ lÃ m má»›i truy váº¥n cÃ³ key chÃ­nh xÃ¡c lÃ  `'todos'`. CÃ¡c truy váº¥n con hoáº·c truy váº¥n khÃ¡c khÃ´ng Ä‘Æ°á»£c lÃ m má»›i.

- ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ cÆ¡ báº£n vá» cÃ¡ch sá»­ dá»¥ng `invalidateQueries` vÃ  cÃ¡c tÃ¹y chá»n trong React Query. Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡c tÃ¹y chá»n khÃ¡c vÃ  cÃ¡c kháº£ nÄƒng linh hoáº¡t khÃ¡c cá»§a React Query trong tÃ i liá»‡u chÃ­nh thá»©c cá»§a nÃ³.

## HÃ£y giáº£i thÃ­ch khÃ¡i niá»‡m vá» `invalidateQueries` vÃ  cÃ¡ch triá»ƒn khai sá»­ dá»¥ng nÃ³ trong code nhÆ° tháº¿ nÃ o ?

- Trong React Query, khÃ¡i niá»‡m `"invalidateQueries"` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m má»›i (invalidate) cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› cache. Khi má»™t truy váº¥n Ä‘Æ°á»£c lÃ m má»›i, React Query sáº½ tá»± Ä‘á»™ng gá»­i má»™t yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- CÃ¡ch sá»­ dá»¥ng `"invalidateQueries"` lÃ  thÃ´ng qua phÆ°Æ¡ng thá»©c `"invalidateQueries"` cá»§a Ä‘á»‘i tÆ°á»£ng `queryClient`, mÃ  báº¡n cÃ³ thá»ƒ láº¥y báº±ng cÃ¡ch sá»­ dá»¥ng hook `"useQueryClient"` tá»« thÆ° viá»‡n react-query. VÃ­ dá»¥:

```jsx
import { useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo

    // LÃ m má»›i truy váº¥n 'todos'
    queryClient.invalidateQueries('todos')
  }

  // ...
}
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta sá»­ dá»¥ng `"invalidateQueries"` Ä‘á»ƒ lÃ m má»›i truy váº¥n cÃ³ key lÃ  `'todos'`. Khi phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c gá»i, React Query sáº½ tá»± Ä‘á»™ng xÃ³a truy váº¥n `'todos'` khá»i bá»™ nhá»› cache vÃ  gá»­i má»™t yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- NgoÃ i ra, `"invalidateQueries"` cÅ©ng há»— trá»£ cÃ¡c tÃ¹y chá»n Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch lÃ m má»›i truy váº¥n, nhÆ°:

  - `exact`: XÃ¡c Ä‘á»‹nh liá»‡u chá»‰ cÃ³ truy váº¥n cÃ³ key chÃ­nh xÃ¡c trÃ¹ng khá»›p vá»›i key Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh má»›i sáº½ Ä‘Æ°á»£c lÃ m má»›i hay khÃ´ng.
  - `refetchActive`: XÃ¡c Ä‘á»‹nh liá»‡u cÃ¡c truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh `fetching` sáº½ Ä‘Æ°á»£c há»§y vÃ  lÃ m má»›i hay khÃ´ng.
  - `refetchInactive`: XÃ¡c Ä‘á»‹nh liá»‡u cÃ¡c truy váº¥n khÃ´ng hoáº¡t Ä‘á»™ng (inactive) sáº½ Ä‘Æ°á»£c lÃ m má»›i hay khÃ´ng.
  - `throwOnError`: XÃ¡c Ä‘á»‹nh liá»‡u náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh lÃ m má»›i truy váº¥n, cÃ³ nÃ©m ra lá»—i Ä‘á»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bÃªn ngoÃ i hay khÃ´ng.

- CÃ¡c tÃ¹y chá»n nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n vÃ o phÆ°Æ¡ng thá»©c `"invalidateQueries"` Ä‘á»ƒ Ä‘iá»u chá»‰nh hÃ nh vi lÃ m má»›i truy váº¥n.

- `InvalidateQueries` lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ trong React Query, cho phÃ©p lÃ m má»›i cÃ¡c truy váº¥n má»™t cÃ¡ch linh hoáº¡t vÃ  dá»… dÃ ng khi cáº§n thiáº¿t, Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u trong cache cá»§a chÃºng ta luÃ´n Ä‘Æ°á»£c cáº­p nháº­t vÃ  Ä‘á»“ng bá»™ vá»›i nguá»“n dá»¯ liá»‡u.

## â“â“ CÃ²n khÃ¡i niá»‡m nÃ o khÃ¡c vá»›i khÃ¡i niá»‡m trÃªn khÃ´ng ?

- KhÃ¡i niá»‡m khÃ¡c liÃªn quan Ä‘áº¿n `"invalidateQueries"` trong React Query lÃ  `"refetchQueries"`. `"refetchQueries"` cho phÃ©p lÃ m má»›i má»™t danh sÃ¡ch cÃ¡c truy váº¥n cá»¥ thá»ƒ sau khi má»™t truy váº¥n hoáº·c `mutation` Ä‘Ã£ Ä‘Æ°á»£c thá»±c hiá»‡n thÃ nh cÃ´ng.

- Khi sá»­ dá»¥ng `"refetchQueries"`, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh danh sÃ¡ch cÃ¡c truy váº¥n cáº§n lÃ m má»›i báº±ng cÃ¡ch sá»­ dá»¥ng key cá»§a tá»«ng truy váº¥n. Khi má»™t `mutation` hoáº·c má»™t truy váº¥n thÃ nh cÃ´ng (vá»›i tÃ¹y chá»n "onSuccess"), React Query sáº½ tá»± Ä‘á»™ng lÃ m má»›i cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong `"refetchQueries"`.

- VÃ­ dá»¥:

```jsx
const createPost = async (newPost) => {
  // Gá»­i yÃªu cáº§u Ä‘á»ƒ táº¡o bÃ i viáº¿t má»›i

  // LÃ m má»›i cÃ¡c truy váº¥n liÃªn quan sau khi táº¡o bÃ i viáº¿t thÃ nh cÃ´ng
  queryClient.refetchQueries(['posts', 'userPosts'])
}
```

- Trong vÃ­ dá»¥ trÃªn, sau khi táº¡o bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ lÃ m má»›i hai truy váº¥n cÃ³ keys lÃ  `'posts'` vÃ  `'userPosts'`. CÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c gá»­i láº¡i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u.

- Qua Ä‘Ã³, `"refetchQueries"` cung cáº¥p má»™t cÃ¡ch linh hoáº¡t hÆ¡n Ä‘á»ƒ lÃ m má»›i nhiá»u truy váº¥n cÃ¹ng má»™t lÃºc sau khi cÃ³ sá»± thay Ä‘á»•i trong dá»¯ liá»‡u.

## âŒâŒ Giáº£i thÃ­ch Ã½ nÃ y trong Ä‘oáº¡n trÃªn: - Trong vÃ­ dá»¥ trÃªn, sau khi táº¡o bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ lÃ m má»›i hai truy váº¥n cÃ³ keys lÃ  `'posts'` vÃ  `'userPosts'`. CÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c gá»­i láº¡i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u ? CÃ³ nghÄ©a lÃ  nÃ³ láº¥y dá»¯ liá»‡u má»›i nháº¥t Ä‘á»ƒ nÃ³ lÆ°u trong `cache` hay lÃ  nÃ³ `render` lÃªn giao diá»‡n ngÆ°á»i dÃ¹ng ?

- Khi sá»­ dá»¥ng `"refetchQueries"` trong React Query, nÃ³ sáº½ gá»­i láº¡i cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong danh sÃ¡ch `refetchQueries` Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« nguá»“n dá»¯ liá»‡u trÃªn server. Sau Ä‘Ã³, dá»¯ liá»‡u má»›i Ä‘Æ°á»£c nháº­n sáº½ Ä‘Æ°á»£c lÆ°u trong cache cá»§a React Query vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng.

- VÃ­ dá»¥, khi chÃºng ta táº¡o má»™t bÃ i viáº¿t má»›i thÃ nh cÃ´ng, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng `"refetchQueries"` Ä‘á»ƒ gá»­i láº¡i cÃ¡c truy váº¥n `'posts'` vÃ  `'userPosts'` Ä‘á»ƒ láº¥y danh sÃ¡ch bÃ i viáº¿t má»›i nháº¥t. Khi cÃ¡c truy váº¥n nÃ y thÃ nh cÃ´ng, dá»¯ liá»‡u má»›i sáº½ Ä‘Æ°á»£c lÆ°u trong cache cá»§a React Query. Sau Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng dá»¯ liá»‡u má»›i nÃ y Ä‘á»ƒ cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng, hiá»ƒn thá»‹ danh sÃ¡ch bÃ i viáº¿t má»›i nháº¥t vÃ  cÃ¡c bÃ i viáº¿t cá»§a ngÆ°á»i dÃ¹ng tÆ°Æ¡ng á»©ng.

- TÃ³m láº¡i, `"refetchQueries"` giÃºp chÃºng ta lÃ m má»›i cÃ¡c truy váº¥n vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t tá»« server, tá»« Ä‘Ã³ lÆ°u vÃ o cache vÃ  sá»­ dá»¥ng Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng.

## Theo trÃ¬nh tá»± lÃ  nÃ³ lÆ°u vÃ o trong cache cá»§a server trÆ°á»›c rá»“i nÃ³ má»›i render lÃªn giao diá»‡n ngÆ°á»i dÃ¹ng pháº£i khÃ´ng ?

- KhÃ´ng, trong trÆ°á»ng há»£p cá»§a React Query, dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p trong cache cá»§a `server`. React Query sá»­ dá»¥ng má»™t cache riÃªng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u trÃªn phÃ­a `client`, Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi thÆ° viá»‡n React Query.

- Khi má»™t truy váº¥n Ä‘Æ°á»£c gá»­i tá»« React Query, dá»¯ liá»‡u tráº£ vá» tá»« `server` sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache cá»§a React Query trÃªn phÃ­a `client`. Sau Ä‘Ã³, dá»¯ liá»‡u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c truy xuáº¥t vÃ  sá»­ dá»¥ng mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u láº¡i Ä‘áº¿n `server`. Khi cÃ³ sá»± thay Ä‘á»•i trong dá»¯ liá»‡u hoáº·c khi chÃºng ta yÃªu cáº§u lÃ m má»›i dá»¯ liá»‡u, React Query sáº½ gá»­i yÃªu cáº§u tá»›i `server` Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t vÃ  cáº­p nháº­t láº¡i cache.

- Sau khi dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache cá»§a React Query, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ render láº¡i giao diá»‡n ngÆ°á»i dÃ¹ng. Khi cÃ³ thay Ä‘á»•i trong cache hoáº·c khi chÃºng ta gá»­i yÃªu cáº§u lÃ m má»›i dá»¯ liá»‡u, React Query sáº½ tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng dá»±a trÃªn dá»¯ liá»‡u má»›i trong cache mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u má»›i Ä‘áº¿n `server`.

- VÃ¬ váº­y, trong quÃ¡ trÃ¬nh sá»­ dá»¥ng React Query, dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  quáº£n lÃ½ trong cache cá»§a React Query trÃªn phÃ­a `client` vÃ  dÃ¹ng Ä‘á»ƒ render giao diá»‡n ngÆ°á»i dÃ¹ng mÃ  khÃ´ng tÃ¡c Ä‘á»™ng trá»±c tiáº¿p vÃ o cache cá»§a `server`.

## â“â“ `invalidateQueries` vÃ  `refetchQueries` Ä‘iá»ƒm giá»‘ng nhau cá»§a nÃ³ lÃ  gÃ¬ ?

- Cáº£ hai phÆ°Æ¡ng thá»©c `invalidateQueries` vÃ  `refetchQueries` trong React Query Ä‘á»u liÃªn quan Ä‘áº¿n viá»‡c cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n.

- Äiá»ƒm giá»‘ng nhau cá»§a hai phÆ°Æ¡ng thá»©c nÃ y lÃ  cáº£ hai Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n. Khi sá»­ dá»¥ng cáº£ `invalidateQueries` vÃ  `refetchQueries`, React Query sáº½ gá»­i cÃ¡c yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t tá»« mÃ¡y chá»§ vÃ  cáº­p nháº­t láº¡i káº¿t quáº£ truy váº¥n.

- Tuy nhiÃªn, cÃ³ má»™t sá»± khÃ¡c biá»‡t quan trá»ng giá»¯a hai phÆ°Æ¡ng thá»©c nÃ y:

1. `invalidateQueries`: PhÆ°Æ¡ng thá»©c nÃ y chá»‰ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡, nhÆ°ng khÃ´ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§. NÃ³ thÃ´ng bÃ¡o cho React Query biáº¿t ráº±ng dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n nÃ y Ä‘Ã£ khÃ´ng cÃ²n há»£p lá»‡ vÃ  cáº§n Ä‘Æ°á»£c lÃ m má»›i. React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i khi cáº§n thiáº¿t, vÃ­ dá»¥ nhÆ° khi truy cáº­p láº¡i trang hoáº·c khi sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `refetch` hoáº·c `useQueryClient`.

2. `refetchQueries`: PhÆ°Æ¡ng thá»©c nÃ y gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ cho cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Báº±ng cÃ¡ch sá»­ dá»¥ng `refetchQueries`, báº¡n cÃ³ thá»ƒ tÆ°á»ng minh yÃªu cáº§u React Query gá»­i yÃªu cáº§u má»›i vÃ  cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh ngay láº­p tá»©c.

- TÃ³m láº¡i, Ä‘iá»ƒm giá»‘ng nhau cá»§a `invalidateQueries` vÃ  `refetchQueries` lÃ  cáº£ hai Ä‘á»u liÃªn quan Ä‘áº¿n viá»‡c cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n, nhÆ°ng cÃ¡ch thá»©c vÃ  quyá»n kiá»ƒm soÃ¡t cáº­p nháº­t dá»¯ liá»‡u cá»§a chÃºng cÃ³ sá»± khÃ¡c biá»‡t.

## â“â“ `invalidateQueries` vÃ  `refetchQueries` Ä‘iá»ƒm khÃ¡c nhau cá»§a nÃ³ lÃ  gÃ¬ ?

- Äiá»ƒm khÃ¡c nhau chÃ­nh giá»¯a `invalidateQueries` vÃ  `refetchQueries` trong React Query lÃ :

1. `invalidateQueries`: PhÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡. Khi báº¡n gá»i phÆ°Æ¡ng thá»©c nÃ y, React Query sáº½ ghi nháº­n ráº±ng dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã£ khÃ´ng cÃ²n há»£p lá»‡ vÃ  cáº§n Ä‘Æ°á»£c lÃ m má»›i. Tuy nhiÃªn, phÆ°Æ¡ng thá»©c nÃ y khÃ´ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ ngay láº­p tá»©c. Thay vÃ o Ä‘Ã³, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i khi cáº§n thiáº¿t, cháº³ng háº¡n khi truy cáº­p láº¡i trang hoáº·c khi sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `refetch` hoáº·c `useQueryClient`.

2. `refetchQueries`: PhÆ°Æ¡ng thá»©c `refetchQueries` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i tá»« mÃ¡y chá»§ cho cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh. Khi báº¡n gá»i phÆ°Æ¡ng thá»©c nÃ y vÃ  chá»‰ Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n lÃ m má»›i, React Query sáº½ tá»©c thÃ¬ gá»­i yÃªu cáº§u má»›i vÃ  cáº­p nháº­t dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n Ä‘Ã³.

- Váº­y Ä‘iá»ƒm khÃ¡c nhau chÃ­nh lÃ  `invalidateQueries` chá»‰ Ä‘Ã¡nh dáº¥u truy váº¥n lÃ  khÃ´ng há»£p lá»‡, trong khi `refetchQueries` gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u má»›i ngay láº­p tá»©c cho cÃ¡c truy váº¥n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.

## â“â“ CÃ²n cÃ¡i nÃ o khÃ¡c vá»›i khÃ¡i niá»‡m trÃªn khÃ´ng ?

- Má»™t khÃ¡i niá»‡m khÃ¡c liÃªn quan Ä‘áº¿n `"invalidateQueries"` trong React Query lÃ  `"resetQueries"`. `"resetQueries"` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘áº·t láº¡i (reset) dá»¯ liá»‡u cá»§a má»™t hay nhiá»u truy váº¥n vá» tráº¡ng thÃ¡i ban Ä‘áº§u.

- Khi sá»­ dá»¥ng `"resetQueries"`, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh danh sÃ¡ch cÃ¡c truy váº¥n cáº§n Ä‘áº·t láº¡i báº±ng cÃ¡ch sá»­ dá»¥ng key cá»§a tá»«ng truy váº¥n. Khi má»™t hÃ nh Ä‘á»™ng hoáº·c má»™t sá»± kiá»‡n xáº£y ra vÃ  báº¡n muá»‘n Ä‘áº·t láº¡i dá»¯ liá»‡u cÃ¡c truy váº¥n Ä‘á»ƒ báº¯t Ä‘áº§u láº¡i tá»« tráº¡ng thÃ¡i ban Ä‘áº§u, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `"resetQueries"` Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³.

- VÃ­ dá»¥:

```jsx
const handleLogout = async () => {
  // Thá»±c hiá»‡n Ä‘Äƒng xuáº¥t

  // Äáº·t láº¡i dá»¯ liá»‡u cÃ¡c truy váº¥n liÃªn quan vá» tráº¡ng thÃ¡i ban Ä‘áº§u
  queryClient.resetQueries(['user', 'posts'])
}
```

- Trong vÃ­ dá»¥ trÃªn, khi ngÆ°á»i dÃ¹ng thá»±c hiá»‡n Ä‘Äƒng xuáº¥t (Log out), chÃºng ta sá»­ dá»¥ng `"resetQueries"` Ä‘á»ƒ Ä‘áº·t láº¡i dá»¯ liá»‡u cá»§a hai truy váº¥n cÃ³ keys lÃ  `'user'` vÃ  `'posts'`, Ä‘á»ƒ báº¯t Ä‘áº§u láº¡i tá»« tráº¡ng thÃ¡i ban Ä‘áº§u. Äiá»u nÃ y cÃ³ thá»ƒ há»¯u Ã­ch khi cáº§n Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u hiá»ƒn thá»‹ sau khi Ä‘Äƒng xuáº¥t lÃ  dá»¯ liá»‡u má»›i nháº¥t vÃ  khÃ´ng bá»‹ lÆ°u láº¡i tá»« phiÃªn Ä‘Äƒng nháº­p trÆ°á»›c.

- Tá»•ng quan, `"resetQueries"` lÃ  má»™t cÃ¡ch Ä‘á»ƒ Ä‘áº·t láº¡i dá»¯ liá»‡u cá»§a cÃ¡c truy váº¥n vá» tráº¡ng thÃ¡i ban Ä‘áº§u, trong khi `"invalidateQueries"` lÃ  má»™t cÃ¡ch Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c truy váº¥n lÃ  khÃ´ng há»£p lá»‡ vÃ  chuáº©n bá»‹ cho viá»‡c lÃ m má»›i chÃºng. Cáº£ hai Ä‘á»u giÃºp quáº£n lÃ½ vÃ  Ä‘iá»u khiá»ƒn dá»¯ liá»‡u trong React Query.

## Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query (`invalidateQueries`) trong React Query:

- Trong React Query, `invalidateQueries` lÃ  má»™t phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c cung cáº¥p bá»Ÿi `useQueryClient` Ä‘á»ƒ lÃ m má»›i (invalidate) cÃ¡c truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache. Khi chÃºng ta gá»i phÆ°Æ¡ng thá»©c nÃ y, React Query sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i tá»« nguá»“n dá»¯ liá»‡u (vÃ­ dá»¥: tá»« API).

- DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query:

1. Äáº§u tiÃªn, chÃºng ta cáº§n láº¥y instance cá»§a `queryClient` báº±ng cÃ¡ch sá»­ dá»¥ng `useQueryClient` trong component:

```jsx
import { useQueryClient } from 'react-query'

const MyComponent = () => {
  const queryClient = useQueryClient()

  // ...
}
```

2. Sau Ä‘Ã³, khi muá»‘n lÃ m má»›i má»™t hoáº·c nhiá»u truy váº¥n, chÃºng ta gá»i phÆ°Æ¡ng thá»©c `invalidateQueries` trÃªn `queryClient`:

```jsx
queryClient.invalidateQueries('todos')
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta gá»i `invalidateQueries('todos')` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`. Äiá»u nÃ y sáº½ xÃ³a káº¿t quáº£ truy váº¥n trong cache vÃ  kÃ­ch hoáº¡t láº¡i viá»‡c truy váº¥n dá»¯ liá»‡u má»›i cho cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`.

- NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ truyá»n má»™t máº£ng cÃ¡c key Ä‘á»ƒ lÃ m má»›i nhiá»u truy váº¥n cÃ¹ng má»™t lÃºc:

```jsx
queryClient.invalidateQueries(['todos', 'user', 'posts'])
```

- Trong vÃ­ dá»¥ trÃªn, chÃºng ta lÃ m má»›i cÃ¡c truy váº¥n cÃ³ key lÃ  `'todos'`, `'user'` vÃ  `'posts'`. Táº¥t cáº£ cÃ¡c truy váº¥n nÃ y sáº½ Ä‘Æ°á»£c xÃ³a khá»i cache vÃ  truy váº¥n láº¡i tá»« nguá»“n dá»¯ liá»‡u.

- `invalidateQueries` cÅ©ng há»— trá»£ má»™t sá»‘ tÃ¹y chá»n Ä‘á»ƒ Ä‘iá»u chá»‰nh cÃ¡ch lÃ m má»›i truy váº¥n, nhÆ° `exact` Ä‘á»ƒ chá»‰ lÃ m má»›i truy váº¥n chÃ­nh xÃ¡c báº±ng key hoáº·c `refetchActive` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n Ä‘ang Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng. Äá»ƒ biáº¿t thÃªm chi tiáº¿t, báº¡n cÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u chÃ­nh thá»©c cá»§a React Query.

## HÆ°á»›ng dáº«n vÃ  vÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng React Query, bao gá»“m cáº£ viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` ?

- Äá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` trong React Query, báº¡n cáº§n lÃ m nhÆ° sau:

1. Äáº§u tiÃªn, Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ cÃ i Ä‘áº·t React Query vÃ  Ä‘Ã£ import cÃ¡c hÃ m cáº§n thiáº¿t tá»« thÆ° viá»‡n:

```jsx
import { useQueryClient } from 'react-query'
```

2. Trong component cá»§a báº¡n, sá»­ dá»¥ng hook `useQueryClient` Ä‘á»ƒ láº¥y má»™t instance cá»§a `QueryClient`:

```jsx
const queryClient = useQueryClient()
```

3. BÃ¢y giá» báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `invalidateQueries` Ä‘á»ƒ lÃ m má»›i cÃ¡c truy váº¥n trong `QueryClient`. PhÆ°Æ¡ng thá»©c nÃ y nháº­n vÃ o má»™t key hoáº·c má»™t máº£ng cÃ¡c key Ä‘á»ƒ chá»‰ Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n lÃ m má»›i:

```jsx
queryClient.invalidateQueries('todos') // LÃ m má»›i truy váº¥n cÃ³ key lÃ  'todos'
queryClient.invalidateQueries(['user', userId]) // LÃ m má»›i truy váº¥n cÃ³ key lÃ  ['user', userId]
queryClient.invalidateQueries() // LÃ m má»›i táº¥t cáº£ cÃ¡c truy váº¥n trong QueryClient
```

- VÃ­ dá»¥ vá» viá»‡c sá»­ dá»¥ng `invalidateQueries`:

```jsx
import { useQuery, useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gá»i API Ä‘á»ƒ xÃ³a todo
    await deleteTodoAPI(todoId)

    // LÃ m má»›i truy váº¥n 'todos' sau khi xÃ³a
    queryClient.invalidateQueries('todos')
  }

  return (
    <div>
      {/* Hiá»ƒn thá»‹ danh sÃ¡ch todo */}
      {todos.map((todo) => (
        <div key={todo.id}>
          <span>{todo.title}</span>
          <button onClick={() => handleDeleteTodo(todo.id)}>XÃ³a</button>
        </div>
      ))}
    </div>
  )
}
```

- Trong vÃ­ dá»¥ trÃªn, khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt "XÃ³a" Ä‘á»ƒ xÃ³a má»™t todo, chÃºng ta gá»i API Ä‘á»ƒ thá»±c hiá»‡n xÃ³a todo Ä‘Ã³. Sau khi xÃ³a thÃ nh cÃ´ng, chÃºng ta sá»­ dá»¥ng `invalidateQueries` Ä‘á»ƒ lÃ m má»›i truy váº¥n 'todos', tá»« Ä‘Ã³ Ä‘áº£m báº£o ráº±ng danh sÃ¡ch todos Ä‘Æ°á»£c cáº­p nháº­t má»›i nháº¥t.

## ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ khÃ¡c vá» invalidateQueries trong react query:

-

## Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation trong React Query:

## Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query:

## Cáº­p nháº­t data query thÃ´ng qua setQueryData trong React Query:

## refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate trong React Query:

## Sá»­ dá»¥ng tÃ­nh nÄƒng prefetching query trong React Query:

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

á» video láº§n trÆ°á»›c náº¿u anh em Ä‘á»ƒ Ã½ thÃ¬ mÃ¬nh cÃ³ má»™t bug nho nhá» trong pháº§n Student Info Ä‘Ã³ lÃ  khÃ´ng hiá»ƒn thá»‹ Ä‘Ãºng gender, video nÃ y mÃ¬nh sáº½ fix luÃ´n.

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ Biáº¿t Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng Invalidate Query
ğŸ‰ Cáº­p nháº­t data cá»§a query thÃ´ng qua mutation
ğŸ‰ Hiá»ƒu cÃ¡ch sá»­ dá»¥ng tÃ­nh nÄƒng prefetching cá»§a React Query

ğŸ•°ï¸Ná»™i dung chÃ­nh

00:00 - Cáº­p nháº­t data query thÃ´ng qua setQueryData
05:38 - refetch láº¡i query thÃ´ng qua cÆ¡ cháº¿ invalidate
12:14 - SÆ° dá»¥ng tÃ­nh nÄƒng prefetching query

![SWR trong React Query](image-1.png)
