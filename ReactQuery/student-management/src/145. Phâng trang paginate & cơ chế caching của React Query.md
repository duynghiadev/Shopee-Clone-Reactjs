## ÄÃ¢y lÃ  Docs tá»± research:

## CÃ¡ch phÃ¢n trang vÃ  tá»‘i Æ°u UX vá»›i React Query ?

- Äá»ƒ phÃ¢n trang vÃ  tá»‘i Æ°u tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (UX) vá»›i React Query, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng vÃ  cÆ¡ cháº¿ cá»§a nÃ³ nhÆ° pagination vÃ  caching. DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c bÆ°á»›c cÆ¡ báº£n Ä‘á»ƒ thá»±c hiá»‡n phÃ¢n trang vÃ  tá»‘i Æ°u UX vá»›i React Query:

1. `Láº¥y dá»¯ liá»‡u theo trang:` Sá»­ dá»¥ng React Query Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« API theo tá»«ng trang. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `queryFn` Ä‘á»ƒ gá»i API vÃ  truyá»n tham sá»‘ trang (vÃ­ dá»¥: page, limit) Ä‘á»ƒ chá»‰ Ä‘á»‹nh dá»¯ liá»‡u cáº§n láº¥y.

2. `Sá»­ dá»¥ng cache vÃ  stale time:` Sá»­ dá»¥ng cache cá»§a React Query Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u Ä‘Ã£ láº¥y tá»« API trÆ°á»›c Ä‘Ã³. Äáº·t thá»i gian `stale` (thá»i gian háº¿t háº¡n) phÃ¹ há»£p Ä‘á»ƒ kiá»ƒm soÃ¡t thá»i gian `cache` dá»¯ liá»‡u. Khi ngÆ°á»i dÃ¹ng chuyá»ƒn trang hoáº·c yÃªu cáº§u dá»¯ liá»‡u má»›i, React Query sáº½ sá»­ dá»¥ng dá»¯ liá»‡u `cache` trÆ°á»›c khi gá»­i yÃªu cáº§u tá»›i `server`, tá»‘i Æ°u hÃ³a thá»i gian pháº£n há»“i vÃ  giáº£m táº£i cho `server`.

3. `Sá»­ dá»¥ng pagination vÃ  scroll loading:` Äá»‘i vá»›i danh sÃ¡ch dá»¯ liá»‡u lá»›n, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `pagination` Ä‘á»ƒ hiá»ƒn thá»‹ tá»«ng trang dá»¯ liá»‡u. React Query cung cáº¥p cÃ¡c tÃ¹y chá»n nhÆ° `offset`, `limit`, hoáº·c `cursor` Ä‘á»ƒ Ä‘á»‹nh rÃµ cÃ¡c trang dá»¯ liá»‡u. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c thÃ nh pháº§n UI nhÆ° nÃºt `"Trang trÆ°á»›c"` vÃ  `"Trang tiáº¿p"` Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng giá»¯a cÃ¡c trang. NgoÃ i ra, báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng `scroll loading` Ä‘á»ƒ tá»± Ä‘á»™ng táº£i thÃªm dá»¯ liá»‡u khi ngÆ°á»i dÃ¹ng cuá»™n Ä‘áº¿n cuá»‘i danh sÃ¡ch.

4. `Xá»­ lÃ½ tráº¡ng thÃ¡i loading vÃ  error:` Khi láº¥y dá»¯ liá»‡u má»›i hoáº·c chuyá»ƒn trang, sá»­ dá»¥ng tráº¡ng thÃ¡i `loading` Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o hoáº·c biá»ƒu tÆ°á»£ng cho ngÆ°á»i dÃ¹ng biáº¿t ráº±ng dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c táº£i. Náº¿u cÃ³ lá»—i xáº£y ra, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i hoáº·c cho phÃ©p ngÆ°á»i dÃ¹ng thá»­ láº¡i. React Query cung cáº¥p cÃ¡c tráº¡ng thÃ¡i nhÆ° `isLoading`, `isError` Ä‘á»ƒ giÃºp báº¡n xá»­ lÃ½ cÃ¡c tráº¡ng thÃ¡i nÃ y má»™t cÃ¡ch dá»… dÃ ng.

5. `Cung cáº¥p cÃ¡c chá»©c nÄƒng tÆ°Æ¡ng tÃ¡c:` Äá»ƒ tá»‘i Æ°u UX, báº¡n cÃ³ thá»ƒ cung cáº¥p cÃ¡c chá»©c nÄƒng tÆ°Æ¡ng tÃ¡c nhÆ° tÃ¬m kiáº¿m, sáº¯p xáº¿p vÃ  bá»™ lá»c. Sá»­ dá»¥ng React Query Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u dá»±a trÃªn cÃ¡c tÆ°Æ¡ng tÃ¡c nÃ y vÃ  tá»± Ä‘á»™ng `refresh` danh sÃ¡ch khi dá»¯ liá»‡u thay Ä‘á»•i.

6. `TÃ¹y chá»‰nh UI vÃ  tÆ°Æ¡ng tÃ¡c:` Sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n UI hoáº·c tá»± thiáº¿t káº¿ UI Ä‘á»ƒ táº¡o giao diá»‡n phÃ¢n trang vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u. React Query khÃ´ng Ä‘á»‹nh sáºµn giao diá»‡n, cho phÃ©p báº¡n tÃ¹y chá»‰nh vÃ  tÃ­ch há»£p vá»›i cÃ¡c thÃ nh pháº§n UI khÃ¡c theo Ã½ muá»‘n.

- TÃ³m láº¡i, React Query cung cáº¥p cÃ¡c tÃ­nh nÄƒng vÃ  cÆ¡ cháº¿ Ä‘á»ƒ phÃ¢n trang vÃ  tá»‘i Æ°u UX khi lÃ m viá»‡c vá»›i dá»¯ liá»‡u. Báº±ng cÃ¡ch sá»­ dá»¥ng `cache`, `pagination` vÃ  cÃ¡c tráº¡ng thÃ¡i cá»§a React Query, báº¡n cÃ³ thá»ƒ cung cáº¥p tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng tá»‘t hÆ¡n khi lÃ m viá»‡c vá»›i danh sÃ¡ch dá»¯ liá»‡u lá»›n.

## Nhá»¯ng state quan trá»ng trong React Query ?

- Trong React Query, cÃ³ má»™t sá»‘ state quan trá»ng mÃ  báº¡n cáº§n quan tÃ¢m khi lÃ m viá»‡c vá»›i dá»¯ liá»‡u. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ state quan trá»ng trong React Query:

1. `isLoading:` State nÃ y cho biáº¿t liá»‡u query Ä‘ang trong quÃ¡ trÃ¬nh táº£i dá»¯ liá»‡u tá»« server hay khÃ´ng. Khi `isLoading` lÃ  `true`, báº¡n cÃ³ thá»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o hoáº·c biá»ƒu tÆ°á»£ng `"Loading"` Ä‘á»ƒ thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng.

2. `isError:` State nÃ y xÃ¡c Ä‘á»‹nh xem query cÃ³ gáº·p lá»—i khi táº£i dá»¯ liá»‡u hay khÃ´ng. Khi `isError` lÃ  `true`, báº¡n cÃ³ thá»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i hoáº·c xá»­ lÃ½ lá»—i má»™t cÃ¡ch thÃ­ch há»£p.

3. `data:` State nÃ y chá»©a dá»¯ liá»‡u Ä‘Æ°á»£c tráº£ vá» tá»« `server`. Khi query thÃ nh cÃ´ng, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c lÆ°u trong `data` vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn giao diá»‡n.

4. `error:` State nÃ y chá»©a thÃ´ng tin vá» lá»—i náº¿u cÃ³. Náº¿u `isError` lÃ  `true`, báº¡n cÃ³ thá»ƒ truy cáº­p vÃ o `error` Ä‘á»ƒ láº¥y thÃ´ng tin vá» lá»—i vÃ  hiá»ƒn thá»‹ nÃ³ cho ngÆ°á»i dÃ¹ng.

5. `isFetching:` State nÃ y cho biáº¿t liá»‡u `query` Ä‘ang trong quÃ¡ trÃ¬nh `fetch ngáº§m` hay khÃ´ng. Khi `isFetching` lÃ  `true`, cÃ³ nghÄ©a lÃ  `query` Ä‘ang thá»±c hiá»‡n má»™t `fetch ngáº§m` Ä‘á»ƒ kiá»ƒm tra xem cÃ³ dá»¯ liá»‡u má»›i hay khÃ´ng.

6. `isStale:` State nÃ y cho biáº¿t liá»‡u dá»¯ liá»‡u hiá»‡n táº¡i cÃ³ háº¿t háº¡n (`stale`) hay khÃ´ng. Khi `isStale` lÃ  `true`, báº¡n cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh cÃ³ nÃªn lÃ m má»›i dá»¯ liá»‡u hay khÃ´ng Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u luÃ´n cáº­p nháº­t.

7. `status:` State nÃ y xÃ¡c Ä‘á»‹nh `tráº¡ng thÃ¡i tá»•ng quÃ¡t` cá»§a `query`. CÃ¡c giÃ¡ trá»‹ thÃ´ng thÆ°á»ng cá»§a `status` bao gá»“m `"loading"`, `"success"`, `"error"` vÃ  `"idle"`. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `status` Ä‘á»ƒ kiá»ƒm soÃ¡t luá»“ng xá»­ lÃ½ vÃ  hiá»ƒn thá»‹ giao diá»‡n phÃ¹ há»£p.

- CÃ¡c state nÃ y lÃ  cÃ¡c biáº¿n quan trá»ng trong React Query Ä‘á»ƒ báº¡n cÃ³ thá»ƒ theo dÃµi tráº¡ng thÃ¡i vÃ  xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng tÆ°Æ¡ng á»©ng.

## CÆ¡ cháº¿ caching cá»§a React Query ?

- CÆ¡ cháº¿ caching cá»§a React Query cho phÃ©p lÆ°u trá»¯ dá»¯ liá»‡u trÆ°á»›c Ä‘Ã³ tá»« cÃ¡c truy váº¥n vÃ  tÃ¡i sá»­ dá»¥ng nÃ³ mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u Ä‘áº¿n server. Äiá»u nÃ y giÃºp cáº£i thiá»‡n hiá»‡u suáº¥t á»©ng dá»¥ng vÃ  giáº£m táº£i cho mÃ¡y chá»§.

- React Query sá»­ dá»¥ng má»™t cache Ä‘á»™ng Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c káº¿t quáº£ truy váº¥n. Khi má»™t truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n, káº¿t quáº£ truy váº¥n Ä‘Æ°á»£c lÆ°u trá»¯ trong cache vá»›i má»™t khÃ³a truy váº¥n (`query key`, VÃ­ dá»¥: ['todos']) duy nháº¥t. Khi cÃ¹ng má»™t truy váº¥n Ä‘Æ°á»£c gá»i láº¡i, React Query sáº½ kiá»ƒm tra cache xem liá»‡u káº¿t quáº£ truy váº¥n Ä‘Ã£ tá»“n táº¡i hay khÃ´ng. Náº¿u Ä‘Ã£ tá»“n táº¡i, káº¿t quáº£ tá»« cache Ä‘Æ°á»£c tráº£ vá» ngay láº­p tá»©c mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u Ä‘áº¿n server.

- CÆ¡ cháº¿ caching cá»§a React Query cÃ²n há»— trá»£ cÃ¡c tÃ¹y chá»n Ä‘á»ƒ quáº£n lÃ½ viá»‡c lÃ m má»›i dá»¯ liá»‡u vÃ  háº¿t háº¡n cache. CÃ¡c tÃ¹y chá»n nÃ y bao gá»“m:

  - `staleTime`: Thá»i gian háº¿t háº¡n cache. Náº¿u thá»i gian tá»« láº§n truy váº¥n trÆ°á»›c Ä‘áº¿n hiá»‡n táº¡i vÆ°á»£t quÃ¡ giÃ¡ trá»‹ nÃ y, React Query sáº½ coi káº¿t quáº£ cache lÃ  "stale" vÃ  báº¯t Ä‘áº§u gá»­i yÃªu cáº§u má»›i Ä‘áº¿n server Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u má»›i.

  - `cacheTime`: Thá»i gian lÆ°u trá»¯ cache. Káº¿t quáº£ truy váº¥n sáº½ Ä‘Æ°á»£c lÆ°u trong cache trong khoáº£ng thá»i gian nÃ y. Sau khi háº¿t háº¡n, káº¿t quáº£ cache sáº½ bá»‹ xÃ³a khá»i cache vÃ  yÃªu cáº§u má»›i sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u má»›i.

- âœ…âœ… CÆ¡ cháº¿ caching cá»§a React Query cung cáº¥p má»™t cÃ¡ch tiá»‡n lá»£i vÃ  hiá»‡u quáº£ Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u trong á»©ng dá»¥ng. NÃ³ giÃºp tá»‘i Æ°u hiá»‡u suáº¥t vÃ  tÄƒng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng báº±ng cÃ¡ch giáº£m sá»‘ lÆ°á»£ng yÃªu cáº§u gá»­i Ä‘áº¿n server vÃ  táº­n dá»¥ng dá»¯ liá»‡u cache cÃ³ sáºµn.

- PhÆ°Æ¡ng thá»©c `invalidation` trong React Query:

- Trong React Query, phÆ°Æ¡ng thá»©c `invalidation` lÃ  má»™t cÃ¡ch Ä‘á»ƒ xÃ³a dá»¯ liá»‡u cache liÃªn quan Ä‘áº¿n má»™t truy váº¥n hoáº·c má»™t nhÃ³m truy váº¥n cá»¥ thá»ƒ. `Invalidating cache` cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t tá»« server hoáº·c xÃ³a dá»¯ liá»‡u cache khÃ´ng cÃ²n há»£p lá»‡.

- React Query cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c `invalidation` sau Ä‘Ã¢y:

1. `Invalidate Query`: PhÆ°Æ¡ng thá»©c `invalidateQueries` cho phÃ©p báº¡n xÃ³a dá»¯ liá»‡u cache cho má»™t hoáº·c nhiá»u truy váº¥n dá»±a trÃªn `query key` hoáº·c má»™t hÃ m lá»c. VÃ­ dá»¥:

```jsx
queryClient.invalidateQueries('posts')
```

- PhÆ°Æ¡ng thá»©c trÃªn sáº½ xÃ³a dá»¯ liá»‡u cache cá»§a táº¥t cáº£ cÃ¡c truy váº¥n cÃ³ `query key` lÃ  `'posts'`.

2. `Invalidate Queries by Predicate`: PhÆ°Æ¡ng thá»©c `invalidateQueries` cÅ©ng cho phÃ©p báº¡n sá»­ dá»¥ng má»™t hÃ m lá»c Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c truy váº¥n cáº§n Ä‘Æ°á»£c xÃ³a dá»¯ liá»‡u cache. VÃ­ dá»¥:

```jsx
queryClient.invalidateQueries((query) => query.queryKey.includes('user'))
```

- PhÆ°Æ¡ng thá»©c trÃªn sáº½ xÃ³a dá»¯ liá»‡u cache cá»§a táº¥t cáº£ cÃ¡c truy váº¥n cÃ³ `query key` chá»©a tá»« `'user'`.

3. `Invalidate Query Key`: PhÆ°Æ¡ng thá»©c `invalidateQuery` cho phÃ©p báº¡n xÃ³a dá»¯ liá»‡u cache cá»§a má»™t truy váº¥n cá»¥ thá»ƒ dá»±a trÃªn `query key`. VÃ­ dá»¥:

```jsx
queryClient.invalidateQuery('posts')
```

- PhÆ°Æ¡ng thá»©c trÃªn sáº½ xÃ³a dá»¯ liá»‡u cache cá»§a truy váº¥n cÃ³ `query key` lÃ  `'posts'`.

4. `Invalidate Queries by Predicate and Exact`: PhÆ°Æ¡ng thá»©c `invalidateQueries` cÅ©ng há»— trá»£ sá»± káº¿t há»£p cá»§a hÃ m lá»c vÃ  biáº¿n `exact`. Náº¿u `exact` Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, chá»‰ cÃ³ nhá»¯ng truy váº¥n cÃ³ query key khá»›p chÃ­nh xÃ¡c sáº½ bá»‹ xÃ³a dá»¯ liá»‡u cache. VÃ­ dá»¥:

```jsx
queryClient.invalidateQueries((query) => query.queryKey.startsWith('post'), {
  exact: true
})
```

- PhÆ°Æ¡ng thá»©c trÃªn sáº½ xÃ³a dá»¯ liá»‡u cache cá»§a cÃ¡c truy váº¥n cÃ³ query key báº¯t Ä‘áº§u báº±ng `'post'` má»™t cÃ¡ch chÃ­nh xÃ¡c.

- âœ…âœ… Sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c `invalidation`, báº¡n cÃ³ thá»ƒ linh hoáº¡t xÃ³a dá»¯ liá»‡u cache theo nhu cáº§u cá»§a á»©ng dá»¥ng, Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘Æ°á»£c cáº­p nháº­t vÃ  tÆ°Æ¡ng thÃ­ch vá»›i tráº¡ng thÃ¡i má»›i nháº¥t tá»« server.

- `Optimistic Updates` trong React Query:

- `Optimistic Updates` lÃ  má»™t ká»¹ thuáº­t Ä‘Æ°á»£c sá»­ dá»¥ng trong React Query Ä‘á»ƒ tÄƒng cÆ°á»ng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng báº±ng cÃ¡ch tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c mÃ  khÃ´ng cáº§n chá» Ä‘á»£i pháº£n há»“i tá»« server. Ká»¹ thuáº­t nÃ y cho phÃ©p á»©ng dá»¥ng cáº£m nháº­n Ä‘Æ°á»£c sá»± pháº£n há»“i nhanh chÃ³ng vÃ  trÃ¡nh tráº¡ng thÃ¡i cháº­m trong quÃ¡ trÃ¬nh gá»­i vÃ  nháº­n dá»¯ liá»‡u tá»« server.

- CÆ¡ cháº¿ `Optimistic Updates` trong React Query hoáº¡t Ä‘á»™ng nhÆ° sau:

1. Khi ngÆ°á»i dÃ¹ng thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng, cháº³ng háº¡n nhÆ° táº¡o, cáº­p nháº­t hoáº·c xÃ³a má»™t tÃ i nguyÃªn, á»©ng dá»¥ng sáº½ thá»±c hiá»‡n má»™t thay Ä‘á»•i tráº¡ng thÃ¡i giao diá»‡n má»™t cÃ¡ch táº¡m thá»i, dá»±a trÃªn giáº£ Ä‘á»‹nh ráº±ng hÃ nh Ä‘á»™ng sáº½ thÃ nh cÃ´ng.

2. Trong cÃ¹ng thá»i gian, á»©ng dá»¥ng gá»­i yÃªu cáº§u tá»›i server Ä‘á»ƒ thá»±c hiá»‡n hÃ nh Ä‘á»™ng tÆ°Æ¡ng á»©ng.

3. Náº¿u server pháº£n há»“i thÃ nh cÃ´ng, á»©ng dá»¥ng sáº½ cáº­p nháº­t tráº¡ng thÃ¡i giao diá»‡n vá»›i dá»¯ liá»‡u má»›i nháº­n Ä‘Æ°á»£c tá»« server.

4. Náº¿u server pháº£n há»“i khÃ´ng thÃ nh cÃ´ng, á»©ng dá»¥ng sáº½ hoÃ n nguyÃªn tráº¡ng thÃ¡i giao diá»‡n vá» tráº¡ng thÃ¡i trÆ°á»›c hÃ nh Ä‘á»™ng vÃ  hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cho ngÆ°á»i dÃ¹ng.

- Äiá»ƒm máº¡nh cá»§a `Optimistic Updates` trong React Query lÃ  kháº£ nÄƒng cung cáº¥p pháº£n há»“i ngay láº­p tá»©c cho ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cáº§n chá» Ä‘á»£i server pháº£n há»“i. Äiá»u nÃ y giÃºp tÄƒng tá»‘c Ä‘á»™ vÃ  cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng, giÃºp há» cÃ³ cáº£m giÃ¡c á»©ng dá»¥ng Ä‘Ã¡p á»©ng nhanh chÃ³ng vÃ  mÆ°á»£t mÃ .

- Tuy nhiÃªn, `Optimistic Updates` cÅ©ng Ä‘áº·t ra má»™t sá»‘ thÃ¡ch thá»©c. Viá»‡c duy trÃ¬ Ä‘á»“ng bá»™ giá»¯a tráº¡ng thÃ¡i giao diá»‡n vÃ  dá»¯ liá»‡u trÃªn server lÃ  quan trá»ng. Náº¿u server pháº£n há»“i khÃ´ng thÃ nh cÃ´ng hoáº·c cÃ³ cÃ¡c váº¥n Ä‘á» xáº£y ra, á»©ng dá»¥ng pháº£i cÃ³ kháº£ nÄƒng hoÃ n nguyÃªn tráº¡ng thÃ¡i vÃ  Ä‘á»“ng bá»™ hÃ³a vá»›i dá»¯ liá»‡u má»›i nháº¥t tá»« server.

- React Query cung cáº¥p cÃ¡c cÃ´ng cá»¥ vÃ  phÆ°Æ¡ng phÃ¡p Ä‘á»ƒ há»— trá»£ viá»‡c triá»ƒn khai `Optimistic Updates` má»™t cÃ¡ch dá»… dÃ ng vÃ  an toÃ n trong á»©ng dá»¥ng cá»§a báº¡n. Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c khÃ¡i niá»‡m nhÆ° query `invalidation`, `optimistic mutations` vÃ  `updating queries`, báº¡n cÃ³ thá»ƒ xá»­ lÃ½ cÃ¡c trÆ°á»ng há»£p thÃ nh cÃ´ng vÃ  khÃ´ng thÃ nh cÃ´ng má»™t cÃ¡ch linh hoáº¡t vÃ  Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n giá»¯a dá»¯ liá»‡u vÃ  giao diá»‡n ngÆ°á»i dÃ¹ng.

## âŒâŒ LÆ°u Ã½:

- Cáº£ hai dÃ²ng `queryClient.invalidateQueries('posts')` vÃ  `queryClient.invalidateQuery('posts')` trong React Query cÃ³ chá»©c nÄƒng tÆ°Æ¡ng tá»± nhau nhÆ°ng cÃ³ sá»± khÃ¡c biá»‡t nhá» vá» cÃ¡ch sá»­ dá»¥ng.

1. `queryClient.invalidateQueries('posts')`: DÃ²ng nÃ y sáº½ gá»­i má»™t yÃªu cáº§u Ä‘á»ƒ lÃ m má»›i (invalidate) táº¥t cáº£ cÃ¡c truy váº¥n (queries) cÃ³ tÃªn `'posts'`. NÃ³ sáº½ xÃ³a dá»¯ liá»‡u cache hiá»‡n cÃ³ cho táº¥t cáº£ cÃ¡c truy váº¥n `'posts'` vÃ  khi gá»i láº¡i, React Query sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n truy váº¥n má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t.

2. `queryClient.invalidateQuery('posts')`: DÃ²ng nÃ y sáº½ gá»­i yÃªu cáº§u Ä‘á»ƒ lÃ m má»›i (invalidate) chá»‰ má»™t truy váº¥n cÃ³ tÃªn `'posts'`. NÃ³ chá»‰ xÃ³a dá»¯ liá»‡u cache cho truy váº¥n `'posts'` cá»¥ thá»ƒ vÃ  khi gá»i láº¡i, React Query sáº½ thá»±c hiá»‡n má»™t truy váº¥n má»›i Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t cho truy váº¥n Ä‘Ã³.

- VÃ¬ váº­y, Ä‘iá»ƒm khÃ¡c biá»‡t chÃ­nh giá»¯a hai dÃ²ng nÃ y lÃ  pháº¡m vi cá»§a viá»‡c lÃ m má»›i dá»¯ liá»‡u.

  - `invalidateQueries` lÃ m má»›i táº¥t cáº£ cÃ¡c truy váº¥n cÃ³ tÃªn `'posts`', trong khi `invalidateQuery` chá»‰ lÃ m má»›i truy váº¥n `'posts'` cá»¥ thá»ƒ.
  - `invalidateQueries` nÃ³ nháº­n má»™t khÃ³a truy váº¥n hoáº·c má»™t máº£ng cÃ¡c khÃ³a truy váº¥n lÃ m Ä‘á»‘i sá»‘ `invalidateQueries` cÃ¡c truy váº¥n Ä‘Æ°á»£c liÃªn káº¿t vá»›i cÃ¡c khÃ³a Ä‘Ã³. Äiá»u nÃ y cÃ³ thá»ƒ há»¯u Ã­ch khi báº¡n cÃ³ nhiá»u truy váº¥n phá»¥ thuá»™c vÃ o cÃ¹ng má»™t dá»¯ liá»‡u vÃ  báº¡n muá»‘n `invalidateQueries`.

- âŒâŒ NhÆ°ng trong Docs cá»§a React Query thÃ¬ chá»‰ cÃ³ `invalidateQueries` thÃ´i. KhÃ´ng cÃ³ `invalidateQuery`. Nhá»› nhÃ© !!

## CÆ¡ cháº¿ phÃ¢n trang trong React Query ?

- CÆ¡ cháº¿ phÃ¢n trang trong React Query lÃ  má»™t cÃ¡ch Ä‘á»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u trang web theo tá»«ng trang nhá», giÃºp tá»‘i Æ°u hiá»‡u suáº¥t vÃ  cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng khi lÃ m viá»‡c vá»›i táº­p dá»¯ liá»‡u lá»›n.

- CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a cÆ¡ cháº¿ phÃ¢n trang trong React Query thÆ°á»ng Ä‘Æ°á»£c thá»±c hiá»‡n nhÆ° sau:

1. `Truy váº¥n ban Ä‘áº§u:` Báº¡n thá»±c hiá»‡n má»™t truy váº¥n ban Ä‘áº§u Ä‘á»ƒ láº¥y dá»¯ liá»‡u trang Ä‘áº§u tiÃªn tá»« server. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng hook `useQuery` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n nÃ y.

2. `LÆ°u trá»¯ vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u:` Khi dá»¯ liá»‡u Ä‘Æ°á»£c tráº£ vá» tá»« server, React Query sáº½ lÆ°u trá»¯ nÃ³ trong bá»™ cache. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c state vÃ  hÃ m cung cáº¥p bá»Ÿi React Query Ä‘á»ƒ truy xuáº¥t vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u nÃ y trong giao diá»‡n ngÆ°á»i dÃ¹ng.

3. `Chuyá»ƒn Ä‘á»•i trang:` Khi ngÆ°á»i dÃ¹ng chuyá»ƒn Ä‘á»•i sang trang tiáº¿p theo hoáº·c trang trÆ°á»›c Ä‘Ã³, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tham sá»‘ trong truy váº¥n (nhÆ° sá»‘ trang, kÃ­ch thÆ°á»›c trang, vá»‹ trÃ­ báº¯t Ä‘áº§u...) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u cáº§n láº¥y tá»« cache hoáº·c gá»­i yÃªu cáº§u má»›i Ä‘áº¿n server.

4. `Fetch dá»¯ liá»‡u má»›i:` Náº¿u dá»¯ liá»‡u cáº§n hiá»ƒn thá»‹ khÃ´ng cÃ³ trong cache hoáº·c Ä‘Ã£ háº¿t háº¡n, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘áº¿n server Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng hook `useQuery` vÃ  cung cáº¥p cÃ¡c tham sá»‘ nhÆ° `query key` vÃ  `query function` Ä‘á»ƒ thá»±c hiá»‡n viá»‡c nÃ y.

5. `Cáº­p nháº­t vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i:` Khi dá»¯ liá»‡u má»›i Ä‘Æ°á»£c tráº£ vá» tá»« server, React Query sáº½ cáº­p nháº­t nÃ³ trong cache vÃ  tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘á»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c state vÃ  hÃ m cung cáº¥p bá»Ÿi React Query Ä‘á»ƒ truy xuáº¥t vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i nÃ y.

- CÆ¡ cháº¿ phÃ¢n trang trong React Query giÃºp báº¡n quáº£n lÃ½ dá»¯ liá»‡u phÃ¢n trang má»™t cÃ¡ch dá»… dÃ ng vÃ  hiá»‡u quáº£. NÃ³ cung cáº¥p cÃ¡c cÃ´ng cá»¥ vÃ  tÃ­nh nÄƒng Ä‘á»ƒ truy xuáº¥t vÃ  cáº­p nháº­t dá»¯ liá»‡u phÃ¢n trang, Ä‘á»“ng thá»i giáº£m táº£i cho server vÃ  tÄƒng tá»‘c Ä‘á»™ hiá»ƒn thá»‹ dá»¯ liá»‡u cho ngÆ°á»i dÃ¹ng.

## CÃ³ nghÄ©a lÃ  láº§n Ä‘áº§u nÃ³ láº¥y táº¥t cáº£ cÃ¡c data tá»« server, xong sau Ä‘Ã³ nÃ³ chia nhá» ra tá»«ng trang vÃ  render data ra háº£ ?

- ÄÃºng, cÆ¡ cháº¿ phÃ¢n trang trong React Query thÆ°á»ng báº¯t Ä‘áº§u báº±ng viá»‡c láº¥y táº¥t cáº£ dá»¯ liá»‡u tá»« server trong láº§n truy váº¥n ban Ä‘áº§u. Sau Ä‘Ã³, dá»¯ liá»‡u nÃ y Ä‘Æ°á»£c chia nhá» thÃ nh cÃ¡c trang Ä‘á»ƒ hiá»ƒn thá»‹ vÃ  truy cáº­p dá»… dÃ ng.

- Khi dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c láº¥y vá», React Query sáº½ lÆ°u trá»¯ nÃ³ trong cache Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng láº¡i mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u má»›i Ä‘áº¿n server. Má»—i trang dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache vá»›i má»™t key duy nháº¥t tÆ°Æ¡ng á»©ng vá»›i cÃ¡c tham sá»‘ phÃ¢n trang, nhÆ° sá»‘ trang, kÃ­ch thÆ°á»›c trang, vá»‹ trÃ­ báº¯t Ä‘áº§u...

- Khi ngÆ°á»i dÃ¹ng chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c trang, React Query sáº½ dá»±a vÃ o cÃ¡c tham sá»‘ phÃ¢n trang Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u cáº§n hiá»ƒn thá»‹. Náº¿u dá»¯ liá»‡u Ä‘Ã£ tá»“n táº¡i trong cache vÃ  chÆ°a háº¿t háº¡n (stale), React Query sáº½ trá»±c tiáº¿p láº¥y dá»¯ liá»‡u tá»« cache vÃ  hiá»ƒn thá»‹. Äiá»u nÃ y giÃºp cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng vÃ¬ dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y nhanh chÃ³ng tá»« bá»™ nhá»› cache mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u tá»›i server.

- Náº¿u dá»¯ liá»‡u khÃ´ng cÃ³ trong cache hoáº·c Ä‘Ã£ háº¿t háº¡n, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u má»›i Ä‘áº¿n server Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i. Sau khi nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u tá»« server, React Query cáº­p nháº­t láº¡i cache vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u má»›i lÃªn giao diá»‡n ngÆ°á»i dÃ¹ng.

- Vá»›i cÆ¡ cháº¿ phÃ¢n trang cá»§a React Query, báº¡n cÃ³ thá»ƒ quáº£n lÃ½ dá»¯ liá»‡u phÃ¢n trang má»™t cÃ¡ch dá»… dÃ ng vÃ  hiá»‡u quáº£, Ä‘á»“ng thá»i tá»‘i Æ°u hÃ³a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng báº±ng cÃ¡ch láº¥y dá»¯ liá»‡u nhanh chÃ³ng tá»« cache vÃ  chá»‰ gá»­i yÃªu cáº§u má»›i khi cáº§n thiáº¿t.

## CÃ¡c khÃ¡i niá»‡m quan trá»ng trong React Query cáº§n pháº£i náº¯m vá»¯ng ?

- Äá»ƒ hiá»ƒu rÃµ vá» React Query vÃ  sá»­ dá»¥ng nÃ³ má»™t cÃ¡ch hiá»‡u quáº£, dÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ khÃ¡i niá»‡m quan trá»ng cáº§n náº¯m vá»¯ng:

- `Query:` Äáº¡i diá»‡n cho má»™t truy váº¥n dá»¯ liá»‡u. Má»—i query cÃ³ má»™t query key duy nháº¥t Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u vÃ  cÃ¡c tham sá»‘ liÃªn quan.

- `Query Key:` LÃ  má»™t giÃ¡ trá»‹ duy nháº¥t Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»™t query. Query key cÃ³ thá»ƒ lÃ  má»™t máº£ng cÃ¡c giÃ¡ trá»‹, chuá»—i, hoáº·c Ä‘á»‘i tÆ°á»£ng.

- `Query Function (queryFn):` LÃ  má»™t hÃ m chá»©a logic Ä‘á»ƒ gá»­i yÃªu cáº§u láº¥y dá»¯ liá»‡u tá»« `server`. Query function tráº£ vá» má»™t `Promise` chá»©a dá»¯ liá»‡u cáº§n láº¥y.

- `Query Result:` LÃ  káº¿t quáº£ cá»§a má»™t query, bao gá»“m cÃ¡c tráº¡ng thÃ¡i nhÆ° `isLoading` (Ä‘ang táº£i), `isError` (lá»—i), `data` (dá»¯ liá»‡u), `error` (thÃ´ng tin lá»—i), vÃ  cÃ¡c phÆ°Æ¡ng thá»©c vÃ  thuá»™c tÃ­nh khÃ¡c.

- `Query Cache:` LÃ  nÆ¡i lÆ°u trá»¯ dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n tá»« `server`. React Query sá»­ dá»¥ng `cache` Ä‘á»ƒ lÆ°u trá»¯ vÃ  quáº£n lÃ½ dá»¯ liá»‡u, giÃºp tÄƒng tá»‘c Ä‘á»™ truy váº¥n vÃ  cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

- `Query Client:` LÃ  má»™t Ä‘á»‘i tÆ°á»£ng quáº£n lÃ½ cÃ¡c truy váº¥n vÃ  `cache`. Query client cho phÃ©p thá»±c hiá»‡n cÃ¡c thao tÃ¡c nhÆ° láº¥y dá»¯ liá»‡u tá»« `cache`, cáº­p nháº­t `cache`, xÃ³a `cache`, vÃ  nhiá»u hoáº¡t Ä‘á»™ng khÃ¡c liÃªn quan Ä‘áº¿n quáº£n lÃ½ dá»¯ liá»‡u.

- `Mutation:` LÃ  má»™t tráº¡ng thÃ¡i hoáº·c hÃ nh Ä‘á»™ng Ä‘á»ƒ thay Ä‘á»•i dá»¯ liá»‡u trÃªn `server`. `Mutations` thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c nhÆ° thÃªm, sá»­a, xÃ³a dá»¯ liá»‡u.

- `Query Invalidation:` LÃ  quÃ¡ trÃ¬nh xÃ³a `cache` hoáº·c Ä‘Ã¡nh dáº¥u `cache` lÃ  khÃ´ng há»£p lá»‡ khi cÃ³ thay Ä‘á»•i dá»¯ liá»‡u trÃªn `server`. React Query tá»± Ä‘á»™ng xá»­ lÃ½ viá»‡c xÃ³a `cache` khi cáº§n thiáº¿t.

- `Query Retry:` LÃ  quÃ¡ trÃ¬nh tá»± Ä‘á»™ng thá»­ láº¡i má»™t truy váº¥n khi xáº£y ra lá»—i. React Query cung cáº¥p cÆ¡ cháº¿ `retry` tá»± Ä‘á»™ng Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng lá»—i liÃªn quan Ä‘áº¿n truy váº¥n dá»¯ liá»‡u.

- Nhá»¯ng khÃ¡i niá»‡m trÃªn giÃºp báº¡n hiá»ƒu rÃµ hÆ¡n vá» cÃ¡ch React Query hoáº¡t Ä‘á»™ng vÃ  cÃ¡ch sá»­ dá»¥ng nÃ³ trong á»©ng dá»¥ng cá»§a báº¡n.

## CÆ¡ cháº¿ Caching trong React Query ?

- CÆ¡ cháº¿ caching lÃ  má»™t pháº§n quan trá»ng trong React Query Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng. Khi má»™t truy váº¥n (query) Ä‘Æ°á»£c thá»±c hiá»‡n, dá»¯ liá»‡u tráº£ vá» tá»« server sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong cache Ä‘á»ƒ sá»­ dá»¥ng láº¡i trong tÆ°Æ¡ng lai. Khi cáº§n truy váº¥n dá»¯ liá»‡u tiáº¿p theo, React Query sáº½ trÆ°á»›c tiÃªn kiá»ƒm tra cache xem liá»‡u dá»¯ liá»‡u Ä‘Ã£ cÃ³ sáºµn hay chÆ°a. Náº¿u Ä‘Ã£ cÃ³ trong cache vÃ  váº«n cÃ²n há»£p lá»‡, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c tráº£ vá» tá»« cache mÃ  khÃ´ng cáº§n gá»­i yÃªu cáº§u lÃªn server. Äiá»u nÃ y giÃºp giáº£m táº£i cho server vÃ  tÄƒng tá»‘c Ä‘á»™ truy váº¥n.

- CÆ¡ cháº¿ caching trong React Query cÃ³ má»™t sá»‘ khÃ­a cáº¡nh quan trá»ng cáº§n lÆ°u Ã½:

- `Cache Time:` Thá»i gian cache (`cache time`) lÃ  khoáº£ng thá»i gian mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trong cache trÆ°á»›c khi Ä‘Æ°á»£c coi lÃ  háº¿t háº¡n. Máº·c Ä‘á»‹nh, thá»i gian cache lÃ  vÃ´ háº¡n, tá»©c lÃ  dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  sá»­ dá»¥ng láº¡i cho Ä‘áº¿n khi nÃ³ bá»‹ xÃ³a hoáº·c khÃ´ng cÃ²n há»£p lá»‡.

- `Stale Time:` Thá»i gian stale (`stale time`) lÃ  khoáº£ng thá»i gian mÃ  dá»¯ liá»‡u trong cache váº«n Ä‘Æ°á»£c coi lÃ  há»£p lá»‡ sau khi háº¿t háº¡n cache. Trong thá»i gian nÃ y, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c tráº£ vá» tá»« cache vÃ  Ä‘á»“ng thá»i React Query cÅ©ng gá»­i má»™t yÃªu cáº§u ngáº§m (`background request`) Ä‘áº¿n `server` Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i nháº¥t. Náº¿u dá»¯ liá»‡u má»›i Ä‘Æ°á»£c tráº£ vá» tá»« `server`, nÃ³ sáº½ Ä‘Æ°á»£c cáº­p nháº­t trong `cache` vÃ  sau Ä‘Ã³ tráº£ vá» cho á»©ng dá»¥ng.

- `Invalidate Query:` CÃ³ thá»ƒ xÃ³a `cache` hoáº·c Ä‘Ã¡nh dáº¥u `cache` lÃ  khÃ´ng há»£p lá»‡ Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘Æ°á»£c cáº­p nháº­t tá»« `server` khi cÃ³ sá»± thay Ä‘á»•i. React Query cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° `invalidateQueries` Ä‘á»ƒ xÃ³a `cache` cho má»™t hoáº·c nhiá»u query.

- `Automatic Garbage Collection:` React Query cÅ©ng cÃ³ cÆ¡ cháº¿ tá»± Ä‘á»™ng xÃ³a `cache` khÃ´ng cÃ²n sá»­ dá»¥ng Ä‘Ã³ Ä‘Æ°á»£c gá»i lÃ  `garbage collection`. Khi má»™t query khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  khÃ´ng cÃ³ thay Ä‘á»•i dá»¯ liá»‡u má»›i, `cache` cá»§a nÃ³ sáº½ Ä‘Æ°á»£c xÃ³a Ä‘á»ƒ giáº£i phÃ³ng bá»™ nhá»› vÃ  tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t.

- âœ…âœ… CÆ¡ cháº¿ `caching` trong React Query giÃºp cáº£i thiá»‡n hiá»‡u suáº¥t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng báº±ng cÃ¡ch sá»­ dá»¥ng dá»¯ liá»‡u tá»« `cache` khi cÃ³ sáºµn vÃ  tá»± Ä‘á»™ng láº¥y dá»¯ liá»‡u má»›i tá»« `server` khi cáº§n thiáº¿t.

## Cáº£i thiá»‡n UX phÃ¢n trang vá»›i `keepPreviousData` trong React Query ?

- Äá»ƒ cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng khi phÃ¢n trang dá»¯ liá»‡u trong React Query, ta cÃ³ thá»ƒ sá»­ dá»¥ng tÃ¹y chá»n `keepPreviousData`. TÃ¹y chá»n nÃ y cho phÃ©p giá»¯ láº¡i dá»¯ liá»‡u trang trÆ°á»›c khi truy váº¥n trang má»›i, giÃºp trÃ¡nh viá»‡c hiá»ƒn thá»‹ má»™t giao diá»‡n trá»‘ng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng khi Ä‘ang chá» dá»¯ liá»‡u má»›i Ä‘Æ°á»£c tráº£ vá» tá»« server.

- Khi chÃºng ta chuyá»ƒn sang trang má»›i, React Query sáº½ tá»± Ä‘á»™ng gá»­i yÃªu cáº§u truy váº¥n Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i. Trong quÃ¡ trÃ¬nh nÃ y, khi dá»¯ liá»‡u má»›i chÆ°a Ä‘Æ°á»£c tráº£ vá», chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng dá»¯ liá»‡u trang trÆ°á»›c (`dá»¯ liá»‡u tá»« cache`) Ä‘á»ƒ hiá»ƒn thá»‹ lÃªn giao diá»‡n. Äiá»u nÃ y giÃºp duy trÃ¬ giao diá»‡n khÃ´ng bá»‹ trá»‘ng vÃ  cho phÃ©p ngÆ°á»i dÃ¹ng tiáº¿p tá»¥c tÆ°Æ¡ng tÃ¡c (`interact`) vá»›i dá»¯ liá»‡u Ä‘Ã£ hiá»ƒn thá»‹.

- Äá»ƒ sá»­ dá»¥ng `keepPreviousData`, chÃºng ta cáº§n thÃªm tÃ¹y chá»n nÃ y vÃ o hook `useQuery`:

```jsx
const queryOptions = {
  keepPreviousData: true
}

const { data, isLoading, isError } = useQuery(queryKey, queryFn, queryOptions)
```

- Khi `keepPreviousData` Ä‘Æ°á»£c Ä‘áº·t thÃ nh `true`, biáº¿n `data` sáº½ giá»¯ láº¡i giÃ¡ trá»‹ cá»§a dá»¯ liá»‡u trang trÆ°á»›c trong quÃ¡ trÃ¬nh truy váº¥n dá»¯ liá»‡u má»›i. Khi dá»¯ liá»‡u má»›i Ä‘Æ°á»£c tráº£ vá», biáº¿n `data` sáº½ Ä‘Æ°á»£c cáº­p nháº­t vá»›i dá»¯ liá»‡u má»›i nháº¥t tá»« `server`.

- Vá»›i `keepPreviousData`, ngÆ°á»i dÃ¹ng sáº½ nháº­n tháº¥y ráº±ng giao diá»‡n khÃ´ng bá»‹ trá»‘ng trong quÃ¡ trÃ¬nh chuyá»ƒn trang vÃ  cÃ³ thá»ƒ tiáº¿p tá»¥c tÆ°Æ¡ng tÃ¡c vá»›i dá»¯ liá»‡u Ä‘Ã£ hiá»ƒn thá»‹. Äiá»u nÃ y cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng vÃ  giÃºp á»©ng dá»¥ng trá»Ÿ nÃªn linh hoáº¡t vÃ  thÃ¢n thiá»‡n hÆ¡n khi lÃ m viá»‡c vá»›i dá»¯ liá»‡u phÃ¢n trang.

## TÃ³m láº¡i khi phÃ¢n trang vÃ  sá»­ dá»¥ng cÆ¡ cháº¿ Caching trong React Query ?

- Khi phÃ¢n trang vÃ  sá»­ dá»¥ng cÆ¡ cháº¿ Caching trong React Query, ta cÃ³ thá»ƒ tÃ³m láº¡i nhÆ° sau:

- `PhÃ¢n trang:` React Query cung cáº¥p cÆ¡ cháº¿ phÃ¢n trang máº¡nh máº½ Ä‘á»ƒ láº¥y vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u phÃ¢n trang tá»« `server`. Ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ¹y chá»n nhÆ° `page`, `pageSize`, `offset`,... Ä‘á»ƒ chá»‰ Ä‘á»‹nh cÃ¡c thÃ´ng sá»‘ phÃ¢n trang vÃ  gá»­i yÃªu cáº§u truy váº¥n tÆ°Æ¡ng á»©ng Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« `server`.

- `Caching:` React Query tá»± Ä‘á»™ng lÆ°u trá»¯ dá»¯ liá»‡u vÃ o cache Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng vÃ  cáº£i thiá»‡n hiá»‡u nÄƒng. Khi ta truy váº¥n dá»¯ liá»‡u tá»« `server`, React Query sáº½ tá»± Ä‘á»™ng lÆ°u trá»¯ káº¿t quáº£ vÃ o cache vÃ  duy trÃ¬ nÃ³ trong má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh. Khi ta tiáº¿p tá»¥c truy váº¥n dá»¯ liá»‡u trang tiáº¿p theo, React Query sáº½ kiá»ƒm tra cache trÆ°á»›c, náº¿u cÃ³ dá»¯ liá»‡u trong cache vÃ  chÆ°a háº¿t háº¡n, nÃ³ sáº½ tráº£ vá» dá»¯ liá»‡u tá»« cache thay vÃ¬ gá»­i yÃªu cáº§u má»›i Ä‘áº¿n `server`.

- `Tá»‘i Æ°u UX:` React Query cung cáº¥p cÃ¡c tÃ¹y chá»n vÃ  kháº£ nÄƒng Ä‘á»ƒ tá»‘i Æ°u tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng khi phÃ¢n trang. Ta cÃ³ thá»ƒ sá»­ dá»¥ng `keepPreviousData` Ä‘á»ƒ giá»¯ láº¡i dá»¯ liá»‡u trang trÆ°á»›c khi truy váº¥n dá»¯ liá»‡u má»›i, giÃºp trÃ¡nh hiá»ƒn thá»‹ giao diá»‡n trá»‘ng khi Ä‘ang chá» dá»¯ liá»‡u má»›i. Ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng `suspense` vÃ  `useIsFetching` Ä‘á»ƒ hiá»ƒn thá»‹ cÃ¡c tráº¡ng thÃ¡i bÃ¡o táº£i dá»¯ liá»‡u vÃ  cáº£i thiá»‡n UX trong quÃ¡ trÃ¬nh truy váº¥n vÃ  cáº­p nháº­t dá»¯ liá»‡u.

- Tá»•ng quan, React Query cung cáº¥p cÃ¡c cÃ´ng cá»¥ vÃ  kháº£ nÄƒng máº¡nh máº½ Ä‘á»ƒ xá»­ lÃ½ phÃ¢n trang vÃ  táº­n dá»¥ng cÆ¡ cháº¿ `Caching` Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng trong á»©ng dá»¥ng React. Viá»‡c sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng nÃ y giÃºp ta dá»… dÃ ng lÃ m viá»‡c vá»›i dá»¯ liá»‡u phÃ¢n trang, giáº£m thá»i gian vÃ  cÃ´ng sá»©c phÃ¡t triá»ƒn, vÃ  mang láº¡i tráº£i nghiá»‡m tá»‘t hÆ¡n cho ngÆ°á»i dÃ¹ng.

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

Video láº§n trÆ°á»›c thÃ¬ chÃºng ta Ä‘Ã£ lÃ m xong chá»©c nÄƒng get list students rá»“i, bÃ¢y giá» chÃºng ta sáº½ hoÃ n thiá»‡n cÃ¡i page students vá»›i chá»©c nÄƒng phÃ¢n trang nhÃ©.

Sáºµn tiá»‡n tÃ¬m hiá»ƒu luÃ´n chá»©c nÄƒng caching cá»§a React Query luÃ´n ğŸ˜

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ CÃ¡ch phÃ¢n trang vÃ  tá»‘i Æ°u UX vá»›i React Query
ğŸ‰ Nhá»¯ng state quan trá»ng trong React Query
ğŸ‰ CÆ¡ cháº¿ caching cá»§a React Query

ğŸ•°ï¸Ná»™i dung chÃ­nh

```bash
00:00 - PhÃ¢n trang
16:45 - CÃ¡c khÃ¡i niá»‡m quan trá»ng
27:25 - CÆ¡ cháº¿ caching
37:09 - Cáº£i thiá»‡n UX phÃ¢n trang vá»›i keepPreviousData
40:03 - TÃ³m láº¡i
```
