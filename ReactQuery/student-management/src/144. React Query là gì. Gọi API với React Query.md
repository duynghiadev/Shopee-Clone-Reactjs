## ÄÃ¢y lÃ  Docs tá»± research:

## HÃ£y nÃªu cÃ¡c khÃ¡i niá»‡m vá» @tanstack/react-query:

## HÃ£y nÃªu cÃ¡c sá»­ dá»¥ng @tanstack/react-query trong dá»± Ã¡n:

## CÃ¡ch dÃ¹ng useQuery cÆ¡ báº£n trong React Query:

1. BÆ°á»›c Ä‘áº§u tiÃªn lÃ  cÃ i Ä‘áº·t React Query trong dá»± Ã¡n cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng npm hoáº·c yarn Ä‘á»ƒ cÃ i Ä‘áº·t:

```jsx
npm install react-query
```

hoáº·c

```jsx
yarn add react-query
```

2. Import `useQuery` tá»« thÆ° viá»‡n React Query vÃ o thÃ nh pháº§n React cá»§a báº¡n:

```jsx
import { useQuery } from 'react-query'
```

3. Sá»­ dá»¥ng `useQuery` trong thÃ nh pháº§n React cá»§a báº¡n. Äáº·t tÃªn biáº¿n vÃ  truyá»n vÃ o hai Ä‘á»‘i sá»‘: `queryKey` vÃ  `queryFn`.

```jsx
const ExampleComponent = () => {
  const { data, isLoading, error } = useQuery(queryKey, queryFn);

  // Xá»­ lÃ½ dá»¯ liá»‡u, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i hoáº·c tráº¡ng thÃ¡i loading

  return (
    // JSX cá»§a thÃ nh pháº§n
  );
};
```

4. Äiá»u chá»‰nh `queryKey` vÃ  `queryFn` theo nhu cáº§u cá»§a báº¡n.

- `queryKey`: ÄÃ¢y lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t Ä‘áº¡i diá»‡n cho truy váº¥n. NÃ³ cÃ³ thá»ƒ lÃ  má»™t chuá»—i, máº£ng hoáº·c má»™t Ä‘á»‘i tÆ°á»£ng. VÃ­ dá»¥: `'todos'`, `['todos', { userId: 1 }]`, `{ query: 'todos', userId: 1 }`.

- `queryFn`: ÄÃ¢y lÃ  má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ (`asynchronous`) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. HÃ m nÃ y tráº£ vá» má»™t Promise chá»©a dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n.

VÃ­ dá»¥:

```jsx
const queryFn = async () => {
  const response = await fetch('https://api.example.com/todos')
  const data = await response.json()
  return data
}
```

5. Sá»­ dá»¥ng `data`, `isLoading` vÃ  `error` Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u vÃ  tráº¡ng thÃ¡i cá»§a truy váº¥n trong thÃ nh pháº§n React cá»§a báº¡n.

- `data`: Chá»©a dá»¯ liá»‡u tráº£ vá» tá»« truy váº¥n. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng tin trong thÃ nh pháº§n cá»§a báº¡n.
- `isLoading`: Má»™t biáº¿n boolean cho biáº¿t liá»‡u truy váº¥n Ä‘ang trong quÃ¡ trÃ¬nh táº£i dá»¯ liá»‡u hay khÃ´ng.
- `error`: Chá»©a thÃ´ng bÃ¡o lá»—i náº¿u truy váº¥n gáº·p pháº£i lá»—i.

6. Trong JSX cá»§a thÃ nh pháº§n React, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `isLoading` Ä‘á»ƒ hiá»ƒn thá»‹ má»™t tráº¡ng thÃ¡i loading hoáº·c sá»­ dá»¥ng `data` Ä‘á»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u tráº£ vá». Xá»­ lÃ½ `error` Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i náº¿u cáº§n thiáº¿t.

- ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n vá» cÃ¡ch sá»­ dá»¥ng cÆ¡ báº£n cá»§a `useQuery` trong React Query. Báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh `queryKey` vÃ  `queryFn` theo yÃªu cáº§u cá»¥ thá»ƒ cá»§a dá»± Ã¡n cá»§a báº¡n.

## Æ¯u Ä‘iá»ƒm tuyá»‡t vá»i khi so sÃ¡nh React Query vá»›i cÃ¡ch fetch data thÃ´ng qua useEffect:

- So sÃ¡nh React Query vá»›i cÃ¡ch fetch data thÃ´ng qua `useEffect`, cÃ³ má»™t sá»‘ Æ°u Ä‘iá»ƒm tuyá»‡t vá»i mÃ  React Query mang láº¡i:

1. `Caching (Bá»™ nhá»› cache)`: React Query tá»± Ä‘á»™ng lÆ°u trá»¯ káº¿t quáº£ truy váº¥n vÃ  cung cáº¥p chÃºng tá»« bá»™ nhá»› cache khi cáº§n thiáº¿t. Khi cÃ¹ng má»™t truy váº¥n Ä‘Æ°á»£c gá»i láº¡i, React Query sáº½ tráº£ vá» dá»¯ liá»‡u tá»« cache mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i truy váº¥n máº¡ng. Äiá»u nÃ y giÃºp tiáº¿t kiá»‡m thá»i gian vÃ  tÃ i nguyÃªn máº¡ng.

2. `Invalidation (Há»§y bá» cache)`: React Query cung cáº¥p cÃ¡c phÆ°Æ¡ng phÃ¡p Ä‘á»ƒ há»§y bá» vÃ  cáº­p nháº­t cache khi cÃ³ sá»± thay Ä‘á»•i dá»¯ liá»‡u. Khi dá»¯ liá»‡u bá»‹ thay Ä‘á»•i, báº¡n cÃ³ thá»ƒ thÃ´ng bÃ¡o cho React Query Ä‘á»ƒ lÃ m má»›i cache vÃ  cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t.

3. `Auto-Refetching (Tá»± Ä‘á»™ng fetch láº¡i)`: React Query cho phÃ©p tá»± Ä‘á»™ng fetch láº¡i dá»¯ liá»‡u sau má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh hoáº·c khi cÃ³ sá»± kiá»‡n xáº£y ra. Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh cáº¥u hÃ¬nh cho truy váº¥n tá»± Ä‘á»™ng cáº­p nháº­t Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c Ä‘á»“ng bá»™ vÃ  cáº­p nháº­t má»›i nháº¥t.

4. `Optimistic Updates (Cáº­p nháº­t láº¡c quan)`: React Query cho phÃ©p cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c vÃ  sau Ä‘Ã³ lÃ m viá»‡c vá»›i dá»¯ liá»‡u báº¥t Ä‘á»“ng bá»™. Báº¡n cÃ³ thá»ƒ cáº­p nháº­t giao diá»‡n trÆ°á»›c khi truy váº¥n hoÃ n thÃ nh, mang láº¡i tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ  hÆ¡n.

5. `Error Handling (Xá»­ lÃ½ lá»—i)`: React Query há»— trá»£ xá»­ lÃ½ lá»—i má»™t cÃ¡ch linh hoáº¡t vÃ  cung cáº¥p cÃ¡c phÆ°Æ¡ng phÃ¡p Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cho ngÆ°á»i dÃ¹ng. Báº¡n cÃ³ thá»ƒ kiá»ƒm soÃ¡t cÃ¡ch xá»­ lÃ½ lá»—i vÃ  hiá»ƒn thá»‹ thÃ´ng bÃ¡o tÃ¹y chá»‰nh cho cÃ¡c trÆ°á»ng há»£p lá»—i khÃ¡c nhau.

- Tá»•ng thá»ƒ, React Query giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c quáº£n lÃ½ tráº¡ng thÃ¡i dá»¯ liá»‡u báº¥t Ä‘á»“ng bá»™, cache vÃ  xá»­ lÃ½ lá»—i trong á»©ng dá»¥ng React. NÃ³ cung cáº¥p má»™t cÃ¡ch tiáº¿p cáº­n máº¡nh máº½ vÃ  linh hoáº¡t Ä‘á»ƒ lÃ m viá»‡c vá»›i dá»¯ liá»‡u, giÃºp tÄƒng hiá»‡u suáº¥t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng cá»§a á»©ng dá»¥ng cá»§a báº¡n.

## CÃ¡ch dÃ¹ng queryKey vÃ  queryFn:

- Cáº£ hai `queryKey` vÃ  `queryFn` Ä‘á»u lÃ  cÃ¡c Ä‘á»‘i sá»‘ trong hook `useQuery` cá»§a React Query vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh truy váº¥n dá»¯ liá»‡u cá»¥ thá»ƒ.

1. queryKey:

- `queryKey` lÃ  má»™t giÃ¡ trá»‹ duy nháº¥t Ä‘áº¡i diá»‡n cho truy váº¥n. NÃ³ cÃ³ thá»ƒ lÃ  má»™t chuá»—i, máº£ng hoáº·c má»™t Ä‘á»‘i tÆ°á»£ng. `queryKey` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u cáº§n truy váº¥n vÃ  cÅ©ng lÃ  má»™t pháº§n quan trá»ng trong viá»‡c quáº£n lÃ½ bá»™ nhá»› cache cá»§a React Query.

- VÃ­ dá»¥ vá»›i má»™t chuá»—i `queryKey`:

```jsx
const { data } = useQuery('todos', fetchTodos)
```

- Trong vÃ­ dá»¥ nÃ y, `'todos'` lÃ  `queryKey` Ä‘áº¡i diá»‡n cho truy váº¥n dá»¯ liá»‡u danh sÃ¡ch cÃ´ng viá»‡c.

- VÃ­ dá»¥ vá»›i má»™t máº£ng `queryKey`:

```jsx
const { data } = useQuery(['todos', { userId: 1 }], fetchUserTodos)
```

- Trong vÃ­ dá»¥ nÃ y, `['todos', { userId: 1 }]` lÃ  `queryKey` Ä‘áº¡i diá»‡n cho truy váº¥n dá»¯ liá»‡u danh sÃ¡ch cÃ´ng viá»‡c cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ (cÃ³ `userId` lÃ  1).

- VÃ­ dá»¥ vá»›i má»™t Ä‘á»‘i tÆ°á»£ng `queryKey`:

```jsx
const { data } = useQuery({ query: 'todos', userId: 1 }, fetchUserTodos)
```

- Trong vÃ­ dá»¥ nÃ y, `{ query: 'todos', userId: 1 }` lÃ  `queryKey` Ä‘áº¡i diá»‡n cho truy váº¥n dá»¯ liá»‡u danh sÃ¡ch cÃ´ng viá»‡c cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ (cÃ³ `userId` lÃ  1).

- Báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh `queryKey` theo yÃªu cáº§u cá»¥ thá»ƒ cá»§a dá»± Ã¡n.

2. queryFn:

- `queryFn` lÃ  má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ (`asynchronous`) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. HÃ m nÃ y tráº£ vá» má»™t `Promise` chá»©a dá»¯ liá»‡u báº¡n muá»‘n truy váº¥n.

- VÃ­ dá»¥:

```jsx
const fetchTodos = async () => {
  const response = await fetch('https://api.example.com/todos')
  const data = await response.json()
  return data
}

const { data } = useQuery('todos', fetchTodos)
```

- Trong vÃ­ dá»¥ nÃ y, `fetchTodos` lÃ  má»™t `queryFn` thá»±c hiá»‡n viá»‡c gá»­i yÃªu cáº§u máº¡ng Ä‘á»ƒ láº¥y dá»¯ liá»‡u danh sÃ¡ch cÃ´ng viá»‡c tá»« má»™t API. HÃ m nÃ y tráº£ vá» má»™t `Promise` chá»©a dá»¯ liá»‡u Ä‘Æ°á»£c gá»­i vá» tá»« API.

- Báº¡n cÃ³ thá»ƒ táº¡o vÃ  tÃ¹y chá»‰nh `queryFn` Ä‘á»ƒ phÃ¹ há»£p vá»›i nhu cáº§u truy váº¥n dá»¯ liá»‡u trong dá»± Ã¡n cá»§a báº¡n.

## Fetch API vá»›i useEffect vÃ  Axios:

- DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `useEffect` vÃ  `Axios` Ä‘á»ƒ thá»±c hiá»‡n Fetch API:

```jsx
import React, { useEffect, useState } from 'react'
import axios from 'axios'

const ExampleComponent = () => {
  const [data, setData] = useState(null)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() => {
    const fetchData = async () => {
      setIsLoading(true)
      try {
        const response = await axios.get('https://api.example.com/data')
        setData(response.data)
        setIsLoading(false)
      } catch (error) {
        setError(error.message)
        setIsLoading(false)
      }
    }

    fetchData()
  }, [])

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (error) {
    return <div>Error: {error}</div>
  }

  return (
    <div>
      {data && (
        <ul>
          {data.map((item) => (
            <li key={item.id}>{item.name}</li>
          ))}
        </ul>
      )}
    </div>
  )
}

export default ExampleComponent
```

- Trong vÃ­ dá»¥ nÃ y:

- ChÃºng ta sá»­ dá»¥ng hook `useState` Ä‘á»ƒ khá»Ÿi táº¡o cÃ¡c state `data`, `isLoading`, vÃ  `error`.
- Trong `useEffect`, chÃºng ta Ä‘á»‹nh nghÄ©a hÃ m `fetchData` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. Trong trÆ°á»ng há»£p nÃ y, chÃºng ta sá»­ dá»¥ng `Axios` Ä‘á»ƒ gá»­i yÃªu cáº§u `GET` Ä‘áº¿n URL `'https://api.example.com/data'`. Khi yÃªu cáº§u thÃ nh cÃ´ng, dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y tá»« pháº£n há»“i vÃ  Ä‘Æ°á»£c lÆ°u vÃ o state `data`, `isLoading` Ä‘Æ°á»£c Ä‘áº·t vá» `false`. Náº¿u xáº£y ra lá»—i, lá»—i Ä‘Æ°á»£c lÆ°u vÃ o state `error`, `isLoading` Ä‘Æ°á»£c Ä‘áº·t vá» `false`.
- ChÃºng ta gá»i hÃ m `fetchData` trong `useEffect` má»™t láº§n duy nháº¥t báº±ng cÃ¡ch truyá»n má»™t máº£ng rá»—ng `[]` lÃ m tham sá»‘ thá»© hai. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng truy váº¥n chá»‰ Ä‘Æ°á»£c thá»±c hiá»‡n má»™t láº§n khi `component` Ä‘Æ°á»£c `render` láº§n Ä‘áº§u tiÃªn.
- Trong JSX, chÃºng ta hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."` náº¿u `isLoading` lÃ  `true`, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i náº¿u `error` tá»“n táº¡i, vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u tá»« `data` náº¿u tá»“n táº¡i.

- Vá»›i vÃ­ dá»¥ trÃªn, báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh URL cá»§a API vÃ  xá»­ lÃ½ dá»¯ liá»‡u theo nhu cáº§u cá»§a dá»± Ã¡n cá»§a báº¡n.

## Fetch data vá»›i useQuery vÃ  Axios:

- DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng `useQuery` vÃ  `Axios` Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u:

```jsx
import React from 'react'
import { useQuery } from 'react-query'
import axios from 'axios'

const ExampleComponent = () => {
  const { data, isLoading, error } = useQuery('data', fetchData)

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (error) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      {data && (
        <ul>
          {data.map((item) => (
            <li key={item.id}>{item.name}</li>
          ))}
        </ul>
      )}
    </div>
  )
}

const fetchData = async () => {
  const response = await axios.get('https://api.example.com/data')
  return response.data
}

export default ExampleComponent
```

- Trong vÃ­ dá»¥ nÃ y:

- ChÃºng ta sá»­ dá»¥ng hook `useQuery` tá»« thÆ° viá»‡n React Query Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. `useQuery` nháº­n vÃ o hai Ä‘á»‘i sá»‘: `queryKey` vÃ  `queryFn`.
- `queryKey` lÃ  má»™t chuá»—i Ä‘áº¡i diá»‡n cho truy váº¥n. Trong vÃ­ dá»¥ nÃ y, chÃºng ta Ä‘áº·t `queryKey` lÃ  `'data'`, Ä‘áº¡i diá»‡n cho truy váº¥n dá»¯ liá»‡u chung.
- `queryFn` lÃ  má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ (`asynchronous`) thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. Trong vÃ­ dá»¥ nÃ y, chÃºng ta Ä‘á»‹nh nghÄ©a hÃ m `fetchData` sá»­ dá»¥ng `Axios` Ä‘á»ƒ gá»­i yÃªu cáº§u `GET` Ä‘áº¿n URL `'https://api.example.com/data'`. HÃ m nÃ y tráº£ vá» dá»¯ liá»‡u tá»« pháº£n há»“i cá»§a yÃªu cáº§u.
- `useQuery` sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u khi component Ä‘Æ°á»£c render vÃ  tá»± Ä‘á»™ng quáº£n lÃ½ bá»™ nhá»› cache cá»§a dá»¯ liá»‡u. Khi dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c truy váº¥n trÆ°á»›c Ä‘Ã³ vÃ  váº«n cÃ²n trong thá»i gian `"stale"` Ä‘Æ°á»£c Ä‘á»‹nh cáº¥u hÃ¬nh, `useQuery` sáº½ tráº£ vá» dá»¯ liá»‡u tá»« `cache` mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i yÃªu cáº§u máº¡ng.
- Trong JSX, chÃºng ta kiá»ƒm tra tráº¡ng thÃ¡i `isLoading` Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o `"Loading..."` khi Ä‘ang táº£i dá»¯ liá»‡u. Náº¿u cÃ³ lá»—i, chÃºng ta hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i. Náº¿u khÃ´ng cÃ³ lá»—i vÃ  dá»¯ liá»‡u tá»“n táº¡i, chÃºng ta hiá»ƒn thá»‹ dá»¯ liá»‡u trong danh sÃ¡ch.

- Vá»›i vÃ­ dá»¥ trÃªn, báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh URL cá»§a API vÃ  xá»­ lÃ½ dá»¯ liá»‡u theo nhu cáº§u cá»§a dá»± Ã¡n cá»§a báº¡n.

## Vá» váº¥n Ä‘á» queryFn cháº¡y báº¥t Ä‘á»“ng bá»™:

- "khÃ´ng Ä‘á»“ng bá»™" trong ngá»¯ cáº£nh cá»§a hÃ m khÃ´ng Ä‘á»“ng bá»™ (`asynchronous`) cÃ³ nghÄ©a lÃ  hÃ m Ä‘Ã³ cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ mÃ  khÃ´ng cháº·n viá»‡c thá»±c thi cá»§a cÃ¡c tÃ¡c vá»¥ khÃ¡c.

- Trong JavaScript, khi má»™t hÃ m Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng Ä‘á»“ng bá»™ báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a `async`, nÃ³ cÃ³ kháº£ nÄƒng thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ mÃ  khÃ´ng cháº·n viá»‡c thá»±c thi cá»§a mÃ£ chÆ°Æ¡ng trÃ¬nh chÃ­nh. Thay vÃ¬ chá» Ä‘á»£i cÃ¡c tÃ¡c vá»¥ lÃ¢u hÆ¡n (nhÆ° viá»‡c gá»­i yÃªu cáº§u máº¡ng hoáº·c truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u) hoÃ n thÃ nh trÆ°á»›c khi tiáº¿p tá»¥c thá»±c hiá»‡n mÃ£ tiáº¿p theo, mÃ£ tiáº¿p tá»¥c cháº¡y trong hÃ m khÃ´ng Ä‘á»“ng bá»™ vÃ  Ä‘Æ°á»£c thá»±c thi báº¥t cháº¥p viá»‡c tÃ¡c vá»¥ Ä‘ang chá» hoÃ n thÃ nh.

- Trong vÃ­ dá»¥ sá»­ dá»¥ng `useQuery` vá»›i `queryFn`, `queryFn` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  má»™t hÃ m khÃ´ng Ä‘á»“ng bá»™ sá»­ dá»¥ng tá»« khÃ³a `async`, cho phÃ©p thá»±c hiá»‡n yÃªu cáº§u máº¡ng báº±ng `Axios` mÃ  khÃ´ng cháº·n mÃ£ chÆ°Æ¡ng trÃ¬nh chÃ­nh. Khi hÃ m khÃ´ng Ä‘á»“ng bá»™ cháº¡y, cÃ¡c tÃ¡c vá»¥ khÃ¡c trong mÃ£ chÆ°Æ¡ng trÃ¬nh váº«n cÃ³ thá»ƒ tiáº¿p tá»¥c thá»±c thi mÃ  khÃ´ng bá»‹ cháº·n. Khi yÃªu cáº§u máº¡ng hoÃ n thÃ nh vÃ  tráº£ vá» dá»¯ liá»‡u, `Promise` sáº½ Ä‘Æ°á»£c giáº£i quyáº¿t vÃ  káº¿t quáº£ sáº½ Ä‘Æ°á»£c tráº£ vá» cho `useQuery` Ä‘á»ƒ cáº­p nháº­t `state` cá»§a hook.

## HÃ£y pháº§n tÃ­ch cÃ¡c chá»©c nÄƒng trong dev tool cho React Query tá»« `@tanstack/react-query-devtools`:

- `@tanstack/react-query-devtools` lÃ  má»™t cÃ´ng cá»¥ phÃ¡t triá»ƒn (dev tool) dÃ nh cho React Query, giÃºp báº¡n theo dÃµi vÃ  phÃ¢n tÃ­ch cÃ¡c chá»©c nÄƒng quan trá»ng cá»§a React Query trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn á»©ng dá»¥ng. DÆ°á»›i Ä‘Ã¢y lÃ  phÃ¢n tÃ­ch cÃ¡c chá»©c nÄƒng chÃ­nh cá»§a dev tool nÃ y:

- `Inspect Queries`: Dev tool cho phÃ©p báº¡n xem táº¥t cáº£ cÃ¡c truy váº¥n (queries) Ä‘ang hoáº¡t Ä‘á»™ng trong á»©ng dá»¥ng cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ xem danh sÃ¡ch cÃ¡c truy váº¥n, tráº¡ng thÃ¡i cá»§a tá»«ng truy váº¥n, vÃ  thá»i gian cáº­p nháº­t gáº§n Ä‘Ã¢y nháº¥t.

- `Inspect Mutations`: BÃªn cáº¡nh cÃ¡c truy váº¥n, dev tool cÅ©ng cho phÃ©p báº¡n theo dÃµi cÃ¡c thay Ä‘á»•i (mutations) Ä‘Æ°á»£c thá»±c hiá»‡n trong á»©ng dá»¥ng. Báº¡n cÃ³ thá»ƒ xem danh sÃ¡ch cÃ¡c mutations, tráº¡ng thÃ¡i cá»§a tá»«ng mutation, vÃ  thá»i gian cáº­p nháº­t gáº§n Ä‘Ã¢y nháº¥t.

- `Inspect Cache`: Dev tool cung cáº¥p má»™t cÃ¡i nhÃ¬n sÃ¢u hÆ¡n vÃ o bá»™ nhá»› cache cá»§a React Query. Báº¡n cÃ³ thá»ƒ xem cÃ¡c khÃ³a cache, giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng, thá»i gian háº¿t háº¡n, vÃ  thÃ´ng tin khÃ¡c liÃªn quan Ä‘áº¿n cache.

- `Inspect Subscriptions`: Náº¿u á»©ng dá»¥ng cá»§a báº¡n sá»­ dá»¥ng tÃ­nh nÄƒng `Subscriptions` cá»§a React Query, dev tool sáº½ cho phÃ©p báº¡n theo dÃµi cÃ¡c `subscription` Ä‘ang hoáº¡t Ä‘á»™ng. Báº¡n cÃ³ thá»ƒ xem danh sÃ¡ch cÃ¡c `subscription`, tráº¡ng thÃ¡i cá»§a tá»«ng `subscription`, vÃ  thÃ´ng tin liÃªn quan khÃ¡c.

- `Inspect Query Client`: Dev tool cung cáº¥p thÃ´ng tin vá» `Query Client` - Ä‘á»‘i tÆ°á»£ng quáº£n lÃ½ táº¥t cáº£ cÃ¡c tráº¡ng thÃ¡i vÃ  hÃ nh vi cá»§a React Query trong á»©ng dá»¥ng cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ xem cáº¥u hÃ¬nh cá»§a `Query Client`, sá»‘ lÆ°á»£ng truy váº¥n Ä‘ang hoáº¡t Ä‘á»™ng, vÃ  thÃ´ng tin khÃ¡c liÃªn quan Ä‘áº¿n quáº£n lÃ½ tráº¡ng thÃ¡i cá»§a React Query.

- `Time Travel`: Dev tool cung cáº¥p kháº£ nÄƒng `"Time Travel"` giÃºp báº¡n xem láº¡i cÃ¡c tráº¡ng thÃ¡i trÆ°á»›c Ä‘Ã³ cá»§a cÃ¡c truy váº¥n vÃ  `mutations`. Báº¡n cÃ³ thá»ƒ chá»n má»™t thá»i Ä‘iá»ƒm cá»¥ thá»ƒ trong quÃ¡ khá»© Ä‘á»ƒ xem tráº¡ng thÃ¡i cá»§a cÃ¡c truy váº¥n vÃ  `mutations` táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³.

- `Filtering` and `Sorting`: Dev tool cho phÃ©p báº¡n lá»c vÃ  sáº¯p xáº¿p danh sÃ¡ch cÃ¡c truy váº¥n, `mutations`, `cache` vÃ  `subscriptions`. Báº¡n cÃ³ thá»ƒ tÃ¬m kiáº¿m, Ã¡p dá»¥ng bá»™ lá»c vÃ  sáº¯p xáº¿p Ä‘á»ƒ dá»… dÃ ng theo dÃµi cÃ¡c thÃ´ng tin quan trá»ng.

- `Inspect Details`: Dev tool cung cáº¥p má»™t giao diá»‡n chi tiáº¿t Ä‘á»ƒ xem thÃ´ng tin chi tiáº¿t vá» má»—i truy váº¥n, `mutation`, `cache` vÃ  `subscription`. Báº¡n cÃ³ thá»ƒ xem cÃ¡c thÃ´ng sá»‘, lá»‹ch sá»­ cáº­p nháº­t, thÃ´ng bÃ¡o lá»—i, vÃ  cÃ¡c thÃ´ng tin khÃ¡c liÃªn quan.

- Vá»›i `@tanstack/react-query-devtools`, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c chá»©c nÄƒng trÃªn Ä‘á»ƒ theo dÃµi, phÃ¢n tÃ­ch vÃ  gá»¡ lá»—i cÃ¡c truy váº¥n, `mutations` vÃ  `cache` trong React Query, giÃºp báº¡n xÃ¢y dá»±ng á»©ng dá»¥ng cháº¥t lÆ°á»£ng vÃ  tá»‘i Æ°u.

## HÃ£y giáº£i thÃ­ch chi tiáº¿t vá» queryKey trong @tanstack/react-query:

- Trong thÆ° viá»‡n `@tanstack/react-query`, `queryKey` lÃ  má»™t thuá»™c tÃ­nh quan trá»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»‹nh danh má»™t truy váº¥n trong React Query. NÃ³ lÃ  má»™t máº£ng chá»©a cÃ¡c giÃ¡ trá»‹ mÃ´ táº£ truy váº¥n, Ä‘Ã³ng vai trÃ² lÃ  "khÃ³a" Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vÃ  phÃ¢n biá»‡t cÃ¡c truy váº¥n khÃ¡c nhau trong á»©ng dá»¥ng cá»§a báº¡n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t phÃ¢n tÃ­ch chi tiáº¿t vá» `queryKey`:

1. `Äá»‹nh dáº¡ng cá»§a queryKey`: `queryKey` lÃ  má»™t máº£ng cÃ¡c giÃ¡ trá»‹. Má»—i pháº§n tá»­ trong máº£ng Ä‘áº¡i diá»‡n cho má»™t thÃ nh pháº§n cá»§a truy váº¥n vÃ  cÃ³ thá»ƒ lÃ  má»™t chuá»—i, sá»‘, Ä‘á»‘i tÆ°á»£ng hoáº·c báº¥t ká»³ kiá»ƒu dá»¯ liá»‡u nÃ o khÃ¡c.

2. `Táº¡o khÃ³a duy nháº¥t cho truy váº¥n`: `queryKey` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o má»™t khÃ³a duy nháº¥t cho truy váº¥n. Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau cho má»—i truy váº¥n, báº¡n cÃ³ thá»ƒ táº¡o ra cÃ¡c khÃ³a khÃ¡c nhau Ä‘á»ƒ phÃ¢n biá»‡t vÃ  quáº£n lÃ½ cÃ¡c truy váº¥n riÃªng biá»‡t.

3. `PhÃ¢n Ä‘oáº¡n (Segmentation)`: `queryKey` há»— trá»£ phÃ¢n Ä‘oáº¡n, cho phÃ©p báº¡n táº¡o cÃ¡c khÃ³a phá»©c táº¡p báº±ng cÃ¡ch chia nhá» truy váº¥n thÃ nh cÃ¡c pháº§n tá»­. VÃ­ dá»¥, náº¿u báº¡n muá»‘n láº¥y thÃ´ng tin má»™t sinh viÃªn vá»›i id cá»¥ thá»ƒ, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `queryKey` nhÆ° `['student', id]` Ä‘á»ƒ táº¡o khÃ³a Ä‘á»‹nh danh duy nháº¥t cho truy váº¥n Ä‘Ã³.

4. `Cáº­p nháº­t dá»¯ liá»‡u`: Khi báº¡n thay Ä‘á»•i `queryKey`, React Query hiá»ƒu ráº±ng truy váº¥n Ä‘Ã£ thay Ä‘á»•i vÃ  sáº½ thá»±c hiá»‡n truy váº¥n má»›i Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u tá»« nguá»“n dá»¯ liá»‡u má»›i. Äiá»u nÃ y giÃºp báº¡n kiá»ƒm soÃ¡t viá»‡c cáº­p nháº­t dá»¯ liá»‡u vÃ  Ä‘áº£m báº£o ráº±ng React Query sáº½ thá»±c hiá»‡n láº¡i truy váº¥n khi `queryKey` thay Ä‘á»•i.

5. `Lá»£i Ã­ch cá»§a queryKey`: Sá»­ dá»¥ng `queryKey` cho phÃ©p React Query tá»± Ä‘á»™ng quáº£n lÃ½ vÃ  theo dÃµi cÃ¡c truy váº¥n trong bá»™ nhá»› `cache`. Khi báº¡n thá»±c hiá»‡n láº¡i cÃ¹ng má»™t truy váº¥n vá»›i cÃ¹ng `queryKey`, React Query sáº½ tráº£ vá» káº¿t quáº£ tá»« bá»™ nhá»› `cache` mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i truy váº¥n. Äiá»u nÃ y giÃºp tÄƒng tá»‘c Ä‘á»™ pháº£n há»“i vÃ  giáº£m táº£i cho nguá»“n dá»¯ liá»‡u.

6. `Cáº¥u trÃºc queryKey phá»¥ thuá»™c vÃ o yÃªu cáº§u á»©ng dá»¥ng cá»§a báº¡n`: Cáº¥u trÃºc vÃ  nghÄ©a cá»§a `queryKey` phá»¥ thuá»™c vÃ o yÃªu cáº§u cá»¥ thá»ƒ cá»§a á»©ng dá»¥ng cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh `queryKey` sao cho phÃ¹ há»£p vá»›i cÃ¡ch báº¡n muá»‘n xÃ¡c Ä‘á»‹nh vÃ  phÃ¢n biá»‡t cÃ¡c truy váº¥n trong á»©ng dá»¥ng cá»§a mÃ¬nh.

- Sá»­ dá»¥ng `queryKey` chÃ­nh xÃ¡c vÃ  duy nháº¥t cho tá»«ng truy váº¥n lÃ  má»™t pháº§n quan trá»ng trong viá»‡c sá»­ dá»¥ng `@tanstack/react-query` Ä‘á»ƒ quáº£n lÃ½ vÃ  tá»‘i Æ°u hÃ³a viá»‡c truy váº¥n dá»¯ liá»‡u trong á»©ng dá»¥ng React cá»§a báº¡n.

## HÃ£y giáº£i thÃ­ch chi tiáº¿t vá» queryFn @tanstack/react-query:

- Trong thÆ° viá»‡n `@tanstack/react-query`, `queryFn` lÃ  má»™t thuá»™c tÃ­nh quan trá»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh hÃ m thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. NÃ³ Ä‘áº¡i diá»‡n cho hÃ m mÃ  React Query sáº½ gá»i khi cáº§n láº¥y dá»¯ liá»‡u má»›i tá»« nguá»“n dá»¯ liá»‡u. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t phÃ¢n tÃ­ch chi tiáº¿t vá» `queryFn`:

1. `Äá»‹nh nghÄ©a queryFn`: `queryFn` lÃ  má»™t hÃ m cÃ³ nhiá»‡m vá»¥ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u tá»« nguá»“n dá»¯ liá»‡u. HÃ m nÃ y cÃ³ thá»ƒ lÃ  má»™t hÃ m báº¥t Ä‘á»“ng bá»™ (`async`) hoáº·c Ä‘á»“ng bá»™ (`sync`) vÃ  cÃ³ thá»ƒ tráº£ vá» dá»¯ liá»‡u hoáº·c má»™t `promise` chá»©a dá»¯ liá»‡u.

2. `Tham sá»‘ cá»§a queryFn`: `queryFn` thÆ°á»ng cÃ³ cÃ¡c tham sá»‘ Ä‘áº§u vÃ o Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c thÃ´ng tin cáº§n thiáº¿t cho truy váº¥n, cháº³ng háº¡n nhÆ° `ID` cá»§a má»™t Ä‘á»‘i tÆ°á»£ng cá»¥ thá»ƒ hoáº·c cÃ¡c tham sá»‘ tÃ¹y chá»‰nh khÃ¡c. Báº¡n cÃ³ thá»ƒ truyá»n cÃ¡c tham sá»‘ nÃ y vÃ o hÃ m `queryFn` khi khai bÃ¡o truy váº¥n.

3. `Xá»­ lÃ½ lá»—i vÃ  exception`: Trong trÆ°á»ng há»£p `queryFn` tráº£ vá» má»™t `promise`, React Query sáº½ tá»± Ä‘á»™ng xá»­ lÃ½ cÃ¡c lá»—i vÃ  `exception` xáº£y ra trong quÃ¡ trÃ¬nh thá»±c hiá»‡n truy váº¥n. Náº¿u `promise` bá»‹ `reject` hoáº·c cÃ³ `exception` Ä‘Æ°á»£c `throw` ra, React Query sáº½ xá»­ lÃ½ lá»—i nÃ y vÃ  cáº­p nháº­t tráº¡ng thÃ¡i truy váº¥n tÆ°Æ¡ng á»©ng.

4. `Cáº­p nháº­t cache vÃ  káº¿t quáº£ truy váº¥n`: Khi `queryFn` hoÃ n thÃ nh vÃ  tráº£ vá» dá»¯ liá»‡u thÃ nh cÃ´ng, React Query sáº½ cáº­p nháº­t bá»™ nhá»› `cache` vÃ  lÆ°u trá»¯ káº¿t quáº£ truy váº¥n. Khi truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i vá»›i cÃ¹ng `queryKey`, React Query sáº½ kiá»ƒm tra bá»™ nhá»› `cache` trÆ°á»›c khi gá»i láº¡i `queryFn`. Náº¿u dá»¯ liá»‡u Ä‘Ã£ cÃ³ trong `cache` vÃ  váº«n cÃ²n há»£p lá»‡ (chÆ°a háº¿t háº¡n), React Query sáº½ tráº£ vá» káº¿t quáº£ tá»« `cache` mÃ  khÃ´ng cáº§n thá»±c hiá»‡n láº¡i `queryFn`.

5. `Lá»£i Ã­ch cá»§a queryFn`: Sá»­ dá»¥ng `queryFn` cho phÃ©p báº¡n tÃ¹y chá»‰nh vÃ  kiá»ƒm soÃ¡t cÃ¡ch truy váº¥n dá»¯ liá»‡u Ä‘Æ°á»£c thá»±c hiá»‡n. Báº¡n cÃ³ thá»ƒ gá»i cÃ¡c API HTTP, truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u, hoáº·c thá»±c hiá»‡n báº¥t ká»³ tÃ¡c vá»¥ nÃ o khÃ¡c Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« nguá»“n dá»¯ liá»‡u. Äiá»u nÃ y cho phÃ©p báº¡n linh hoáº¡t trong viá»‡c tÃ­ch há»£p vÃ  xá»­ lÃ½ dá»¯ liá»‡u tá»« cÃ¡c nguá»“n khÃ¡c nhau.

6. `Äáº·c Ä‘iá»ƒm cá»§a queryFn`: `queryFn` cÃ³ thá»ƒ lÃ  má»™t hÃ m `async/await` hoáº·c má»™t hÃ m tráº£ vá» `promise`. Náº¿u báº¡n sá»­ dá»¥ng má»™t hÃ m `sync`, báº¡n cÃ³ thá»ƒ trá»±c tiáº¿p tráº£ vá» dá»¯ liá»‡u. Tuy nhiÃªn, khi sá»­ dá»¥ng má»™t hÃ m `async/await`, báº¡n cáº§n `wrap` káº¿t quáº£ tráº£ vá» trong má»™t `promise`.

- Sá»­ dá»¥ng `queryFn` cho phÃ©p báº¡n tÃ¹y chá»‰nh vÃ  Ä‘iá»u khiá»ƒn quÃ¡ trÃ¬nh truy váº¥n dá»¯ liá»‡u trong `@tanstack/react-query`. Báº±ng cÃ¡ch Ä‘á»‹nh nghÄ©a vÃ  sá»­ dá»¥ng `queryFn` má»™t cÃ¡ch Ä‘Ãºng Ä‘áº¯n, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c truy váº¥n dá»¯ liá»‡u phá»©c táº¡p vÃ  táº­n dá»¥ng tá»‘i Ä‘a cÃ¡c tÃ­nh nÄƒng cá»§a thÆ° viá»‡n React Query.

## TÃ³m táº¯t vá» React Query (@tanstack/react-query):

- React Query (`@tanstack/react-query`) lÃ  má»™t thÆ° viá»‡n quáº£n lÃ½ tráº¡ng thÃ¡i vÃ  tÆ°Æ¡ng tÃ¡c dá»¯ liá»‡u trong á»©ng dá»¥ng React. DÆ°á»›i Ä‘Ã¢y lÃ  tÃ³m táº¯t vá» React Query:

1. `Caching`: React Query tá»± Ä‘á»™ng quáº£n lÃ½ bá»™ nhá»› cache Ä‘á»ƒ lÆ°u trá»¯ káº¿t quáº£ truy váº¥n dá»¯ liá»‡u. Äiá»u nÃ y giÃºp tÄƒng tá»‘c Ä‘á»™ vÃ  giáº£m viá»‡c truy váº¥n dá»¯ liá»‡u láº·p láº¡i.

2. `Truy váº¥n dá»¯ liá»‡u`: React Query cung cáº¥p hooks nhÆ° `useQuery` Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n dá»¯ liá»‡u. Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c `queryKey` vÃ  `queryFn` Ä‘á»ƒ chá»‰ Ä‘á»‹nh truy váº¥n vÃ  láº¥y dá»¯ liá»‡u tá»« nguá»“n dá»¯ liá»‡u.

3. `Mutation`: React Query há»— trá»£ `mutations` Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i dá»¯ liá»‡u nhÆ° táº¡o, cáº­p nháº­t vÃ  xÃ³a (`CREATE`, `UPDATE`, `DELETE`). Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng hooks nhÆ° `useMutation` Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c `mutations` vÃ  cáº­p nháº­t `cache` má»™t cÃ¡ch Ä‘á»“ng bá»™.

4. `Tá»± Ä‘á»™ng refresh`: React Query cho phÃ©p tá»± Ä‘á»™ng lÃ m má»›i dá»¯ liá»‡u dá»±a trÃªn cÃ¡c cáº¥u hÃ¬nh nhÆ° thá»i gian háº¿t háº¡n `cache`, thá»i gian lÃ m má»›i vÃ  phá»¥ thuá»™c (`dependency`). Äiá»u nÃ y giÃºp Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c cáº­p nháº­t vÃ  Ä‘á»“ng bá»™ vá»›i nguá»“n dá»¯ liá»‡u.

5. `Optimistic updates`: React Query há»— trá»£ `optimistic updates`, cho phÃ©p cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c dá»±a trÃªn hÃ nh Ä‘á»™ng thay Ä‘á»•i dá»¯ liá»‡u trÆ°á»›c khi káº¿t quáº£ tá»« `server` Ä‘Æ°á»£c xÃ¡c nháº­n. Náº¿u xáº£y ra lá»—i, React Query sáº½ tá»± Ä‘á»™ng hoÃ n tÃ¡c vÃ  khÃ´i phá»¥c tráº¡ng thÃ¡i trÆ°á»›c Ä‘Ã³. Ã½ nghÄ©a cá»§a tá»« nÃ y nháº±m chá»‰ sá»± lá»±a chá»n tá»‘i Æ°u vÃ  tin tÆ°á»Ÿng vÃ o káº¿t quáº£ tÃ­nh toÃ¡n hoáº·c cáº­p nháº­t dá»¯ liá»‡u.

6. `Devtools`: React Query Ä‘i kÃ¨m vá»›i cÃ´ng cá»¥ phÃ¡t triá»ƒn máº¡nh máº½ Ä‘á»ƒ giÃ¡m sÃ¡t vÃ  gá»¡ lá»—i cÃ¡c truy váº¥n vÃ  `mutations`. `Devtools` cung cáº¥p thÃ´ng tin chi tiáº¿t vá» tráº¡ng thÃ¡i vÃ  hoáº¡t Ä‘á»™ng cá»§a cÃ¡c truy váº¥n, giÃºp báº¡n xem vÃ  theo dÃµi cÃ¡c yÃªu cáº§u dá»¯ liá»‡u.

- React Query giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c lÃ m viá»‡c vá»›i dá»¯ liá»‡u (`data`) trong á»©ng dá»¥ng React, tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t vÃ  giáº£m thiá»ƒu lÆ°á»£ng mÃ£ láº·p láº¡i. NÃ³ cung cáº¥p cÃ¡c tÃ­nh nÄƒng nhÆ° `caching`, truy váº¥n dá»¯ liá»‡u (`query data`), `mutations` vÃ  tá»± Ä‘á»™ng `refresh` Ä‘á»ƒ giÃºp báº¡n quáº£n lÃ½ dá»¯ liá»‡u má»™t cÃ¡ch hiá»‡u quáº£ vÃ  linh hoáº¡t.

## TÃ³m táº¯t vá» gá»i API vá»›i React Query (@tanstack/react-query):

- React Query (`@tanstack/react-query`) cung cáº¥p cÃ¡c cÃ´ng cá»¥ vÃ  hooks Ä‘á»ƒ gá»i vÃ  quáº£n lÃ½ cÃ¡c API trong á»©ng dá»¥ng React. DÆ°á»›i Ä‘Ã¢y lÃ  tÃ³m táº¯t vá» viá»‡c gá»i API vá»›i React Query:

1. `Hooks gá»i API`: React Query cung cáº¥p hook `useQuery` Ä‘á»ƒ gá»i API vÃ  láº¥y dá»¯ liá»‡u. Báº±ng cÃ¡ch sá»­ dá»¥ng `useQuery`, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c `queryKey` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh truy váº¥n vÃ  sá»­ dá»¥ng `queryFn` Ä‘á»ƒ thá»±c hiá»‡n gá»i API.

2. `Cache tá»± Ä‘á»™ng`: React Query tá»± Ä‘á»™ng quáº£n lÃ½ bá»™ nhá»› cache Ä‘á»ƒ lÆ°u trá»¯ káº¿t quáº£ truy váº¥n dá»¯ liá»‡u. Khi truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i vá»›i cÃ¹ng `queryKey`, React Query kiá»ƒm tra cache trÆ°á»›c vÃ  tráº£ vá» káº¿t quáº£ tá»« cache náº¿u nÃ³ cÃ²n há»£p lá»‡.

3. `Thao tÃ¡c tÆ°Æ¡ng tÃ¡c`: React Query há»— trá»£ cÃ¡c thao tÃ¡c tÆ°Æ¡ng tÃ¡c nhÆ° táº¡o, cáº­p nháº­t vÃ  xÃ³a dá»¯ liá»‡u thÃ´ng qua `mutations`. Báº±ng cÃ¡ch sá»­ dá»¥ng hook `useMutation`, báº¡n cÃ³ thá»ƒ gá»i cÃ¡c `API` liÃªn quan Ä‘áº¿n thay Ä‘á»•i dá»¯ liá»‡u vÃ  cáº­p nháº­t cache má»™t cÃ¡ch Ä‘á»“ng bá»™.

4. `Tá»± Ä‘á»™ng refresh`: React Query cho phÃ©p tá»± Ä‘á»™ng lÃ m má»›i dá»¯ liá»‡u dá»±a trÃªn cÃ¡c cáº¥u hÃ¬nh nhÆ° thá»i gian háº¿t háº¡n cache, thá»i gian lÃ m má»›i vÃ  phá»¥ thuá»™c. Äiá»u nÃ y giÃºp Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c cáº­p nháº­t vÃ  Ä‘á»“ng bá»™ vá»›i nguá»“n dá»¯ liá»‡u.

5. `Optimistic updates`: React Query há»— trá»£ `optimistic updates`, cho phÃ©p cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c dá»±a trÃªn hÃ nh Ä‘á»™ng thay Ä‘á»•i dá»¯ liá»‡u trÆ°á»›c khi káº¿t quáº£ tá»« `server` Ä‘Æ°á»£c xÃ¡c nháº­n. Náº¿u xáº£y ra lá»—i, React Query sáº½ tá»± Ä‘á»™ng hoÃ n tÃ¡c vÃ  khÃ´i phá»¥c tráº¡ng thÃ¡i trÆ°á»›c Ä‘Ã³.

6. `Devtools`: React Query Ä‘i kÃ¨m vá»›i cÃ´ng cá»¥ phÃ¡t triá»ƒn máº¡nh máº½ Ä‘á»ƒ giÃ¡m sÃ¡t vÃ  gá»¡ lá»—i cÃ¡c truy váº¥n vÃ  `mutations`. `Devtools` cung cáº¥p thÃ´ng tin chi tiáº¿t vá» tráº¡ng thÃ¡i vÃ  hoáº¡t Ä‘á»™ng cá»§a cÃ¡c truy váº¥n, giÃºp báº¡n xem vÃ  theo dÃµi cÃ¡c yÃªu cáº§u dá»¯ liá»‡u.

- React Query giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c gá»i API vÃ  quáº£n lÃ½ dá»¯ liá»‡u trong á»©ng dá»¥ng React, giÃºp báº¡n tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t vÃ  tÄƒng tÃ­nh linh hoáº¡t cá»§a á»©ng dá»¥ng. Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c hooks vÃ  tÃ­nh nÄƒng cá»§a React Query, báº¡n cÃ³ thá»ƒ dá»… dÃ ng tÆ°Æ¡ng tÃ¡c vá»›i API vÃ  quáº£n lÃ½ tráº¡ng thÃ¡i dá»¯ liá»‡u má»™t cÃ¡ch hiá»‡u quáº£.

- BÃªn cáº¡nh cÃ¡c tÃ­nh nÄƒng Ä‘Ã£ Ä‘á» cáº­p, viá»‡c gá»i API vá»›i React Query (`@tanstack/react-query`) cÃ²n mang Ä‘áº¿n nhá»¯ng lá»£i Ã­ch khÃ¡c sau:

1. `Error Handling`: React Query cung cáº¥p cÆ¡ cháº¿ xá»­ lÃ½ lá»—i tÃ­ch há»£p cho cÃ¡c yÃªu cáº§u API. Báº¡n cÃ³ thá»ƒ xá»­ lÃ½ lá»—i truy váº¥n hoáº·c `mutations` báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c callback nhÆ° `onError` hoáº·c báº±ng cÃ¡ch kiá»ƒm tra tráº¡ng thÃ¡i lá»—i cá»§a truy váº¥n.

2. `Retries vÃ  Retry Policies`: React Query cho phÃ©p báº¡n xÃ¡c Ä‘á»‹nh chÃ­nh sÃ¡ch `retry` Ä‘á»ƒ tÃ¡i thá»±c hiá»‡n yÃªu cáº§u khi cÃ³ lá»—i xáº£y ra. Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a sá»‘ láº§n `retry`, khoáº£ng thá»i gian giá»¯a cÃ¡c láº§n `retry`, hoáº·c tháº­m chÃ­ xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘iá»u kiá»‡n `retry` cá»¥ thá»ƒ.

3. `Prefetching`: React Query há»— trá»£ `prefetching`, cho phÃ©p báº¡n táº£i dá»¯ liá»‡u trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c yÃªu cáº§u. Äiá»u nÃ y giÃºp cáº£i thiá»‡n thá»i gian pháº£n há»“i vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng, Ä‘áº·c biá»‡t lÃ  trong cÃ¡c trÆ°á»ng há»£p báº¡n biáº¿t trÆ°á»›c ráº±ng dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng trong tÆ°Æ¡ng lai gáº§n.

4. `Paginated Data`: React Query cung cáº¥p há»— trá»£ cho viá»‡c xá»­ lÃ½ dá»¯ liá»‡u phÃ¢n trang. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng hooks nhÆ° `useInfiniteQuery` Ä‘á»ƒ truy váº¥n vÃ  duyá»‡t qua cÃ¡c trang dá»¯ liá»‡u má»™t cÃ¡ch dá»… dÃ ng.

5. `Background Data Updates`: React Query cho phÃ©p báº¡n cáº­p nháº­t dá»¯ liá»‡u ná»n mÃ  khÃ´ng lÃ m giÃ¡n Ä‘oáº¡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `mutations` hoáº·c cáº¥u hÃ¬nh tá»± Ä‘á»™ng lÃ m má»›i Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c cáº­p nháº­t má»™t cÃ¡ch liÃªn tá»¥c.

6. `Custom Query Logic`: React Query cho phÃ©p báº¡n tÃ¹y chá»‰nh logic truy váº¥n vÃ  xá»­ lÃ½ dá»¯ liá»‡u. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c `options` vÃ  hooks nhÆ° `onSuccess`, `onSettled`, `select` Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c logic tÃ¹y chá»‰nh cho truy váº¥n vÃ  `mutations`.

- Táº¥t cáº£ nhá»¯ng lá»£i Ã­ch nÃ y khi gá»i API vá»›i React Query giÃºp báº¡n xÃ¢y dá»±ng á»©ng dá»¥ng React máº¡nh máº½, linh hoáº¡t vÃ  hiá»‡u suáº¥t cao, Ä‘á»“ng thá»i giáº£m bá»›t cÃ´ng Ä‘oáº¡n phÃ¡t triá»ƒn vÃ  tá»‘i Æ°u hÃ³a quy trÃ¬nh lÃ m viá»‡c vá»›i dá»¯ liá»‡u.

- Mutate trong React Query:

![Mutate trong React Query](image-2.png)

- React Query thay tháº¿ Redux Ä‘Æ°á»£c khÃ´ng ?

![React Query thay tháº¿ Redux Ä‘Æ°á»£c khÃ´ng ?](image-3.png)

## ÄÃ¢y lÃ  Docs cá»§a ÄÆ°á»£c Dev:

ğŸ’“Kiáº¿n thá»©c cÃ¡c báº¡n sáº½ Ä‘Æ°á»£c há»c trong video nÃ y:

ğŸ‰ CÃ¡ch dÃ¹ng useQuery cÆ¡ báº£n trong React Query
ğŸ‰ Æ¯u Ä‘iá»ƒm tuyá»‡t vá»i khi so sÃ¡nh React Query vá»›i cÃ¡ch fetch data thÃ´ng qua useEffect
ğŸ‰ CÃ¡ch dÃ¹ng queryKey vÃ  queryFn

ğŸ•°ï¸ Ná»™i dung chÃ­nh

```bash
00:00 - Giá»›i thiá»‡u vá» series
03:47 - Giá»›i thiá»‡u vá» repository
07:58 - Fetch API vá»›i useEffect vÃ  Axios
23:29 - Fetch data vá»›i useQuery vÃ  Axios
36:47 - CÃ i dev tool cho React Query
38:58 - queryKey
47:05 - queryFn
47:53 - TÃ³m táº¯t kiáº¿n thá»©c Ä‘Ã£ há»c
```

![image bÃ i 144](image.png)
