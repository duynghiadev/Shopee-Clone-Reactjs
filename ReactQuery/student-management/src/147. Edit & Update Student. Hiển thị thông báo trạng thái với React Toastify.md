## ƒê√¢y l√† Docs t·ª± research:

## S·ª≠ d·ª•ng react router k·∫øt h·ª£p v·ªõi react query ?

- Khi s·ª≠ d·ª•ng `React Router` k·∫øt h·ª£p v·ªõi `React Query`, ch√∫ng ta c√≥ th·ªÉ t·∫≠n d·ª•ng c√°c t√≠nh nƒÉng c·ªßa c·∫£ hai th∆∞ vi·ªán ƒë·ªÉ x√¢y d·ª±ng ·ª©ng d·ª•ng web ƒë√°ng tin c·∫≠y v·ªõi ph√¢n trang v√† qu·∫£n l√Ω d·ªØ li·ªáu hi·ªáu qu·∫£.

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ c√°ch s·ª≠ d·ª•ng `React Router` v√† `React Query` c√πng nhau:

1. C√†i ƒë·∫∑t `React Router` v√† `React Query`:

```bash
npm install react-router-dom react-query
```

- D√≤ng code n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ c√†i ƒë·∫∑t hai th∆∞ vi·ªán `React Router` v√† `React Query` th√¥ng qua npm (Node Package Manager).

  - `npm` l√† m·ªôt c√¥ng c·ª• qu·∫£n l√Ω g√≥i cho Node.js v√† npm Registry l√† m·ªôt kho l∆∞u tr·ªØ tr·ª±c tuy·∫øn ch·ª©a c√°c g√≥i ph·∫ßn m·ªÅm JavaScript m√† b·∫°n c√≥ th·ªÉ t·∫£i xu·ªëng v√† s·ª≠ d·ª•ng trong d·ª± √°n c·ªßa m√¨nh.
  - `install` l√† m·ªôt l·ªánh trong npm ƒë·ªÉ c√†i ƒë·∫∑t c√°c g√≥i ph·∫ßn m·ªÅm. Khi ch·∫°y l·ªánh install, npm s·∫Ω t·∫£i xu·ªëng v√† c√†i ƒë·∫∑t c√°c g√≥i ƒë∆∞·ª£c li·ªát k√™ trong d√≤ng l·ªánh v√†o d·ª± √°n c·ªßa b·∫°n.
  - `react-router-dom` l√† m·ªôt th∆∞ vi·ªán h·ªó tr·ª£ ƒë·ªãnh tuy·∫øn (`routing`) trong React. N√≥ cung c·∫•p c√°c th√†nh ph·∫ßn (`component`) v√† API ƒë·ªÉ b·∫°n c√≥ th·ªÉ x√°c ƒë·ªãnh c√°c `route` v√† hi·ªÉn th·ªã c√°c component t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng `route`.
  - `react-query` l√† m·ªôt th∆∞ vi·ªán qu·∫£n l√Ω tr·∫°ng th√°i v√† truy v·∫•n d·ªØ li·ªáu trong React. N√≥ cung c·∫•p c√°c hooks v√† API ƒë·ªÉ b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n d·ªØ li·ªáu, l∆∞u tr·ªØ k·∫øt qu·∫£ v√† qu·∫£n l√Ω cache m·ªôt c√°ch d·ªÖ d√†ng.

- Khi ch·∫°y d√≤ng l·ªánh tr√™n, npm s·∫Ω t√¨m ki·∫øm v√† t·∫£i v·ªÅ c√°c g√≥i `react-router-dom` v√† `react-query` t·ª´ npm Registry, sau ƒë√≥ c√†i ƒë·∫∑t ch√∫ng v√†o th∆∞ m·ª•c node_modules trong d·ª± √°n c·ªßa b·∫°n. Sau khi qu√° tr√¨nh c√†i ƒë·∫∑t ho√†n t·∫•t, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c th√†nh ph·∫ßn v√† API c·ªßa hai th∆∞ vi·ªán n√†y trong ·ª©ng d·ª•ng React c·ªßa m√¨nh.

2. T·∫°o c√°c components v√† ƒë·ªãnh nghƒ©a c√°c route trong ·ª©ng d·ª•ng c·ªßa b·∫°n, v√≠ d·ª•:

```jsx
import { BrowserRouter as Router, Switch, Route } from 'react-router-dom'
import { QueryClient, QueryClientProvider } from 'react-query'
import Home from './components/Home'
import PostList from './components/PostList'
import PostDetails from './components/PostDetails'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Router>
        <Switch>
          <Route exact path='/' component={Home} />
          <Route exact path='/posts' component={PostList} />
          <Route path='/posts/:id' component={PostDetails} />
        </Switch>
      </Router>
    </QueryClientProvider>
  )
}

export default App
```

- ƒêo·∫°n code tr√™n m√¥ t·∫£ c√°ch s·ª≠ d·ª•ng `React Router` v√† `React Query` trong ·ª©ng d·ª•ng React. D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch t·ª´ng ph·∫ßn c·ªßa m√£ ngu·ªìn:

- `import { BrowserRouter as Router, Switch, Route } from 'react-router-dom':` ƒê√¢y l√† c√°ch import c√°c th√†nh ph·∫ßn t·ª´ th∆∞ vi·ªán `React Router`. `BrowserRouter` ƒë∆∞·ª£c ƒë·∫∑t t√™n l·∫°i th√†nh `Router` ƒë·ªÉ s·ª≠ d·ª•ng trong m√£ ngu·ªìn.

- `import { QueryClient, QueryClientProvider } from 'react-query':` ƒê√¢y l√† c√°ch import c√°c th√†nh ph·∫ßn t·ª´ th∆∞ vi·ªán `React Query`. `QueryClient` l√† m·ªôt ƒë·ªëi t∆∞·ª£ng qu·∫£n l√Ω tr·∫°ng th√°i v√† cache c·ªßa `React Query`, v√† `QueryClientProvider` l√† m·ªôt th√†nh ph·∫ßn cung c·∫•p `QueryClient` cho c√°c th√†nh ph·∫ßn con trong ·ª©ng d·ª•ng.

- `const queryClient = new QueryClient():` ƒê√¢y l√† kh·ªüi t·∫°o m·ªôt instance c·ªßa `QueryClient`, m·ªôt ƒë·ªëi t∆∞·ª£ng qu·∫£n l√Ω tr·∫°ng th√°i v√† cache c·ªßa `React Query`. Instance n√†y s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi `QueryClientProvider` ƒë·ªÉ cung c·∫•p cho c√°c th√†nh ph·∫ßn con trong ·ª©ng d·ª•ng.

- Trong h√†m `App()`, ch√∫ng ta s·ª≠ d·ª•ng `QueryClientProvider` ƒë·ªÉ bao b·ªçc ·ª©ng d·ª•ng v√† cung c·∫•p `queryClient` cho c√°c th√†nh ph·∫ßn con. ƒêi·ªÅu n√†y cho ph√©p c√°c th√†nh ph·∫ßn con s·ª≠ d·ª•ng `React Query` ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n d·ªØ li·ªáu v√† qu·∫£n l√Ω cache.

- Ch√∫ng ta s·ª≠ d·ª•ng `Router` ƒë·ªÉ bao b·ªçc c√°c th√†nh ph·∫ßn c·ªßa ·ª©ng d·ª•ng v√† ƒë·ªãnh tuy·∫øn gi·ªØa c√°c trang. `Switch` l√† m·ªôt th√†nh ph·∫ßn c·ªßa `React Router` d√πng ƒë·ªÉ ch·ªçn ra ch·ªâ m·ªôt `Route` ph√π h·ª£p v·ªõi URL hi·ªán t·∫°i.

- Ch√∫ng ta ƒë·ªãnh nghƒ©a c√°c `Route` ƒë·ªÉ x√°c ƒë·ªãnh c√°c URL v√† th√†nh ph·∫ßn t∆∞∆°ng ·ª©ng ƒë·ªÉ hi·ªÉn th·ªã. Trong v√≠ d·ª• n√†y, ch√∫ng ta c√≥ ba `Route`:

  - `exact path='/'` cho trang ch·ªß (component `Home`).
  - `exact path='/posts'` cho danh s√°ch b√†i vi·∫øt (component `PostList`).
  - `path='/posts/:id'` cho chi ti·∫øt b√†i vi·∫øt (component `PostDetails`), trong ƒë√≥ `:id` l√† m·ªôt tham s·ªë ƒë·ªông ƒë·ªÉ x√°c ƒë·ªãnh ID c·ªßa b√†i vi·∫øt.

- Cu·ªëi c√πng, ch√∫ng ta xu·∫•t `App` ƒë·ªÉ s·ª≠ d·ª•ng trong ·ª©ng d·ª•ng ch√≠nh.

- V·ªõi c·∫•u h√¨nh n√†y, `React Router` s·∫Ω x√°c ƒë·ªãnh c√°c URL v√† hi·ªÉn th·ªã c√°c th√†nh ph·∫ßn t∆∞∆°ng ·ª©ng trong ·ª©ng d·ª•ng. `React Query` s·∫Ω cung c·∫•p kh·∫£ nƒÉng th·ª±c hi·ªán truy v·∫•n d·ªØ li·ªáu v√† qu·∫£n l√Ω cache cho c√°c th√†nh ph·∫ßn con.

3. Trong c√°c components c·ªßa b·∫°n, s·ª≠ d·ª•ng c√°c hooks c·ªßa `React Query` ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n d·ªØ li·ªáu v√† qu·∫£n l√Ω state c·ªßa ch√∫ng, v√≠ d·ª•:

```jsx
import { useQuery } from 'react-query'
import { useParams } from 'react-router-dom'

const fetchPost = async (postId) => {
  const response = await fetch(`api/posts/${postId}`)
  const data = await response.json()
  return data
}

function PostDetails() {
  const { id } = useParams()

  const { data, isLoading, isError, error } = useQuery(['post', id], () => fetchPost(id))

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post Details</h1>
      <p>ID: {data.id}</p>
      <p>Title: {data.title}</p>
      <p>Content: {data.content}</p>
    </div>
  )
}

export default PostDetails
```

- ƒêo·∫°n m√£ tr√™n m√¥ t·∫£ m·ªôt trang chi ti·∫øt b√†i vi·∫øt trong ·ª©ng d·ª•ng s·ª≠ d·ª•ng `React Query` v√† `React Router`.

  - `import { useQuery } from 'react-query'` v√† `import { useParams } from 'react-router-dom'`: ƒê√¢y l√† c√°ch import `useQuery` t·ª´ `React Query` ƒë·ªÉ th·ª±c hi·ªán truy v·∫•n d·ªØ li·ªáu v√† `useParams` t·ª´ `React Router` ƒë·ªÉ truy c·∫≠p v√†o c√°c tham s·ªë ƒë·ªông trong URL.

  - `const fetchPost = async (postId) => { ... }`: ƒê√¢y l√† h√†m `fetchPost` ƒë·ªÉ l·∫•y d·ªØ li·ªáu c·ªßa m·ªôt b√†i vi·∫øt t·ª´ API. N√≥ s·ª≠ d·ª•ng `postId` l√†m tham s·ªë ƒë·ªÉ x√°c ƒë·ªãnh b√†i vi·∫øt c·∫ßn l·∫•y. H√†m n√†y s·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i y√™u c·∫ßu GET ƒë·∫øn API v√† tr·∫£ v·ªÅ d·ªØ li·ªáu b√†i vi·∫øt d∆∞·ªõi d·∫°ng JSON. D√≤ng n√†y s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `json()` c·ªßa ƒë·ªëi t∆∞·ª£ng `response` ƒë·ªÉ chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu tr·∫£ v·ªÅ th√†nh ƒë·ªëi t∆∞·ª£ng (object) JavaScript. H√†m n√†y tr·∫£ v·ªÅ m·ªôt Promise, v√¨ v·∫≠y ch√∫ng ta s·ª≠ d·ª•ng t·ª´ kh√≥a await ƒë·ªÉ ƒë·ª£i vi·ªác chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu th√†nh c√¥ng.

  - Trong component `PostDetails`, ch√∫ng ta s·ª≠ d·ª•ng `useParams` ƒë·ªÉ l·∫•y tham s·ªë `id` t·ª´ URL. Tham s·ªë n√†y x√°c ƒë·ªãnh ID c·ªßa b√†i vi·∫øt ƒë∆∞·ª£c y√™u c·∫ßu.

  - Ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ th·ª±c hi·ªán truy v·∫•n d·ªØ li·ªáu c·ªßa b√†i vi·∫øt. Ch√∫ng ta truy·ªÅn v√†o m·ªôt m·∫£ng `['post', id]` l√†m `queryKey`, trong ƒë√≥ `'post'` l√† m·ªôt nh√£n ƒë·ªãnh danh cho truy v·∫•n v√† `id` l√† ID c·ªßa b√†i vi·∫øt ƒë·ªÉ x√°c ƒë·ªãnh truy v·∫•n duy nh·∫•t. ƒê·ªëi s·ªë th·ª© hai c·ªßa `useQuery` l√† m·ªôt h√†m callback ch·ª©a logic ƒë·ªÉ l·∫•y d·ªØ li·ªáu b√†i vi·∫øt t·ª´ API b·∫±ng c√°ch s·ª≠ d·ª•ng h√†m `fetchPost` v√† truy·ªÅn `id` l√†m tham s·ªë.

  - `useQuery` s·∫Ω qu·∫£n l√Ω tr·∫°ng th√°i truy v·∫•n v√† cache d·ªØ li·ªáu. Ch√∫ng ta s·ª≠ d·ª•ng c√°c bi·∫øn `data`, `isLoading`, `isError` v√† `error` ƒë∆∞·ª£c tr·∫£ v·ªÅ t·ª´ `useQuery` ƒë·ªÉ x·ª≠ l√Ω tr·∫°ng th√°i c·ªßa truy v·∫•n. C√°c bi·∫øn ƒë√≥ c√≥ s·∫µn trong `useQuery`.

  - Trong ph·∫ßn render, ch√∫ng ta ki·ªÉm tra tr·∫°ng th√°i `isLoading` v√† `isError` ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o t∆∞∆°ng ·ª©ng. N·∫øu ƒëang t·∫£i d·ªØ li·ªáu, ch√∫ng ta hi·ªÉn th·ªã th√¥ng b√°o "Loading...". N·∫øu c√≥ l·ªói, ch√∫ng ta hi·ªÉn th·ªã th√¥ng b√°o l·ªói v√† hi·ªÉn th·ªã `error.message`, `error` l√† th√¥ng tin l·ªói n√≥ ƒë∆∞·ª£c tr·∫£ v·ªÅ t·ª´ hook `useQuery`, n√≥ c√≥ s·∫µn trong `isError`.

  - N·∫øu tr·∫°ng th√°i truy v·∫•n l√† th√†nh c√¥ng (`isLoading` v√† `isError` ƒë·ªÅu l√† `false`), ch√∫ng ta hi·ªÉn th·ªã chi ti·∫øt b√†i vi·∫øt b·∫±ng c√°ch truy c·∫≠p v√†o `data`. Ch√∫ng ta s·ª≠ d·ª•ng c√°c tr∆∞·ªùng `id`, `title` v√† `content` ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin b√†i vi·∫øt.

- Component `PostDetails` s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c `Route` ƒë·ªÉ hi·ªÉn th·ªã trang chi ti·∫øt b√†i vi·∫øt d·ª±a tr√™n `ID` ƒë∆∞·ª£c truy·ªÅn qua URL.

‚úÖ‚úÖ T·ªïng l·∫°i: Tr√™n ƒë√¢y l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ vi·ªác s·ª≠ d·ª•ng `React Router` k·∫øt h·ª£p v·ªõi `React Query` trong ·ª©ng d·ª•ng c·ªßa b·∫°n. B·∫±ng c√°ch s·ª≠ d·ª•ng c·∫£ hai th∆∞ vi·ªán n√†y, b·∫°n c√≥ th·ªÉ qu·∫£n l√Ω `routing` v√† truy v·∫•n d·ªØ li·ªáu m·ªôt c√°ch hi·ªáu qu·∫£, mang l·∫°i tr·∫£i nghi·ªám ng∆∞·ªùi d√πng t·ªët h∆°n v√† t·ªëi ∆∞u h√≥a vi·ªác t·∫£i d·ªØ li·ªáu t·ª´ server.

## ‚ùå‚ùå L∆∞u √Ω: Trong queryKey: ['post', id]. C√°i n√†y c·∫ßn hi·ªÉu k·ªπ, b·∫Øt bu·ªôc ph·∫£i hi·ªÉu: üëáüëáüëá

## ‚ùå‚ùå D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch t·ª´ng tham s·ªë trong queryKey: üëáüëáüëá

## H√£y gi·∫£i th√≠ch v·ªÅ tham s·ªë ƒë·∫ßu ti√™n ['post'] trong `queryKey` r√µ r√†ng h∆°n ?

- Tham s·ªë ƒë·∫ßu ti√™n `['post']` trong `queryKey` ƒë·∫°i di·ªán cho lo·∫°i truy v·∫•n. N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh danh lo·∫°i d·ªØ li·ªáu b·∫°n ƒëang truy v·∫•n.

- Trong tr∆∞·ªùng h·ª£p n√†y, `'post'` l√† m·ªôt chu·ªói ƒë·∫°i di·ªán cho lo·∫°i d·ªØ li·ªáu `"post"` m√† b·∫°n mu·ªën truy v·∫•n. Lo·∫°i d·ªØ li·ªáu n√†y c√≥ th·ªÉ l√† b·∫•t k·ª≥ chu·ªói n√†o m√† b·∫°n t·ª± ƒë·∫∑t t√™n ƒë·ªÉ ph√π h·ª£p v·ªõi m√¥ h√¨nh d·ªØ li·ªáu c·ªßa ·ª©ng d·ª•ng c·ªßa b·∫°n. V√≠ d·ª•: `'user'`, `'comment'`, `'product'`, vv.

- V√≠ d·ª•: N·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n l√† m·ªôt blog v√† b·∫°n mu·ªën truy v·∫•n c√°c b√†i ƒëƒÉng, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `['post']` l√†m `queryKey` ƒë·ªÉ x√°c ƒë·ªãnh lo·∫°i truy v·∫•n l√† `"post"`.

- M·ª•c ƒë√≠ch c·ªßa vi·ªác s·ª≠ d·ª•ng lo·∫°i truy v·∫•n trong `queryKey` l√† ƒë·ªÉ x√°c ƒë·ªãnh v√† ph√¢n lo·∫°i c√°c truy v·∫•n d·ª±a tr√™n lo·∫°i d·ªØ li·ªáu. Khi b·∫°n c√≥ nhi·ªÅu lo·∫°i d·ªØ li·ªáu kh√°c nhau trong ·ª©ng d·ª•ng c·ªßa m√¨nh, vi·ªác ƒë·ªãnh danh m·ªói lo·∫°i d·ªØ li·ªáu th√¥ng qua `queryKey` gi√∫p React Query qu·∫£n l√Ω v√† x·ª≠ l√Ω c√°c truy v·∫•n m·ªôt c√°ch ch√≠nh x√°c.

## Tham s·ªë th·ª© 2 trong `queryKey` l√† `id`. N√≥ c√≥ nghƒ©a l√† sao. T√¥i ch∆∞a hi·ªÉu l·∫Øm ?

- Tham s·ªë th·ª© hai trong `queryKey`, trong tr∆∞·ªùng h·ª£p c·ªßa b·∫°n l√† `id`, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c ƒë·ªãnh m·ªôt gi√° tr·ªã ƒë·∫∑c bi·ªát (v√≠ d·ª•: ID c·ªßa b√†i vi·∫øt) ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu c·ª• th·ªÉ t·ª´ server.

- Khi b·∫°n truy v·∫•n d·ªØ li·ªáu t·ª´ m·ªôt ngu·ªìn d·ªØ li·ªáu nh∆∞ m·ªôt API, th√¥ng th∆∞·ªùng b·∫°n c·∫ßn ch·ªâ ƒë·ªãnh m·ªôt gi√° tr·ªã duy nh·∫•t ƒë·ªÉ x√°c ƒë·ªãnh d·ªØ li·ªáu c·∫ßn l·∫•y. Trong tr∆∞·ªùng h·ª£p c·ªßa b·∫°n l√† `queryKey: ['post', id]`, `id` ƒë·∫°i di·ªán cho gi√° tr·ªã ƒë·∫∑c bi·ªát (v√≠ d·ª•: ID c·ªßa b√†i vi·∫øt) m√† b·∫°n mu·ªën truy v·∫•n.

- V·ªõi m·ªói gi√° tr·ªã `id` kh√°c nhau, b·∫°n c√≥ th·ªÉ truy v·∫•n d·ªØ li·ªáu c·ªßa c√°c b√†i vi·∫øt kh√°c nhau t·ª´ server. Khi `id` thay ƒë·ªïi, React Query s·∫Ω t·ª± ƒë·ªông g·ª≠i y√™u c·∫ßu m·ªõi ƒë·ªÉ l·∫•y d·ªØ li·ªáu t∆∞∆°ng ·ª©ng t·ª´ server.

- V√≠ d·ª•: N·∫øu b·∫°n mu·ªën truy v·∫•n d·ªØ li·ªáu b√†i vi·∫øt c√≥ ID l√† 1, b·∫°n s·∫Ω s·ª≠ d·ª•ng `queryKey: ['post', 1]`. ƒêi·ªÅu n√†y cho bi·∫øt b·∫°n mu·ªën truy v·∫•n d·ªØ li·ªáu b√†i vi·∫øt v·ªõi `ID` l√† `1` t·ª´ server.

- T√≥m l·∫°i, vi·ªác s·ª≠ d·ª•ng `id` l√† m·ªôt c√°ch ƒë·ªÉ x√°c ƒë·ªãnh m·ªôt gi√° tr·ªã ƒë·∫∑c bi·ªát v√† ch·ªâ ƒë·ªãnh d·ªØ li·ªáu c·ª• th·ªÉ b·∫°n mu·ªën truy v·∫•n t·ª´ server.

## Khi t√¥i khai b√°o nh∆∞ v·∫≠y `queryKey: ['post', id]` th√¨ t√¥i s·∫Ω l·∫•y t·∫•t c·∫£ c√°c b√†i vi·∫øt trong `server` lun h·∫£ ?

- Kh√¥ng, khi b·∫°n khai b√°o `queryKey: ['post', id]`, nghƒ©a l√† b·∫°n ch·ªâ ƒë·ªãnh m·ªôt `queryKey` c·ª• th·ªÉ ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu c·ªßa m·ªôt b√†i vi·∫øt duy nh·∫•t t·ª´ server. `QueryKey` n√†y g·ªìm hai ph·∫ßn t·ª≠: `'post'` v√† `id`.

- V·ªõi c√°ch truy v·∫•n nh∆∞ v·∫≠y, React Query s·∫Ω t·ª± ƒë·ªông th√™m `queryKey` v√†o b·ªô nh·ªõ cache ƒë·ªÉ l∆∞u tr·ªØ k·∫øt qu·∫£ truy v·∫•n c·ªßa b√†i vi·∫øt ƒë√≥. Khi b·∫°n th·ª±c hi·ªán truy v·∫•n v·ªõi `queryKey` t∆∞∆°ng t·ª± trong t∆∞∆°ng lai, React Query s·∫Ω tr∆∞·ªõc ti√™n ki·ªÉm tra xem li·ªáu d·ªØ li·ªáu ƒë√£ t·ªìn t·∫°i trong cache hay ch∆∞a.

- N·∫øu d·ªØ li·ªáu ƒë√£ t·ªìn t·∫°i trong cache v√† ch∆∞a h·∫øt h·∫°n (th·ªùi gian h·∫øt h·∫°n ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi `staleTime`), React Query s·∫Ω tr·∫£ v·ªÅ d·ªØ li·ªáu t·ª´ cache m√† kh√¥ng g·ª≠i y√™u c·∫ßu m·ªõi ƒë·∫øn server. ƒêi·ªÅu n√†y gi√∫p c·∫£i thi·ªán hi·ªáu su·∫•t ·ª©ng d·ª•ng.

- N·∫øu d·ªØ li·ªáu trong cache ƒë√£ h·∫øt h·∫°n ho·∫∑c ch∆∞a t·ªìn t·∫°i trong cache, React Query s·∫Ω t·ª± ƒë·ªông g·ª≠i y√™u c·∫ßu m·ªõi ƒë·∫øn server ƒë·ªÉ l·∫•y d·ªØ li·ªáu c·ªßa b√†i vi·∫øt t∆∞∆°ng ·ª©ng. Sau khi nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ t·ª´ server, n√≥ s·∫Ω c·∫≠p nh·∫≠t cache v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ cho b·∫°n s·ª≠ d·ª•ng.

- V√¨ v·∫≠y, v·ªõi `queryKey: ['post', id]`, b·∫°n ch·ªâ truy v·∫•n d·ªØ li·ªáu c·ªßa m·ªôt b√†i vi·∫øt duy nh·∫•t c√≥ `ID` t∆∞∆°ng ·ª©ng t·ª´ server, kh√¥ng ph·∫£i t·∫•t c·∫£ c√°c b√†i vi·∫øt.

## C√≥ nghƒ©a l√† c√°c b√†i vi·∫øt c·ªßa t√¥i ƒë√£ `render` l√™n m√†n h√¨nh h·∫øt r·ªìi. V√† khi t√¥i khai b√°o nh∆∞ v·∫≠y th√¨ c√≥ nghƒ©a l√† t√¥i `click` v√†o 1 b√†i vi·∫øt b·∫•t k√¨ tr√™n m√†n h√¨nh, l√† `id` c·ªßa b√†i vi·∫øt ƒë√≥ ƒë∆∞·ª£c l∆∞u trong `cache`. `queryKey: ['post', id]`, V·∫≠y d√≤ng n√†y c√≥ `id` l√† `id` c·ªßa m·ªói b√†i vi·∫øt m√† t√¥i `click` v√†o ƒë√≥ h·∫£ ?

- ƒê√∫ng, khi b·∫°n khai b√°o `queryKey: ['post', id]`, trong ƒë√≥ `id` l√† `id` c·ªßa b√†i vi·∫øt m√† b·∫°n ƒëang xem ho·∫∑c `click` v√†o. ƒêi·ªÅu n√†y cho ph√©p React Query x√°c ƒë·ªãnh v√† l∆∞u tr·ªØ k·∫øt qu·∫£ truy v·∫•n cho t·ª´ng b√†i vi·∫øt c·ª• th·ªÉ trong cache.

- Khi b·∫°n `click` v√†o m·ªôt b√†i vi·∫øt tr√™n m√†n h√¨nh, b·∫°n c√≥ th·ªÉ truy·ªÅn `id` c·ªßa b√†i vi·∫øt ƒë√≥ v√†o `queryKey` ƒë·ªÉ th·ª±c hi·ªán truy v·∫•n d·ªØ li·ªáu c·ªßa b√†i vi·∫øt t·ª´ server. React Query s·∫Ω s·ª≠ d·ª•ng `queryKey` n√†y ƒë·ªÉ x√°c ƒë·ªãnh k·∫øt qu·∫£ truy v·∫•n t∆∞∆°ng ·ª©ng trong cache.

- V√≠ d·ª•, n·∫øu b·∫°n `click` v√†o b√†i vi·∫øt c√≥ `id` l√† `1`, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `queryKey: ['post', 1]` ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu c·ªßa b√†i vi·∫øt ƒë√≥. Khi ƒë√≥, React Query s·∫Ω ki·ªÉm tra cache v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ truy v·∫•n c·ªßa b√†i vi·∫øt c√≥ `id` l√† `1` n·∫øu n√≥ ƒë√£ t·ªìn t·∫°i trong cache v√† ch∆∞a h·∫øt h·∫°n. N·∫øu ch∆∞a t·ªìn t·∫°i ho·∫∑c ƒë√£ h·∫øt h·∫°n, React Query s·∫Ω g·ª≠i y√™u c·∫ßu m·ªõi ƒë·∫øn server ƒë·ªÉ l·∫•y d·ªØ li·ªáu c·ªßa b√†i vi·∫øt v√† c·∫≠p nh·∫≠t cache.

- Vi·ªác s·ª≠ d·ª•ng `queryKey` v·ªõi `id` c·ªßa b√†i vi·∫øt gi√∫p React Query qu·∫£n l√Ω v√† l·∫•y d·ªØ li·ªáu t∆∞∆°ng ·ª©ng t·ª´ cache v√† server d·ªÖ d√†ng cho t·ª´ng b√†i vi·∫øt ri√™ng bi·ªát.

## V·∫≠y t√≥m l·∫°i `['post', id]` trong `queryKey`, c√≥ nghƒ©a l√† khi c√°c b√†i vi·∫øt ƒë∆∞·ª£c l∆∞u trong cache th√¨ `'post'` ƒë√≥ng vai tr√≤ nh∆∞ `key`, c√≤n `id` ƒë√≥ng vai tr√≤ nh∆∞ `value` ƒë√∫ng kh√¥ng ?

- ƒê√∫ng, b·∫°n ƒë√£ hi·ªÉu ƒë√∫ng. Trong `queryKey: ['post', id]`, `'post'` ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt ph·∫ßn t·ª≠ `key` v√† `id` ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt ph·∫ßn t·ª≠ `value` trong m·∫£ng `queryKey`.

- C√°c m·∫£ng `queryKey` ƒë∆∞·ª£c s·ª≠ d·ª•ng trong React Query nh∆∞ m·ªôt c√°ch ƒë·ªÉ x√°c ƒë·ªãnh duy nh·∫•t m·ªôt truy v·∫•n d·ªØ li·ªáu. Trong tr∆∞·ªùng h·ª£p n√†y, `'post'` l√† ph·∫ßn t·ª≠ `key` v√† ƒë·∫°i di·ªán cho lo·∫°i d·ªØ li·ªáu b√†i vi·∫øt trong truy v·∫•n. `id` l√† ph·∫ßn t·ª≠ `value` v√† ƒë·∫°i di·ªán cho gi√° tr·ªã c·ª• th·ªÉ c·ªßa `id` c·ªßa b√†i vi·∫øt m√† b·∫°n mu·ªën truy v·∫•n.

- Khi s·ª≠ d·ª•ng `queryKey: ['post', id]`, React Query s·∫Ω s·ª≠ d·ª•ng c·∫£ `key` v√† `value` ƒë·ªÉ x√°c ƒë·ªãnh truy v·∫•n c·ª• th·ªÉ v√† qu·∫£n l√Ω k·∫øt qu·∫£ truy v·∫•n cho t·ª´ng b√†i vi·∫øt d·ª±a tr√™n `id` t∆∞∆°ng ·ª©ng.

## H√£y n√™u kh√°i ni·ªám useMutation trong react query ?

- Trong React Query, `useMutation` l√† m·ªôt hook d√πng ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu, ch·∫≥ng h·∫°n nh∆∞ t·∫°o, c·∫≠p nh·∫≠t ho·∫∑c x√≥a (POST, PUT, DELETE) d·ªØ li·ªáu tr√™n server (ngo·∫°i tr·ª´ GET). N√≥ cung c·∫•p m·ªôt c√°ch ti·ªán l·ª£i ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c thay ƒë·ªïi d·ªØ li·ªáu v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa ch√∫ng.

- Khi s·ª≠ d·ª•ng `useMutation`, b·∫°n c·∫ßn cung c·∫•p m·ªôt h√†m g·ªçi l√† `mutationFn`, ƒë·∫°i di·ªán cho y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu (v√≠ d·ª•: g·ª≠i m·ªôt POST request ƒë·ªÉ t·∫°o m·ªõi m·ªôt b√†i vi·∫øt). Khi g·ªçi h√†m `mutationFn`, React Query s·∫Ω qu·∫£n l√Ω qu√° tr√¨nh g·ª≠i y√™u c·∫ßu, x·ª≠ l√Ω k·∫øt qu·∫£ v√† cung c·∫•p c√°c tr·∫°ng th√°i v√† ph∆∞∆°ng th·ª©c h·ªØu √≠ch ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi y√™u c·∫ßu ƒë√≥.

- C√°c tr·∫°ng th√°i ch√≠nh khi s·ª≠ d·ª•ng `useMutation` bao g·ªìm:

- `isLoading:` ƒê√°nh d·∫•u xem y√™u c·∫ßu ƒëang ƒë∆∞·ª£c th·ª±c hi·ªán hay kh√¥ng.
- `isError:` ƒê√°nh d·∫•u xem y√™u c·∫ßu c√≥ l·ªói x·∫£y ra hay kh√¥ng.
- `error:` Th√¥ng tin chi ti·∫øt v·ªÅ l·ªói (n·∫øu c√≥).
- `data:` D·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ y√™u c·∫ßu th√†nh c√¥ng (n·∫øu c√≥).
- `mutate:` Ph∆∞∆°ng th·ª©c ƒë·ªÉ g·ªçi y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu.
- `reset:` Ph∆∞∆°ng th·ª©c ƒë·ªÉ ƒë·∫∑t l·∫°i tr·∫°ng th√°i y√™u c·∫ßu.

- `useMutation` c≈©ng cung c·∫•p c√°c callback nh∆∞ `onSuccess` v√† `onError`, cho ph√©p b·∫°n th·ª±c hi·ªán c√°c h√†nh ƒë·ªông tu·ª≥ ch·ªânh sau khi y√™u c·∫ßu th√†nh c√¥ng ho·∫∑c g·∫∑p l·ªói.

## V√≠ d·ª• c∆° b·∫£n v·ªÅ useMutation trong react query ?

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ c√°ch s·ª≠ d·ª•ng `useMutation` trong React Query ƒë·ªÉ th·ª±c hi·ªán m·ªôt y√™u c·∫ßu `POST` ƒë·ªÉ t·∫°o m·ªõi m·ªôt b√†i vi·∫øt:

```jsx
import { useMutation } from 'react-query'

const createPost = async (newPost) => {
  const response = await fetch('api/posts', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(newPost)
  })

  if (!response.ok) {
    throw new Error('Failed to create post')
  }

  const data = await response.json()
  return data
}

function CreatePostForm() {
  const mutation = useMutation(createPost)

  const handleSubmit = (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newPost = Object.fromEntries(formData.entries())
    mutation.mutate(newPost)
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='title' placeholder='Title' />
      <textarea name='content' placeholder='Content' />
      <button type='submit' disabled={mutation.isLoading}>
        {mutation.isLoading ? 'Creating...' : 'Create'}
      </button>
      {mutation.isError && <div>Error: {mutation.error.message}</div>}
      {mutation.isSuccess && <div>Post created successfully!</div>}
    </form>
  )
}
```

- Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o m·ªôt y√™u c·∫ßu `POST` m·ªõi b·∫±ng c√°ch cung c·∫•p h√†m `createPost` l√†m ƒë·ªëi s·ªë cho `useMutation`. Sau ƒë√≥, ch√∫ng ta s·ª≠ d·ª•ng `mutation.mutate` ƒë·ªÉ g·ªçi y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu v·ªõi d·ªØ li·ªáu m·ªõi t·ª´ `form`.

- `mutation.isLoading` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ki·ªÉm tra xem y√™u c·∫ßu ƒëang ƒë∆∞·ª£c th·ª±c hi·ªán hay kh√¥ng ƒë·ªÉ ƒëi·ªÅu ch·ªânh tr·∫°ng th√°i c·ªßa n√∫t `"Create"`.
- `mutation.isError` v√† `mutation.error.message` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ l·ªói x·∫£y ra.
- `mutation.isSuccess` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng sau khi y√™u c·∫ßu ƒë∆∞·ª£c th·ª±c hi·ªán th√†nh c√¥ng.

- ƒê√¢y ch·ªâ l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ c√°ch s·ª≠ d·ª•ng `useMutation` v√† c√≥ th·ªÉ ƒë∆∞·ª£c t√πy ch·ªânh v√† m·ªü r·ªông theo nhu c·∫ßu c·ªßa ·ª©ng d·ª•ng.

## Gi·∫£i th√≠ch ƒëo·∫°n code tr√™n:

- Trong ƒëo·∫°n code tr√™n, ch√∫ng ta s·ª≠ d·ª•ng `useMutation` t·ª´ React Query ƒë·ªÉ th·ª±c hi·ªán m·ªôt y√™u c·∫ßu `POST` ƒë·ªÉ t·∫°o m·ªõi m·ªôt b√†i vi·∫øt.

- H√†m `createPost` l√† m·ªôt h√†m b·∫•t ƒë·ªìng b·ªô (`async`) ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ g·ª≠i y√™u c·∫ßu `POST` t·ªõi API v√† tr·∫£ v·ªÅ d·ªØ li·ªáu sau khi y√™u c·∫ßu th√†nh c√¥ng. N·∫øu y√™u c·∫ßu g·∫∑p l·ªói, ch√∫ng ta s·∫Ω `throw` m·ªôt l·ªói ƒë·ªÉ x·ª≠ l√Ω sau n√†y.

- Trong component `CreatePostForm`, ch√∫ng ta s·ª≠ d·ª•ng `useMutation(createPost)` ƒë·ªÉ kh·ªüi t·∫°o m·ªôt mutation instance. Mutation instance n√†y cung c·∫•p c√°c thu·ªôc t√≠nh v√† ph∆∞∆°ng th·ª©c ƒë·ªÉ theo d√µi tr·∫°ng th√°i c·ªßa `mutation`.

- Trong h√†m `handleSubmit`, ch√∫ng ta s·ª≠ d·ª•ng `mutation.mutate(newPost)` ƒë·ªÉ g·ªçi y√™u c·∫ßu t·∫°o m·ªõi b√†i vi·∫øt. `newPost` l√† ƒë·ªëi t∆∞·ª£ng ch·ª©a th√¥ng tin b√†i vi·∫øt t·ª´ `form`.

- Trong form, ch√∫ng ta s·ª≠ d·ª•ng `onSubmit` ƒë·ªÉ g·ªçi h√†m `handleSubmit` khi form ƒë∆∞·ª£c submit. Tr·∫°ng th√°i `mutation.isLoading` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒëi·ªÅu khi·ªÉn tr·∫°ng th√°i c·ªßa n√∫t `"Create"` v√† tr·∫°ng th√°i n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o t∆∞∆°ng ·ª©ng (`"Creating..."` ho·∫∑c `"Create"`).

- `mutation.isError` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ki·ªÉm tra xem y√™u c·∫ßu c√≥ g·∫∑p l·ªói hay kh√¥ng. N·∫øu c√≥ l·ªói, ch√∫ng ta hi·ªÉn th·ªã th√¥ng b√°o l·ªói trong `div` c√≥ th√¥ng b√°o l√† Error.

- `mutation.isSuccess` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ki·ªÉm tra xem y√™u c·∫ßu ƒë√£ th√†nh c√¥ng hay kh√¥ng. N·∫øu th√†nh c√¥ng, ch√∫ng ta hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng trong `div` c√≥ th√¥ng b√°o l√† Post created successfully!.

- ƒêo·∫°n code tr√™n ch·ªâ l√† m·ªôt v√≠ d·ª• c∆° b·∫£n ƒë·ªÉ gi·∫£i th√≠ch c√°ch s·ª≠ d·ª•ng `useMutation` trong React Query. B·∫°n c√≥ th·ªÉ t√πy ch·ªânh v√† m·ªü r·ªông n√≥ theo nhu c·∫ßu c·ªßa ·ª©ng d·ª•ng.

## V√≠ d·ª• n√¢ng cao v·ªÅ useMutation trong react query ?

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• n√¢ng cao v·ªÅ vi·ªác s·ª≠ d·ª•ng `useMutation` trong React Query ƒë·ªÉ t·∫°o, c·∫≠p nh·∫≠t v√† x√≥a d·ªØ li·ªáu:

```jsx
import React from 'react'
import { useMutation, useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  // H√†m g·ªçi API ƒë·ªÉ t·∫°o m·ªõi m·ªôt todo
  const createTodo = async (newTodo) => {
    const response = await fetch('api/todos', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(newTodo)
    })

    if (!response.ok) {
      throw new Error('Failed to create todo')
    }

    const data = await response.json()
    return data
  }

  // H√†m g·ªçi API ƒë·ªÉ c·∫≠p nh·∫≠t m·ªôt todo
  const updateTodo = async (updatedTodo) => {
    const response = await fetch(`api/todos/${updatedTodo.id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(updatedTodo)
    })

    if (!response.ok) {
      throw new Error('Failed to update todo')
    }

    const data = await response.json()
    return data
  }

  // H√†m g·ªçi API ƒë·ªÉ x√≥a m·ªôt todo
  const deleteTodo = async (todoId) => {
    const response = await fetch(`api/todos/${todoId}`, {
      method: 'DELETE'
    })

    if (!response.ok) {
      throw new Error('Failed to delete todo')
    }
  }

  const mutationOptions = {
    onSuccess: () => {
      // Khi th·ª±c hi·ªán th√†nh c√¥ng create/update/delete, ta refetch l·∫°i d·ªØ li·ªáu ƒë·ªÉ c·∫≠p nh·∫≠t UI
      queryClient.invalidateQueries('todos')
    }
  }

  const createMutation = useMutation(createTodo, mutationOptions)
  const updateMutation = useMutation(updateTodo, mutationOptions)
  const deleteMutation = useMutation(deleteTodo, mutationOptions)

  const handleCreateTodo = () => {
    const newTodo = { title: 'New Todo', completed: false }
    createMutation.mutate(newTodo)
  }

  const handleUpdateTodo = (todo) => {
    const updatedTodo = { ...todo, completed: !todo.completed }
    updateMutation.mutate(updatedTodo)
  }

  const handleDeleteTodo = (todoId) => {
    deleteMutation.mutate(todoId)
  }

  return (
    <div>
      <button onClick={handleCreateTodo}>Create Todo</button>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>
            {todo.title} - {todo.completed ? 'Completed' : 'Not Completed'}
            <button onClick={() => handleUpdateTodo(todo)}>Toggle Complete</button>
            <button onClick={() => handleDeleteTodo(todo.id)}>Delete</button>
          </li>
        ))}
      </ul>
    </div>
  )
}

export default TodoList
```

- Trong v√≠ d·ª• tr√™n, ch√∫ng ta s·ª≠ d·ª•ng `useMutation` ƒë·ªÉ t·∫°o ra ba bi·∫øn mutation: `createMutation`, `updateMutation`, v√† `deleteMutation`. M·ªói bi·∫øn mutation ƒë∆∞·ª£c kh·ªüi t·∫°o v·ªõi h√†m t∆∞∆°ng ·ª©ng ƒë·ªÉ g·ªçi API t∆∞∆°ng ·ª©ng (t·∫°o m·ªõi, c·∫≠p nh·∫≠t, x√≥a).

- `mutationOptions` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh c·∫•u h√¨nh c√°c h√†nh vi sau khi mutation ƒë∆∞·ª£c th·ª±c hi·ªán th√†nh c√¥ng. Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng `onSuccess` ƒë·ªÉ khi mutation ho√†n th√†nh th√†nh c√¥ng, ta s·∫Ω l√†m t∆∞∆°i l·∫°i d·ªØ li·ªáu b·∫±ng c√°ch g·ªçi `queryClient.invalidateQueries('todos')`. ƒêi·ªÅu n√†y gi√∫p c·∫≠p nh·∫≠t UI v·ªõi d·ªØ li·ªáu m·ªõi nh·∫•t.

- Khi ng∆∞·ªùi d√πng th·ª±c hi·ªán c√°c h√†nh ƒë·ªông nh∆∞ t·∫°o m·ªõi, c·∫≠p nh·∫≠t ho·∫∑c x√≥a m·ªôt todo, ta g·ªçi ph∆∞∆°ng th·ª©c `mutate` tr√™n c√°c bi·∫øn mutation t∆∞∆°ng ·ª©ng v√† chuy·ªÉn tham s·ªë t∆∞∆°ng ·ª©ng (newTodo, updatedTodo, todoId).

- Khi mutation ƒëang x·ª≠ l√Ω, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c thu·ªôc t√≠nh nh∆∞ `isLoading`, `isError`, v√† `error` ƒë·ªÉ hi·ªÉn th·ªã tr·∫°ng th√°i v√† th√¥ng b√°o l·ªói t∆∞∆°ng ·ª©ng.

- V√≠ d·ª• tr√™n ch·ªâ l√† m·ªôt v√≠ d·ª• n√¢ng cao v·ªÅ vi·ªác s·ª≠ d·ª•ng `useMutation` trong React Query. B·∫°n c√≥ th·ªÉ t√πy ch·ªânh nhi·ªÅu h∆°n v√† √°p d·ª•ng cho c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng th·ª±c t·∫ø kh√°c nhau.

## Gi·∫£i th√≠ch ƒëo·∫°n code tr√™n:

```jsx
import React from 'react'
import { useMutation, useQueryClient } from 'react-query'
```

- ƒêo·∫°n m√£ tr√™n bao g·ªìm hai import:

1. `React`: ƒê√¢y l√† import c·∫ßn thi·∫øt ƒë·ªÉ s·ª≠ d·ª•ng React trong ·ª©ng d·ª•ng c·ªßa b·∫°n. M·ªçi th√†nh ph·∫ßn React ƒë·ªÅu ph·∫£i import th∆∞ vi·ªán React tr∆∞·ªõc khi s·ª≠ d·ª•ng (hi·ªán t·∫°i v·ªõi phi√™n b·∫£n m·ªõi th√¨ c√≥ th·ªÉ kh√¥ng c·∫ßn import d√≤ng n√†y).

2. `useMutation`, `useQueryClient` t·ª´ th∆∞ vi·ªán `react-query`: ƒê√¢y l√† hai hook ƒë∆∞·ª£c cung c·∫•p b·ªüi React Query ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông mutation v√† truy v·∫•n trong ·ª©ng d·ª•ng.

- `useMutation`: Hook n√†y cho ph√©p b·∫°n th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông mutation (th√™m, s·ª≠a, x√≥a) v√† theo d√µi tr·∫°ng th√°i c·ªßa ch√∫ng. N√≥ nh·∫≠n v√†o m·ªôt h√†m mutation v√† tr·∫£ v·ªÅ c√°c gi√° tr·ªã v√† ph∆∞∆°ng th·ª©c li√™n quan ƒë·∫øn mutation.
- `useQueryClient`: Hook n√†y cung c·∫•p m·ªôt instance c·ªßa QueryClient, ƒë·∫°i di·ªán cho client c·ªßa React Query. B·∫±ng c√°ch s·ª≠ d·ª•ng `useQueryClient`, b·∫°n c√≥ th·ªÉ truy c·∫≠p v√† thao t√°c v·ªõi c√°c ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn cache, nh∆∞ invalidate, refetch, remove c√°c query, mutation v√† nhi·ªÅu h∆°n n·ªØa.

- B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `useMutation` ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông mutation, v√† `useQueryClient` ƒë·ªÉ thao t√°c v·ªõi cache v√† c√°c ho·∫°t ƒë·ªông li√™n quan trong React Query.

```jsx
const TodoList = () => {
  const queryClient = useQueryClient();
  ...
};
```

- Trong ƒëo·∫°n m√£ tr√™n, ch√∫ng ta s·ª≠ d·ª•ng hook `useQueryClient` t·ª´ th∆∞ vi·ªán React Query ƒë·ªÉ t·∫°o m·ªôt instance c·ªßa `QueryClient` v√† g√°n cho bi·∫øn `queryClient`.

- `useQueryClient`: Hook n√†y tr·∫£ v·ªÅ m·ªôt instance c·ªßa `QueryClient` ƒë∆∞·ª£c s·ª≠ d·ª•ng trong ·ª©ng d·ª•ng. `QueryClient` l√† m·ªôt ƒë·ªëi t∆∞·ª£ng qu·∫£n l√Ω tr·∫°ng th√°i v√† cache cho c√°c truy v·∫•n v√† mutations trong React Query. B·∫±ng c√°ch s·ª≠ d·ª•ng `useQueryClient`, ch√∫ng ta c√≥ th·ªÉ truy c·∫≠p v√† th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn cache nh∆∞ refetch, invalidate, remove queries, mutations v√† nhi·ªÅu h∆°n n·ªØa.

- Trong ƒëo·∫°n m√£ tr√™n, ch√∫ng ta s·ª≠ d·ª•ng `useQueryClient` ƒë·ªÉ l·∫•y m·ªôt instance c·ªßa QueryClient v√† g√°n n√≥ cho bi·∫øn `queryClient`. Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng bi·∫øn `queryClient` ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn cache, nh∆∞ l√†m m·ªõi l·∫°i d·ªØ li·ªáu, x√≥a d·ªØ li·ªáu, v√† c√°c ho·∫°t ƒë·ªông kh√°c m√† c·∫ßn truy c·∫≠p v√†o cache c·ªßa React Query.

```jsx
const createTodo = async (newTodo) => {
  const response = await fetch('api/todos', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(newTodo)
  })

  if (!response.ok) {
    throw new Error('Failed to create todo')
  }

  const data = await response.json()
  return data
}

const updateTodo = async (updatedTodo) => {
  const response = await fetch(`api/todos/${updatedTodo.id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(updatedTodo)
  })

  if (!response.ok) {
    throw new Error('Failed to update todo')
  }

  const data = await response.json()
  return data
}

const deleteTodo = async (todoId) => {
  const response = await fetch(`api/todos/${todoId}`, {
    method: 'DELETE'
  })

  if (!response.ok) {
    throw new Error('Failed to delete todo')
  }
}
```

- Trong ƒëo·∫°n m√£ tr√™n, ch√∫ng ta ƒë·ªãnh nghƒ©a ba h√†m `createTodo`, `updateTodo`, v√† `deleteTodo` ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông t∆∞∆°ng ·ª©ng v·ªõi vi·ªác t·∫°o, c·∫≠p nh·∫≠t v√† x√≥a m·ªôt todo t·ª´ API.

1. H√†m `createTodo`:

- H√†m n√†y nh·∫≠n v√†o m·ªôt ƒë·ªëi t∆∞·ª£ng `newTodo` ch·ª©a th√¥ng tin c·ªßa todo m·ªõi.
- S·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i m·ªôt request POST t·ªõi endpoint `'api/todos'`.
- Trong ph·∫ßn c·∫•u h√¨nh request:
  - ƒê·∫∑t method l√† `'POST'` ƒë·ªÉ t·∫°o m·ªôt todo m·ªõi.
  - ƒê·∫∑t header l√† `'Content-Type': 'application/json'` ƒë·ªÉ ch·ªâ ƒë·ªãnh ki·ªÉu d·ªØ li·ªáu g·ª≠i ƒëi l√† JSON.
  - Chuy·ªÉn ƒë·ªïi `newTodo` th√†nh chu·ªói JSON b·∫±ng c√°ch s·ª≠ d·ª•ng `JSON.stringify`.
  - ƒê·∫∑t body c·ªßa request l√† chu·ªói JSON ch·ª©a th√¥ng tin c·ªßa `newTodo`.
- Sau ƒë√≥, ch√∫ng ta ch·ªù response t·ª´ server b·∫±ng c√°ch s·ª≠ d·ª•ng await.
- N·∫øu response kh√¥ng th√†nh c√¥ng (kh√¥ng c√≥ status code 2xx), ta throw m·ªôt l·ªói v·ªõi th√¥ng b√°o 'Failed to create todo'.
- N·∫øu response th√†nh c√¥ng, ta parse response body t·ª´ ki·ªÉu d·ªØ li·ªáu chu·ªói sang d·ªØ li·ªáu ƒë·ªëi t∆∞·ª£ng (object) v√† tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√≥.

- H√†m createTodo ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o m·ªôt todo m·ªõi b·∫±ng c√°ch g·ª≠i m·ªôt request POST t·ªõi API v√† tr·∫£ v·ªÅ d·ªØ li·ªáu c·ªßa todo ƒë∆∞·ª£c t·∫°o.

2. H√†m `updateTodo`:

- Trong ƒëo·∫°n code tr√™n, ch√∫ng ta c√≥ h√†m `updateTodo` ƒë·ªÉ c·∫≠p nh·∫≠t m·ªôt todo ƒë√£ t·ªìn t·∫°i b·∫±ng ph∆∞∆°ng th·ª©c `PUT` trong API. D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch t·ª´ng d√≤ng code:

- `const updateTodo = async (updatedTodo) => {`: ƒê√¢y l√† khai b√°o c·ªßa h√†m `updateTodo` nh·∫≠n m·ªôt tham s·ªë `updatedTodo`, ƒë·∫°i di·ªán cho th√¥ng tin todo c·∫ßn c·∫≠p nh·∫≠t.

- `const response = await fetch(api/todos/${updatedTodo.id}, {`: Ch√∫ng ta s·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i m·ªôt y√™u c·∫ßu `PUT` ƒë·∫øn API v·ªõi URL ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ `api/todos/` v√† `updatedTodo.id` ƒë·ªÉ ch·ªâ ƒë·ªãnh todo c·∫ßn c·∫≠p nh·∫≠t.

- `method: 'PUT'`: ƒê√¢y l√† ph·∫ßn c·ªßa c·∫•u h√¨nh y√™u c·∫ßu g·ª≠i ƒëi, ch·ªâ ƒë·ªãnh r·∫±ng ch√∫ng ta ƒëang s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `PUT` ƒë·ªÉ c·∫≠p nh·∫≠t todo.

- `headers: { 'Content-Type': 'application/json' }`: ƒê√¢y l√† ph·∫ßn c·∫•u h√¨nh cho ti√™u ƒë·ªÅ c·ªßa y√™u c·∫ßu g·ª≠i ƒëi. Trong tr∆∞·ªùng h·ª£p n√†y, ch√∫ng ta ƒëang ch·ªâ ƒë·ªãnh r·∫±ng d·ªØ li·ªáu ƒë∆∞·ª£c g·ª≠i ƒëi d∆∞·ªõi d·∫°ng JSON.

- `body: JSON.stringify(updatedTodo)`: ƒê√¢y l√† ph·∫ßn c·∫•u h√¨nh cho n·ªôi dung y√™u c·∫ßu g·ª≠i ƒëi. Ch√∫ng ta s·ª≠ d·ª•ng JSON.stringify ƒë·ªÉ chuy·ªÉn ƒë·ªïi ƒë·ªëi t∆∞·ª£ng `updatedTodo` th√†nh chu·ªói JSON tr∆∞·ªõc khi g·ª≠i ƒëi (`.stringify` l√† chuy·ªÉn t·ª´ `object` sang `string`).

- `if (!response.ok) { throw new Error('Failed to update todo') }`: Ch√∫ng ta ki·ªÉm tra xem ph·∫£n h·ªìi t·ª´ API c√≥ th√†nh c√¥ng hay kh√¥ng b·∫±ng c√°ch ki·ªÉm tra gi√° tr·ªã `response.ok`. Trong tr∆∞·ªùng h·ª£p kh√¥ng th√†nh c√¥ng, ch√∫ng ta n√©m m·ªôt l·ªói ƒë·ªÉ x·ª≠ l√Ω sau n√†y.

- `const data = await response.json()`: N·∫øu ph·∫£n h·ªìi t·ª´ API th√†nh c√¥ng, ch√∫ng ta s·ª≠ d·ª•ng `response.json()` ƒë·ªÉ chuy·ªÉn ƒë·ªïi n·ªôi dung ph·∫£n h·ªìi t·ª´ JSON sang ƒë·ªëi t∆∞·ª£ng JavaScript. K·∫øt qu·∫£ chuy·ªÉn ƒë·ªïi ƒë∆∞·ª£c l∆∞u tr·ªØ trong bi·∫øn `data`.

- `return data`: Cu·ªëi c√πng, ch√∫ng ta tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t t·ª´ API th√¥ng qua bi·∫øn `data`.

- T√≥m l·∫°i, h√†m `updateTodo` th·ª±c hi·ªán g·ª≠i y√™u c·∫ßu `PUT` ƒë·∫øn API ƒë·ªÉ c·∫≠p nh·∫≠t todo ƒë√£ t·ªìn t·∫°i, v√† sau ƒë√≥ tr·∫£ v·ªÅ d·ªØ li·ªáu c·∫≠p nh·∫≠t th√†nh c√¥ng ƒë·ªÉ s·ª≠ d·ª•ng trong qu√° tr√¨nh hi·ªÉn th·ªã ho·∫∑c x·ª≠ l√Ω ti·∫øp theo.

3. H√†m `deleteTodo`:

- Trong ƒëo·∫°n code tr√™n, ch√∫ng ta c√≥ h√†m `deleteTodo` ƒë·ªÉ x√≥a m·ªôt todo th√¥ng qua ph∆∞∆°ng th·ª©c `DELETE` trong API. D∆∞·ªõi ƒë√¢y l√† gi·∫£i th√≠ch t·ª´ng d√≤ng code:

- `const deleteTodo = async (todoId) => {`: ƒê√¢y l√† khai b√°o c·ªßa h√†m b·∫•t ƒë·ªìng b·ªô `deleteTodo` nh·∫≠n m·ªôt tham s·ªë `todoId`, ƒë·∫°i di·ªán cho ID c·ªßa todo c·∫ßn x√≥a. T·ª´ kh√≥a `async` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh nghƒ©a m·ªôt h√†m b·∫•t ƒë·ªìng b·ªô, cho ph√©p s·ª≠ d·ª•ng `await` ƒë·ªÉ ƒë·ª£i cho ƒë·∫øn khi m·ªôt ho·∫°t ƒë·ªông b·∫•t ƒë·ªìng b·ªô ho√†n th√†nh.

- `const response = await fetch(api/todos/${todoId}, {`: Ch√∫ng ta s·ª≠ d·ª•ng `fetch` ƒë·ªÉ g·ª≠i m·ªôt y√™u c·∫ßu `DELETE` ƒë·∫øn API v·ªõi URL ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ `api/todos/` v√† `todoId` ƒë·ªÉ ch·ªâ ƒë·ªãnh todo c·∫ßn x√≥a.

- `method: 'DELETE'`: ƒê√¢y l√† ph·∫ßn c·ªßa c·∫•u h√¨nh y√™u c·∫ßu g·ª≠i ƒëi, ch·ªâ ƒë·ªãnh r·∫±ng ch√∫ng ta ƒëang s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `DELETE` ƒë·ªÉ x√≥a todo.

- `if (!response.ok) { throw new Error('Failed to delete todo') }`: Ch√∫ng ta ki·ªÉm tra xem ph·∫£n h·ªìi t·ª´ API c√≥ th√†nh c√¥ng hay kh√¥ng b·∫±ng c√°ch ki·ªÉm tra gi√° tr·ªã `response.ok`. Trong tr∆∞·ªùng h·ª£p kh√¥ng th√†nh c√¥ng, ch√∫ng ta n√©m m·ªôt l·ªói ƒë·ªÉ x·ª≠ l√Ω sau n√†y.

- T√≥m l·∫°i, h√†m `deleteTodo` th·ª±c hi·ªán g·ª≠i y√™u c·∫ßu `DELETE` ƒë·∫øn API ƒë·ªÉ x√≥a todo d·ª±a tr√™n `todoId`. N·∫øu ph·∫£n h·ªìi t·ª´ API th√†nh c√¥ng, kh√¥ng c√≥ d·ªØ li·ªáu tr·∫£ v·ªÅ, ng∆∞·ª£c l·∫°i, n·∫øu kh√¥ng th√†nh c√¥ng, ch√∫ng ta n√©m m·ªôt l·ªói ƒë·ªÉ x·ª≠ l√Ω sau n√†y.

```jsx
const mutationOptions = {
  onSuccess: () => {
    queryClient.invalidateQueries('todos')
  }
}
```

-

```jsx
const createMutation = useMutation(createTodo, mutationOptions)
const updateMutation = useMutation(updateTodo, mutationOptions)
const deleteMutation = useMutation(deleteTodo, mutationOptions)
```

```jsx
const handleCreateTodo = () => {
  const newTodo = { title: 'New Todo', completed: false }
  createMutation.mutate(newTodo)
}

const handleUpdateTodo = (todo) => {
  const updatedTodo = { ...todo, completed: !todo.completed }
  updateMutation.mutate(updatedTodo)
}

consthandleDeleteTodo = (todoId) => {
  deleteMutation.mutate(todoId)
}
```

```jsx
return (
  <div>
    <button onClick={handleCreateTodo}>Create Todo</button>
    <ul>
      {todos.map((todo) => (
        <li key={todo.id}>
          {todo.title} - {todo.completed ? 'Completed' : 'Not Completed'}
          <button onClick={() => handleUpdateTodo(todo)}>Toggle Complete</button>
          <button onClick={() => handleDeleteTodo(todo.id)}>Delete</button>
        </li>
      ))}
    </ul>
  </div>
)
```

## H√£y n√™u kh√°i ni·ªám useQuery trong react query ?

- Trong React Query, `useQuery` l√† m·ªôt hook ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu l·∫•y d·ªØ li·ªáu t·ª´ m·ªôt ngu·ªìn b√™n ngo√†i, ch·∫≥ng h·∫°n nh∆∞ API, v√† theo d√µi tr·∫°ng th√°i c·ªßa y√™u c·∫ßu.

- Khi s·ª≠ d·ª•ng `useQuery`, b·∫°n c·∫ßn cung c·∫•p c√°c th√¥ng tin c·∫ßn thi·∫øt nh∆∞ `queryKey` v√† `queryFn`. `queryKey` l√† m·ªôt gi√° tr·ªã duy nh·∫•t ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh danh cho query, x√°c ƒë·ªãnh lo·∫°i d·ªØ li·ªáu ƒë∆∞·ª£c y√™u c·∫ßu. `queryFn` l√† m·ªôt h√†m m√† React Query s·∫Ω g·ªçi ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu l·∫•y d·ªØ li·ªáu.

- Khi y√™u c·∫ßu ƒë∆∞·ª£c g·ª≠i ƒëi, `useQuery` s·∫Ω t·ª± ƒë·ªông theo d√µi tr·∫°ng th√°i c·ªßa y√™u c·∫ßu v√† cung c·∫•p c√°c bi·∫øn nh∆∞ `data`, `isLoading`, `isError`, `error`, `isFetching`, `refetch` v√† nhi·ªÅu bi·∫øn kh√°c ƒë·ªÉ gi√∫p b·∫°n x·ª≠ l√Ω v√† hi·ªÉn th·ªã d·ªØ li·ªáu v√† tr·∫°ng th√°i t∆∞∆°ng ·ª©ng.

- M·ªôt s·ªë kh√°i ni·ªám quan tr·ªçng li√™n quan ƒë·∫øn `useQuery` trong React Query:

- `data`: D·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ y√™u c·∫ßu l·∫•y d·ªØ li·ªáu. N√≥ s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t khi y√™u c·∫ßu th√†nh c√¥ng.
- `isLoading`: X√°c ƒë·ªãnh xem y√™u c·∫ßu ƒëang trong qu√° tr√¨nh t·∫£i hay kh√¥ng.
- `isError`: X√°c ƒë·ªãnh xem y√™u c·∫ßu c√≥ g·∫∑p l·ªói hay kh√¥ng.
- `error`: Th√¥ng tin v·ªÅ l·ªói n·∫øu y√™u c·∫ßu g·∫∑p l·ªói.
- `isFetching`: X√°c ƒë·ªãnh xem y√™u c·∫ßu ƒëang trong qu√° tr√¨nh fetch hay kh√¥ng, bao g·ªìm c·∫£ khi s·ª≠ d·ª•ng refetch.
- `refetch`: M·ªôt h√†m d√πng ƒë·ªÉ g·ª≠i l·∫°i y√™u c·∫ßu l·∫•y d·ªØ li·ªáu.
- `onSuccess`: M·ªôt h√†m callback ƒë∆∞·ª£c g·ªçi khi y√™u c·∫ßu th√†nh c√¥ng.
- `onError`: M·ªôt h√†m callback ƒë∆∞·ª£c g·ªçi khi y√™u c·∫ßu g·∫∑p l·ªói.

- S·ª≠ d·ª•ng `useQuery`, b·∫°n c√≥ th·ªÉ t·∫°o c√°c query instances ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu l·∫•y d·ªØ li·ªáu kh√°c nhau trong ·ª©ng d·ª•ng v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa ch√∫ng.

## V√≠ d·ª• c∆° b·∫£n v·ªÅ useQuery trong react query ?

- D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ c√°ch s·ª≠ d·ª•ng `useQuery` trong React Query ƒë·ªÉ l·∫•y danh s√°ch c√°c b√†i vi·∫øt t·ª´ m·ªôt API:

```jsx
import { useQuery } from 'react-query'

const fetchPosts = async () => {
  const response = await fetch('api/posts')
  const data = await response.json()
  return data
}

function PostList() {
  const { data, isLoading, isError, error } = useQuery('posts', fetchPosts)

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post List</h1>
      <ul>
        {data.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  )
}
```

- Trong v√≠ d·ª• tr√™n, ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu l·∫•y danh s√°ch c√°c b√†i vi·∫øt t·ª´ API. Ch√∫ng ta cung c·∫•p m·ªôt `queryKey` (trong tr∆∞·ªùng h·ª£p n√†y l√† `'posts'`) ƒë·ªÉ ƒë·ªãnh danh cho query v√† m·ªôt `queryFn` (trong tr∆∞·ªùng h·ª£p n√†y l√† h√†m `fetchPosts`) ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu.

- Khi y√™u c·∫ßu ƒë∆∞·ª£c g·ª≠i ƒëi, `useQuery` s·∫Ω t·ª± ƒë·ªông theo d√µi tr·∫°ng th√°i c·ªßa y√™u c·∫ßu v√† cung c·∫•p c√°c bi·∫øn nh∆∞ `data`, `isLoading`, `isError`, `error` ƒë·ªÉ x·ª≠ l√Ω v√† hi·ªÉn th·ªã d·ªØ li·ªáu t∆∞∆°ng ·ª©ng. Trong v√≠ d·ª• n√†y, ch√∫ng ta ki·ªÉm tra tr·∫°ng th√°i c·ªßa y√™u c·∫ßu v√† hi·ªÉn th·ªã d·ªØ li·ªáu, th√¥ng b√°o t·∫£i d·ªØ li·ªáu ho·∫∑c th√¥ng b√°o l·ªói t∆∞∆°ng ·ª©ng.

- V·ªõi `useQuery`, ch√∫ng ta c√≥ th·ªÉ d·ªÖ d√†ng th·ª±c hi·ªán c√°c y√™u c·∫ßu l·∫•y d·ªØ li·ªáu v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa ch√∫ng trong ·ª©ng d·ª•ng React m·ªôt c√°ch d·ªÖ d√†ng v√† m·∫°nh m·∫Ω.

## ƒê·ªãnh danh trong query trong queryKey c·ªßa React Query l√† sao ?

- Trong ng·ªØ c·∫£nh c·ªßa React Query, "ƒë·ªãnh danh" (identity) l√† m·ªôt c√°ch ƒë·ªÉ x√°c ƒë·ªãnh m·ªôt truy v·∫•n d·ªØ li·ªáu m·ªôt c√°ch duy nh·∫•t. N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ph√¢n bi·ªát c√°c truy v·∫•n kh√°c nhau v√† qu·∫£n l√Ω k·∫øt qu·∫£ truy v·∫•n.

- ƒê·ªãnh danh th∆∞·ªùng ƒë∆∞·ª£c x√°c ƒë·ªãnh b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªôt gi√° tr·ªã duy nh·∫•t nh∆∞ m·ªôt kh√≥a (`key`). Trong React Query, `queryKey` c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c ƒë·ªãnh ƒë·ªãnh danh cho m·ªôt truy v·∫•n. `queryKey` c√≥ th·ªÉ l√† m·ªôt m·∫£ng (array) ch·ª©a c√°c gi√° tr·ªã nh∆∞ t√™n truy v·∫•n v√† c√°c tham s·ªë ƒëi k√®m, ho·∫∑c c√≥ th·ªÉ l√† m·ªôt gi√° tr·ªã duy nh·∫•t ƒë·∫°i di·ªán cho truy v·∫•n.

- Khi ƒë·ªãnh danh c·ªßa m·ªôt truy v·∫•n thay ƒë·ªïi, React Query s·∫Ω hi·ªÉu r·∫±ng ƒë√≥ l√† m·ªôt truy v·∫•n m·ªõi v√† s·∫Ω th·ª±c hi·ªán truy v·∫•n l·∫°i t·ª´ `server` thay v√¨ s·ª≠ d·ª•ng k·∫øt qu·∫£ t·ª´ b·ªô nh·ªõ `cache`. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng b·∫°n nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ `server` khi c√≥ s·ª± thay ƒë·ªïi trong ƒë·ªãnh danh c·ªßa truy v·∫•n.

## M·ªói gi√° tr·ªã ƒë·ªãnh danh ƒë√≥ th√¨ n√≥ s·∫Ω g√°n cho 1 id. C√≥ nghƒ©a l√† 1 d·ªØ li·ªáu ƒë∆∞·ª£c g√°n cho 1 id, c√≥ 10 d·ªØ li·ªáu th√¨ s·∫Ω g√°n cho 10 id h·∫£ ?

- ƒê√∫ng, trong React Query, m·ªói gi√° tr·ªã ƒë·ªãnh danh (`queryKey`) s·∫Ω ƒë∆∞·ª£c g√°n cho m·ªôt ID duy nh·∫•t ƒë·ªÉ x√°c ƒë·ªãnh truy v·∫•n d·ªØ li·ªáu t∆∞∆°ng ·ª©ng. Khi th·ª±c hi·ªán m·ªôt truy v·∫•n, React Query s·∫Ω s·ª≠ d·ª•ng ƒë·ªãnh danh ƒë·ªÉ x√°c ƒë·ªãnh xem truy v·∫•n ƒë√£ ƒë∆∞·ª£c th·ª±c hi·ªán tr∆∞·ªõc ƒë√≥ hay ch∆∞a.

- V√≠ d·ª•, n·∫øu b·∫°n c√≥ 10 d·ªØ li·ªáu v√† mu·ªën l·∫•y th√¥ng tin chi ti·∫øt v·ªÅ t·ª´ng d·ªØ li·ªáu, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `queryKey` v·ªõi m·ªôt gi√° tr·ªã duy nh·∫•t (v√≠ d·ª•: `'post'`) v√† k·∫øt h·ª£p n√≥ v·ªõi ID c·ªßa t·ª´ng b√†i vi·∫øt ƒë·ªÉ t·∫°o ra m·ªôt ƒë·ªãnh danh duy nh·∫•t cho t·ª´ng truy v·∫•n. ƒêi·ªÅu n√†y cho ph√©p React Query qu·∫£n l√Ω c√°c k·∫øt qu·∫£ truy v·∫•n ri√™ng bi·ªát cho t·ª´ng b√†i vi·∫øt.

- V√≠ d·ª•: `['post', 1]`, `['post', 2]`, `['post', 3]`, v.v. l√† c√°c ƒë·ªãnh danh duy nh·∫•t cho c√°c truy v·∫•n l·∫•y th√¥ng tin t·ª´ng b√†i vi·∫øt t∆∞∆°ng ·ª©ng.

## V√≠ d·ª• n√¢ng cao v·ªÅ useQuery trong react query ?

-

## T·ªïng quan v·ªÅ useMutation v√† useQuery trong react query ?

- `useMutation` v√† `useQuery` l√† hai hook quan tr·ªçng trong React Query. D∆∞·ªõi ƒë√¢y l√† t·ªïng quan v·ªÅ c·∫£ hai hook:

1. `useMutation`:

- `useMutation` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu `thay ƒë·ªïi` d·ªØ li·ªáu nh∆∞ t·∫°o m·ªõi, c·∫≠p nh·∫≠t ho·∫∑c x√≥a d·ªØ li·ªáu t·ª´ server.
- N√≥ nh·∫≠n v√†o m·ªôt h√†m `mutationFn` (ho·∫∑c promise) ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu.

- `useMutation` cung c·∫•p c√°c bi·∫øn v√† ph∆∞∆°ng th·ª©c ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa y√™u c·∫ßu, nh∆∞ `isLoading`, `isError`, `error`, `data`, `mutate`, `reset`, v√† nhi·ªÅu h∆°n n·ªØa.

  - `mutate`: Ph∆∞∆°ng th·ª©c n√†y d√πng ƒë·ªÉ k√≠ch ho·∫°t qu√° tr√¨nh mutation. B·∫°n c√≥ th·ªÉ truy·ªÅn v√†o d·ªØ li·ªáu c·∫ßn thay ƒë·ªïi v√† n√≥ s·∫Ω g·ª≠i y√™u c·∫ßu t·ªõi server ƒë·ªÉ th·ª±c hi·ªán mutation.
  - `isLoading, isError, isSuccess`: C√°c tr·∫°ng th√°i n√†y x√°c ƒë·ªãnh tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa qu√° tr√¨nh mutation (ƒëang t·∫£i, c√≥ l·ªói, th√†nh c√¥ng).
  - `error`: N·∫øu c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh mutation, th√¥ng tin l·ªói s·∫Ω ƒë∆∞·ª£c l∆∞u trong bi·∫øn error.
  - `reset`: Ph∆∞∆°ng th·ª©c n√†y d√πng ƒë·ªÉ ƒë·∫∑t l·∫°i tr·∫°ng th√°i c·ªßa mutation v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.

- B·∫±ng c√°ch s·ª≠ d·ª•ng `mutate`, ch√∫ng ta c√≥ th·ªÉ g·ª≠i y√™u c·∫ßu thay ƒë·ªïi d·ªØ li·ªáu m·ªôt c√°ch b·∫•t ƒë·ªìng b·ªô v√† qu·∫£n l√Ω tr·∫°ng th√°i y√™u c·∫ßu d·ªÖ d√†ng.

2. `useQuery`:

- `useQuery` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu `l·∫•y` d·ªØ li·ªáu t·ª´ server.
- N√≥ nh·∫≠n v√†o m·ªôt `queryKey` ƒë·ªÉ ƒë·ªãnh danh cho y√™u c·∫ßu v√† m·ªôt `queryFn` (ho·∫∑c promise) ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu l·∫•y d·ªØ li·ªáu.

- `useQuery` cung c·∫•p c√°c bi·∫øn v√† ph∆∞∆°ng th·ª©c ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa y√™u c·∫ßu, nh∆∞ `isLoading`, `isError`, `error`, `data`, `refetch`, `reset`, v√† nhi·ªÅu h∆°n n·ªØa.

  - `data`: D·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ server ƒë∆∞·ª£c l∆∞u trong bi·∫øn `data`.
  - `isLoading, isError, isSuccess`: C√°c tr·∫°ng th√°i n√†y x√°c ƒë·ªãnh tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa qu√° tr√¨nh truy v·∫•n (ƒëang t·∫£i, c√≥ l·ªói, th√†nh c√¥ng).
  - `error`: N·∫øu c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh truy v·∫•n, th√¥ng tin l·ªói s·∫Ω ƒë∆∞·ª£c l∆∞u trong bi·∫øn error.
  - `refetch`: Ph∆∞∆°ng th·ª©c n√†y d√πng ƒë·ªÉ l√†m m·ªõi truy v·∫•n, g·ª≠i y√™u c·∫ßu l√™n server ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi.
  - `invalidateQueries`: Ph∆∞∆°ng th·ª©c n√†y d√πng ƒë·ªÉ ƒë√°nh d·∫•u c√°c truy v·∫•n li√™n quan l√† kh√¥ng h·ª£p l·ªá, y√™u c·∫ßu truy v·∫•n l·∫°i d·ªØ li·ªáu t·ª´ server.

- Khi s·ª≠ d·ª•ng `useQuery`, React Query s·∫Ω t·ª± ƒë·ªông qu·∫£n l√Ω b·ªô nh·ªõ cache v√† s·ª≠ d·ª•ng d·ªØ li·ªáu ƒë√£ l∆∞u tr·ªØ trong cache n·∫øu c√≥, gi√∫p t·ªëi ∆∞u hi·ªáu su·∫•t v√† gi·∫£m s·ªë l·∫ßn g·ª≠i y√™u c·∫ßu l·∫∑p l·∫°i.

- C·∫£ hai hook ƒë·ªÅu gi√∫p ch√∫ng ta qu·∫£n l√Ω tr·∫°ng th√°i y√™u c·∫ßu d·ªÖ d√†ng v√† t·ª± ƒë·ªông, h·ªó tr·ª£ t·∫£i d·ªØ li·ªáu b·∫•t ƒë·ªìng b·ªô, qu·∫£n l√Ω cache v√† cung c·∫•p c√°c ph∆∞∆°ng th·ª©c ti·ªán √≠ch ƒë·ªÉ thao t√°c v·ªõi d·ªØ li·ªáu. S·ª≠ d·ª•ng `useMutation` v√† `useQuery` trong React Query gi√∫p t·∫°o ra tr·∫£i nghi·ªám t·ªët h∆°n cho vi·ªác l√†m vi·ªác v·ªõi d·ªØ li·ªáu trong ·ª©ng d·ª•ng React.

## T√≥m l·∫°i l√† khi s·ª≠ d·ª•ng `useMutation` l√† bao g·ªìm POST, PUT, DELETE. C√≤n khi s·ª≠ d·ª•ng `useQuery` l√† s·ª≠ d·ª•ng GET ?

- ƒê√∫ng, khi s·ª≠ d·ª•ng `useMutation` trong React Query, ch√∫ng ta th∆∞·ªùng s·ª≠ d·ª•ng n√≥ ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu `thay ƒë·ªïi` d·ªØ li·ªáu nh∆∞ t·∫°o m·ªõi (POST), c·∫≠p nh·∫≠t (PUT/PATCH) v√† x√≥a (DELETE). ƒêi·ªÅu n√†y l√† do c√°c y√™u c·∫ßu n√†y th∆∞·ªùng li√™n quan ƒë·∫øn vi·ªác `thay ƒë·ªïi` d·ªØ li·ªáu tr√™n server.

- Trong khi ƒë√≥, khi s·ª≠ d·ª•ng `useQuery`, ch√∫ng ta th∆∞·ªùng s·ª≠ d·ª•ng n√≥ ƒë·ªÉ th·ª±c hi·ªán y√™u c·∫ßu `l·∫•y` d·ªØ li·ªáu t·ª´ server, ƒëi·ªÉn h√¨nh l√† y√™u c·∫ßu GET. Ch√∫ng ta s·ª≠ d·ª•ng `useQuery` ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ server v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa y√™u c·∫ßu, bao g·ªìm tr·∫°ng th√°i t·∫£i d·ªØ li·ªáu (`isLoading`), tr·∫°ng th√°i l·ªói (`isError`), d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l·∫•y (`data`), v√† nhi·ªÅu thu·ªôc t√≠nh v√† ph∆∞∆°ng th·ª©c kh√°c.

- Tuy nhi√™n, trong th·ª±c t·∫ø, kh√¥ng c√≥ quy t·∫Øc c·ª©ng v√† nhanh ch√≥ng r·∫±ng `useMutation` ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho POST, PUT v√† DELETE, v√† `useQuery` ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho GET. Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng c·∫£ hai hook ƒë·ªÉ th·ª±c hi·ªán c√°c y√™u c·∫ßu t√πy ch·ªânh v√† ph√π h·ª£p v·ªõi nhu c·∫ßu c·ª• th·ªÉ c·ªßa ·ª©ng d·ª•ng c·ªßa ch√∫ng ta. M·ª•c ƒë√≠ch ch√≠nh c·ªßa React Query l√† h·ªó tr·ª£ vi·ªác l√†m vi·ªác v·ªõi d·ªØ li·ªáu b·∫•t ƒë·ªìng b·ªô v√† qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa c√°c y√™u c·∫ßu d·ªÖ d√†ng v√† hi·ªáu qu·∫£.

## React Toastify l√† g√¨ ?

- React Toastify l√† m·ªôt th∆∞ vi·ªán React ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã c√°c th√¥ng b√°o (toasts) trong ·ª©ng d·ª•ng web. N√≥ cung c·∫•p c√°c th√†nh ph·∫ßn v√† API ƒë∆°n gi·∫£n ƒë·ªÉ t·∫°o ra c√°c th√¥ng b√°o ƒë·∫πp, linh ho·∫°t v√† d·ªÖ s·ª≠ d·ª•ng.

- V·ªõi React Toastify, b·∫°n c√≥ th·ªÉ hi·ªÉn th·ªã c√°c th√¥ng b√°o t·∫°m th·ªùi trong g√≥c m√†n h√¨nh, th√¥ng b√°o l·ªói, th√¥ng b√°o th√†nh c√¥ng, th√¥ng b√°o c·∫£nh b√°o v√† nhi·ªÅu lo·∫°i th√¥ng b√°o kh√°c. B·∫°n c√≥ th·ªÉ t√πy ch·ªânh c√°c th√¥ng b√°o theo √Ω mu·ªën, bao g·ªìm n·ªôi dung, ki·ªÉu, th·ªùi gian t·ªìn t·∫°i, h√†nh ƒë·ªông, h√¨nh ·∫£nh v√† nhi·ªÅu thu·ªôc t√≠nh kh√°c.

- React Toastify cung c·∫•p m·ªôt API ƒë∆°n gi·∫£n ƒë·ªÉ t·∫°o ra c√°c th√¥ng b√°o b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c h√†m nh∆∞ `toast.success()`, `toast.error()`, `toast.warning()` v√† `toast.info()`. N√≥ c≈©ng cung c·∫•p c√°c hook nh∆∞ `useToast()` ƒë·ªÉ t·∫°o ra c√°c th√¥ng b√°o t·ª´ c√°c th√†nh ph·∫ßn React.

- Th∆∞ vi·ªán n√†y gi√∫p c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v√† tƒÉng t√≠nh t∆∞∆°ng t√°c trong ·ª©ng d·ª•ng c·ªßa b·∫°n b·∫±ng c√°ch cung c·∫•p c√°c th√¥ng b√°o h·ªØu √≠ch v√† h·∫•p d·∫´n cho ng∆∞·ªùi d√πng.

## cho v√≠ d·ª• c∆° b·∫£n v·ªÅ React Toastify ?

- ƒê·ªÉ s·ª≠ d·ª•ng React Toastify, b·∫°n c·∫ßn c√†i ƒë·∫∑t th∆∞ vi·ªán `react-toastify` v√† import c√°c th√†nh ph·∫ßn c·∫ßn thi·∫øt. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• c∆° b·∫£n v·ªÅ vi·ªác s·ª≠ d·ª•ng React Toastify ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng:

```jsx
import React from 'react'
import { toast, ToastContainer } from 'react-toastify'
import 'react-toastify/dist/ReactToastify.css'

const ExampleComponent = () => {
  const handleButtonClick = () => {
    toast.success('Thao t√°c th√†nh c√¥ng!')
  }

  return (
    <div>
      <button onClick={handleButtonClick}>Hi·ªÉn th·ªã th√¥ng b√°o</button>
      <ToastContainer />
    </div>
  )
}

export default ExampleComponent
```

- Trong v√≠ d·ª• tr√™n, ch√∫ng ta import th√†nh ph·∫ßn `toast` v√† `ToastContainer` t·ª´ `react-toastify`. H√†m `toast.success()` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng khi ng∆∞·ªùi d√πng nh·∫•p v√†o n√∫t. `ToastContainer` ƒë∆∞·ª£c ƒë·∫∑t trong th√†nh ph·∫ßn ƒë·ªÉ ch·ª©a v√† hi·ªÉn th·ªã c√°c th√¥ng b√°o.

- B·∫°n c√≥ th·ªÉ thay ƒë·ªïi ki·ªÉu th√¥ng b√°o b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c h√†m kh√°c nh∆∞ `toast.error()` (th√¥ng b√°o l·ªói), `toast.warning()` (th√¥ng b√°o c·∫£nh b√°o) v√† `toast.info()` (th√¥ng b√°o th√¥ng tin). B·∫°n c≈©ng c√≥ th·ªÉ t√πy ch·ªânh n·ªôi dung v√† c√°c thu·ªôc t√≠nh kh√°c c·ªßa th√¥ng b√°o theo √Ω mu·ªën.

- L∆∞u √Ω r·∫±ng b·∫°n c·∫ßn import CSS c·ªßa React Toastify (`react-toastify/dist/ReactToastify.css`) ƒë·ªÉ ƒë·∫£m b·∫£o giao di·ªán c·ªßa th√¥ng b√°o ƒë∆∞·ª£c hi·ªÉn th·ªã ƒë√∫ng c√°ch.

- ƒê√¢y ch·ªâ l√† m·ªôt v√≠ d·ª• ƒë∆°n gi·∫£n v·ªÅ c√°ch s·ª≠ d·ª•ng React Toastify. Th∆∞ vi·ªán n√†y c√≤n r·∫•t nhi·ªÅu t√≠nh nƒÉng v√† t√πy ch·ªçn ƒë·ªÉ b·∫°n kh√°m ph√° v√† t√πy ch·ªânh theo nhu c·∫ßu c·ªßa m√¨nh.

## ƒê√¢y l√† Docs c·ªßa ƒê∆∞·ª£c Dev:

TI·∫øp n·ªëi video l·∫ßn tr∆∞·ªõc, l·∫ßn n√†y ch√∫ng ta s·∫Ω th·ª±c hi·ªán ch·ª©c nƒÉng Edit v√† Delete Student b·∫±ng React Query nh√©.

üíìKi·∫øn th·ª©c c√°c b·∫°n s·∫Ω ƒë∆∞·ª£c h·ªçc trong video n√†y:

üéâ S·ª≠ d·ª•ng react router k·∫øt h·ª£p v·ªõi react query
üéâ useMutation v√† useQuery
üéâ React Toastify

üï∞Ô∏èN·ªôi dung ch√≠nh

00:00 - Edit Student
15:50 - S·ª≠ d·ª•ng React Toastify
18:40 - X·ª≠ l√Ω l·ªói submit t·ª´ server tr·∫£ v·ªÅ
22:11 - Delete Student
